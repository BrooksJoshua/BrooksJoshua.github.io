<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Designpatterns</title>
    <url>/2020/10/05/designpatterns/</url>
    <content><![CDATA[<p>本博客对Java中常见的设计模式进行简要的介绍汇总.</p>
<a id="more"></a>

<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>很多场景下我们只需要一个该类型的对象, 比如: 线程池(ThreadPool), 缓存(Cache), 对话框(Dialog), 处理偏好设置和注册表(Registry)的对象, 日志对象, 充当打印机/显卡等设备的驱动程序的对象等等. 事实上, 这类对象也<strong>只能</strong> 有一个实例, 如果多了就会导致许多问题. 比如: 程序异常, 资源使用过量, 结果不一致等. 那么这种只需要一个实例对象的编程模式在软件工程上被抽象为单例模式.</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>单例模式是一种常用的软件设计模式，其定义是单例对象的类只能允许一个实例存在。</p>
<h2 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h2><p>单例模式的基本思路就是在类中想构造函数私有化, 然后提供一个public的获取实例对象的方法让外部获取, 并且确保外部多次获取返回的都是同一个对象.</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><h3 id="一-饿汉式"><a href="#一-饿汉式" class="headerlink" title="一. 饿汉式"></a>一. 饿汉式</h3><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr01</span> </span>&#123;</span><br><span class="line">  	<span class="function"><span class="keyword">private</span> <span class="title">Mgr01</span><span class="params">()</span> </span>&#123;&#125;;  <span class="comment">//step 1. 构造函数私有化, 保证外部(其他类无法通过new的方式创建对象) </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Mgr01 INSTANCE = <span class="keyword">new</span> Mgr01();<span class="comment">//step 2. 内部创建静态实例, static保证了类一加载就实例化, , final保证了实例的唯一性 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Mgr01 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;   <span class="comment">//step 3. 返回step2创建的实例, 并将该方法对外开放.</span></span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Mgr01 m1 = Mgr01.getInstance();</span><br><span class="line">        Mgr01 m2 = Mgr01.getInstance();</span><br><span class="line">        System.out.println(m1 == m2);       <span class="comment">//true </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><p>类加载到内存后，就实例化一个单例，JVM保证线程安全<br>简单实用，推荐使用！<br>唯一缺点：不管用到与否，类装载时就完成实例化<br>Class.forName(“”)<br>（话说你不用的，你装载它干啥）</p>
<h3 id="二-饿汉式变体"><a href="#二-饿汉式变体" class="headerlink" title="二. 饿汉式变体"></a>二. 饿汉式变体</h3><h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dp.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跟01是一个意思</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr02</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Mgr02 INSTANCE;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        INSTANCE = <span class="keyword">new</span> Mgr02();   <span class="comment">//通过静态代码块的方式初始化实例INSTANCE, 本质和饿汉式一样</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Mgr02</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Mgr02 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Mgr02 m1 = Mgr02.getInstance();</span><br><span class="line">        Mgr02 m2 = Mgr02.getInstance();</span><br><span class="line">        System.out.println(m1 == m2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三-懒汉式"><a href="#三-懒汉式" class="headerlink" title="三. 懒汉式"></a>三. 懒汉式</h3><h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * lazy loading</span></span><br><span class="line"><span class="comment"> * 也称懒汉式</span></span><br><span class="line"><span class="comment"> * 虽然达到了按需初始化的目的，但却带来线程不安全的问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr03</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Mgr03 INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Mgr03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Mgr03 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;       <span class="comment">// 多线程调用该方法时, 可能存在某个线程判断完INSTANCE == null之后, 返回实例之前被其他线程抢占资源,再判断</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> Mgr03();  <span class="comment">// 最终造成这里会执行两次实例化</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;</span><br><span class="line">                    System.out.println(Mgr03.getInstance().hashCode())</span><br><span class="line">            ).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><p>虽然达到了按需初始化的目的，但却带来线程不安全的问题, 如下图:</p>
<p><img src="/2020/10/05/designpatterns/%E5%8D%95%E4%BE%8B_%E6%87%92%E6%B1%89%E5%BC%8F.png" alt="单例_懒汉式"></p>
<h4 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h4><p><img src="/2020/10/05/designpatterns/%E5%8D%95%E4%BE%8B_%E6%87%92%E6%B1%89%E5%BC%8F_%E7%BB%93%E6%9E%9C.png" alt="单例_懒汉式_结果"> </p>
<h3 id="四-懒汉式变体-线程安全但低效"><a href="#四-懒汉式变体-线程安全但低效" class="headerlink" title="四. 懒汉式变体(线程安全但低效)"></a>四. 懒汉式变体(线程安全但低效)</h3><p>懒汉式的改进, 满足线程安全</p>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dp.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * lazy loading</span></span><br><span class="line"><span class="comment"> * 也称懒汉式</span></span><br><span class="line"><span class="comment"> * 虽然达到了按需初始化的目的，但却带来线程不安全的问题</span></span><br><span class="line"><span class="comment"> * 可以通过synchronized解决，但也带来效率下降</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr04</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Mgr04 INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Mgr04</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Mgr04 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  <span class="comment">//Mgr03版本的优化, 能够做到线程安全</span></span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> Mgr04();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"m"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                System.out.println(Mgr04.getInstance().hashCode());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h4><p>虽然懒汉式达到了按需初始化的目的，但却带来线程不安全的问题, 该版本就是通过将懒汉式的getInstance方法同步化(synchronized)来解决线程安全的问题的. </p>
<p>但这同时也带来效率下降</p>
<h3 id="五-懒汉式变体-高效但线程不安全"><a href="#五-懒汉式变体-高效但线程不安全" class="headerlink" title="五. 懒汉式变体(高效但线程不安全)"></a>五. 懒汉式变体(高效但线程不安全)</h3><h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dp.singleton;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr05</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Mgr05 INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Mgr05</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Mgr05 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;  <span class="comment">// 此处还是会存在线程不安全隐患</span></span><br><span class="line">            <span class="comment">//妄图通过减小同步代码块的方式提高效率，然后不可行</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Mgr05<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                INSTANCE = <span class="keyword">new</span> Mgr05();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"m"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                System.out.println(Mgr05.getInstance().hashCode());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="特点-3"><a href="#特点-3" class="headerlink" title="特点"></a>特点</h4><p>为了尝试优化Mgr04的低效特点, 尝试将同步代码范围缩小以提上效率. 所以将同步函数变为了同步代码块. 但是, 此时 <code>if(INSTANCE==null)</code>的判断不属于同步块之后会造成线程安全隐患. 所以依旧不可取.</p>
<h3 id="六-懒汉式变体-高效-amp-安全"><a href="#六-懒汉式变体-高效-amp-安全" class="headerlink" title="六. 懒汉式变体(高效&amp;安全)"></a>六. 懒汉式变体(高效&amp;安全)</h3><h4 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr06</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Mgr06</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Mgr06 INSTANCE;    <span class="comment">//注意要加上volatile, 涉及到JIT指令重排的问题</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Mgr06 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;   <span class="comment">//双重判断</span></span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;		<span class="comment">// 第一次判断是否null主要能够起到提升效率的作用, 如果非空就直接返回, 否则才继续内层逻辑</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Mgr06<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123; <span class="comment">// 这层的判断</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                    INSTANCE = <span class="keyword">new</span> Mgr06();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                System.out.println(Mgr06.getInstance().hashCode());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="特点-4"><a href="#特点-4" class="headerlink" title="特点"></a>特点</h4><h3 id="V7-静态内部类方式"><a href="#V7-静态内部类方式" class="headerlink" title="V7 静态内部类方式"></a>V7 静态内部类方式</h3><h4 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dp.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态内部类方式</span></span><br><span class="line"><span class="comment"> * JVM保证单例</span></span><br><span class="line"><span class="comment"> * 加载外部类时不会加载内部类，这样可以实现懒加载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr07</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Mgr07</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Mgr07Holder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Mgr07 INSTANCE = <span class="keyword">new</span> Mgr07();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Mgr07 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Mgr07Holder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                System.out.println(Mgr07.getInstance().hashCode());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="特点-5"><a href="#特点-5" class="headerlink" title="特点"></a>特点</h4><p>JVM加载内部类时不会加载内部类, 所以 当Mgr07被加载时, Mgr07Holder 就不会被加载. 所以也就实现了懒加载. 另外, JVM加载某个类时只加载一次, 所以只有当外部用户调用Mgr07的getInstance方法时才会用到Mgr07Holder类, 才回去加载Mgr07Holder, 但是有只加载一次, 所以也*<em>保证了线程的安全性. *</em></p>
<h3 id="V8"><a href="#V8" class="headerlink" title="V8"></a>V8</h3><h4 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不仅可以解决线程同步，还可以防止反序列化。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Mgr08 &#123;  <span class="comment">//枚举类型反编译是一个抽象类, 所以从这点来看外部是无法通过new来获取其实例对象的.</span></span><br><span class="line"></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                System.out.println(Mgr08.INSTANCE.hashCode());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="特点-6"><a href="#特点-6" class="headerlink" title="特点"></a>特点</h4><p><strong>不仅可以解决线程同步，还可以防止反序列化.</strong></p>
<h3 id="单例总结"><a href="#单例总结" class="headerlink" title="单例总结"></a>单例总结</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 1. 实际工作中用的最多的还是饿汉式 Mgr01</span></span><br><span class="line"><span class="comment"> * 2. 语法最完美的是枚举V8版本,写法简单的同时满足线程同步和反序列化后对象和反序列化之前对象时同一个的问题. (JAVA创始人在 effective Java一书中提出的) </span></span><br><span class="line"><span class="comment"> * 3. 3--&gt;6 逐步优化的过程(即3,4,5为什么不可取的原因)是面试中最常问的. </span></span><br><span class="line"><span class="comment"> * 4. 1, 6, 7, 8 做到默写</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h1 id="Strategy策略"><a href="#Strategy策略" class="headerlink" title="Strategy策略"></a>Strategy策略</h1><h2 id="Scenario"><a href="#Scenario" class="headerlink" title="Scenario"></a>Scenario</h2><p>比如说有这样一个场景: </p>
<p>首先需要对int 类型的一个数组<code>int[] arr</code>进行排序, 比较自然的想法就是定义一个工具类Sorter.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] arr)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;arr.length; j++) &#123;</span><br><span class="line">                minPos = arr[j]&lt;arr[minPos] ? j : minPos;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在需要对数组进行排序的时候调用<code>sort(int[] arr)</code>方法即可. 如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr=&#123;<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">10</span>&#125;;</span><br><span class="line">        Sorter sorter = <span class="keyword">new</span> Sorter();</span><br><span class="line">        sorter.sort(arr); <span class="comment">// 调用排序</span></span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行上面的代码确实能达到排序的目的</p>
<p><img src="/2020/10/05/designpatterns/%E7%AD%96%E7%95%A5_1%E5%88%9D%E5%A7%8B%E6%8E%92%E5%BA%8FintArray.png" alt="策略_1初始排序"></p>
<h2 id="Extension"><a href="#Extension" class="headerlink" title="Extension"></a>Extension</h2><p>那么 问题来了, 如果再想对double类型数组排序, 该怎么办呢? 就只能重写Sort类或者重载里面的sort方法:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] arr)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;arr.length; j++) &#123;</span><br><span class="line">                minPos = arr[j]&lt;arr[minPos] ? j : minPos;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">double</span>[] arr)</span>  </span>&#123;    <span class="comment">// 新增可以对double[]类型排序的方法</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;arr.length; j++) &#123;</span><br><span class="line">                minPos = arr[j]&lt;arr[minPos] ? j : minPos;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">double</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;   <span class="comment">//新增</span></span><br><span class="line">        <span class="keyword">double</span> temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后需要对double进行排序时进行调用sort(double[] arr_d)即可, 如下:</p>
<p><img src="/2020/10/05/designpatterns/%E7%AD%96%E7%95%A5_1%E5%88%9D%E5%A7%8B%E6%8E%92%E5%BA%8FdoubleArray.png" alt="策略_1初始排序"></p>
<h2 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h2><p>那么如果是对猫Cat, 狗Dog, 人Person进行排序, 是不是也要进行相应类型的重载sort(Type[] t)才能达到目的呢?</p>
<p>所以, 就有了这样一种想法, 能不能重新定义sort方法里面的比较大小, 不是直接按照大小, 而是可以根据各自类型的特有属性去个性化比较, 比如比较猫时按照年龄比较, 比较狗时按照体重比价, 那就就有了下面的代码</p>
<p>​    step 1 定义类型的比较方法, 猫按照年龄比较</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Cat&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Cat c)</span></span>&#123;    <span class="comment">// 对猫进行比较"大小"的方法</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.age &lt; c.age) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.age &gt; c.age) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在sort(Cat[] c)方法比较方式进行修改</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Cat[] arr)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;arr.length; j++) &#123;</span><br><span class="line">                <span class="comment">// 以前是直接 arr[i]&lt;arr[j] 比较, 现在是调用Cat的compareTo方法比较</span></span><br><span class="line">                minPos = arr[j].compareTo(arr[minPos])==-<span class="number">1</span> ? j : minPos;   </span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(Cat[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        Cat temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Almighty-Adapter"><a href="#Almighty-Adapter" class="headerlink" title="Almighty-Adapter"></a>Almighty-Adapter</h2><p>但是似乎又忘了, 一开始, 我们是想让sort方法适应所有类型, 而不是某一种类型. 所以对sort(Cat[] c)方法进行类型适配是必须的.</p>
<p>因为是适配所有类型, 所以很自然的想到适配sort(Object[] obj)的样子, 但是obj并没有compareTo方法. 所以我们的想法是, 自定义一个接口不妨叫Comparable, 里面有一个compareTo方法. 然后有排序需求的实体类必须<code>implements Comparable</code> 实现该接口, 实现其<code>compareTo()</code>方法, sort方法重写成<code>sort(Comparable[] c)</code>的形式, 即可排序.</p>
<p>所以总体需要如下3个步骤:</p>
<p>step 1. 自定义接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object[] obj)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>step 2. 实体类实现接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Comparable</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> height ;</span><br><span class="line">    <span class="keyword">int</span> weight ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(<span class="keyword">int</span> height, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Dog&#123;"</span> +</span><br><span class="line">                <span class="string">"height="</span> + height +</span><br><span class="line">                <span class="string">", weight="</span> + weight +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        Dog d=(Dog) obj;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.weight&lt;d.weight)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.weight&gt;d.weight)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>step 3 重写sort方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] arr)</span>  </span>&#123;   <span class="comment">//注意此处是Comparable[] 类型, 因为我们在自定义的接口里面定义了compareTo方法.</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;arr.length; j++) &#123;</span><br><span class="line">                minPos = arr[j].compareTo(arr[minPos])==-<span class="number">1</span> ? j : minPos;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(Object[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        Object temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>step 4 调用验证</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">          Sorter sorter = <span class="keyword">new</span> Sorter();</span><br><span class="line">          Cat[] cats=&#123;<span class="keyword">new</span> Cat(<span class="string">"Alex"</span>,<span class="number">3</span>), <span class="keyword">new</span> Cat(<span class="string">"Brox"</span>,<span class="number">2</span>),<span class="keyword">new</span> Cat(<span class="string">"Joshua"</span>,<span class="number">4</span>), <span class="keyword">new</span> Cat(<span class="string">"Ted"</span>,<span class="number">1</span>)&#125;;</span><br><span class="line">          sorter.sort(cats);</span><br><span class="line">          System.out.println(Arrays.toString(cats));</span><br><span class="line"></span><br><span class="line">          Dog[] dogs=&#123;<span class="keyword">new</span> Dog(<span class="number">5</span>,<span class="number">10</span>),<span class="keyword">new</span> Dog(<span class="number">7</span>,<span class="number">8</span>),<span class="keyword">new</span> Dog(<span class="number">6</span>,<span class="number">9</span>)&#125;;</span><br><span class="line">          sorter.sort(dogs);</span><br><span class="line">          System.out.println(Arrays.toString(dogs));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/05/designpatterns/%E7%AD%96%E7%95%A5_2%E9%80%82%E9%85%8DObject%E6%8E%92%E5%BA%8F.png" alt="策略_2适配Object排序"></p>
<h2 id="Generic"><a href="#Generic" class="headerlink" title="Generic"></a>Generic</h2><p>但是这种方式有一个弊端: 因为对Object做的适配是通过Comparable接口里的(int compareTo(Object[] obj); 实现的, 那么每次实体类实现接口compareTo方法时, 第一时间都要做一次类型强转如: Dog d=(Dog) obj; 那么有没有办法能避免这种冗余操作呢?  聪明的你可能已经想到了使用泛型即可完成这种功能.</p>
<p>所以重新调整上面的代码:</p>
<p>step 1. 接口泛型化</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>step 2. Sort (和上一版本保持一致即可)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] arr)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;arr.length; j++) &#123;</span><br><span class="line">                minPos = arr[j].compareTo(arr[minPos])==-<span class="number">1</span> ? j : minPos;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(Object[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        Object temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>step 3. 实体类泛化</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Dog</span>&gt;</span>&#123;  <span class="comment">// Comparable&lt;Dog&gt; 泛型填充具体的Dog</span></span><br><span class="line">    <span class="keyword">int</span> height ;</span><br><span class="line">    <span class="keyword">int</span> weight ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(<span class="keyword">int</span> height, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Dog&#123;"</span> +</span><br><span class="line">                <span class="string">"height="</span> + height +</span><br><span class="line">                <span class="string">", weight="</span> + weight +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Dog d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.weight&lt;d.weight)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.weight&gt;d.weight)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>step 4 调用验证:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">          Sorter sorter = <span class="keyword">new</span> Sorter();</span><br><span class="line">          Cat[] cats=&#123;<span class="keyword">new</span> Cat(<span class="string">"Alex"</span>,<span class="number">3</span>), <span class="keyword">new</span> Cat(<span class="string">"Brox"</span>,<span class="number">2</span>),<span class="keyword">new</span> Cat(<span class="string">"Joshua"</span>,<span class="number">4</span>), <span class="keyword">new</span> Cat(<span class="string">"Ted"</span>,<span class="number">1</span>)&#125;;</span><br><span class="line">          sorter.sort(cats);</span><br><span class="line">          System.out.println(Arrays.toString(cats));</span><br><span class="line"></span><br><span class="line">          Dog[] dogs=&#123;<span class="keyword">new</span> Dog(<span class="number">5</span>,<span class="number">10</span>),<span class="keyword">new</span> Dog(<span class="number">7</span>,<span class="number">8</span>),<span class="keyword">new</span> Dog(<span class="number">6</span>,<span class="number">9</span>)&#125;;</span><br><span class="line">          sorter.sort(dogs);</span><br><span class="line">          System.out.println(Arrays.toString(dogs));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 发现也能实现最终排序功能</p>
<p><img src="/2020/10/05/designpatterns/%E7%AD%96%E7%95%A5_2%E9%80%82%E9%85%8DObject%E6%8E%92%E5%BA%8F.png" alt="策略_2适配Object排序"></p>
<h2 id="策略"><a href="#策略" class="headerlink" title="策略"></a><span style="color:red">策略</span></h2><p><strong>截止目前, 虽然对比较类型做了泛化让其适配所有类型, 只要该类型实现了Comparable接口及其compareTo方法即可. 但是灵活性还是不够高, 如果想使用身高height(而不是原来的体重weight)对狗进行比较, 即提高比较本身灵活性, 改变比较的策略, 又该怎么做呢 ? 这才真正引出<span style="color:red">策略模式</span>.</strong></p>
<p>那么如何才能根据用户需求进行个性化的比较策略的切换以期达到灵活比较的目标呢? 这就需要用户将策略类型作为参数传进比较方法.</p>
<p>Step 1. 定义Comparator接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparator</span>&lt;<span class="title">T</span>&gt; </span>&#123;  <span class="comment">//也需要泛化, 因为类型的匹配还是需要的</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(T o1, T o2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Step 2. 定义策略类型 </p>
<p>需要什么类型就定义什么类型比如下面定义了两种, DogComparator1 按体重weight比较.DogComparator2 按体重height比较.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 策略一: weight*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogComparator1</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Dog</span>&gt; </span>&#123; <span class="comment">//DogComparator1具体比较策略的实现, 按体重</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Dog dogA, Dog dogB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dogA.weight &lt; dogB.weight) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dogA.weight &gt; dogB.weight) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 策略一: height*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogComparator2</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Dog</span>&gt; </span>&#123; <span class="comment">//DogComparator2具体比较策略的实现, 按身高</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Dog dogA, Dog dogB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dogA.height &lt; dogB.height) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dogA.height &gt; dogB.height) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Step 3 Sorter方法应用策略</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(T[] arr, Comparator&lt;T&gt; ct)</span> </span>&#123;   <span class="comment">// sort方法里定义了不同的策略类型comparator参数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> minPos = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">                <span class="comment">//minPos = arr[j].compareTo(arr[minPos])==-1 ? j : minPos;</span></span><br><span class="line">                minPos = ct.compare(arr[j],arr[minPos])==-<span class="number">1</span> ? j : minPos;   <span class="comment">//注意这里比较是用comparator的compare方法进行比较. </span></span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minPos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(T[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        T temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Step 4. 调用验证</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.tank.designPatterns.Strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Sorter&lt;Dog&gt; dogSorter = <span class="keyword">new</span> Sorter&lt;&gt;();</span><br><span class="line">        Dog[] dogs=&#123;<span class="keyword">new</span> Dog(<span class="number">5</span>,<span class="number">10</span>),<span class="keyword">new</span> Dog(<span class="number">7</span>,<span class="number">8</span>),<span class="keyword">new</span> Dog(<span class="number">6</span>,<span class="number">9</span>)&#125;;</span><br><span class="line">        dogSorter.sort(dogs, <span class="keyword">new</span> DogComparator1());		<span class="comment">// 排序时需要什么策略就传什么策略</span></span><br><span class="line">        System.out.println(<span class="string">"按1 weight排序:\n"</span>+Arrays.toString(dogs));</span><br><span class="line"></span><br><span class="line">        dogSorter.sort(dogs,  (dogA,dogB)-&gt;&#123;    <span class="comment">//因为comparator只有一个方法, 所以也可以用lambada表达式的写法传入第二个参数</span></span><br><span class="line">            <span class="keyword">if</span> (dogA.height &lt; dogB.height) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dogA.height &gt; dogB.height) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">"按2 height排序:\n"</span>+Arrays.toString(dogs));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2020/10/05/designpatterns/%E7%AD%96%E7%95%A5%E7%B1%BB%E5%9E%8B.png" alt="策略类型"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2020/10/05/designpatterns/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93.png" alt="策略模式总结"></p>
<p>工厂模式</p>
<p>门面</p>
<p>装饰器</p>
<p>责任链</p>
<p>观察者</p>
<p>组合模式</p>
<p>享元</p>
<p>代理(静/动)</p>
<p>迭代器</p>
<p>访问者</p>
<p>构建器</p>
<p>适配器</p>
<p>桥接</p>
<p>命令</p>
<p>原型(prototype)</p>
<p>备忘录</p>
<p>模板</p>
<p>状态</p>
<p>解释器</p>
<p>总结和6大设计原则</p>
]]></content>
      <categories>
        <category>Manual</category>
        <category>DesignPatterns</category>
      </categories>
      <tags>
        <tag>Manual</tag>
        <tag>DesignPatterns</tag>
      </tags>
  </entry>
  <entry>
    <title>Javabasics</title>
    <url>/2020/10/04/javabasics/</url>
    <content><![CDATA[<p>本博客是java基础教程系列的多线程章节.</p>
<a id="more"></a>

<h2 id="join"><a href="#join" class="headerlink" title="join"></a>join</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyThread t1 = <span class="keyword">new</span> MyThread(<span class="string">"子线程"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            t1.join();  <span class="comment">// t1调用join方法的效果就是等待t1线程执行完, 结束后才会释放,主线程才能执行</span></span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException ie)&#123;</span><br><span class="line">            ie.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"主线程获得执行权,继续执行..."</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span> ; i&lt;=<span class="number">100</span>;i++)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    MyThread(String s)&#123;<span class="keyword">super</span>(s);&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span> ; i&lt;=<span class="number">100</span>;i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">"I'm thread:"</span>+getName());</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"第"</span>+i+<span class="string">"次, 睡一会..."</span>);</span><br><span class="line">                sleep(<span class="number">50</span>);      <span class="comment">//</span></span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException ie)&#123;</span><br><span class="line">                ie.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>功能: 等待调用join方法的线程执行完, 才会释放,其他线程才能执行</p>
<p>效果图:</p>
<p><img src="/2020/10/04/javabasics/join.png" alt="join"></p>
<h2 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyThread2 t1 = <span class="keyword">new</span> MyThread2();</span><br><span class="line">        MyThread2 t2 = <span class="keyword">new</span> MyThread2();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">                System.out.println(getName()+<span class="string">", round:\t"</span>+i);</span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"changeing to ...."</span>);</span><br><span class="line">                    yield(); <span class="comment">//当前线程释放资源给其他线程执行, 只释放一次</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>功能:  <strong>当前线程释放资源给其他线程执行, 只释放一次</strong></p>
<p>效果图:</p>
<p><img src="/2020/10/04/javabasics/yield.png" alt="yield"></p>
<h2 id="优先级设置"><a href="#优先级设置" class="headerlink" title="优先级设置"></a>优先级设置</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> T1());</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> T2());</span><br><span class="line">        thread1.setPriority(Thread.MAX_PRIORITY);  <span class="comment">//设置后,1线程执行的时间分片明显比2长</span></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">1000</span>;i++)&#123;</span><br><span class="line">                System.out.println(<span class="string">"--------T1:\t"</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">1000</span>;i++)&#123;</span><br><span class="line">                System.out.println(<span class="string">"T2:\t"</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>功能: 为某线程设置优先级系数, 系数越大, 获得执行的时间分片就越大, 持续执行的时间就越长.</p>
<p>效果图: (线程1执行到16才给线程2执行1次, 然后1再获取到执行执行权再执行到27才给2执行1次)</p>
<p><img src="/2020/10/04/javabasics/%E4%BC%98%E5%85%88%E7%BA%A7.png" alt="优先级"></p>
<h2 id="售票问题"><a href="#售票问题" class="headerlink" title="售票问题"></a>售票问题</h2><h3 id="多批票"><a href="#多批票" class="headerlink" title="多批票"></a>多批票</h3><p>代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">int</span> num=<span class="number">100</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(num&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"...saled ticket No:\t"</span> + num--);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket t1 = <span class="keyword">new</span> Ticket(); <span class="comment">//多批票</span></span><br><span class="line">        Ticket t2 = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Ticket t3 = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Ticket t4 = <span class="keyword">new</span> Ticket();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行发现:</p>
<p><img src="/2020/10/04/javabasics/ticket1.png" alt="ticket1"></p>
<p>显然, 这种方式售票是不符合需求的, 因为 num 是Ticket的成员变量, 每次创建线程都会重新开辟空间, 分配一个新的地址来存储新的num并且存值100. </p>
<p>那么如何才能保证多个线程卖的是同样的100张票(而不是400张). 直观的想法是加上为num <code>static</code>关键字修饰, 使其为静态, 存在堆内存中,对象共享. </p>
<h3 id="static-保证同一批"><a href="#static-保证同一批" class="headerlink" title="static 保证同一批"></a>static 保证同一批</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> num=<span class="number">100</span>;  <span class="comment">//相较上面的代码仅仅多了一个static</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(num&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"...saled ticket No:\t"</span> + num--);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket t1 = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Ticket t2 = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Ticket t3 = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Ticket t4 = <span class="keyword">new</span> Ticket();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时再次运行检查, 发现能够满足需求. </p>
<p><img src="/2020/10/04/javabasics/ticket02.png" alt="ticket02"></p>
<p>但是现实情况是有可能是某些售票点卖的票是有特殊要求的. 虽然总数还是100, 但是有可能某售票点A(对应线程1)专门负责出售80-100号头等舱票. 那么<code>static</code>的方式显然也是不合适的.</p>
<h3 id="Runnable-封装票"><a href="#Runnable-封装票" class="headerlink" title="Runnable 封装票"></a>Runnable 封装票</h3><p>所以最符合需求的实现方式应该是将票单独封装.(实现Runnable接口的方式)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;  <span class="comment">// num=99时, 有可能线程一判断完num&gt;0,但是执行权释放, 线程2进来判断, num=99&gt;0, 所以线程2卖了99, num--变成98了, 然后将执行权释放此时线程1获得执行权, 接着上次判断完的, 直接卖99号票. 所以出现了同一张票被卖了多次的情况.  </span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"...saled ticket No:\t"</span> + num--);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t4 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时再运行发现: 同一张票被卖了多次的情况又发生了. </p>
<p><img src="/2020/10/04/javabasics/ticket03.png" alt="ticket03"></p>
<h3 id="同步synchronized方法-run上"><a href="#同步synchronized方法-run上" class="headerlink" title="同步synchronized方法(run上)"></a>同步synchronized方法(run上)</h3><p>为了解决上面的问题, 我们将买票的操作进行加锁同步化. 很直观的想法就是在run方法上加锁</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  <span class="comment">//run()方法同步synchronized</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"...saled ticket No:\t"</span> + num--);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t4 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然而, 在run()方法上同步synchronized并不能解决问题, 因为while(true)也被同步了, 即使线程0 sleep释放了执行权, 其他线程也得不到执行权, 进不来. 因为synchronized是加在run()方法上的, 所以只有当run()方法执行完之后其他线程才有机会获得执行权. 但是, 因为while(true)的存在, 线程0 永远都不会执行完run()方法.</p>
<p><img src="/2020/10/04/javabasics/ticket04.png" alt="ticket03"></p>
<h3 id="同步synchronized代码块"><a href="#同步synchronized代码块" class="headerlink" title="同步synchronized代码块"></a>同步synchronized代码块</h3><p>回头再分析Runnable单独封装的方法,  发现同一张票被卖了多次的情况的原因是, 卖票的动作非一行代码(不具备原子性), 所以, synchronized关键字加载需要具备原子性的业务代码上, 所以如下修改代码: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;  <span class="comment">// 将需要原子性的代码, 放在synchronized代码块中</span></span><br><span class="line">                <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">"...saled ticket No:\t"</span> + num--);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t4 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时, 再次运行, 发现一切正常, 完全满足需求. (既没有卖0,-1这种票的, 也没有同一张票被卖了多次的情况)</p>
<h3 id="同步synchronized方法-单独封装"><a href="#同步synchronized方法-单独封装" class="headerlink" title="同步synchronized方法(单独封装)"></a>同步synchronized方法(单独封装)</h3><p>其实, 更好的一种方法是将synchronized同步代码块中的动作单独封装成方法同步方法, 然后在 run()中调用该方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">         sale();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sale</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"...saled ticket No:\t"</span> + num--);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        Thread t4 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2020/10/04/javabasics/ticket05.png" alt="ticket05"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">线程安全问题产生的原因: (同时满足)</span></span><br><span class="line"><span class="comment">1. 多个线程操作同一共享数据</span></span><br><span class="line"><span class="comment">2. 操作共享数据的代码有多条.</span></span><br><span class="line"><span class="comment">也就是说: </span></span><br><span class="line"><span class="comment">当一个线程在执行操作共享数据的多行代码的过程中, 此时有另一个线程参与了运算, 就会导致</span></span><br><span class="line"><span class="comment">线程安全问题的产生.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">解决思路: </span></span><br><span class="line"><span class="comment">将多条操作共享数据的代码进行封装, 当前线程没执行完这段代码时, 其他线程都进不来, 无法</span></span><br><span class="line"><span class="comment">参与运算, </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Java中同步能解决该问题.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">同步好处: 保证线程安全.</span></span><br><span class="line"><span class="comment">同步弊端: 相对而言效率会低一些.</span></span><br><span class="line"><span class="comment">同步前提: 必须有多个线程使用同一个锁.  上面同步synchronized代码块案例中, </span></span><br><span class="line"><span class="comment">				 synchronized (this)&#123;...&#125; 的锁对象时this, 因为只有一个Ticket实例</span></span><br><span class="line"><span class="comment">				 对象, 所以能保证同一个锁, </span></span><br><span class="line"><span class="comment">				 </span></span><br><span class="line"><span class="comment">				 </span></span><br><span class="line"><span class="comment">				 </span></span><br><span class="line"><span class="comment">同步代码块的锁: 任意对象</span></span><br><span class="line"><span class="comment">同步函数: this</span></span><br><span class="line"><span class="comment">静态同步函数: CurrentObj.class</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="单例设计模式线程安全问题"><a href="#单例设计模式线程安全问题" class="headerlink" title="单例设计模式线程安全问题"></a>单例设计模式线程安全问题</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Single1</span> </span>&#123; <span class="comment">//饿汉式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Single1 s = <span class="keyword">new</span> Single1();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Single1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Single1 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Single2</span> </span>&#123; <span class="comment">//懒汉式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Single2 s = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Single2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Single2 <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="comment">//如果再多线程的run()方法中进行实例化操作,</span></span><br><span class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;  <span class="comment">//那么此处可能会出现线程不安全的情况, if判断完后, 返回实例之前, 有其他线程进入那么就会导致两个线程返回不同的实例, 单例模式就会被打破</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Single2();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Single3</span> </span>&#123; <span class="comment">//懒汉式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Single3 s = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Single3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Single3 <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="comment">//为了解决Single2的安全问题, 为该实例方法加上synchronized同步, 但是这又会导致效率下降 </span></span><br><span class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Single3();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Single4</span> </span>&#123; <span class="comment">//懒汉式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Single4 s = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Single4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  Single4 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(s==<span class="keyword">null</span>)&#123; <span class="comment">//提升效率</span></span><br><span class="line">          <span class="keyword">synchronized</span> (Single4<span class="class">.<span class="keyword">class</span>)</span>&#123; <span class="comment">//解决安全</span></span><br><span class="line">              <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">new</span> Single4();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span>  s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线程间通信的同步问题"><a href="#线程间通信的同步问题" class="headerlink" title="线程间通信的同步问题"></a>线程间通信的同步问题</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r=<span class="keyword">new</span> Resource();</span><br><span class="line">        In in = <span class="keyword">new</span> In(r);</span><br><span class="line">        Out out = <span class="keyword">new</span> Out(r);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(in);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(out);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span></span>&#123;</span><br><span class="line">      String name;</span><br><span class="line">      String sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">In</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line">    In(Resource r)&#123;</span><br><span class="line">        <span class="keyword">this</span>.r=r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(flag%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                r.name=<span class="string">"Lee"</span>;</span><br><span class="line">                r.sex=<span class="string">"man"</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                r.name=<span class="string">"艾洛"</span>;</span><br><span class="line">                r.sex=<span class="string">"女女女女女女女女"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          ++flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Out</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line">    Out(Resource r)&#123;</span><br><span class="line">        <span class="keyword">this</span>.r=r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">           System.out.println(r.sex+<span class="string">"............"</span>+r.name);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行上述代码发现线程不安全:</p>
<p><img src="/2020/10/04/javabasics/ticket6.png" alt="ticket6"></p>
<p>为了解决上面的问题, 所以把run方法里面的操作工资资源数据的逻辑代码进行同步化, 并且保证同步化的锁是同一把锁🔐.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r = <span class="keyword">new</span> Resource();</span><br><span class="line">        In in = <span class="keyword">new</span> In(r);</span><br><span class="line">        Out out = <span class="keyword">new</span> Out(r);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(in);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(out);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">In</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    In(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (r) &#123;      <span class="comment">// synchronized 需要同时作用于in和out, 并且使用同一把锁</span></span><br><span class="line">                <span class="keyword">if</span> (flag % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    r.name = <span class="string">"Lee"</span>;</span><br><span class="line">                    r.sex = <span class="string">"man"</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    r.name = <span class="string">"艾洛"</span>;</span><br><span class="line">                    r.sex = <span class="string">"女女女女女女女女"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">           ++flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Out</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Out(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (r) &#123;  <span class="comment">// synchronized 需要同时作用于in和out, 并且使用同一把锁</span></span><br><span class="line">                System.out.println(r.sex + <span class="string">"............"</span> + r.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/04/javabasics/ticket7.png" alt="ticket7"></p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>  但是如果我们的需求是男女输出是依次交替进行的, 而不是一批一批的.应该怎么办呢? 这就引出了<strong>等待唤醒机制</strong>, 即<code>wait-notify</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r = <span class="keyword">new</span> Resource();</span><br><span class="line">        In in = <span class="keyword">new</span> In(r);</span><br><span class="line">        Out out = <span class="keyword">new</span> Out(r);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(in);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(out);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String sex;</span><br><span class="line">    <span class="keyword">boolean</span> isWait=<span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">In</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    In(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">synchronized</span> (r) &#123;</span><br><span class="line">                <span class="keyword">if</span> (r.isWait) &#123;  <span class="comment">//虽然wait和notify是Object的方法, 但是因为这些方法是操作线程状态的, 所以必须指明要对那个线程进行操作. </span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        r.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (flag % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    r.name = <span class="string">"Lee"</span>;</span><br><span class="line">                    r.sex = <span class="string">"man"</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    r.name = <span class="string">"艾洛"</span>;</span><br><span class="line">                    r.sex = <span class="string">"女女女女女女女女"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                r.isWait = <span class="keyword">true</span>;</span><br><span class="line">                r.notify();</span><br><span class="line">            &#125;</span><br><span class="line">            ++flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Out</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Out(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">synchronized</span> (r) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!r.isWait) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        r.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(r.sex + <span class="string">"............"</span> + r.name);</span><br><span class="line">                r.isWait = <span class="keyword">false</span>;</span><br><span class="line">                r.notify();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行上述代码可以看到能满足我们交替输出男女的需求.</p>
<p><img src="/2020/10/04/javabasics/ticket8.png" alt="ticket8"></p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="生产者-消费者"><a href="#生产者-消费者" class="headerlink" title="生产者-消费者"></a>生产者-消费者</h2><h3 id="单个生产者-消费者"><a href="#单个生产者-消费者" class="headerlink" title="单个生产者-消费者"></a>单个生产者-消费者</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r = <span class="keyword">new</span> Resource(<span class="string">"烤鸭"</span>);</span><br><span class="line">        Producer p = <span class="keyword">new</span> Producer(r);</span><br><span class="line">        Consumer c = <span class="keyword">new</span> Consumer(r);</span><br><span class="line">        Thread t0 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        t0.start();</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isWait = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Resource</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">produde</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isWait) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        setCount(getCount() + <span class="number">1</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">",\t生产:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">true</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">consume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isWait) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">".................消费:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">false</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWait</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isWait;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWait</span><span class="params">(<span class="keyword">boolean</span> wait)</span> </span>&#123;</span><br><span class="line">        isWait = wait;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Producer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            r.produde();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Consumer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">           r.consume();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2020/10/04/javabasics/%E5%8D%95%E4%B8%AA%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85.png" alt="单个生产者消费者"></p>
<h3 id="多个生产者消费者-问题1"><a href="#多个生产者消费者-问题1" class="headerlink" title="多个生产者消费者(问题1)"></a>多个生产者消费者(问题1)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r = <span class="keyword">new</span> Resource(<span class="string">"烤鸭"</span>);</span><br><span class="line">        Producer p = <span class="keyword">new</span> Producer(r);</span><br><span class="line">        Consumer c = <span class="keyword">new</span> Consumer(r);</span><br><span class="line">        Thread t0 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        t0.start();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isWait = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Resource</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">produde</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isWait) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        setCount(getCount() + <span class="number">1</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">",\t生产:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">true</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">consume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isWait) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">".................消费:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">false</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWait</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isWait;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWait</span><span class="params">(<span class="keyword">boolean</span> wait)</span> </span>&#123;</span><br><span class="line">        isWait = wait;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Producer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            r.produde();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Consumer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">           r.consume();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/04/javabasics/%E5%A4%9A%E4%B8%AA%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85-%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9.png" alt="多个生产者消费者-重复消费"></p>
<p>产生该问题的原因是, notify()方法每次只唤醒的线程池中的一个线程, (t0,t1生产者线程, t2,t3消费者线程). 假如某一时刻, 只有t3拥有执行权, 执行完后notify, 唤醒的是t2, 而此时if(isWait) 不会重复判断标记. 那么就出现了重复消费, 同理, 也可能出现重复生产.</p>
<p>那么该怎么解决呢? </p>
<h3 id="多个生产者消费者-问题2"><a href="#多个生产者消费者-问题2" class="headerlink" title="多个生产者消费者(问题2)"></a>多个生产者消费者(问题2)</h3><p>可能有人会想到, 不用if, 而是改用while(isWait)来判断标记, 保证每个被唤醒的线程都会重复判断标记. </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r = <span class="keyword">new</span> Resource(<span class="string">"烤鸭"</span>);</span><br><span class="line">        Producer p = <span class="keyword">new</span> Producer(r);</span><br><span class="line">        Consumer c = <span class="keyword">new</span> Consumer(r);</span><br><span class="line">        Thread t0 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        t0.start();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isWait = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Resource</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">produde</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (isWait) &#123; <span class="comment">//相较于上面的问题1中的代码, 仅仅将if改为while</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        setCount(getCount() + <span class="number">1</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">",\t生产:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">true</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">consume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!isWait) &#123; <span class="comment">//相较于上面的问题1中的代码, 仅仅将if改为while</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">".................消费:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">false</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWait</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isWait;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWait</span><span class="params">(<span class="keyword">boolean</span> wait)</span> </span>&#123;</span><br><span class="line">        isWait = wait;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Producer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            r.produde();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Consumer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">           r.consume();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样的话又会产生另外一个问题: </p>
<p>​    (t0,t1生产者线程, t2,t3消费者线程) 假如某一时刻, 当 t0,t1,t2都wait状态, 此时, t3获取到执行权后, 执行完, 将标记置为false, 然后唤醒线程池中的线程, 如果不幸唤醒的是t2, 那么t2再次判断while(!isWait), 就会导致4个线程都会wait. 形成死锁. 如下图</p>
<p><img src="/2020/10/04/javabasics/%E5%A4%9A%E4%B8%AA%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85-%E6%AD%BB%E9%94%81.png" alt="多个生产者消费者-死锁"></p>
<h3 id="多个生产者消费者-解决sync-while-notifyAll"><a href="#多个生产者消费者-解决sync-while-notifyAll" class="headerlink" title="多个生产者消费者(解决sync-while-notifyAll)"></a>多个生产者消费者(解决sync-while-notifyAll)</h3><p>那么难道没有办法解决多生产者消费者的问题了吗? 当然不是. </p>
<p><strong>总结</strong></p>
<p>​    上面出现问题的原因, 只要同事满足两点即可解决问题:</p>
<pre><code>1. 等代标记必须每次都判断  (while代替if)
  2. 每次唤醒必须有对方(消费-生产互为对方)线程. (notifyAll()确保一定会唤醒对方线程)</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r = <span class="keyword">new</span> Resource(<span class="string">"烤鸭"</span>);</span><br><span class="line">        Producer p = <span class="keyword">new</span> Producer(r);</span><br><span class="line">        Consumer c = <span class="keyword">new</span> Consumer(r);</span><br><span class="line">        Thread t0 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        t0.start();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isWait = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Resource</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">produde</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (isWait) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        setCount(getCount() + <span class="number">1</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">",\t生产:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">true</span>);</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">consume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!isWait) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">".................消费:"</span> + getName() + getCount());</span><br><span class="line">        setWait(<span class="keyword">false</span>);</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWait</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isWait;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWait</span><span class="params">(<span class="keyword">boolean</span> wait)</span> </span>&#123;</span><br><span class="line">        isWait = wait;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Producer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            r.produde();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Consumer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">           r.consume();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多个生产者消费者-解决lock-condition–signal"><a href="#多个生产者消费者-解决lock-condition–signal" class="headerlink" title="多个生产者消费者(解决lock-condition–signal)"></a>多个生产者消费者(解决lock-condition–signal)</h3><p>用上面的synchronized-while-notifyAll的方法虽然能解决问题, 但是每次都是线程所有线程池中的所有线程(比如t0执行完唤醒线程池中的t1,t2,t3), t1,t2,t3重新获取执行资格, 但是只有其中一个会立刻获取执行权, 不妨是t2, 那么因为是while判断, 所以t2又要重新判断等待标记. 显然, 这样做效率会有降低.</p>
<p>JDK5之后, 将锁对象进行了封装, 将原来隐式的synchronized锁和其配套的监视器对象方法(wait-notify-notifyAll)进行了封装, 使其显示化, 并且不再是一个锁对象对应一组监视器方法, 而是可以一个锁对应多组监视器方法.</p>
<p>具体的可以参见<a href="https://docs.oracle.com/javase/8/docs/api/" target="_blank" rel="noopener">Java SE API</a>  下的<code>java.utils.concurrent.locks</code>包下的lock和condition对象方法.</p>
<p>condition类的描述中有一句: </p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="strong">**Where a `Lock` replaces the use of `synchronized` methods and statements, a `Condition` replaces the use of the Object monitor methods.**</span></span><br></pre></td></tr></table></figure>

<p>翻译过来也就是说, (可以用下面的图表示):</p>
<p><img src="/2020/10/04/javabasics/lock_condition_signal.png" alt="lock_condition_signal"></p>
<p>synchronized和lock对比</p>
<p><img src="/2020/10/04/javabasics/synchronized%E5%92%8Clock%E5%AF%B9%E6%AF%94.png" alt="synchronized和lock对比"></p>
<p>官网提供了一段代码使用示例:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">As an example, suppose we have a bounded buffer which supports put and take methods. If a take is attempted on an empty buffer, then the thread will block until an item becomes available; if a put is attempted on a full buffer, then the thread will block until a space becomes available. We would like to keep waiting put threads and take threads in separate wait-sets so that we can use the optimization of only notifying a single thread at a time when items or spaces become available in the buffer. This can be achieved using two Condition instances.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">BoundedBuffer</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">   <span class="keyword">final</span> Condition notFull  = lock.newCondition(); </span><br><span class="line">   <span class="keyword">final</span> Condition notEmpty = lock.newCondition(); </span><br><span class="line"></span><br><span class="line">   <span class="keyword">final</span> Object[] items = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">   <span class="keyword">int</span> putptr, takeptr, count;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">     lock.lock();</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">while</span> (count == items.length)</span><br><span class="line">         notFull.await();</span><br><span class="line">       items[putptr] = x;</span><br><span class="line">       <span class="keyword">if</span> (++putptr == items.length) putptr = <span class="number">0</span>;</span><br><span class="line">       ++count;</span><br><span class="line">       notEmpty.signal();</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">     lock.lock();</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">while</span> (count == <span class="number">0</span>)</span><br><span class="line">         notEmpty.await();</span><br><span class="line">       Object x = items[takeptr];</span><br><span class="line">       <span class="keyword">if</span> (++takeptr == items.length) takeptr = <span class="number">0</span>;</span><br><span class="line">       --count;</span><br><span class="line">       notFull.signal();</span><br><span class="line">       <span class="keyword">return</span> x;</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>所以lock-condition-signal方式解决代码如下: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Resource r = <span class="keyword">new</span> Resource(<span class="string">"烤鸭"</span>);</span><br><span class="line">        Producer p = <span class="keyword">new</span> Producer(r);</span><br><span class="line">        Consumer c = <span class="keyword">new</span> Consumer(r);</span><br><span class="line">        Thread t0 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(p);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(c);</span><br><span class="line">        t0.start();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isWait = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    Condition c1 = lock.newCondition();  <span class="comment">//生产者锁的监视器</span></span><br><span class="line">    Condition c2 = lock.newCondition();  <span class="comment">//消费者锁的监视器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Resource</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         lock.lock();</span><br><span class="line">         <span class="keyword">try</span>&#123;</span><br><span class="line">             <span class="keyword">while</span> (isWait) &#123;</span><br><span class="line">                 <span class="comment">// try &#123; this.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;</span></span><br><span class="line">                 <span class="keyword">try</span> &#123; c1.await(); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">             &#125;</span><br><span class="line">             setCount(getCount() + <span class="number">1</span>);</span><br><span class="line">             System.out.println(Thread.currentThread().getName() + <span class="string">",\t生产:"</span> + getName() + getCount());</span><br><span class="line">             setWait(<span class="keyword">true</span>); </span><br><span class="line">             c2.signal(); <span class="comment">//生产者执行完之后, 确保只唤醒线程池中消费者线程, 且只唤醒一个</span></span><br><span class="line">         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">             lock.unlock();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">consume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          lock.lock();</span><br><span class="line">          <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (!isWait) &#123;</span><br><span class="line">                <span class="comment">// try &#123; this.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;</span></span><br><span class="line">                <span class="keyword">try</span> &#123; c2.await(); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">".................消费:"</span> + getName() + getCount());</span><br><span class="line">            setWait(<span class="keyword">false</span>);</span><br><span class="line">            c1.signal(); <span class="comment">//消费者执行完之后, 确保只唤醒线程池中生产者线程, 且只唤醒一个</span></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWait</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isWait;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWait</span><span class="params">(<span class="keyword">boolean</span> wait)</span> </span>&#123;</span><br><span class="line">        isWait = wait;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Producer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            r.produce();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Resource r;</span><br><span class="line"></span><br><span class="line">    Consumer(Resource r) &#123;</span><br><span class="line">        <span class="keyword">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">           r.consume();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="wait和sleep区别"><a href="#wait和sleep区别" class="headerlink" title="wait和sleep区别"></a>wait和sleep区别</h2><table>
<thead>
<tr>
<th></th>
<th>–</th>
<th>wait</th>
</tr>
</thead>
<tbody><tr>
<td>1. 归属</td>
<td>Thread静态方法</td>
<td>Object方法</td>
</tr>
<tr>
<td>2. 时间</td>
<td>必须指定</td>
<td>可指定也可不指定</td>
</tr>
<tr>
<td>3. 锁</td>
<td>不释放</td>
<td>释放</td>
</tr>
<tr>
<td>4. 作用范围</td>
<td>任何地方</td>
<td>同步方法或同步代码块</td>
</tr>
</tbody></table>
<h2 id="正确停止线程的方法"><a href="#正确停止线程的方法" class="headerlink" title="正确停止线程的方法"></a>正确停止线程的方法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        T1 t1 = <span class="keyword">new</span> T1();</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(t1);</span><br><span class="line">        thread.start();</span><br><span class="line">        t1.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> continueFlag=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(continueFlag)&#123;</span><br><span class="line">                System.out.println(<span class="string">"T1:\t"</span>+i++);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>&#123;</span><br><span class="line">            continueFlag=<span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>run()执行结束, 线程就结束, 也就停止了, 所以正确的停止线程的方法就是想办法让run()执行完业务逻辑后, 自然停止.</p>
<h2 id="interrupt停止线程"><a href="#interrupt停止线程" class="headerlink" title="interrupt停止线程"></a>interrupt停止线程</h2><p>interrupt()是另一种停止线程的方式 (不推荐)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThreadWithInterrupt</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        InterruptStop is = <span class="keyword">new</span> InterruptStop();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(is);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(is);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (++num == <span class="number">50</span>) &#123;</span><br><span class="line">                t1.interrupt();</span><br><span class="line">                t2.interrupt();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"...........main\t"</span> + num);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"over!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterruptStop</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flag = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();  <span class="comment">// 有可能多个线程在此处都释放资源等待被唤醒, 但是没有notify()方法将其唤醒, 所以也会死锁, 一直等待下去, </span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"...继续执行"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有可能多个线程在此处都释放资源等待被唤醒, 但是没有notify()方法将其唤醒, 所以也会死锁, 一直等待下去,  因此, 在main线程中做一个标记, 当执行到多少回时, 调用线程的interrupt() 方法将线程唤醒, 然后将标记置为false, 然后while(flag)不成立, 所以run方法结束, 线程也就结束. </p>
<h2 id="守护线程Daemon"><a href="#守护线程Daemon" class="headerlink" title="守护线程Daemon"></a>守护线程Daemon</h2><p>守护线程也叫后台线程. 非后台线程(一般线程)也叫前台线程. 启动线程前调用setDaemon()方法可以将线程设置为守护线程. 当正在运行的线程都是守护线程时(也就是前台线程全部运行完结束了), 那么JVM会退出.</p>
<p>如果将 interrupt停止线程   部分的代码的main方法中改为只interrupt t1线程, 那么运行程序将一直进行, 永远不会停止, 因为t2一直处于wait状态, 但是, 如果在此基础上再在t2线程启动前,将其设置为守护线程,那么t1线程和主线程执行完,整个程序就会停止.  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThreadWithInterrupt</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        InterruptStop is = <span class="keyword">new</span> InterruptStop();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(is);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(is);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.setDaemon(<span class="keyword">true</span>);   <span class="comment">// 将t2线程设为守护线程</span></span><br><span class="line">        t2.start();</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (++num == <span class="number">50</span>) &#123;</span><br><span class="line">                t1.interrupt();</span><br><span class="line">                <span class="comment">//t2.interrupt();</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"...........main\t"</span> + num);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"over!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterruptStop</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flag = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + e.getStackTrace());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"...继续执行"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2020/10/04/javabasics/%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B2.png" alt="守护线程2"></p>
<p><img src="/2020/10/04/javabasics/%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B.png" alt="守护线程"></p>
<h2 id="线程同步问题"><a href="#线程同步问题" class="headerlink" title="线程同步问题"></a>线程同步问题</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   Timer timer=<span class="keyword">new</span> Timer();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Demo01 demo= <span class="keyword">new</span> Demo01();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(demo);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(demo);</span><br><span class="line">        t1.setName(<span class="string">"Alex"</span>);</span><br><span class="line">        t2.setName(<span class="string">"Brooks"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        timer.add(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Timer</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            num++;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(name+<span class="string">", 你是第"</span>+num+<span class="string">"个调用timer的线程"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行上述代码的现象:</p>
<p><img src="/2020/10/04/javabasics/%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98.png" alt="synchronized同步"></p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析:"></a>分析:</h3><p>上述代码的正常执行流程是: T1 执行完add()方法中的num++后sleep, 释放资源 , 给到T2执行; 同样T2 执行完add()方法中的num++后sleep, 释放资源. 所以当T1 重新获取到执行资格的时候, 此时num已经是2.  </p>
<p>出现上述现象的原因就是在一个(T1)线程执行的过程中, 另一个线程(T2)也同样访问了该资源(num), 因为是同一个变量(内存中同一地址区域), 所以造成了混乱.</p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>直观的想法就是在一个线程访问执行某一资源的时候, 不能让其他线程使用或改变该资源. 这就引出了同步的概念</p>
<p>synchronized</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   Timer timer=<span class="keyword">new</span> Timer();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Demo01 demo= <span class="keyword">new</span> Demo01();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(demo);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(demo);</span><br><span class="line">        t1.setName(<span class="string">"Alex"</span>);</span><br><span class="line">        t2.setName(<span class="string">"Brooks"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        timer.add(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Timer</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123; <span class="comment">// 在T1线程访问时, 将其锁定 </span></span><br><span class="line">                num++;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(name+<span class="string">", 你是第"</span>+num+<span class="string">"个调用timer的线程"</span>);</span><br><span class="line">            &#125; <span class="comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后执行上述代码结果:</p>
<p><img src="/2020/10/04/javabasics/synchronized%E5%90%8C%E6%AD%A5.png" alt="synchronized同步"></p>
<p>一种更简单的方法就是将synchronized关键字加在方法签名上</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   Timer timer=<span class="keyword">new</span> Timer();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Demo01 demo= <span class="keyword">new</span> Demo01();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(demo);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(demo);</span><br><span class="line">        t1.setName(<span class="string">"Alex"</span>);</span><br><span class="line">        t2.setName(<span class="string">"Brooks"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        timer.add(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Timer</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String name)</span> </span>&#123; <span class="comment">//方法签名上添加synchronized关键字</span></span><br><span class="line">                num++;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(name+<span class="string">", 你是第"</span>+num+<span class="string">"个调用timer的线程"</span>);</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><h3 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因:"></a>产生原因:</h3><p> 同一个线程, 在执行run()里面的业务逻辑时, 对多个对象进行了’锁定’, 而这多个锁定的对象在多个线程值之间又有依赖关系, 此时就产生了死锁. </p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码:"></a>代码:</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> multiThreadDemos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">static</span> Object o1 = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">static</span> Object o2 = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Demo01 demo01 = <span class="keyword">new</span> Demo01();</span><br><span class="line">        Demo01 demo02 = <span class="keyword">new</span> Demo01();</span><br><span class="line">        demo01.flag=<span class="keyword">true</span>;</span><br><span class="line">        demo02.flag=<span class="keyword">false</span>;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(demo01);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(demo02);</span><br><span class="line">        thread1.setName(<span class="string">"Alex"</span>);</span><br><span class="line">        thread2.setName(<span class="string">"Brooks"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"flag="</span>+flag);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (o1)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (o2)&#123; System.out.println(<span class="string">"1"</span>); &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (o2)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (o1)&#123; System.out.println(<span class="string">"0"</span>); &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现象:</p>
<p><img src="/2020/10/04/javabasics/%E6%AD%BB%E9%94%81.png" alt="死锁"></p>
<p>哲学家吃饭问题:</p>
<p><img src="/2020/10/04/javabasics/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%90%83%E9%A5%AD.png" alt="哲学家吃饭"></p>
<h3 id="解决办法-1"><a href="#解决办法-1" class="headerlink" title="解决办法"></a>解决办法</h3><p>将锁的粒度变为粗粒度. </p>
]]></content>
      <categories>
        <category>JavaSE</category>
        <category>Thread</category>
      </categories>
      <tags>
        <tag>JavaSE</tag>
        <tag>Thread</tag>
      </tags>
  </entry>
  <entry>
    <title>stepbystepJava</title>
    <url>/2020/10/04/stepbystepJava/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Interviewsummary</title>
    <url>/2020/10/04/interviewsummary/</url>
    <content><![CDATA[<p>本博客主要记录博主面试过重中遇到的问题, 以及面试结束后的汇总分析.</p>
<a id="more"></a>



<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="MySQL的索引类型"><a href="#MySQL的索引类型" class="headerlink" title="MySQL的索引类型"></a>MySQL的索引类型</h2><p>索普唯复聚非全（普通索引、唯一索引、复合索引（组合索引、联合索引）、聚簇索引、非聚簇索引、全文索引）.主键索引、倒排索引、覆盖索引、哈希索引、B+树、空间数据索引（RTree）</p>
<h2 id="用过哪些设计模式"><a href="#用过哪些设计模式" class="headerlink" title="用过哪些设计模式"></a>用过哪些设计模式</h2><h2 id="单例是如何保证线程安全的"><a href="#单例是如何保证线程安全的" class="headerlink" title="单例是如何保证线程安全的"></a>单例是如何保证线程安全的</h2><h2 id="ArayList的底层实现原理"><a href="#ArayList的底层实现原理" class="headerlink" title="ArayList的底层实现原理"></a>ArayList的底层实现原理</h2><h2 id="什么情况下会死锁"><a href="#什么情况下会死锁" class="headerlink" title="什么情况下会死锁"></a>什么情况下会死锁</h2><h2 id="面向对象的设计原则-不是特点"><a href="#面向对象的设计原则-不是特点" class="headerlink" title="面向对象的设计原则(不是特点)"></a>面向对象的设计原则(不是特点)</h2><h2 id="spring中常用的注解"><a href="#spring中常用的注解" class="headerlink" title="spring中常用的注解"></a>spring中常用的注解</h2><h2 id="springboot中常见的注解"><a href="#springboot中常见的注解" class="headerlink" title="springboot中常见的注解"></a>springboot中常见的注解</h2><h2 id="redis的典型应用场景-分布式锁…"><a href="#redis的典型应用场景-分布式锁…" class="headerlink" title="redis的典型应用场景(分布式锁…)"></a>redis的典型应用场景(分布式锁…)</h2><h2 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h2><h2 id="sleep和wait的区别"><a href="#sleep和wait的区别" class="headerlink" title="sleep和wait的区别"></a>sleep和wait的区别</h2><h2 id="get请求和post请求区别"><a href="#get请求和post请求区别" class="headerlink" title="get请求和post请求区别"></a>get请求和post请求区别</h2>]]></content>
      <categories>
        <category>common</category>
      </categories>
      <tags>
        <tag>interview</tag>
      </tags>
  </entry>
  <entry>
    <title>Debug</title>
    <url>/2020/10/04/debug/</url>
    <content><![CDATA[<p>本博客主要讲解在idea中如何进行debug的基本操作.</p>
<a id="more"></a>



<h4 id="01-Debug简介和意义"><a href="#01-Debug简介和意义" class="headerlink" title="01_Debug简介和意义"></a>01_Debug简介和意义</h4><ul>
<li><p>什么是程序DeBug？</p>
<ul>
<li><p>Debug，是程序开发人员必会的一项调试程序的技能。</p>
</li>
<li><p>企业中程序开发和程序调试的比例为1:1.5，可以说如果你不会调试程序，你就没有办法从事编程工作。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>Debug能帮助我们做什么？<ol>
<li>追踪代码的运行流程。</li>
<li>程序运行异常定位。</li>
<li>线上问题追踪。</li>
</ol>
</li>
</ul>
<ul>
<li><p>Debug对于程序学习者的意义</p>
<ol>
<li>通过调试能够更好的查看程序的执行流程。</li>
<li>复杂的程序逻辑，通过老师的口述讲解，很难理解清楚，这个时候借助调试能够很好的帮助同学们理解程序。</li>
<li>定位问题，提高自我解决问题的能力。</li>
</ol>
</li>
</ul>
<h4 id="02-IDEA中的Debug步骤"><a href="#02-IDEA中的Debug步骤" class="headerlink" title="02_IDEA中的Debug步骤"></a>02_IDEA中的Debug步骤</h4><ul>
<li><p>设置断点（F9）</p>
</li>
<li><p>调试程序（8个按钮）</p>
<p><img src="/2020/10/04/debug/debug%5C2019-09-28_162216.jpg" alt></p>
<table>
<thead>
<tr>
<th>按钮</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><img src="/2020/10/04/debug/debug%5C2019-09-28_163744.jpg" alt></td>
<td>(Alt + F10)：如果你的光标在其它行或其它页面，点击这个按钮可跳转到当前代码执行的行</td>
</tr>
<tr>
<td><img src="/2020/10/04/debug/debug%5C2019-09-28_164022.jpg" alt></td>
<td>(F8)：步过，一行一行地往下走，如果这一行上有方法不会进入方法。</td>
</tr>
<tr>
<td><img src="images/2019-09-28_162345.jpg?lastModify=1569659273?lastModify=1569659273" alt="img"></td>
<td>(F7)：步入。如果当前行有方法，可以进入方法内部，一般用于进入自定义方法内，不会进入官方类库的方法。</td>
</tr>
<tr>
<td><img src="/2020/10/04/debug/debug%5C2019-09-28_164200.jpg" alt></td>
<td>(Alt + Shift + F7)：强制步入，能进入任何方法，查看底层源码的时候可以用这个进入官方类库的方法。</td>
</tr>
<tr>
<td><img src="/2020/10/04/debug/debug%5C2019-09-28_164215.jpg" alt></td>
<td>(Shift + F8)：步出，从步入的方法内退出到方法调用处，此时方法已执行完毕，只是还没有完成赋值。</td>
</tr>
<tr>
<td><img src="/2020/10/04/debug/debug%5C2019-09-28_164428.jpg" alt></td>
<td>回退断点。</td>
</tr>
<tr>
<td><img src="/2020/10/04/debug/debug%5C2019-09-28_164418.jpg" alt></td>
<td>(Alt + F9)：运行到光标处，你可以将光标定位到你需要查看的那一行，然后使用这个功能，代码会运行至光标行，而不需要打断点。</td>
</tr>
<tr>
<td><img src="/2020/10/04/debug/debug%5C2019-09-28_164437.jpg" alt></td>
<td>(Alt + F8)：计算表达式。</td>
</tr>
</tbody></table>
</li>
<li><p>观察变量</p>
<ul>
<li>查看变量有三种方式：<ul>
<li>程序区查看变量</li>
<li>Debugger的Variables中查看变量</li>
<li>鼠标悬停到变量名上会弹出当前变量的值</li>
</ul>
</li>
</ul>
<p><img src="/2020/10/04/debug/debug%5C2019-09-28_165050.jpg" alt></p>
</li>
<li><p>查看输出</p>
</li>
</ul>
<h4 id="03-跳转到当前代码执行的行"><a href="#03-跳转到当前代码执行的行" class="headerlink" title="03_跳转到当前代码执行的行"></a>03_跳转到当前代码执行的行</h4><ul>
<li><p>跳转到当前代码执行的行（Alt + F10）<img src="E:/debug/images/2019-09-28_163744.jpg" alt></p>
</li>
<li><p>作用</p>
<ul>
<li>使程序窗口切换到当前正在运行的程序处。</li>
</ul>
</li>
</ul>
<h4 id="04-步过调试的使用"><a href="#04-步过调试的使用" class="headerlink" title="04_步过调试的使用"></a>04_步过调试的使用</h4><ul>
<li>步过调试<ul>
<li>步过调试按钮（F8）<img src="/2020/10/04/debug/debug%5C2019-09-28_164022.jpg" alt></li>
</ul>
</li>
<li>作用<ul>
<li>步过，一行一行地往下走，如果这一行上有方法不会进入方法。</li>
<li>常用于调试过程中不想进入调用的方法体的情况。</li>
</ul>
</li>
</ul>
<h4 id="05-步入调试的使用"><a href="#05-步入调试的使用" class="headerlink" title="05_步入调试的使用"></a>05_步入调试的使用</h4><ul>
<li><p>步入调试</p>
<ul>
<li>步过调试按钮（F7）<img src="/2020/10/04/debug/debug%5C2019-09-28_162345.jpg" alt></li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li><p>步入，一行一行地往下走，如果这一行上有方法，则进入方法内部。</p>
</li>
<li><p>一般用于进入自定义方法内，不会进入官方类库的方法。</p>
</li>
</ul>
</li>
</ul>
<h4 id="06-强制步入调试的使用"><a href="#06-强制步入调试的使用" class="headerlink" title="06_强制步入调试的使用"></a>06_强制步入调试的使用</h4><ul>
<li><p>强制步入调试</p>
<ul>
<li>强制步入调试按钮（Alt + Shift + F7）<img src="E:/debug/images/2019-09-28_164200.jpg" alt></li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li><p>进入官方类库方法</p>
</li>
<li><p>帮助我们学习和查看JDK源码</p>
</li>
</ul>
</li>
</ul>
<h4 id="07-步出调试的使用"><a href="#07-步出调试的使用" class="headerlink" title="07_步出调试的使用"></a>07_步出调试的使用</h4><ul>
<li><p>步出调试</p>
<ul>
<li>步出调试按钮（Shift + F8）<img src="/2020/10/04/debug/debug%5C2019-09-28_164215.jpg" alt></li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li>从方法内退出到方法调用处。</li>
<li>调试的时候，有时候会跳入到自己不想查看的方法体，这个时候使用步出。</li>
</ul>
</li>
</ul>
<h4 id="08-回退断点调试的使用"><a href="#08-回退断点调试的使用" class="headerlink" title="08_回退断点调试的使用"></a>08_回退断点调试的使用</h4><ul>
<li><p>回退断点</p>
<ul>
<li>回退断点按钮 <img src="/2020/10/04/debug/debug%5C2019-09-28_164428.jpg" alt></li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li><p>回退到当前方法的调用处。</p>
</li>
<li><p>当想重新查看该方法体的执行过程时，不用重新启动Debug，可以使用回退断点方式。</p>
</li>
</ul>
</li>
</ul>
<h4 id="09-运行到光标处"><a href="#09-运行到光标处" class="headerlink" title="09_运行到光标处"></a>09_运行到光标处</h4><ul>
<li>运行到光标处<ul>
<li>运行光标处按钮 （F9）<img src="/2020/10/04/debug/debug%5C2019-09-28_164418.jpg" alt></li>
<li>作用<ul>
<li>使程序运行到光标处，而无需设置断点。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="10-计算表达式"><a href="#10-计算表达式" class="headerlink" title="10_计算表达式"></a>10_计算表达式</h4><ul>
<li><p>计算表达式</p>
<ul>
<li><p>计算表达式按钮（Alt + F8）<img src="/2020/10/04/debug/debug%5C2019-09-28_164437.jpg" alt></p>
<p><img src="/2020/10/04/debug/debug%5C2019-10-03_182159.jpg" alt></p>
</li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li>设置变量，在计算表达式的框里，可以改变变量的值，这样有时候就能很方便我们去调试各种值的情况了。 </li>
</ul>
</li>
</ul>
<h4 id="11-条件断点"><a href="#11-条件断点" class="headerlink" title="11_条件断点"></a>11_条件断点</h4><ul>
<li><p>条件断点</p>
<ul>
<li><p>右键单击断点处，可以设置进入断点的条件</p>
<p><img src="/2020/10/04/debug/debug%5C2019-10-03_182101.jpg" alt></p>
</li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li>通过设置断点条件，在满足条件时，才停在断点处，否则直接运行。</li>
</ul>
</li>
</ul>
<h4 id="12-多线程调试"><a href="#12-多线程调试" class="headerlink" title="12_多线程调试"></a>12_多线程调试</h4><ul>
<li><p>步骤</p>
<ul>
<li><p>多线程调试，需要调整断点挂起级别为Thread</p>
<p><img src="/2020/10/04/debug/debug%5C2019-10-05_164127.jpg" alt></p>
</li>
<li><p>Frame中选择线程进行调试</p>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>common</category>
      </categories>
      <tags>
        <tag>Manual</tag>
        <tag>idea</tag>
        <tag>debug</tag>
      </tags>
  </entry>
  <entry>
    <title>Algorithms</title>
    <url>/2020/09/28/Algorithms/</url>
    <content><![CDATA[<p>异或</p>
<ol>
<li>0101101000101000 类似这样的数, 取出最右边的①</li>
<li>一个数组中有一个数出现了奇数词,其他元素都出现了偶数次, 找出这个出现奇数次的数</li>
<li>一个数组中有两个数出现了奇数词,其他元素都出现了偶数次, 找出这两个出现奇数次的数</li>
<li>一个二int类型值的二进制数中1 的个数</li>
</ol>
<p>各类排序 (冒泡, 选择, 插入, 归并, 桶)</p>
<p>链表</p>
<p>单链表和双链表如何反转</p>
<p>删除单链表的指定值. (如: 2-0-3-4-5-6-7-2-4-1 要删除2, 则返回 0-3-4-5-6-7-4-1)</p>
]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter3_AOP</title>
    <url>/2020/09/28/SpringBoot-Chapter3-AOP/</url>
    <content><![CDATA[<h1 id="Aop简介"><a href="#Aop简介" class="headerlink" title="Aop简介"></a>Aop简介</h1><p>AOP的全称是Aspect Oriented Programming，翻译成中文是面向切面编程。它的主要思想是在程序正常执行的某一个点切进去加入特定的逻辑。AOP框架中对AOP支持最完整的是Aspectj，Spring Aop是基于Aspectj实现的专门针对于Spring自身支持的Aop，它的功能没有Aspectj那么完整，它只作用于Spring bean容器中bean对象的某个方法的执行。正如Spring官方文档所描述的那样，Spring Aop与Aspectj不是竞争关系，而是相互补充、相互完善的这么一个关系。</p>
<a id="more"></a>

<h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>AOP框架的基本原理基本上都是通过代理的方式对目标对象达到切入式的切面编程的效果，Spring Aop也不例外。Spring Aop只能对它自身bean容器中定义的bean对象进行代理，这算是Spring Aop的一个限制，如果你的项目中不使用Spring的IOC，使用Spring的Aop显然是有点不那么合适的。Spring Aop中使用的代理有两种方式，一种是Jdk的动态代理，另一种是基于CGLIB实现的代理，当我们的bean对象实现了某一接口后，Spring默认将采用Jdk动态代理，当我们的bean对象没有实现接口时，默认将采用CGLIB代理，Spring也支持我们在bean对象实现了接口时也强制的使用CGLIB代理。Spring的Bean容器在初始化bean对象的时候就会判断对应的bean是否需要进行切面编程，即是否需要对其进行代理，如果需要，则初始化的时候就会把它初始化为一个代理对象。下面基于Jdk来看一个简单的示例，假设我们定义了如下这样一个代理工厂，其可以将一个普通的对象基于其实现的接口利用Jdk动态代理机制生成对应的代理对象。具体代码和说明请看如下代码，其中我们可以在目标对象执行特定的方法时加入一些特定的处理逻辑。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ProxyFactory instance = <span class="keyword">new</span> ProxyFactory();</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">ProxyFactory</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ProxyFactory <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">create</span><span class="params">(<span class="keyword">final</span> T t)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (T) Proxy.newProxyInstance(t.getClass().getClassLoader(), t.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * 当使用创建的代理对象执行其中的方法时，都会转换为调用与代理对象绑定的InvocationHandler对象的invoke方法，</span></span><br><span class="line"><span class="comment">			 * 这样我们就可以在这个方法里面对调用情况进行一些特定的处理逻辑</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">				System.out.println(<span class="string">"正在调用的方法是："</span> + method);</span><br><span class="line">				<span class="comment">//1、加入对调用方法前的处理逻辑</span></span><br><span class="line">				<span class="comment">//...</span></span><br><span class="line">				Object result = <span class="keyword">null</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="comment">//2、正常的调用目标对象的目标方法</span></span><br><span class="line">					result = method.invoke(t, args);</span><br><span class="line">					<span class="comment">//3、可加入正常调用后的处理逻辑</span></span><br><span class="line">					<span class="comment">//...</span></span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					<span class="comment">//4、可加入目标对象的方法调用抛出异常后的处理逻辑</span></span><br><span class="line">					<span class="comment">//..</span></span><br><span class="line">				&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">					<span class="comment">//5、可加入目标对象的方法执行完成后的处理逻辑，此逻辑不论是否抛出异常都将执行</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下是基于上述代码进行的一个简单示例，具体如下，有兴趣的朋友也可以自己试一试。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	ProxyFactory proxyFactory = ProxyFactory.getInstance();</span><br><span class="line">	<span class="comment">//创建一个实现了UserService接口的对象</span></span><br><span class="line">	UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">	<span class="comment">//创建一个基于userService对象的代理对象</span></span><br><span class="line">	UserService proxy = proxyFactory.create(userService);</span><br><span class="line">	<span class="comment">//调用代理对象的某个方法</span></span><br><span class="line">	User user = proxy.findById(<span class="number">1</span>);</span><br><span class="line">	System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述只是一个简单的示例，只是为了说明Spring Aop的大体原理，实际上Spring Aop的代理逻辑比这个要复杂很多，在初始化bean后它需要判断该bean是否需要创建代理对象，这通常都是BeanPostProcessor的功能。有兴趣的读者可以参考一下DefaultListableBeanFactory的preInstantiateSingletons方法，了解一下Spring bean的初始化过程，更详细的内容请参考AbstractApplicationContext.refresh方法。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>在了解Spring Aop的用法前，我们需要先了解一下Spring Aop中的一些重要概念，这些概念的英文名称摘自Spring的官方文档，这些术语在本系列文章中出现时可能会以原始英文的形式出现。</p>
<ul>
<li>Aspect：切面类，是面向切面编程的主体类，用以定义Pointcut和Advice这样的对应关系。</li>
<li>Join Point：切入点，程序运行的某一个点，比如执行某个方法，在Spring AOP中Join Point总是表示一个方法的执行。</li>
<li>Advice：切面类Aspect需要在Join Point处执行的操作。Advice的类型主要包括Before、After和Around三种。包括Spring在类的很多AOP框架都会把Advice以类似于Interceptor（拦截器）的形式进行封装，然后在每个Join Point的前后都可以包含一个Interceptor链，即可以进行多个操作处理。</li>
<li>Pointcut：用来定义匹配的Join Point的，它是一个表达式。它往往会跟Advice绑定在一起，用以指定需要在Pointcut表达式匹配的Join Point执行的操作。采用Pointcut表达式来匹配Join Point是AOP中一个非常重要的概念，它能够使得我们的Advice能够比较独立，即一个Advice可以同时服务于多个JoinPoint。Spring AOP默认采用Aspectj（AOP的始祖）的Pointcut表达式。</li>
<li>Introduction：用来声明额外的方法和属性。可以给目标对象引入新的接口及其实现。例如可以使用Introduction让一个bean实现isModified接口。</li>
<li>Target Object：目标对象，表示Aspect正在处理的对象。因为Spring AOP是基于运行时代理实现的，所以这个对象永远都是一个代理对象。</li>
<li>Aop Proxy：由AOP框架创建的一个代理对象。在Spring AOP中这个代理对象将由JDK代理（基于接口）或CGLIB代理（基于Class）生成。</li>
<li>Weaving：表示编织的意思。用以将切面类Aspect与目标对象联系在一起的这么一个动作，所形成的结果就是在Pointcut所指定的Join Point执行时由Aspect对目标对象执行特定的Advice。AOP框架中的Weaving动作可以发生在编译时、类装载时和运行时，Spring AOP的Weaving动作是发生在运行时。</li>
</ul>
<h3 id="Advice类型"><a href="#Advice类型" class="headerlink" title="Advice类型"></a>Advice类型</h3><p>Advice的类型主要有Before、After和Around三种，Before作用于JoinPoint执行前，After作用于JoinPoint执行后（After类型还可以细分），Around则可作用于JoinPoint执行前后，且JoinPoint的执行需要在Around类型的Advice中进行调用，具体如下：</p>
<ul>
<li>Before：Before类型的Advice将在Join Point执行前运行，除非在运行时抛出一个异常，否则Before类型的Advice不会阻止Join Point的运行。</li>
<li>After Return：After Return类型的Advice将在Join Point正常执行完成（return）后运行，即Join Point的运行没有抛出对外的异常后返回的。</li>
<li>After Throwing：After Throwing类型的Advice将在Join Point抛出对外的异常后运行。</li>
<li>After （finally）：After类型的Advice不论Join Point的执行结果如何都将运行。</li>
<li>Around：Around类型的Advice将围绕一个Join Point执行，它既可以在Join Point执行前执行特定的逻辑，也可以在Join Point执行后执行特定的逻辑，还可以控制Join Point是否执行、抛出异常、修改返回值等。</li>
</ul>
<p>Around Advice的功能是最强大的，所有其它Advice能够满足的需求使用Around Advice也都能够满足。但是Spring官方并推荐我们大量的使用Around Advice，而是使用最简单最能满足我们需要的那个Advice。比如如果你只是想简单的在Join Point执行完成后根据返回值来更新缓存，那你使用After Return Advice将比使用Around Advice更合适。这不但能够使你的程序更加的简单，也能减少你出错的机会（使用Around Advice时需要用户自己调用JoinPoint的proceed方法，让JoinPoint继续运行），更能减少程序运行的复杂度。</p>
<p>Spring AOP目前只支持对方法执行这样的JoinPoint进行特定的Advice处理，更确切的来说是只支持对Spring Bean容器里面的bean定义的方法执行进行切入特定的处理逻辑。如果你需要对属性的访问也进行拦截，也执行特定的Advice，那么你可以考虑使用Aspectj。还有一点需要注意的是切面类不会被自动代理，不能作为其它切面类作用的目标类，即使你配置的Poincut目标对象能包含对应的Aspect也不行。</p>
<p>（注：本文是基于Spring4.1.0所写）</p>
<h1 id="基于Aspectj注解的Spring-Aop简单实现"><a href="#基于Aspectj注解的Spring-Aop简单实现" class="headerlink" title="基于Aspectj注解的Spring Aop简单实现"></a>基于Aspectj注解的Spring Aop简单实现</h1><p>Spring Aop是基于Aop框架Aspectj实现的，它不是完完全全的对Aspectj框架进行扩展和改造，而是利用Aspectj里面的一些功能来实现自己的Aop框架，其中就包括对Aspectj提供的注解的解析。之前已经提过Spring Aop和Aspectj实现的Aop之间的差别，这里就不再赘述。本文主要描述的是如何利用Aspectj提供的注解来实现Spring Aop功能，旨在让大家对Spring Aop、对使用Aspectj注解开发Spring Aop有一个初步印象。</p>
<h2 id="启用对Aspectj注解的支持"><a href="#启用对Aspectj注解的支持" class="headerlink" title="启用对Aspectj注解的支持"></a>启用对Aspectj注解的支持</h2><p>使用Aspectj注解来实现Spring Aop时我们首先需要启用Spring对Aspectj注解支持的功能，这是通过配置来进行的。当我们的Spring配置是以配置文件为主时，我们可以通过在Spring的配置文件中引入aop相关的schema，然后通过``来启用对Aspectj注解的支持。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.elim.test"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 启用对Aspectj注解的支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当我们的配置是通过使用@Configuration标注的配置类来进行的时候，我们就可以通过在该配置类上使用@EnableAspectJAutoProxy进行标注来启用对Aspectj注解的支持。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义切面类"><a href="#定义切面类" class="headerlink" title="定义切面类"></a>定义切面类</h2><p>定义切面类比较简单，只需要定义一个简单的使用@Aspect进行标注的类即可。@Aspect是Spring Aop识别切面类的一个标记，但是光使用@Aspect对切面类进行标注还不行。因为Spring Aop只能对定义在bean容器中的bean发生作用，对应的切面类也必须是定义在bean容器中的bean对象时其才能发现。@Aspect不具备默认让Spring扫描到它，把对应的类实例化为Spring bean的功能，所以我们必须要在bean容器中定义该bean。可以通过配置文件定义，也可以通过使用@Component进行标注等。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用@Aspect标注的切面类也可以像普通类一样定义普通的属性和方法，如果有需要也可以把它当做一个普通的bean使用。</p>
<h2 id="定义Pointcut"><a href="#定义Pointcut" class="headerlink" title="定义Pointcut"></a>定义Pointcut</h2><p>Pointcut是用来定义切面类需要作用的JoinPoint的，在Spring Aop中这些JoinPoint其实就是一些我们需要进行切入的方法执行，因为之前我们说过Spring Aop只支持对bean方法执行的切入。基于Aspect注解形式定义的Pointcut的核心是@Pointcut注解，我们需要在Aspect类中定义一个没有返回值的方法，方法类型可任意，然后在该方法上使用@Pointcut进行标注，表示其是一个Pointcut定义，对应的方法名即表示该Pointcut的名称。@Pointcut有一个value属性，其通常是一个表达式，通过它可以指定当前Pointcut需要作用的JoinPoint。表达式可以有很多种写法，这个在后续会专门讲解，通常用的最多的就是execution，表示方法的执行。如我们想定义一个Pointcut的JoinPoint为所有add方法的执行，那么我们可以如下定义。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* add(..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pointcut</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义Advice"><a href="#定义Advice" class="headerlink" title="定义Advice"></a>定义Advice</h2><p>Advice需要与Pointcut绑定在一起，用以定义需要在指定的Pointcut匹配的JoinPoint处执行的操作。Advice主要有三种类型，before、after和around，Aspectj对它们都有对应的注解进行支持。基于Aspectj注解的advice定义是通过对应的注解来指定的，我们需要在切面类中定义一个方法，然后在该方法上使用对应的注解进行标注。对应的advice注解都有一个value属性，我们需要通过它来指定与之绑定的Pointcut，对应的Pointcut需要通过Pointcut定义的类全名称.方法名()来指定，如果是在当前切面类中定义的Pointcut则可以省略对应的类名称。这里主要拿before来做一个示例，如下，我们在切面类中定义了一个方法before，并用@Before注解标注了该方法，同时指定了其所绑定的Pointcut为同一个切面类中定义的pointcut。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* add(..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pointcut</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"com.elim.test.spring.aop.MyAspect.pointcut()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">		System.out.println(joinPoint.getTarget() + <span class="string">"----------------------Before---------------------"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，当我们在访问Spring bean容器中任意bean对象的add方法前就会调用MyAspect切面类中定义的before方法了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@ContextConfiguration("classpath:applicationContext.xml")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserService userService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		User user = <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">"ZhangSan"</span>);</span><br><span class="line">		userService.add(user);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Pointcut表达式介绍"><a href="#Pointcut表达式介绍" class="headerlink" title="Pointcut表达式介绍"></a>Pointcut表达式介绍</h1><h2 id="表达式类型"><a href="#表达式类型" class="headerlink" title="表达式类型"></a>表达式类型</h2><p>标准的Aspectj Aop的pointcut的表达式类型是很丰富的，但是Spring Aop只支持其中的9种，外加Spring Aop自己扩充的一种一共是10种类型的表达式，分别如下。</p>
<ul>
<li>execution：一般用于指定方法的执行，用的最多。</li>
<li>within：指定某些类型的全部方法执行，也可用来指定一个包。</li>
<li>this：Spring Aop是基于代理的，生成的bean也是一个代理对象，this就是这个代理对象，当这个对象可以转换为指定的类型时，对应的切入点就是它了，Spring Aop将生效。</li>
<li>target：当被代理的对象可以转换为指定的类型时，对应的切入点就是它了，Spring Aop将生效。</li>
<li>args：当执行的方法的参数是指定类型时生效。</li>
<li>@target：当代理的目标对象上拥有指定的注解时生效。</li>
<li>@args：当执行的方法参数类型上拥有指定的注解时生效。</li>
<li>@within：与@target类似，看官方文档和网上的说法都是@within只需要目标对象的类或者父类上有指定的注解，则@within会生效，而@target则是必须是目标对象的类上有指定的注解。而根据笔者的测试这两者都是只要目标类或父类上有指定的注解即可。</li>
<li>@annotation：当执行的方法上拥有指定的注解时生效。</li>
<li>bean：当调用的方法是指定的bean的方法时生效。</li>
</ul>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><h3 id="execution"><a href="#execution" class="headerlink" title="execution"></a>execution</h3><p>execution是使用的最多的一种Pointcut表达式，表示某个方法的执行，其标准语法如下。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? </span><br><span class="line">	name-pattern(param-pattern) <span class="keyword">throws</span>-pattern?)</span><br></pre></td></tr></table></figure>

<p>modifiers-pattern表示方法的访问类型，public等；ret-type-pattern表示方法的返回值类型，如String表示返回类型是String，“<em>”表示所有的返回类型；declaring-type-pattern表示方法的声明类，如“com.elim..<em>”表示com.elim包及其子包下面的所有类型；name-pattern表示方法的名称，如“add</em>”表示所有以add开头的方法名；param-pattern表示方法参数的类型，name-pattern(param-pattern)其实是一起的表示的方法集对应的参数类型，如“add()”表示不带参数的add方法，“add(</em>)”表示带一个任意类型的参数的add方法，“add(*,String)”则表示带两个参数，且第二个参数是String类型的add方法；throws-pattern表示异常类型；其中以问号结束的部分都是可以省略的。</p>
<ul>
<li>1、“execution(* add())”匹配所有的不带参数的add()方法。</li>
<li>2、“execution(public * com.elim..<em>.add</em>(..))”匹配所有com.elim包及其子包下所有类的以add开头的所有public方法。</li>
<li>3、“execution(* *(..) throws Exception)”匹配所有抛出Exception的方法。</li>
</ul>
<h3 id="within"><a href="#within" class="headerlink" title="within"></a>within</h3><p>within是用来指定类型的，指定类型中的所有方法将被拦截。</p>
<ul>
<li>1、“within(com.elim.spring.aop.service.UserServiceImpl)”匹配UserServiceImpl类对应对象的所有方法外部调用，而且这个对象只能是UserServiceImpl类型，不能是其子类型。</li>
<li>2、“within(com.elim..*)”匹配com.elim包及其子包下面所有的类的所有方法的外部调用。</li>
</ul>
<h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p>Spring Aop是基于代理的，this就表示代理对象。this类型的Pointcut表达式的语法是this(type)，当生成的代理对象可以转换为type指定的类型时则表示匹配。基于JDK接口的代理和基于CGLIB的代理生成的代理对象是不一样的。</p>
<ul>
<li>1、“this(com.elim.spring.aop.service.IUserService)”匹配生成的代理对象是IUserService类型的所有方法的外部调用。</li>
</ul>
<h3 id="target"><a href="#target" class="headerlink" title="target"></a>target</h3><p>Spring Aop是基于代理的，target则表示被代理的目标对象。当被代理的目标对象可以被转换为指定的类型时则表示匹配。</p>
<ul>
<li>1、“target(com.elim.spring.aop.service.IUserService)”则匹配所有被代理的目标对象能够转换为IUserService类型的所有方法的外部调用。</li>
</ul>
<h3 id="args"><a href="#args" class="headerlink" title="args"></a>args</h3><p>args用来匹配方法参数的。</p>
<ul>
<li>1、“args()”匹配任何不带参数的方法。</li>
<li>2、“args(java.lang.String)”匹配任何只带一个参数，而且这个参数的类型是String的方法。</li>
<li>3、“args(..)”带任意参数的方法。</li>
<li>4、“args(java.lang.String,..)”匹配带任意个参数，但是第一个参数的类型是String的方法。</li>
<li>5、“args(..,java.lang.String)”匹配带任意个参数，但是最后一个参数的类型是String的方法。</li>
</ul>
<h3 id="target-1"><a href="#target-1" class="headerlink" title="@target"></a>@target</h3><p>@target匹配当被代理的目标对象对应的类型及其父类型上拥有指定的注解时。</p>
<ul>
<li>1、“@target(com.elim.spring.support.MyAnnotation)”匹配被代理的目标对象对应的类型上拥有MyAnnotation注解时。</li>
</ul>
<h3 id="args-1"><a href="#args-1" class="headerlink" title="@args"></a>@args</h3><p>@args匹配被调用的方法上含有参数，且对应的参数类型上拥有指定的注解的情况。</p>
<ul>
<li>1、“@args(com.elim.spring.support.MyAnnotation)”匹配方法参数类型上拥有MyAnnotation注解的方法调用。如我们有一个方法add(MyParam param)接收一个MyParam类型的参数，而MyParam这个类是拥有注解MyAnnotation的，则它可以被Pointcut表达式“@args(com.elim.spring.support.MyAnnotation)”匹配上。</li>
</ul>
<h3 id="within-1"><a href="#within-1" class="headerlink" title="@within"></a>@within</h3><p>@within用于匹配被代理的目标对象对应的类型或其父类型拥有指定的注解的情况，但只有在调用拥有指定注解的类上的方法时才匹配。</p>
<ul>
<li>1、“@within(com.elim.spring.support.MyAnnotation)”匹配被调用的方法声明的类上拥有MyAnnotation注解的情况。比如有一个ClassA上使用了注解MyAnnotation标注，并且定义了一个方法a()，那么在调用ClassA.a()方法时将匹配该Pointcut；如果有一个ClassB上没有MyAnnotation注解，但是它继承自ClassA，同时它上面定义了一个方法b()，那么在调用ClassB().b()方法时不会匹配该Pointcut，但是在调用ClassB().a()时将匹配该方法调用，因为a()是定义在父类型ClassA上的，且ClassA上使用了MyAnnotation注解。但是如果子类ClassB覆写了父类ClassA的a()方法，则调用ClassB.a()方法时也不匹配该Pointcut。</li>
</ul>
<h3 id="annotation"><a href="#annotation" class="headerlink" title="@annotation"></a>@annotation</h3><p>@annotation用于匹配方法上拥有指定注解的情况。</p>
<ul>
<li>1、“@annotation(com.elim.spring.support.MyAnnotation)”匹配所有的方法上拥有MyAnnotation注解的方法外部调用。</li>
</ul>
<h3 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h3><p>bean用于匹配当调用的是指定的Spring的某个bean的方法时。</p>
<ul>
<li>1、“bean(abc)”匹配Spring Bean容器中id或name为abc的bean的方法调用。</li>
<li>2、“bean(user*)”匹配所有id或name为以user开头的bean的方法调用。</li>
</ul>
<h2 id="表达式组合"><a href="#表达式组合" class="headerlink" title="表达式组合"></a>表达式组合</h2><p>表达式的组合其实就是对应的表达式的逻辑运算，与、或、非。可以通过它们把多个表达式组合在一起。</p>
<ul>
<li>1、“bean(userService) &amp;&amp; args()”匹配id或name为userService的bean的所有无参方法。</li>
<li>2、“bean(userService) || @annotation(MyAnnotation)”匹配id或name为userService的bean的方法调用，或者是方法上使用了MyAnnotation注解的方法调用。</li>
<li>3、“bean(userService) &amp;&amp; !args()”匹配id或name为userService的bean的所有有参方法调用。</li>
</ul>
<h2 id="基于Aspectj注解的Pointcut表达式应用"><a href="#基于Aspectj注解的Pointcut表达式应用" class="headerlink" title="基于Aspectj注解的Pointcut表达式应用"></a>基于Aspectj注解的Pointcut表达式应用</h2><p>在使用基于Aspectj注解的Spring Aop时，我们可以把通过@Pointcut注解定义Pointcut，指定其表达式，然后在需要使用Pointcut表达式的时候直接指定Pointcut。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* add(..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">beforeAdd</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"beforeAdd()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"-----------before-----------"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码中我们就是在@Before()中直接指定使用当前类定义的beforeAdd()方法对应的Pointcut的表达式，如果我们需要指定的Pointcut定义不是在当前类中的，我们需要加上类名称，如下面这个示例中引用的就是定义在MyService中的add()方法上的Pointcut的表达式。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"com.elim.spring.aop.service.MyService.add()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----------before2-----------"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然了，除了通过引用Pointcut定义间接的引用其对应的Pointcut表达式外，我们也可以直接使用Pointcut表达式的，如下面这个示例就直接在@Before中使用了Pointcut表达式。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有的add方法的外部执行时</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(* add())"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeExecution</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-------------before execution---------------"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（注：本文是基于Spring4.1.0所写，写于2017年1月14日星期六）</p>
<h1 id="基于Aspectj注解的Advice介绍"><a href="#基于Aspectj注解的Advice介绍" class="headerlink" title="基于Aspectj注解的Advice介绍"></a>基于Aspectj注解的Advice介绍</h1><p>之前介绍过，Advice一共有五种类型，分别是before、after return、after throwing、after（finally）和around。在使用注解的时候，它们对应的注解分别是@Before、@AfterReturning、@AfterThrowing、@After和@Around。 这几个注解都是在org.aspectj.lang.annotation包中。</p>
<h2 id="Before"><a href="#Before" class="headerlink" title="@Before"></a>@Before</h2><p>Before Advice将在目标方法执行前执行Advice逻辑，通过它我们可以在指定的切入点方法执行前加入特定的逻辑。如下是定义的一个Before Advice，通过其value属性（注解中只指定value属性时属性名是可以省略的）指定其需要拦截的切入点id或name为userService的bean的方法执行，然后拦截后我们只是简单的打印一条语句，在实际应用中这里应该加上我们特定的逻辑。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"bean(userService)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----before with pointcut expression: bean(userService)------"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：</p>
<ul>
<li>1、@Before除了可以通过value属性指定需要拦截的切入点外，还可以指定一个argNames属性，这个是用于方便我们在Advice中访问切入点方法参数的，这个在后续会专门用一篇文章来讲如何在Advice中使用切入点方法参数。</li>
<li>2、argNames这个属性不仅在@Before上有，在其它的Advice注解上也有。</li>
<li>3、除非抛出异常，否则Before Advice是没法阻止程序继续往下执行的。</li>
</ul>
<p>所有的Advice方法都可以接收一个JoinPoint参数，而且这个参数必须是Advice方法的第一个参数，通过这个参数我们可以获取到目标方法的一些信息，比如当前方法调用传递的参数信息、目标对象等。而如果是Around类型的Advice则必须接受一个ProceedingJoinPoint类型的参数，ProceedingJoinPoint是JoinPoint的子类。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"bean(userService)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----before with pointcut expression: bean(userService)------"</span>);</span><br><span class="line">	joinPoint.getArgs();<span class="comment">//获取当前目标方法调用传递的参数</span></span><br><span class="line">	joinPoint.getSignature();<span class="comment">//获取当前目标方法的签名，通过它可以获取到目标方法名</span></span><br><span class="line">	joinPoint.getThis();<span class="comment">//获取AOP生成的代理对象</span></span><br><span class="line">	joinPoint.getTarget();<span class="comment">//获取被代理对象，即目标对象</span></span><br><span class="line">	System.out.println(joinPoint.getArgs());</span><br><span class="line">	System.out.println(joinPoint.getSignature().getName());</span><br><span class="line">	System.out.println(joinPoint.getThis().getClass());</span><br><span class="line">	System.out.println(joinPoint.getTarget().getClass());</span><br><span class="line">	System.out.println(joinPoint.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AfterReturning"><a href="#AfterReturning" class="headerlink" title="@AfterReturning"></a>@AfterReturning</h2><p>AfterReturning Advice对应的是切入点方法正常执行完的拦截，即切入点方法执行时没有对外抛出异常，包括在目标方法被Around类型的Advice处理时没有抛出异常，如果目标方法在被Around类型的Advice处理时也抛出了异常，则同样会被认为目标方法是执行异常的，因为Around Advice是最先处理的，AfterReturning Advice会在Around Advice处理结束后才被触发的。如果我们希望在AfterReturning Advice中根据目标方法的返回结果做特定的业务逻辑，那么我们可以给AfterReturning Advice处理方法加一个参数，参数类型可以是你能确定的目标方法返回类型或用通用的Object，然后需要在@AfterReturning上通过returning属性指定目标方法的返回值需要赋值给AfterReturning Advice处理方法的哪个参数。如下示例中就在Advice处理方法上加入了一个通用类型的Object类型的returnValue参数，然后指定@AfterReturning的returning属性为“returnValue”。如果我们确定目标方法的返回结果一定是一个User类型的，那么我们也可以指定下面的方法参数类型是User类型。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AfterReturning</span>(value=<span class="string">"bean(userService)"</span>, returning=<span class="string">"returnValue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----after returning with pointcut expression: bean(userService)------"</span>);</span><br><span class="line">	System.out.println(<span class="string">"-----return value is: "</span> + returnValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AfterThrowing"><a href="#AfterThrowing" class="headerlink" title="@AfterThrowing"></a>@AfterThrowing</h2><p>AfterThrowing Advice对应的是切入点方法执行对外抛出异常的拦截。因为当一个切入点方法可以同时被Around Advice和AfterThrowing Advice拦截时，实际上AfterThrowing Advice拦截的是Around Advice处理后的结果，所以这种情况下最终AfterThrowing Advice是否能被触发，还要看Around Advice自身是否对外抛出异常，即算是目标方法对外抛出了异常，但是被Around Advice处理了又没有向外抛出异常的时候AfterThrowing Advice也不会被触发的。如果希望在AfterThrowing Advice处理方法中获取到被抛出的异常，可以给对应的Advice处理方法加一个Exception或其子类型（能确定抛出的异常类型）的方法参数，然后通过@AfterThrowing的throwing属性指定拦截到的异常对象对应的Advice处理方法的哪个参数。如下就指定了拦截到的异常对象将传递给Advice处理方法的ex参数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing</span>(value=<span class="string">"bean(userService)"</span>, throwing=<span class="string">"ex"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(Exception ex)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----after throwing with pointcut expression: bean(userService)------"</span> + ex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AfterThrowing是用于在切入点方法抛出异常时进行某些特殊的处理，但是它不会阻止方法调用者看到异常结果。</p>
<h2 id="After"><a href="#After" class="headerlink" title="@After"></a>@After</h2><p>After Advice就相当于try…catch…finally语句里面的finally的角色，即无论被拦截的切入点方法是成功执行完成还是对外抛出了异常，对应的Advice处理方法都将会执行。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@After</span>(<span class="string">"bean(userService)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----after with pointcut expression: bean(userService)------"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Around"><a href="#Around" class="headerlink" title="@Around"></a>@Around</h2><p>Around Advice必须接收一个ProceedingJoinPoint类型的方法参数，然后在方法体中选择一个合适的时机来调用ProceedingJoinPoint的proceed方法以触发对目标方法的调用，然后Around Advice处理方法的返回值会被当做是目标方法调用的返回值。所以通过Around Advice我们可以在通过ProceedingJoinPoint调用目标方法的前后加上特定的逻辑，包括使用try…catch…finally等，所以Around Advice是功能最强大的一个Advice，前面的任何一种Advice在应用的时候都可以被Around Advice替换。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Around</span>(<span class="string">"bean(userService)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----around with pointcut expression: bean(userService)------"</span>);</span><br><span class="line">	System.out.println(<span class="string">"---------------------调用前---------------------"</span>);</span><br><span class="line">	Object result = pjp.proceed();</span><br><span class="line">	System.out.println(<span class="string">"---------------------调用后---------------------"</span>);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的示例中我们就通过Around Advice拦截了id或name为userService的bean的所有方法调用，把真实的目标方法的返回结果返回去了。而实际上我们这里还可以修改目标方法的返回结果，比如常用的就是Spring的缓存会通过Around Advice在调用目标方法前先从缓存中获取结果，如果获取到了则直接返回。这也是Around Advice跟AfterReturning Advice一个比较大的差别，AfterReturning Advice是不能改变返回对象的引用的，但是它可以改变返回对象的个别属性。在使用Around Advice时也可以改变目标方法调用时传递的参数，这个时候要用到ProceedingJoinPoint 的带参数的proceed(Object[] args)方法了。如下示例中我们就在Around Advice中把调用目标方法的参数替换为15了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Around</span>(<span class="string">"bean(userService)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"-----around with pointcut expression: bean(userService)------"</span>);</span><br><span class="line">	System.out.println(<span class="string">"---------------------调用前---------------------"</span>);</span><br><span class="line">	Object[] params = <span class="keyword">new</span> Object[]&#123;<span class="number">15</span>&#125;;</span><br><span class="line">	Object result = pjp.proceed(params);<span class="comment">//可以调整目标方法调用时传递的参数</span></span><br><span class="line">	System.out.println(<span class="string">"---------------------调用后---------------------"</span>);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Advice执行顺序"><a href="#Advice执行顺序" class="headerlink" title="Advice执行顺序"></a>Advice执行顺序</h2><p>官方的说法是在进入切入点前优先级越高的越先执行，而在从切入点出去时优先级越高的会越后执行。当一个切面类中定义了多个Advice需要作用于同一个切入点时它们的执行顺序是不确定的，理由是无法通过反射获取到这些Advice在编译好的字节码中的声明顺序，这种情况下官方建议将多种切面逻辑整合到一个Advice中处理，以免造成错误。当两个定义在不同的切面中的Advice需要作用在同一个切入点时，除非你在切面类上使用@Order注解指定了顺序，数字越小表示优先级越高，或者是使切面类实现Ordered接口。以下是官方原文地址。</p>
<p><a href="http://docs.spring.io/spring/docs/4.1.0.RELEASE/spring-framework-reference/html/aop.html#aop-ataspectj-advice-ordering" target="_blank" rel="noopener">官网文档</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/5.2.9.RELEASE/spring-framework-reference/core.html#aop-introduction-defn" target="_blank" rel="noopener">新版地址5.2.9</a></p>
<p>（注：本文是基于Spring4.1.0所写，写于2017年1月19日星期四）</p>
<h1 id="给Advice传递参数"><a href="#给Advice传递参数" class="headerlink" title="给Advice传递参数"></a>给Advice传递参数</h1><p>Advice除了可以接收JoinPoint（非Around Advice）或ProceedingJoinPoint（Around Advice）参数外，还可以直接接收与切入点方法执行有关的对象，比如切入点方法参数、切入点目标对象（target）、切入点代理对象（this）等。</p>
<h2 id="获取切入点方法参数"><a href="#获取切入点方法参数" class="headerlink" title="获取切入点方法参数"></a>获取切入点方法参数</h2><p>假设我们现在有一个id为userService的bean中定义了一个findById(int id)方法，我们希望定义一个Advice来拦截这个方法，并且把findById()的参数作为Advice处理方法的参数，即每次调用findById()传递的参数都将传递到Advice处理方法，那么我们可以如下这样定义。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(value=<span class="string">"bean(userService) &amp;&amp; execution(* findById(java.lang.Integer)) &amp;&amp; args(id)"</span>, argNames=<span class="string">"id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam</span><span class="params">(JoinPoint joinPoint, Integer id)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">" ID is : "</span> + id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这种定义是非常精确的定义，我们通过表达式“bean(userService) &amp;&amp; execution(* findById(java.lang.Integer))”就已经明确的指定了我们需要拦截的是id或name为userService的findById(Integer)方法，后面又加了一个args(id)是干什么用的呢？它的作用跟findById(Integer)是类似的，它表示我们的切入点方法必须只接收一个参数，而且这个参数的类型是和当前定义的Advice处理方法的参数id是相同类型的，在上面的示例中其实就是要求是Integer类型的；另外它还有一个非常重要的作用，通过这种指定后对应的Advice处理方法在执行时将接收到与之对应的切入点方法参数的值。在上面的示例中笔者特意给Advice处理方法加了一个JoinPoint参数是为了说明JoinPoint、ProceedingJoinPoint参数是可以直接定义在Advice方法的第一个参数，并且是可以与其它接收的参数共存的。其实如果我们不只是需要拦截findById(Integer)方法，而是需要拦截id为userService的bean中所有接收一个int/Integer参数的方法，那么我们可以把上面的配置简化为如下这样。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(value=<span class="string">"bean(userService) &amp;&amp; args(id)"</span>, argNames=<span class="string">"id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam2</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">" ID is : "</span> + id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们需要拦截的方法可能是有多个参数的，但我们只关注第一个参数，那我们可以把表达式调整为如下这样，只关注第一个参数为int/Integer类型的，并且在Advice方法中接收这个方法参数进行相应的处理。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(value=<span class="string">"bean(userService) &amp;&amp; args(id,..)"</span>, argNames=<span class="string">"id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam2</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">" ID is : "</span> + id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="argNames参数"><a href="#argNames参数" class="headerlink" title="argNames参数"></a>argNames参数</h2><p>我们可以看到在上述例子中我们都指定了@Before的argNames属性的值为id，那么这个argNames属性有什么作用呢？argNames属性是用于指定在表达式中应用的参数名与Advice方法参数是如何对应的，argNames中指定的参数名必须与表达式中的一致，可以与Advice方法参数名不一致；当表达式中使用了多个参数时，argNames中需要指定多个参数，多个参数之间以英文逗号分隔，这些参数的顺序必须与对应的Advice方法定义的参数顺序是一致的。比如下面这个示例中，我们在Pointcut表达式中使用了name和sex两个参数，我们的Advice处理方法接收两个参数，分别是sex1和name1，我们希望Pointcut表达式中的name参数是对应的Advice处理方法的第二个参数，即name1，希望Pointcut表达式中的sex参数是对应的Advice处理方法的第一个参数，即sex1，那么我们在指定@Before注解的argNames参数时必须定义name和sex参数与Advice处理方法参数的关系，且顺序要求与对应的处理方法的参数顺序一致，即哪个参数是需要与Advice处理方法的第一个参数匹配则把哪个参数放第一位，与第二个参数匹配的则放第二位，在我们的这个示例中就应该是sex放第一位，name放第二位。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(value=<span class="string">"bean(userService) &amp;&amp; args(name, sex)"</span>, argNames=<span class="string">"sex, name"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam3</span><span class="params">(<span class="keyword">int</span> sex1, String name1)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"sex is : "</span> + sex1);</span><br><span class="line">	System.out.println(<span class="string">"name is : "</span> + name1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Before注解的argNames参数不是必须的，它只有在我们编译的字节码中不含DEBUG信息或Pointcut表达式中使用的参数名与Advice处理方法的参数名不一致时才需要。所以在编译的字节码中包含DEBUG信息且Advice参数名与Pointcut表达式中使用的参数名一致时，我们完全可以把argNames参数省略。如果表达式里面使用了多个参数，那么这些参数在表达式中的顺序可以与Advice方法对应参数的顺序不一致，例如下面这个样子。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(value=<span class="string">"bean(userService) &amp;&amp; args(id)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam2</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">" ID is : "</span> + id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取this对象"><a href="#获取this对象" class="headerlink" title="获取this对象"></a>获取this对象</h2><p>this对象就是Spring生成的bean的那个代理对象。如下示例就是Advice方法接收this对象，我们给Advice方法指定一个需要拦截的this对象类型的参数，然后在表达式中使用this类型的表达式定义，表达式中定义的对应类型指定为Advice方法参数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"this(userService)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam4</span><span class="params">(IUserService userService)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//this对象应该是一个代理对象</span></span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">"==============传递this对象： "</span> + userService.getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="混合使用"><a href="#混合使用" class="headerlink" title="混合使用"></a>混合使用</h2><p>我们的Advice方法可以同时接收多个目标方法参数，与此同时它也可以接收this等对象，即它们是可以混合使用的。下面这个示例中我们就同时接收了this对象和目标方法int/Interger类型的参数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"this(userService) &amp;&amp; args(id)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam5</span><span class="params">(IUserService userService, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">"==========="</span> + id + <span class="string">"=============="</span> + userService.getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取target对象"><a href="#获取target对象" class="headerlink" title="获取target对象"></a>获取target对象</h2><p>获取target对象也比较简单，只需要把表达式改为target类型的表达式即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"target(userService)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam6</span><span class="params">(IUserService userService)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">"==============传递target对象： "</span> + userService.getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取注解对象"><a href="#获取注解对象" class="headerlink" title="获取注解对象"></a>获取注解对象</h2><p>当我们的Pointcut表达式类型是通过注解匹配时，我们也可以在Advice处理方法中获取匹配的注解对象，如下面这个示例，其它如使用@target等是类似的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"@annotation(annotation)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam7</span><span class="params">(MyAnnotation annotation)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="keyword">this</span>.getClass().getName()+<span class="string">"==============传递标注在方法上的annotation： "</span> + annotation.annotationType().getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="泛型参数"><a href="#泛型参数" class="headerlink" title="泛型参数"></a>泛型参数</h2><p>有的时候我们的Advice方法需要接收的切入点方法参数定义的不是具体的类型，而是一个泛型，这种情况下怎么办呢？可能你会想那我就把对应的Advice方法参数定义为Object类型就好了，反正所有的类型都可以转换为Object类型。对的，这样是没有错的，但是说如果你只想拦截某种具体类型的参数调用时就可以不用把Advice方法参数类型定义为Object了，这样还得在方法体里面进行判断，我们可以直接把Advice方法参数类型定义为我们想拦截的方法参数类型。比如我们有下面这样一个使用了泛型的方法定义，我们希望只有在调用testParam方法时传递的参数类型是Integer类型时才进行拦截。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">testParam</span><span class="params">(T param)</span></span>;</span><br></pre></td></tr></table></figure>

<p>那这个时候我们就可以把我们的Advice的表达式定义为如下这样，前者精确定义接收方法名为testParam，返回类型为void，后者精确定义方法参数为一个Integer类型的参数，其实前者也可以定义为“execution(void testParam(Integer))”。看到这你可能会想，为什么不直接把表达式定义为“execution(void testParam(param))”呢？因为execution是不支持Advice方法参数绑定的，基本上支持Advice参数绑定的就只有this、target、args以及对应的注解形式加@annotation。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(void testParam(..)) &amp;&amp; args(param)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam8</span><span class="params">(Integer param)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"pointcut expression[args(param)]--------------param:"</span> + param);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是常用的传递参数给Advice处理方法的方式，有一些示例可能没有讲到，比如@target这种，这些其实都是类似的。包括上面我们都是以@Before这种Advice来讲的，其实其它的Advice在接收参数的时候也是类似的。</p>
<p><strong>参考文档</strong><br>1、官方文档</p>
<p>（注：本文是基于Spring4.1.0所写，写于2017年1月20日星期五）</p>
<h1 id="DeclareParents介绍"><a href="#DeclareParents介绍" class="headerlink" title="@DeclareParents介绍"></a>@DeclareParents介绍</h1><p>@DeclareParents注解也是Aspectj提供的，在使用基于Aspectj注解的Spring Aop时，我们可以在切面中通过@DeclareParents指定满足指定表达式的类将自动实现某些接口。这个只是在运行时会将生成的代理类实现指定的接口。有接口就会有实现，对应的实现类也需要我们在@DeclareParents声明自动实现的接口时声明。现假设我们有一个接口叫CommonParent，其实现类叫CommonParentImpl，代码如下。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommonParent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonParentImpl</span> <span class="keyword">implements</span> <span class="title">CommonParent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"-----------do something------------"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们希望我们的所有的Service实现类都可以在运行时自动实现CommonParent接口，即所有的Service实现类在运行时都可以被当做CommonParent来使用。那我们可以定义如下这样一个切面类和对应的Advice。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeclareParentsAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@DeclareParents</span>(value=<span class="string">"com.elim.spring.aop.service..*"</span>, defaultImpl=CommonParentImpl<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">	<span class="title">private</span> <span class="title">CommonParent</span> <span class="title">commonParent</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"bean(userService) &amp;&amp; this(commonParent)"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeUserService</span><span class="params">(CommonParent commonParent)</span> </span>&#123;</span><br><span class="line">		commonParent.doSomething();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上，我们先在切面类中声明了一个CommonParent类型的属性，然后在上面使用了@DeclareParents注解表示我们需要把CommonParent声明为某些指定类型的父接口，然后通过@DeclareParents的value属性指定需要作用的类的形式，其语法和Pointcut表达式类似。通过defaultImpl属性指定默认CommonParent接口的实现类是CommonParentImpl。然后我们声明了一个before类型的Advice，在其中直接把我们的bean当做CommonParent类型的对象使用。</p>
<p>整个过程就是这样的，非常简单。但是笔者暂时还没有发现这个在实际应用中可以应用于哪些场景，欢迎交流。</p>
<p>参考文档 1、官方文档</p>
<p>（注：本文是基于Spring4.1.0所写，写于2017年1月22日星期日）</p>
<h1 id="基于XML配置的Spring-AOP"><a href="#基于XML配置的Spring-AOP" class="headerlink" title="基于XML配置的Spring AOP"></a>基于XML配置的Spring AOP</h1><p>基于XML配置的Spring AOP需要引入AOP配置的Schema，然后我们就可以使用AOP Schema下定义的config、aspect、pointcut等标签进行Spring AOP配置了。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/beans/spring-beans-4.1.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/context/spring-context-4.1.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.1.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>基于XML配置的Spring AOP的核心配置是config元素，其它的诸如切面配置、切入点配置等都是配置在它的下面的，所以我们需要先定义一个config元素。</p>
<h2 id="配置切面"><a href="#配置切面" class="headerlink" title="配置切面"></a>配置切面</h2><p>切面的配置是通过aspect元素配置的，我们需要通过其ref属性指定切面类对应的Spring bean的id或name，还可以通过其order属性指定切面类的在拦截的时候的优先级。需要说明的是在使用Spring时基于XML的配置和基于注解的配置往往是可以混用的，所以在下面示例中我们使用的切面类引用不一定非得在Spring的bean配置文件中进行配置。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"schemaBasedAspect"</span> <span class="attr">class</span>=<span class="string">"com.elim.spring.aop.aspect.SchemaBasedAspect"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 基于XML的AOP配置是基于config元素开始的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 定义切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"aspect1"</span> <span class="attr">ref</span>=<span class="string">"schemaBasedAspect"</span> <span class="attr">order</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置切入点"><a href="#配置切入点" class="headerlink" title="配置切入点"></a>配置切入点</h2><p>切入点可以是直接配置在config元素下的，意为顶级切入点，也可以是配置在指定的aspect下面的。切入点的配置是通过pointcut元素来配置的，在配置的时候我们需要指定id和expression属性，expression属性就对应的是切入点的表达式，其配置规则跟基于Aspectj注解配置时的规则是一样的。如下示例中就定义了两个pointcut，一个是顶级的，一个是在aspectj1中定义的。需要注意的是顶级的Pointcut必须定义在aspect之前。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"bean(userService)"</span> <span class="attr">id</span>=<span class="string">"userServicePointCut2"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 定义切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"aspect1"</span> <span class="attr">ref</span>=<span class="string">"schemaBasedAspect"</span> <span class="attr">order</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"bean(userService)"</span> <span class="attr">id</span>=<span class="string">"userServicePointCut"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我们的切入点是以Aspectj注解的形式定义在类里面的，我们也可以像在前面介绍的基于Aspectj注解配置那样进行引用，如在下面这个配置就是使用的在SchemaBasedAspect类的pointcut方法上通过@Pointcut指定的表达式。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"com.elim.spring.aop.aspect.SchemaBasedAspect.pointcut()"</span> <span class="attr">id</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置Advice"><a href="#配置Advice" class="headerlink" title="配置Advice"></a>配置Advice</h2><p>切面的最终目的是为了拦截指定切入点的方法执行，然后加入自己特定逻辑的，有了切面定义和切入点的定义后，我们需要定义在哪些切入点上需要使用切面的哪些Advice，即执行切面类的哪些方法。我们知道Advice有before、after、after returning、after throwing和around五种，对应的分别是before、after、after-returning、after-throwing和around标签，它们都是定义在aspect标签下的。这五类Advice在定义时的用法基本上是类似的，通过method方法指定Advice对应的是aspect类的哪个方法，然后通过pointcut指定切入点的表达式，或者通过pointcut-ref指定需要引用的是哪个切入点。如下示例中我们就定义了两个Advice，before Advice指定了对应的是切面类的doBefore方法，然后通过pointcut-ref指定需要使用的切入点是id为userServicePointCut的切入点；around Advice指定了对应的是切面类的doAround方法，然后通过pointcut直接指定了需要作用的切入点表达式。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"aspect1"</span> <span class="attr">ref</span>=<span class="string">"schemaBasedAspect"</span> <span class="attr">order</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 定义一个Around Advice --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"doBefore"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointCut"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"doAround"</span> <span class="attr">pointcut</span>=<span class="string">"bean(userService)"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"bean(userService)"</span> <span class="attr">id</span>=<span class="string">"userServicePointCut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>和基于注解的配置类似，如果我们需要在afterReturning Advice中访问返回值，我们也可以给对应的处理方法一个返回值对应类型（或Object类型）的参数，然后通过after-returning元素的returning属性指定返回值需要赋予给Advice处理方法的哪个参数，参数名需要一致。同样afterThrowing类型的Advice需要在处理方法中接收抛出的异常时，也可以给定对应的处理方法一个Exception类型的参数，然后通过after-throwing元素的throwing属性指定抛出的异常需要赋值给Advice处理方法的哪个参数。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"doAfterReturning"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span> <span class="attr">returning</span>=<span class="string">"returnValue"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"doAfterThrowing"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span> <span class="attr">throwing</span>=<span class="string">"ex"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>参数传递也是类似的，在Advice处理方法上给定指定的参数，然后在定义Pointcut表达式的时候加上对应的参数传递限制，如“args(id)”、“this(userService)”等，在需要指定参数的绑定顺序时，可以通过before、around等Advice标签的arg-names属性指定。如下示例中我们就要求id为userServicePointCut的Pointcut需要接收一个参数，这个参数是需要跟对应的Advice处理方法绑定的，而before Advice是使用该Pointcut的，所以就要求id与对应的处理方法参数绑定，而且对应的方法参数名需要是id。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"aspect1"</span> <span class="attr">ref</span>=<span class="string">"schemaBasedAspect"</span> <span class="attr">order</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"doBefore"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointCut"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"doAround"</span> <span class="attr">pointcut</span>=<span class="string">"bean(userService)"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"bean(userService) <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> args(id)"</span> <span class="attr">id</span>=<span class="string">"userServicePointCut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们对应的doBefore处理方法是这样的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"======================doBefore======================"</span> + id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的示例中在定义id为userServicePointcut的表达式的时候用到了“&amp;&amp;”，这是因为在XML中&amp;是特殊字符，我们必须对它进行转义。其实在XML中配置Pointcut表达式时我们可以使用“and”、“or”和“not”替代“&amp;&amp;”、“||”和“!”。</p>
<h2 id="declare-parents"><a href="#declare-parents" class="headerlink" title="declare-parents"></a>declare-parents</h2><p>在基于注解的形式定义AOP时，我们有一个<code>@DeclareParents</code>注解可以给所有匹配的bean生成的代理默认加上指定的接口实现，并使用默认的实现。如果是基于XML配置时想达到对应的效果我们可以通过<code>declare-parents</code>元素。示例如下:</p>
<p>切面类<code>SchemaBasedAspect</code>有一个<code>doBefore</code>方法接收一个<code>CommonParent</code>参数，我们在配置切面时配置了一个<code>before Advice</code>将调用切面类的<code>doBefore</code>方法；通过<code>declare-parents</code>元素指定<code>service</code>包下面所有的类都实现<code>CommonParent</code>接口，底层在调用的时候将会调用<code>CommonParentImpl</code>的实现。<code>CommonParent</code>接口的源码没有提供，其只定义了一个返回类型为void的doSomething()方法。然后我们的before Advice将拦截id为<code>userService</code>的bean的所有方法调用，注意因为我们声明了所有的Service都将实现<code>CommonParent</code>接口，所以生成的id为<code>userService</code>的bean其实也是实现了<code>CommonParent</code>接口的，在调用的<code>doBefore</code>方法时传递的就是id为<code>userService</code>的bean，我们在<code>doBefore</code>方法中又继续调用<code>CommonParent</code>的<code>doSomething</code>方法就相当于重新调用了id为<code>userService</code>的bean的方法，会造成<code>before Advice</code>循环拦截和调用。</p>
<p>很显然此种情况下，我们是不希望CommonParent的方法调用还被拦截的，所以我们在对应的Pointcut表达式上把CommonParent的doSomething方法排除了。在应用注解的时候不用排除也不会循环调用，但是使用XML配置时必须排除。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(CommonParent commonParent)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"======================doBefore======================"</span>);</span><br><span class="line">	commonParent.doSomething();</span><br><span class="line">&#125;</span><br><span class="line">&lt;bean id=<span class="string">"schemaBasedAspect"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.elim.spring.aop.aspect.SchemaBasedAspect"</span> /&gt;</span><br><span class="line">&lt;bean id=<span class="string">"commonParent"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.elim.spring.aop.service.CommonParentImpl"</span> /&gt;</span><br><span class="line">&lt;!-- 基于XML的AOP配置是基于config元素开始的 --&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">	&lt;aop:aspect id=<span class="string">"aspect1"</span> ref=<span class="string">"schemaBasedAspect"</span> order=<span class="string">"1"</span>&gt;</span><br><span class="line">		&lt;aop:before method=<span class="string">"doBefore"</span> pointcut-ref=<span class="string">"userServicePointCut"</span> /&gt;</span><br><span class="line">		&lt;aop:pointcut expression=<span class="string">"bean(userService) and this(commonParent) and !execution(void com.elim.spring.aop.service.CommonParent.doSomething())"</span></span><br><span class="line">			id=<span class="string">"userServicePointCut"</span> /&gt;</span><br><span class="line">		&lt;!-- 加上通用的父类 --&gt;</span><br><span class="line">		&lt;aop:declare-parents types-matching=<span class="string">"com.elim.spring.aop.service..*"</span></span><br><span class="line">			implement-<span class="class"><span class="keyword">interface</span></span>=<span class="string">"com.elim.spring.aop.service.CommonParent"</span></span><br><span class="line">			delegate-ref=<span class="string">"commonParent"</span>/&gt;</span><br><span class="line">	&lt;/aop:aspect&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>

<h2 id="启用CGLIB代理类"><a href="#启用CGLIB代理类" class="headerlink" title="启用CGLIB代理类"></a>启用CGLIB代理类</h2><p>默认情况下当bean实现了接口时Spring AOP是基于JDK的动态代理的，也就是说我们生成的bean只能调用接口中定义的方法，如果我们的bean是没有实现接口的，则会采用CGLIB代理。如果我们希望不管bean是否实现了接口都采用CGLIB代理，则在基于Aspectj注解进行AOP配置时，我们可以通过aspectj-autoproxy元素的proxy-target-class=”true”启用CGLIB代理。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果是基于XML的配置时，我们也希望强制使用CGLIB代理时怎么办呢？我们可以在config元素上配置proxy-target-class=”true”。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（注：本文是基于Spring4.1.0所写，Elim写于2017年1月23日星期一）</p>
<h1 id="advisor标签"><a href="#advisor标签" class="headerlink" title="advisor标签"></a>advisor标签</h1><p>advisor标签是需要定义在aspect标签里面的，其作用与aspect类似，可以简单的把它理解为一个特殊的切面，用于把一个Advice和一个Pointcut组合起来。一个advisor标签对应的就是一个Advisor接口的实现类，默认是DefaultBeanFactoryPointcutAdvisor实现。其使用的基本语法类似如下这样。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">""</span> <span class="attr">pointcut-ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的advice-ref属性用于指定一个org.aopalliance.aop.Advice实现，该接口没有任何内容，只是起到标记作用，用于标记某个类是Advice。pointcut-ref用于指定一个通过已经存在的Pointcut定义，当然也可以直接通过pointcut属性指定对应的Pointcut表达式。如果在一个config元素下既定义了aspect，又定义了advisor，那advisor必须定义在aspect之前。接下来看一下如何通过advisor标签应用常用的5种Advice，本文旨在介绍advisor是如何用的，以及如何使用5种Advice，至于每种Advice的功能、区别啥的已经在之前的文章中已经介绍过了，就不再赘述了，有兴趣的读者请参考以前的博文。</p>
<h2 id="before-Advice"><a href="#before-Advice" class="headerlink" title="before Advice"></a>before Advice</h2><p>对应于切入点方法执行前的拦截的Advice接口是BeforeAdvice接口，这个接口也是一个空接口没有实现，我们在自定义自己的BeforeAdvice实现时不直接实现BeforeAdvice接口，而是实现MethodBeforeAdvice接口。这是Spring为了将来可以支持对类的成员变量的访问进行拦截而预留的定义，也就是说将来BeforeAdvice还会有一个基于对类的成员变量访问的拦截的子接口定义。MethodBeforeAdvice接口中定义了一个before方法，在调入目标方法前就会调用before方法。如下就是一个MethodBeforeAdvice的实现示例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogBeforeAdvice</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"===============before advice start=============="</span>);</span><br><span class="line">		System.out.println(<span class="string">"method: "</span> + method);</span><br><span class="line">		System.out.println(<span class="string">"args: "</span> + args);</span><br><span class="line">		System.out.println(<span class="string">"target: "</span> + target);</span><br><span class="line">		System.out.println(<span class="string">"===============before advice end================"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义了Advice之后，我们就可以通过advisor标签来把它和指定的PointCut绑定了。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"bean(userService)"</span> <span class="attr">id</span>=<span class="string">"userServicePointcut"</span>/&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logBeforeAdvice"</span> <span class="attr">order</span>=<span class="string">"1"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logBeforeAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.spring.aop.advice.LogBeforeAdvice"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="around-Advice"><a href="#around-Advice" class="headerlink" title="around Advice"></a>around Advice</h2><p>around Advice的实现需要实现org.aopalliance.intercept.MethodInterceptor接口，该接口定义了一个接收MethodInvacation类型的参数的invoke方法。通过MethodInvocation对象可以获取到目标方法、方法参数等信息，然后还可以通过调用其proceed方法来调用对应的目标方法，所以我们可以根据需要来判断是否需要调用目标方法。invoke方法的返回值将作为目标方法的调用者接收到的返回值，所以我们也可以在invoke方法中根据需要判断需要给目标方法调用者返回什么样的结果。以下是一个MethodInterceptor接口实现示例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAroundAdvice</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"=============================方法调用开始==="</span> + invocation.getMethod());</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Object result = invocation.proceed();</span><br><span class="line">			System.out.println(<span class="string">"=============================方法调用正常结束==="</span> + invocation.getMethod());</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"=============================方法调用异常==="</span> + invocation.getMethod());</span><br><span class="line">			<span class="keyword">throw</span> e;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之前介绍基于XML配置和基于Aspectj注解的配置进行Around Advice配置时都可以在运行时根据条件来改变实际调用目标方法时传递的参数，那么如果我们直接实现MethodInterceptor接口是否又可以呢？答案是肯定的，MethodInterceptor的invoke方法参数MethodInvocation中已经封装了或者目标方法和参数的信息，如果需要改变传递的参数，我们可以不调用MethodInvocation的proceed方法，而是选择获取当前Method，然后直接调用Method的invoke方法传递自己所需要的参数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAroundAdvice</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"=============================方法调用开始==="</span> + invocation.getMethod());</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Object result = invocation.getMethod().invoke(invocation.getThis(), <span class="number">1</span>);</span><br><span class="line">			System.out.println(<span class="string">"=============================方法调用正常结束==="</span> + invocation.getMethod());</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"=============================方法调用异常==="</span> + invocation.getMethod());</span><br><span class="line">			<span class="keyword">throw</span> e;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其配置与before advice的配置是类似的。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"bean(userService)"</span> <span class="attr">id</span>=<span class="string">"userServicePointcut"</span>/&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logAroundAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logAroundAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.spring.aop.advice.LogAroundAdvice"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="afterReturning-Advice"><a href="#afterReturning-Advice" class="headerlink" title="afterReturning Advice"></a>afterReturning Advice</h2><p>AfterReturning Advice将在目标方法正常返回时触发，对应的是AfterReturningAdvice接口，其定义如下，第一个参数是目标方法的返回值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AfterReturningAdvice</span> <span class="keyword">extends</span> <span class="title">AfterAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下是笔者的一个测试实现。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAfterReturningAdvice</span> <span class="keyword">implements</span> <span class="title">AfterReturningAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"==============调用成功返回，返回值是："</span> + returnValue);</span><br><span class="line">		System.out.println(<span class="string">"Method: "</span> + method);</span><br><span class="line">		<span class="keyword">if</span> (returnValue <span class="keyword">instanceof</span> User) &#123;</span><br><span class="line">			<span class="comment">//不能修改返回值，但可以修改返回值的某些属性，因为是对象引用</span></span><br><span class="line">			((User) returnValue).setName(<span class="string">"modifyedName"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="afterThrowing-Advice"><a href="#afterThrowing-Advice" class="headerlink" title="afterThrowing Advice"></a>afterThrowing Advice</h2><p>afterThrowing Advice对应的Advice接口子类是ThrowsAdvice，该接口也是一个空接口，也是用于标记作用的，但是不同于BeforeAdvice定义了可供用户实现的包含方法定义的子接口MethodBeforeAdvice，ThrowingAdvice没有这样的子接口。这是因为用户可能需要同时对多种异常进行处理，如果把接口方法定义好了，那用户只能在方法体中判断当前捕获的异常类型了。没有方法定义时用户就可以在实现类中定义很多的异常处理方法了，但是这些方法也不是随便定义的，它们必须满足以下形式。其中的方法名必须为afterThrowing，方法参数只有最后一个subclassOfThrowable是必须的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">afterThrowing([Method, args, target], subclassOfThrowable)</span><br></pre></td></tr></table></figure>

<p>以下是一个实现示例，在示例中我们一共实现了三个处理Exception的方法，前两个处理方法用于处理特定的异常类型，而且只接收一个异常类型参数，最后一个处理方法接收所有的参数，处理除前两者以外的其它异常。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogThrowsAdvice</span> <span class="keyword">implements</span> <span class="title">ThrowsAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理IllegalArgumentException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(IllegalArgumentException e)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"=====================方法调用异常，抛出了IllegalArgumentException"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理NumberFormatException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(NumberFormatException e)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"=====================方法调用异常，抛出了NumberFormatException"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理其它所有的异常</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(Method method, Object[] args, Object target, Exception e)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"=====================方法调用异常了，"</span> + e);</span><br><span class="line">		System.out.println(<span class="string">"Method: "</span> + method);</span><br><span class="line">		System.out.println(<span class="string">"Args: "</span> + args);</span><br><span class="line">		System.out.println(<span class="string">"Target: "</span> + target);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="after-Advice"><a href="#after-Advice" class="headerlink" title="after Advice"></a>after Advice</h2><p>对于After Advice类型的Advice没有特定的接口供我们实现，如果需要自己实现一个Advice可以达到after Advice那样的效果，即无论切入点方法是否抛出异常都执行某些逻辑时，可以使用MethodInterceptor代替，在方法实现中使用try…finally形式即可。</p>
<p>上面配置的完整配置如下。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"bean(userService)"</span> <span class="attr">id</span>=<span class="string">"userServicePointcut"</span>/&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logBeforeAdvice"</span> <span class="attr">order</span>=<span class="string">"1"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointcut"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logThrowsAdvice"</span> <span class="attr">order</span>=<span class="string">"2"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointcut"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logAfterReturningAdvice"</span> <span class="attr">order</span>=<span class="string">"3"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointcut"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logAroundAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"userServicePointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logBeforeAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.spring.aop.advice.LogBeforeAdvice"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logThrowsAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.spring.aop.advice.LogThrowsAdvice"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logAfterReturningAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.spring.aop.advice.LogAfterReturningAdvice"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logAroundAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.spring.aop.advice.LogAroundAdvice"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>（注：本文是基于Spring4.1.0，Elim写于2017年1月23日星期一）</p>
<h1 id="基于正则表达式的Pointcut"><a href="#基于正则表达式的Pointcut" class="headerlink" title="基于正则表达式的Pointcut"></a>基于正则表达式的Pointcut</h1><h2 id="JdkRegexpMethodPointcut"><a href="#JdkRegexpMethodPointcut" class="headerlink" title="JdkRegexpMethodPointcut"></a>JdkRegexpMethodPointcut</h2><p>Spring官方为我们提供了一个基于正则表达式来匹配方法名的Pointcut，<code>JdkRegexpMethodPointcut</code>。该Pointcut是继承自<code>StaticMethodMatcherPointcut</code>的。我们在定义<code>JdkRegexpMethodPointcut</code>时可以通过<code>patterns</code>和<code>excludedPatterns</code>来注入需要满足和排除的正则表达式，它们对应的都是一个<code>String[]</code>。比如我们想匹配所有的方法名以<code>find</code>开头的方法，我们可以如下定义：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"regexPointcut"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.JdkRegexpMethodPointcut"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"patterns"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>find.*<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="comment">&lt;!-- 所有方法名以find开始的方法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我们需要匹配或需要排除的正则表达式只是单一的一个正则表达式，那么我们也可以通过<code>pattern</code>和<code>excludedPattern</code>来指定单一的需要匹配和排除的正则表达式。需要注意的是<code>patterns</code>和<code>pattern</code>不能同时使用，<code>excludedPattern</code>和<code>excludedPatterns</code>也是一样的。当我们同时指定了<code>patterns</code>和<code>excludedPatterns</code>时，该<code>Pointcut</code>将先匹配<code>patterns</code>，对于能够匹配<code>patterns</code>的将再判断其是否在<code>excludedPatterns</code>中，如果存在也将不匹配。以下是该匹配逻辑的核心代码。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">matchesPattern</span><span class="params">(String signatureString)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.patterns.length; i++) &#123;</span><br><span class="line">		<span class="keyword">boolean</span> matched = matches(signatureString, i);</span><br><span class="line">		<span class="keyword">if</span> (matched) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="keyword">this</span>.excludedPatterns.length; j++) &#123;</span><br><span class="line">				<span class="keyword">boolean</span> excluded = matchesExclusion(signatureString, j);</span><br><span class="line">				<span class="keyword">if</span> (excluded) &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要说明的是在上面的匹配逻辑中传递的参数signatureString是对应方法的全路径名称，即包含该方法的类的全路径及该方法的名称，如“org.springframework.aop.support.JdkRegexpMethodPointcut.matches”这种，所以如果我们需要在使用正则表达式定义Pointcut时，也可以匹配某某类的某某方法这种形式。</p>
</blockquote>
<h2 id="RegexpMethodPointcutAdvisor"><a href="#RegexpMethodPointcutAdvisor" class="headerlink" title="RegexpMethodPointcutAdvisor"></a>RegexpMethodPointcutAdvisor</h2><p>使用了<code>JdkRegexpMethodPointcut</code>后，我们在使用的时候通常会进行如下配置。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logBeforeAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"regexPointcut"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logBeforeAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.advice.LogBeforeAdvice"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"regexPointcut"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.JdkRegexpMethodPointcut"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"patterns"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>find.*<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="comment">&lt;!-- 所有方法名以find开始的方法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其实针对于<code>JdkRegexpMethodPointcut</code>，Spring为我们提供了一个简便的<code>Advisor</code>定义，可以让我们同时指定一个<code>JdkRegexpMethodPointcut</code>和其需要对应的<code>Advice</code>，那就是<code>RegexpMethodPointcutAdvisor</code>，我们可以给它注入一个Advice和对应需要匹配的正则表达式（pattern或patterns注入）。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.RegexpMethodPointcutAdvisor"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"advice"</span> <span class="attr">ref</span>=<span class="string">"logBeforeAdvice"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pattern"</span> <span class="attr">value</span>=<span class="string">"find.*"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是<code>RegexpMethodPointcutAdvisor</code>没有提供不匹配的正则表达式注入方法，即没有excludedPattern和excludedPatterns注入，如果需要该功能请还是使用<code>JdkRegexpMethodPointcut</code>。</p>
</blockquote>
<p>（本文是基于Spring4.1.0所写，Elim写于2017年5月8日）</p>
<h1 id="编程式的Pointcut"><a href="#编程式的Pointcut" class="headerlink" title="编程式的Pointcut"></a>编程式的Pointcut</h1><p>除了可以通过注解和Xml配置定义Pointcut之外，其实我们还可以通过程序来定义<code>Pointcut</code>。Spring Aop的切入点（Pointcut）对应于它的一个<code>Pointcut</code>接口，全称是<code>org.springframework.aop.Pointcut</code>。该接口的定义如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Pointcut</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">ClassFilter <span class="title">getClassFilter</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">MethodMatcher <span class="title">getMethodMatcher</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	Pointcut TRUE = TruePointcut.INSTANCE;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该接口一共定义了两个核心方法，一个用于获取该Pointcut对应的过滤Class的ClassFilter对象，一个用于获取过滤Method的MethodMatcher对象。<br>ClassFilter接口的定义如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClassFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Class&lt;?&gt; clazz)</span></span>;</span><br><span class="line"></span><br><span class="line">	ClassFilter TRUE = TrueClassFilter.INSTANCE;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该接口只定义了一个matches方法，用于判断指定的Class对象是否匹配当前的过滤规则。<br>MethodMatcher接口定义如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MethodMatcher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Method method, Class&lt;?&gt; targetClass)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isRuntime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Method method, Class&lt;?&gt; targetClass, Object[] args)</span></span>;</span><br><span class="line"></span><br><span class="line">	MethodMatcher TRUE = TrueMethodMatcher.INSTANCE;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该接口中一共定义了三个方法，两个matches方法，一个包含方法参数一个不包含。不包含方法参数的matches方法用于判断非运行时的方法匹配，比如只需要匹配方法名、方法参数定义的；包含方法参数值的matches方法用于运行时判断方法是否匹配，应用于需要根据方法传参来判断是否匹配的情况，但是该方法一般会在不包含方法参数的matches方法返回true和isRuntime()方法true的情形下才会调用。isRuntime()方法用于指定该Pointcut是否需要在运行时才能判断对应的方法是否匹配。</p>
<h2 id="自定义Pointcut"><a href="#自定义Pointcut" class="headerlink" title="自定义Pointcut"></a>自定义Pointcut</h2><p>以下是一个自定义Pointcut的代码，其将匹配所有的名称Service结尾的Class对应的名称以find开始的方法调用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.ClassFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.MethodMatcher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义Pointcut</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Elim</span></span><br><span class="line"><span class="comment"> * 2017年5月8日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCustomPointcut</span> <span class="keyword">implements</span> <span class="title">Pointcut</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ClassFilter <span class="title">getClassFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> MyCustomClassFilter();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> MethodMatcher <span class="title">getMethodMatcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> MyCustomMethodMatcher();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCustomClassFilter</span> <span class="keyword">implements</span> <span class="title">ClassFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">			<span class="comment">//实现自己的判断逻辑，这里简单的判断对应Class的名称是以Service结尾的就表示匹配</span></span><br><span class="line">			<span class="keyword">return</span> clazz.getName().endsWith(<span class="string">"Service"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCustomMethodMatcher</span> <span class="keyword">implements</span> <span class="title">MethodMatcher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Method method, Class&lt;?&gt; targetClass)</span> </span>&#123;</span><br><span class="line">			<span class="comment">//实现方法匹配逻辑</span></span><br><span class="line">			<span class="keyword">return</span> method.getName().startsWith(<span class="string">"find"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isRuntime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Method method, Class&lt;?&gt; targetClass, Object[] args)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们可以定义该自定义Pointcut对应的bean，再定义一个Advisor将使用该Pointcut。如下示例中我们就指定了将在MyCustomPointcut对应的切入点处采用LogAroundAdvice。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"logAroundAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myCustomPointcut"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logAroundAdvice"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.advice.LogAroundAdvice"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myCustomPointcut"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.pointcut.MyCustomPointcut"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="继承自现有的Pointcut"><a href="#继承自现有的Pointcut" class="headerlink" title="继承自现有的Pointcut"></a>继承自现有的Pointcut</h2><p>除了可以完全实现Pointcut接口外，我们还可以直接使用Spring自带的Pointcut。比如基于固定方法的StaticMethodMatcherPointcut。该Pointcut是一个抽象类，在使用该Pointcut时只需要实现一个抽象方法matches(Method method, Class&lt;?&gt; targetClass)，以下是一个继承自StaticMethodMatcherPointcut的示例类定义，该Pointcut将匹配所有Class中定义的方法名以find开头的方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FindMethodMatcherPointcut</span> <span class="keyword">extends</span> <span class="title">StaticMethodMatcherPointcut</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Method method, Class&lt;?&gt; targetClass)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> method.getName().startsWith(<span class="string">"find"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于更多Spring官方已经提供的其它Pointcut定义请参考Spring的API文档。</p>
<p>（注：本文是基于Spring4.1.0所写，Elim写于2017年5月8日）</p>
<h1 id="编程式的创建Aop代理之ProxyFactory"><a href="#编程式的创建Aop代理之ProxyFactory" class="headerlink" title="编程式的创建Aop代理之ProxyFactory"></a>编程式的创建Aop代理之ProxyFactory</h1><p>Spring Aop是基于代理的，ProxyFactory是Spring Aop内部用来创建Proxy对象的一个工厂类。如果我们需要在程序运行时来动态的应用Spring Aop，则我们可以考虑使用ProxyFactory。使用ProxyFactory时，我们需要为它指定我们需要代理的目标对象、代理时我们需要使用的Advisor或Advice。如下示例就是一个简单的使用ProxyFactory创建MyService对象的代理，同时对其应用了一个MethodBeforeAdvice，即每次调用代理对象的方法时都将先调用MethodBeforeAdvice的before方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testProxyFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	MyService myService = <span class="keyword">new</span> MyService();</span><br><span class="line">	ProxyFactory proxyFactory = <span class="keyword">new</span> ProxyFactory(myService);</span><br><span class="line">	proxyFactory.addAdvice(<span class="keyword">new</span> MethodBeforeAdvice() &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args,</span></span></span><br><span class="line"><span class="function"><span class="params">                           Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"执行目标方法调用之前的逻辑"</span>);</span><br><span class="line">			<span class="comment">//不需要手动去调用目标方法，</span></span><br><span class="line">                               <span class="comment">//Spring内置逻辑里面会调用目标方法</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;);;</span><br><span class="line">	MyService proxy = (MyService) proxyFactory.getProxy();</span><br><span class="line">	proxy.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="指定被代理对象"><a href="#指定被代理对象" class="headerlink" title="指定被代理对象"></a>指定被代理对象</h2><p>ProxyFactory有多个重载的构造函数，上面示例中笔者用的是指定被代理对象的构造函数，如果我们应用的是其它构造函数，则可以通过ProxyFactory的setTarget(Object)方法来指定被代理对象。如果我们没有指定被代理对象的Class，那么默认创建出来的代理对象是我们传递的被代理对象的类型，即获取的是targetObject.getClass()类型。如果我们的被代理对象的类型是包含多个接口实现或父类型的，而我们只希望代理其中的某一个类型时，我们可以通过ProxyFactory的setTargetClass(Class)来指定创建的代理对象是基于哪个Class的。默认情况下，ProxyFactory会根据实际情况选择创建的代理对象是基于JDK代理的还是基于CBLIB代理的，即目标对象拥有接口实现且没有设置<code>proxyTargetClass=&quot;true&quot;</code>或者指定的targetClass是一个接口的时候将采用JDK代理，否则将采用CGLIB代理。也就是说即算是你通过ProxyFactory.setProxyTargetClass(true)指定了将会建立基于Class的CGLIB代理，最终也不一定是CGLIB代理，因为这种情况下如果targetClass是一个接口也将建立JDK代理。这块的逻辑是由DefaultAopProxyFactory的createAopProxy()方法实现的，其源码如下。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="function"><span class="keyword">public</span> AopProxy <span class="title">createAopProxy</span><span class="params">(AdvisedSupport config)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> AopConfigException </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (config.isOptimize() || config.isProxyTargetClass()</span><br><span class="line">                     || hasNoUserSuppliedProxyInterfaces(config)) &#123;</span><br><span class="line">			Class&lt;?&gt; targetClass = config.getTargetClass();</span><br><span class="line">			<span class="keyword">if</span> (targetClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">"TargetSource cannot determine target class: "</span> +</span><br><span class="line">	<span class="string">"Either an interface or a target is required for proxy creation."</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (targetClass.isInterface()) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ObjenesisCglibAopProxy(config);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>ProxyFactory底层在创建代理对象的时候实际上是会委托给AopProxyFactory对象的，AopProxyFactory是一个接口，其只定义了一个createAopProxy()方法，Spring提供了一个默认实现，DefaultAopProxyFactory。ProxyFactory中使用的就是DefaultAopProxyFactory，有兴趣的朋友可以参考一下ProxyFactory的源代码。</p>
<h2 id="指定Advisor"><a href="#指定Advisor" class="headerlink" title="指定Advisor"></a>指定Advisor</h2><p>使用Aop时我们是需要对拦截的方法做一些处理的，对于Spring Aop来讲，需要对哪些方法调用做什么样的处理是通过Advisor来定义的，通常是一个PointcutAdvisor。PointcutAdvisor接口中包含主要有两个接口方法，一个用来获取Pointcut，一个用来获取Advice对象，它俩的组合就构成了需要在哪个Pointcut应用哪个Advice。所以有需要的时候我们也可以实现自己的Advisor实现。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单的实现自己的PointcutAdvisor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Elim 2017年5月9日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdvisor</span> <span class="keyword">implements</span> <span class="title">PointcutAdvisor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Advice <span class="title">getAdvice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> MethodBeforeAdvice() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, </span></span></span><br><span class="line"><span class="function"><span class="params">  </span></span></span><br><span class="line"><span class="function"><span class="params">                            Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"BeforeAdvice实现，在目标方法被调用前调用，目标方法是："</span> </span><br><span class="line"></span><br><span class="line">+ method.getDeclaringClass().getName() + <span class="string">"."</span></span><br><span class="line">						+ method.getName());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPerInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Pointcut <span class="title">getPointcut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//匹配所有的方法调用</span></span><br><span class="line">		<span class="keyword">return</span> Pointcut.TRUE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testProxyFactory2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		MyService myService = <span class="keyword">new</span> MyService();</span><br><span class="line">		ProxyFactory proxyFactory = <span class="keyword">new</span> ProxyFactory(myService);</span><br><span class="line">		proxyFactory.addAdvisor(<span class="keyword">new</span> MyAdvisor());</span><br><span class="line">		MyService proxy = (MyService) proxyFactory.getProxy();</span><br><span class="line">		proxy.add();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>上述示例就是一个指定代理对象对应的Advisor的示例。其实一个代理对象可以同时绑定多个Advisor对象，ProxyFactory的addAdvisor()方法可多次被调用，且该方法还有一些重载的方法定义，可以参数Spring的API文档。</p>
<h2 id="指定Advice"><a href="#指定Advice" class="headerlink" title="指定Advice"></a>指定Advice</h2><p>我们的第一个示例指定的代理对象绑定的是一个Advice，而第二个示例指定的Advisor，对此你会不会有什么疑问呢？依据我们对Spring Aop的了解，Spring的Aop代理对象绑定的就一定是一个Advisor，而且通常是一个PointcutAdvisor，通过它我们可以知道我们的Advice究竟是要应用到哪个Pointcut（哪个方法调用）？当我们通过ProxyFactory在创建代理对象时绑定的是一个Advice对象时，实际上ProxyFactory内部还是为我们转换为了一个Advisor对象的，只是该Advisor对象对应的Pointcut是一个匹配所有方法调用的Pointcut实例。</p>
<h2 id="指定是否需要发布代理对象"><a href="#指定是否需要发布代理对象" class="headerlink" title="指定是否需要发布代理对象"></a>指定是否需要发布代理对象</h2><p>在调用Aop代理对象的方法时，默认情况下我们是不能访问到当前的代理对象的，如果我们指定了创建的代理对象需要对外发布代理对象，那么在调用代理对象的方法时Spring会把当前的代理对象存入AopContext中，我们就可以在目标对象的方法中通过AopContext中获取到当前的代理对象了。这是通过exposeProxy属性来指定的，如果我们希望对外发布代理对象，我们可以通过exposeProxy的set方法来指定该属性的值为true。如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testProxyFactory2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	MyService myService = <span class="keyword">new</span> MyService();</span><br><span class="line">	ProxyFactory proxyFactory = <span class="keyword">new</span> ProxyFactory(myService);</span><br><span class="line">	proxyFactory.setExposeProxy(<span class="keyword">true</span>);<span class="comment">//指定对外发布代理对象，即在目标对象方法中可以通过AopContext.currentProxy()访问当前代理对象。</span></span><br><span class="line">	proxyFactory.addAdvisor(<span class="keyword">new</span> MyAdvisor());</span><br><span class="line">	proxyFactory.addAdvisor(<span class="keyword">new</span> MyAdvisor());<span class="comment">//多次指定Advisor将同时应用多个Advisor</span></span><br><span class="line">	MyService proxy = (MyService) proxyFactory.getProxy();</span><br><span class="line">	proxy.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了上述配置信息以外，ProxyFactory其实还可以配置很多其它的信息，更多的配置信息项请参考ProxyFactory的源代码或参考Spring API文档。</p>
<p><strong>参考文档</strong></p>
<ul>
<li>Spring4.1.0官方文档</li>
<li>Spring源代码</li>
</ul>
<p>（本文是基于Spring4.1.0所写，Elim写于2017年5月9日）</p>
<h1 id="编程式的创建Aop代理之AspectjProxyFactory"><a href="#编程式的创建Aop代理之AspectjProxyFactory" class="headerlink" title="编程式的创建Aop代理之AspectjProxyFactory"></a>编程式的创建Aop代理之AspectjProxyFactory</h1><p>之前已经介绍了一款编程式的创建Aop代理的工厂——<code>ProxyFactory</code>，其实<code>ProxyFactory</code>拥有的功能<code>AspectjProxyFactory</code>都有。它们虽然没有直接的继承关系，但是它们都继承自<code>ProxyCreatorSupport</code>，而创建代理对象的核心逻辑都是在<code>ProxyCreatorSupport</code>中实现的。所以说<code>ProxyFactory</code>拥有的功能<code>AspectjProxyFactory</code>都有。那么<code>AspectjProxyFactory</code>与<code>ProxyFactory</code>相比有什么不同呢？<br><code>AspectjProxyFactory</code>的特殊之处就在于其可以直接指定需要创建的代理对象需要绑定的切面。在使用P<code>roxyFactory</code>时，我们能够绑定的是<code>Advisor</code>或<code>Advice</code>，但是如果我们的程序中已经有了现成的切面类定义且能够为我们新创建的代理类使用时，我们还要为了<code>ProxyFactory</code>建立代理对象的需要创建对应的<code>Advisor</code>类、<code>Advice</code>类和<code>Pointcut</code>类定义，这无疑是非常麻烦的。<code>AspectjProxyFactory</code>通常用于创建基于Aspectj风格的Aop代理对象。现假设我们有如下这样一个切面类定义。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* add(..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">beforeAdd</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"beforeAdd()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"-----------before-----------"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上述切面类定义中我们定义了一个<code>Advisor</code>，其对应了一个<code>BeforeAdvice</code>，实际上是一个<code>AspectJMethodBeforeAdvice</code>，该<code>Advice</code>对应的是上面的<code>before1()</code>方法，还对应了一个<code>Pointcut</code>，实际上是一个<code>AspectJExpressionPointcut</code>。该<code>Advisor</code>的语义就是调用所有的方法名为“add”的方法时都将在调用前调用<code>MyAspect.before1()</code>方法。如果我们现在需要创建一个代理对象，其需要绑定的<code>Advisor</code>逻辑跟上面定义的切面类中定义的<code>Advisor</code>类似。则我们可以进行如下编程。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAspectJProxyFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	MyService myService = <span class="keyword">new</span> MyService();</span><br><span class="line">	AspectJProxyFactory proxyFactory = <span class="keyword">new</span> AspectJProxyFactory(myService);</span><br><span class="line">	proxyFactory.addAspect(MyAspect<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	proxyFactory.setProxyTargetClass(<span class="keyword">true</span>);<span class="comment">//是否需要使用CGLIB代理</span></span><br><span class="line">	MyService proxy = proxyFactory.getProxy();</span><br><span class="line">	proxy.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上述代码中我们<code>AspectjProxyFactory</code>在创建代理对象时需要使用的切面类（其实addAspect还有一个重载的方法可以指定一个切面类的对象），其实在<code>AspectjProxyFactory</code>内部还是解析了该切面类中包含的所有的<code>Advisor</code>，然后把能够匹配当前代理对象类的<code>Advisor</code>与创建的代理对象绑定了。有兴趣的读者可以查看一下<code>AspectjProxyFactory</code>的源码，以下是部分核心代码。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAspect</span><span class="params">(Class&lt;?&gt; aspectClass)</span> </span>&#123;</span><br><span class="line">	String aspectName = aspectClass.getName();</span><br><span class="line">	AspectMetadata am = createAspectMetadata(aspectClass, aspectName);</span><br><span class="line">	MetadataAwareAspectInstanceFactory instanceFactory = </span><br><span class="line">            createAspectInstanceFactory(am, aspectClass, aspectName);</span><br><span class="line">	addAdvisorsFromAspectInstanceFactory(instanceFactory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addAdvisorsFromAspectInstanceFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    MetadataAwareAspectInstanceFactory instanceFactory)</span> </span>&#123;</span><br><span class="line">	List&lt;Advisor&gt; advisors = <span class="keyword">this</span>.aspectFactory.getAdvisors(instanceFactory);</span><br><span class="line">	advisors = AopUtils.findAdvisorsThatCanApply(advisors, getTargetClass());</span><br><span class="line">	AspectJProxyUtils.makeAdvisorChainAspectJCapableIfNecessary(advisors);</span><br><span class="line">	OrderComparator.sort(advisors);</span><br><span class="line">	addAdvisors(advisors);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是在使用<code>AspectjProxyFactory</code>基于切面类创建代理对象时，我们指定的切面类上必须包含@Aspect注解。<br>另外需要注意的是虽然我们自己通过编程的方式可以通过<code>AspectjProxyFactory</code>创建基于<code>@Aspect</code>标注的切面类的代理，但是通过配置``使用基于注解的Aspectj风格的Aop时，Spring内部不是通过<code>AspectjProxyFactory</code>创建的代理对象，而是通过<code>ProxyFactory</code>。有兴趣的朋友可以查看一下<code>AnnotationAwareAspectjAutoProxyCreator</code>的源代码。</p>
</blockquote>
<p>（注：本文是基于Spring4.1.0所写，Elim写于2017年5月9日）</p>
<h1 id="ProxyFactoryBean创建代理对象"><a href="#ProxyFactoryBean创建代理对象" class="headerlink" title="ProxyFactoryBean创建代理对象"></a>ProxyFactoryBean创建代理对象</h1><p><code>ProxyFactoryBean</code>实现了Spring的<code>FactoryBean</code>接口，所以它跟Spring中的其它<code>FactoryBean</code>一样，都是基于工厂模式来获取一个bean的。<code>ProxyFactoryBean</code>就是用来获取一个对象的代理对象的<code>FactoryBean</code>。它也是继承自<code>ProxyCreatorSupport</code>类的，所以它的功能基本跟<code>ProxyFactory</code>差不多，只是<code>ProxyFactory</code>是用于编程式的创建代理对象。而<code>ProxyFactoryBean</code>用于在Spring的bean容器中创建基于bean的代理对象。通常一个简单的<code>ProxyFactoryBean</code>配置大概会是如下这样。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"proxyFactoryBeanTestService"</span> </span><br><span class="line">  <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span><br><span class="line">  &lt;property name=<span class="string">"target"</span>&gt;&lt;!-- 指定被代理的对象 --&gt;</span><br><span class="line">    &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.elim.learn.spring.aop.service.ProxyFactoryBeanTestService"</span>/&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property name=<span class="string">"proxyTargetClass"</span> value=<span class="string">"true"</span>/&gt;&lt;!-- 指定启用基于Class的代理 --&gt;</span><br><span class="line">  &lt;!-- 指定生成的代理对象需要绑定的Advice或Advisor在bean容器中的名称 --&gt;</span><br><span class="line">  &lt;property name=<span class="string">"interceptorNames"</span>&gt;</span><br><span class="line">    &lt;list&gt;</span><br><span class="line">      &lt;value&gt;logAroundAdvice&lt;/value&gt;</span><br><span class="line">    &lt;/list&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的示例中我们被代理的对象对应的Class是<code>com.elim.learn.spring.aop.service.ProxyFactoryBeanTestService</code>，其是一个没有实现任何接口的Class，所以我们生成的代理对象最终会是基于CGLIB的代理。我们需要指定<code>proxyTargetClass=&quot;true&quot;</code>，以表示我们是倾向于使用CGLIB代理的，对于上面的配置实际上就是告诉Spring我们要使用CGLIB代理。虽然这里我们不指定<code>proxyTargetClass=&quot;true&quot;</code>时，Spring可能也会给我们使用CGLIB代理，为什么这里说是可能呢？因为<code>ProxyFactoryBean</code>默认生成的bean都是单例、且在生成bean时会自动检测被代理对象实现的接口，而且<code>proxyTargetClass</code>默认是false，这种情况下<code>ProxyFactoryBean</code>就会自动检测被代理对象的实现的接口。按理来说我们的bean是一个没有实现接口的bean，Spring给我们去找它实现的接口是找不出来的，但是我们知道Spring的Aop是会自动为我们的对象实现一些接口的。简单的说如果我们的bean容器中配置了其它的Advisor，那么我们指定的target对象有可能就不是一个原始的bean，而是一个已经被Aop代理过的bean对象，这种bean对象，Spring Aop默认会为其实现一个<code>Advised</code>接口。所以使用<code>ProxyFactoryBean</code>时，如果我们的代理对象类是没有实现接口的，或者我们期望生成代理对象时是基于Class的，而不是基于Interface的，我们最好明确的指定<code>proxyTargetClass=&quot;true&quot;</code>，而不是寄希望于Spring的自动决定机制。 指定被代理对象时，除了可以直接指定target外，我们还可以通过targetName指定被代理对象在bean容器中的bean名称。 在上面的示例中我们通过interceptorNames属性指定了生成的代理对象需要应用的Advisor/Advice对应于bean容器中的bean的名称。跟ProxyFactory一样，如果我们指定的是Advice对象，则其会转换为一个匹配所有方法调用的Advisor与代理对象绑定。 在指定intercepterNames时我们也可以通过“<em>”指定所有beanName以XX开始的Advisor/Advice，如我们的bean容器中同时拥有“abc1Advisor”、“abc2Advisor”两个Advisor，我们期望创建的ProxyFactoryBean同时应用这两个Advisor，那我们可以不用单独指定两次，而是一次性把interceptorNames指定的一个beanName为“abc</em>”。需要注意的是“*”只能定义在beanName的末端。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyFactoryBeanTestService"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span>&gt;</span><span class="comment">&lt;!-- 指定被代理的对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">" com.elim.learn.spring.aop.service.ProxyFactoryBeanTestService"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyTargetClass"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span><span class="comment">&lt;!-- 指定启用基于Class的代理 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 指定生成的代理对象需要绑定的Advice或Advisor在bean容器中的名称 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>abc*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>其它配置信息</strong></p>
<ul>
<li><strong>exposeProxy</strong>：属于从<code>ProxyCreatorSupport</code>继承过来的属性，用于定义是否需要在调用代理对象时把代理对象发布到<code>AopContext</code>，默认是<code>false</code>。</li>
<li><strong>singleton</strong>：用来指定<code>ProxyFactoryBean</code>生成的bean是否是单例的，默认是<code>true</code>。该值对应于<code>FactoryBean</code>的isSingleton()接口方法的返回值。</li>
<li><strong>frozen</strong>：属于从<code>ProxyCreatorSupport</code>继承过来的属性，用于指定代理对象被创建后是否还允许更改代理配置，通过<code>Advised</code>接口更改。<code>true</code>表示不允许，默认是false。</li>
<li><strong>autodetectInterfaces</strong>：表示是否在生成代理对象时需要启用自动检测被代理对象实现的接口，默认是<code>true</code>。</li>
<li><strong>proxyInterfaces</strong>：基于接口的代理时指定需要代理的接口。</li>
<li><strong>interfaces</strong>：基于接口的代理时指定需要代理的接口，属于从<code>ProxyCreatorSupport</code>继承过来的。 关于<code>ProxyFactoryBean</code>的更多配置项信息可以参考Spring的API文档或<code>ProxyFactoryBean</code>的源代码。<br>（注：本文是基于Spring4.1.0所写，Elim写于2017年5月10日）</li>
</ul>
<h1 id="Aop自动创建代理对象的原理"><a href="#Aop自动创建代理对象的原理" class="headerlink" title="Aop自动创建代理对象的原理"></a>Aop自动创建代理对象的原理</h1><p>我们在使用Spring Aop时，通常Spring会自动为我们创建目标bean的代理对象，以使用对应的Advisor。<strong>前提是我们在使用Spring Aop时是使用的<code>&lt;aop:config/&gt;</code>或<code>&lt;aop:aspectj-autoproxy/&gt;</code></strong>，这是因为当我们在applicationContext.xml文件中通过<a href="aop:config/">aop:config/</a>的形式定义需要使用Aop的场景时，Spring会自动为我们添加<code>AspectjAwareAdvisorAutoProxyCreator</code>类型的bean；而我们定义了<code>&lt;aop:aspectj-autoproxy/&gt;</code>时，Spring会默认为我们添加<code>AnnotationAwareAspectjAutoProxyCreator</code>类型的bean。</p>
<p>Spring中在bean实例化后能够对bean对象进行包装的是<code>BeanPostProcessor</code>，<code>AspectjAwareAdvisorAutoProxyCreator</code>和<code>AnnotationAwareAspectjAutoProxyCreator</code>都是实现了<code>BeanPostProcessor</code>接口的。</p>
<p><code>AnnotationAwareAspectjAutoProxyCreator</code>的父类是<code>AspectjAwareAdvisorAutoProxyCreator</code></p>
<p>而<code>AspectjAwareAdvisorAutoProxyCreator</code>的父类是AbstractAdvisorAutoProxyCreator，<code>AbstractAdvisorAutoProxyCreator</code>的父类是实现了<code>BeanPostProcessor</code>的<code>AbstractAutoProxyCreator</code>。</p>
<p>它们的核心逻辑都是在bean初始化后找出bean容器中所有的能够匹配当前bean的Advisor，找到了则将找到的Advisor通过ProxyFactory创建该bean的代理对象返回。</p>
<p><code>AspectjAwareAdvisorAutoProxyCreator</code>在寻找候选的Advisor时会找到bean容器中所有的实现了Advisor接口的bean，而<code>AnnotationAwareAspectjAutoProxyCreator</code>则在<code>AspectjAwareAdvisorAutoProxyCreator</code>的基础上增加了对标注了<code>@Aspect</code>的bean的处理，会附加上通过<code>@Aspect</code>标注的bean中隐式定义的Advisor。所以这也是为什么我们在使用<code>@Aspect</code>标注形式的Spring Aop时需要在<code>applicationContext.xml</code>文件中添加<code>&lt;aop:aspectj-autoproxy/&gt;</code>的原因。</p>
<p>既然<code>AspectjAwareAdvisorAutoProxyCreator</code>和<code>AnnotationAwareAspectjAutoProxyCreator</code>都会自动扫描bean容器中的Advisor，所以当我们使用了<code>&lt;aop:config/&gt;</code>或<code>&lt;aop:aspectj-autoproxy/&gt;</code>形式的Aop定义时，<strong>如果因为某些原因光通过配置满足不了你Aop的需求，而需要自己实现Advisor接口时（一般是实现PointcutAdvisor接口），那这时候你只需要把自己的Advisor实现类，定义为Spring的一个bean即可</strong>。</p>
<p>如果你在<code>applicationContext.xml</code>中没有定义<a href="aop:config/">aop:config/</a>或<a href="aop:aspectj-autoproxy/">aop:aspectj-autoproxy/</a>，那你也可以直接在<code>applicationContext.xml</code>中直接定义<code>AspectjAwareAdvisorAutoProxyCreator</code>或<code>AnnotationAwareAspectjAutoProxyCreator</code>类型的bean，效果也是一样的。</p>
<p>其实为了能够在创建目标bean的时候能够自动创建基于我们自定义的Advisor实现类的代理对象，我们的bean容器中只要有<code>AbstractAutoProxyCreator</code>类型的bean定义即可，当然了你实现自己的<code>BeanPostProcessor</code>，在其<code>postProcessAfterInitialization</code>方法中创建自己的代理对象也是可以的。但是本着不重复发明轮子的原则，我们尽量使用官方已经提供好的实现即可。<code>AbstractAutoProxyCreator</code>是继承自<code>ProxyConfig</code>的，所以我们在定义<code>AbstractAutoProxyCreator</code>子类的bean时，我们也可以手动的定义一些<code>ProxyConfig</code>中包含的属性，比如<code>proxyTargetClass</code>、<code>exposeProxy</code>等。<code>AbstractAutoProxyCreator</code>的子类除了<code>AspectjAwareAdvisorAutoProxyCreator</code>和<code>AnnotationAwareAspectjAutoProxyCreator</code>外，我们可用的还有<code>BeanNameAutoProxyCreator</code>和<code>DefaultAdvisorAutoProxyCreator</code>。</p>
<h2 id="BeanNameAutoProxyCreator"><a href="#BeanNameAutoProxyCreator" class="headerlink" title="BeanNameAutoProxyCreator"></a>BeanNameAutoProxyCreator</h2><p><code>BeanNameAutoProxyCreator</code>可以用来定义哪些bean可与哪些<code>Advisor/Advice</code>绑定，以生成对应的代理对象。需要绑定的bean是通过<code>beanNames</code>属性来指定的，对应的是bean的名称，其中可以包含“<em>”号，表示任意字符，比如“abc</em>”则匹配任意名称以“abc”开始的bean；需要绑定的<code>Advisor/Advice</code>是通过<code>interceptorNames</code>来指定的，如果指定的是<code>Advisor</code>，那么是否可生成基于该<code>Advisor</code>的代理需要对应的bean能够匹配对应<code>Advisor</code>（<code>PointcutAdvisor</code>类型）的<code>Pointcut</code>；如果指定的是<code>Advice</code>，则该<code>Advice</code>会被包含在<code>Pointcut</code>恒匹配的<code>Advisor</code>中，即能够与所有的bean绑定生成对应的代理，且会对所有的方法调用起作用。 指定interceptorNames时是不能使用通配符的，只能精确的指定需要应用的<code>Advisor/Advice</code>对应的bean名称。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.service.UserServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myService"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.service.MyService"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 匹配userService和所有名称以my开头的bean --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"beanNames"</span> <span class="attr">value</span>=<span class="string">"userService, my*"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- interceptorNames中不能使用通配符，只能是精确匹配，</span></span><br><span class="line"><span class="comment">             即精确指定Advisor/Advice的bean名称 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span> <span class="attr">value</span>=<span class="string">"logBeforeAdvice, myAdvisor "</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logBeforeAdvice"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.advice.LogBeforeAdvice"</span> /&gt;</span></span><br><span class="line">	 </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAdvisor"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.advisor.MyAdvisor"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上就是一个使用<code>BeanNameAutoProxyCreator</code>建立指定的bean基于指定的<code>Advisor/Advice</code>的代理对象的示例。示例中我们指定interceptorNames时特意应用了一个<code>Advisor</code>实现和一个<code>Advice</code>实现。<code>Advice</code>会应用于所有绑定的bean的所有方法调用，而<code>Advisor</code>只会应用于其中的Pointcut能够匹配的方法调用。这里的源码我就不提供了，有兴趣的朋友可以自己试试。</p>
<h2 id="DefaultAdvisorAutoProxyCreator"><a href="#DefaultAdvisorAutoProxyCreator" class="headerlink" title="DefaultAdvisorAutoProxyCreator"></a>DefaultAdvisorAutoProxyCreator</h2><p><code>DefaultAdvisorAutoProxyCreator</code>的父类也是<code>AbstractAdvisorAutoProxyCreator</code>。<code>DefaultAdvisorAutoProxyCreator</code>的作用是会默认将bean容器中所有的<code>Advisor</code>都取到，如果有能够匹配某一个bean的<code>Advisor</code>存在，则会基于能够匹配该bean的所有<code>Advisor</code>创建对应的代理对象。需要注意的是<code>DefaultAdvisorAutoProxyCreator</code>在创建bean的代理对象时是不会考虑<code>Advice</code>的，只是<code>Advisor</code>。如上面的示例中，如果我们希望所有的bean都能够自动的与匹配的<code>Advisor</code>进行绑定生成对应的代理对象，那么我们可以调整配置如下。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.service.UserServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myService"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.service.MyService"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> </span></span><br><span class="line"><span class="tag"> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAdvisor"</span> <span class="attr">class</span>=<span class="string">"com.elim.learn.spring.aop.advisor.MyAdvisor"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用<code>DefaultAdvisorAutoProxyCreator</code>时可能我们并不希望为所有的bean定义都自动应用bean容器中的所有<code>Advisor</code>，而只是希望自动创建基于部分<code>Advisor</code>的代理对象。这个时候如果我们期望应用自动代理的<code>Advisor</code>的bean定义的名称都是拥有固定的前缀时，则我们可以应用<code>DefaultAdvisorAutoProxyCreator</code>的<code>setAdvisorBeanNamePrefix(String)</code>指定需要应用的<code>Advisor</code>的bean名称的前缀，同时需要通过<code>setUsePrefix(boolean)</code>指定需要应用这种前缀匹配机制。如我们的bean容器中有两个<code>Advisor</code>定义，一个bean名称是“myAdvisor”，一个bean名称是“youAdvisor”，如果只期望自动创建基于bean名称以“my”开始的Advisor的代理，则可以进行如下配置。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"usePrefix"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 匹配所有bean名称以my开始的Advisor --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"advisorBeanNamePrefix"</span> <span class="attr">value</span>=<span class="string">"my"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（注：本文是基于Spring4.1.0所写，Elim写于2017年5月12日）</p>
<h1 id="Spring-Aop原理之Advised接口"><a href="#Spring-Aop原理之Advised接口" class="headerlink" title="Spring Aop原理之Advised接口"></a>Spring Aop原理之Advised接口</h1><p>通过之前我们介绍的<code>ProxyFactory</code>我们知道，Spring Aop是通过<code>ProxyFactory</code>来创建代理对象的。<code>ProxyFactory</code>在创建代理对象时会委托给<code>DefaultAopProxyFactory.createAopProxy(AdvisedSupport config)</code>，<code>DefaultAopProxyFactory</code>内部会分情况返回基于JDK的<code>JdkDynamicAopProxy</code>或基于CGLIB的<code>ObjenesisCglibAopProxy</code>，它俩都实现了Spring的<code>AopProxy</code>接口。<code>AopProxy</code>接口中只定义了一个方法，<code>getProxy()</code>方法，Spring Aop创建的代理对象也就是该接口方法的返回结果。</p>
<p>我们先来看一下基于JDK代理的<code>JdkDynamicAopProxy</code>的getProxy()的逻辑。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> getProxy(ClassUtils.getDefaultClassLoader());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">		logger.debug(<span class="string">"Creating JDK dynamic proxy: target source is "</span> </span><br><span class="line">                + <span class="keyword">this</span>.advised.getTargetSource());</span><br><span class="line">	&#125;</span><br><span class="line">	Class&lt;?&gt;[] proxiedInterfaces = AopProxyUtils</span><br><span class="line">            .completeProxiedInterfaces(<span class="keyword">this</span>.advised);</span><br><span class="line">	findDefinedEqualsAndHashCodeMethods(proxiedInterfaces);</span><br><span class="line">	<span class="keyword">return</span> Proxy.newProxyInstance(classLoader, proxiedInterfaces, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到它最终是通过JDK的<code>Proxy</code>来创建的代理，使用的<code>InvocationHandler</code>实现类是它本身，而使用的接口是<code>AopProxyUtils.completeProxiedInterfaces(this.advised)</code>的返回结果。而这个<code>this.advised</code>对象是<code>AdvisedSupport</code>类型，它是<code>ProxyFactory</code>的父类（间接通过<code>ProxyCreatorSupport</code>继承，<code>ProxyFactory</code>的直接父类是<code>ProxyCreatorSupport</code>，<code>ProxyCreatorSupport</code>的父类是<code>AdvisedSupport</code>），<code>AdvisedSupport</code>的父类是<code>ProxyConfig</code>，<code>ProxyConfig</code>中包含创建代理对象时的一些配置项信息。以下是<code>AopProxyUtils.completeProxiedInterfaces(this.advised)</code>的内部逻辑。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt;[] completeProxiedInterfaces(AdvisedSupport advised) &#123;</span><br><span class="line">	Class&lt;?&gt;[] specifiedInterfaces = advised.getProxiedInterfaces();</span><br><span class="line">	<span class="keyword">if</span> (specifiedInterfaces.length == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">// No user-specified interfaces: </span></span><br><span class="line">                <span class="comment">//check whether target class is an interface.</span></span><br><span class="line">		Class&lt;?&gt; targetClass = advised.getTargetClass();</span><br><span class="line">		<span class="keyword">if</span> (targetClass != <span class="keyword">null</span> &amp;&amp; targetClass.isInterface()) &#123;</span><br><span class="line">			specifiedInterfaces = <span class="keyword">new</span> Class&lt;?&gt;[] &#123;targetClass&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">boolean</span> addSpringProxy = !advised.isInterfaceProxied(SpringProxy<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	<span class="keyword">boolean</span> addAdvised = !advised.isOpaque() </span><br><span class="line">                &amp;&amp; !advised.isInterfaceProxied(Advised<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	<span class="keyword">int</span> nonUserIfcCount = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (addSpringProxy) &#123;</span><br><span class="line">		nonUserIfcCount++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (addAdvised) &#123;</span><br><span class="line">		nonUserIfcCount++;</span><br><span class="line">	&#125;</span><br><span class="line">	Class&lt;?&gt;[] proxiedInterfaces = <span class="keyword">new</span> Class&lt;?&gt;[specifiedInterfaces.length</span><br><span class="line">                 + nonUserIfcCount];</span><br><span class="line">	System.arraycopy(specifiedInterfaces, <span class="number">0</span>, </span><br><span class="line">                proxiedInterfaces, <span class="number">0</span>, specifiedInterfaces.length);</span><br><span class="line">	<span class="keyword">if</span> (addSpringProxy) &#123;</span><br><span class="line">		proxiedInterfaces[specifiedInterfaces.length]</span><br><span class="line">                     = SpringProxy<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (addAdvised) &#123;</span><br><span class="line">		proxiedInterfaces[proxiedInterfaces.length - <span class="number">1</span>] = Advised<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> proxiedInterfaces;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到其会在<code>!advised.isOpaque() &amp;&amp; !advised.isInterfaceProxied(Advised.class)</code>返回<code>true</code>的情况下加上本文的主角<code>Advised</code>接口。<code>isOpaque()</code>是<code>ProxyConfig</code>中的一个方法，对应的是<code>opaque</code>属性，表示是否禁止将代理对象转换为<code>Advised</code>对象，默认是<code>false</code>。<code>!advised.isInterfaceProxied(Advised.class)</code>表示将要代理的目标对象类没有实现<code>Advised</code>接口，对于我们自己应用的<code>Class</code>来说，一般都不会自己去实现<code>Advised</code>接口的，所以这个通常也是返回<code>true</code>，所以通常创建Aop代理对象时是会创建包含<code>Advised</code>接口的代理对象的，即上述的<code>proxiedInterfaces[proxiedInterfaces.length - 1] = Advised.class</code>会被执行。<br>前面我们已经提到，<code>JdkDynamicAopProxy</code>创建代理对象应用的<code>InvocationHandler</code>是其自身，所以我们在调用<code>JdkDynamicAopProxy</code>创建的代理对象的任何方法时都将调用<code>JdkDynamicAopProxy</code>实现的<code>InvocationHandler</code>接口的<code>invoke(Object proxy, Method method, Object[] args)</code>方法。该方法实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">	MethodInvocation invocation;</span><br><span class="line">	Object oldProxy = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">boolean</span> setProxyContext = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">	TargetSource targetSource = <span class="keyword">this</span>.advised.targetSource;</span><br><span class="line">	Class&lt;?&gt; targetClass = <span class="keyword">null</span>;</span><br><span class="line">	Object target = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>.equalsDefined &amp;&amp; AopUtils.isEqualsMethod(method)) &#123;</span><br><span class="line">			<span class="comment">// The target does not implement </span></span><br><span class="line">                        <span class="comment">// the equals(Object) method itself.</span></span><br><span class="line">			<span class="keyword">return</span> equals(args[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>.hashCodeDefined &amp;&amp; AopUtils.isHashCodeMethod(method)) &#123;</span><br><span class="line">			<span class="comment">// The target does not implement the hashCode() </span></span><br><span class="line">                        <span class="comment">// method itself.</span></span><br><span class="line">			<span class="keyword">return</span> hashCode();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>.advised.opaque </span><br><span class="line">                    &amp;&amp; method.getDeclaringClass().isInterface() &amp;&amp;</span><br><span class="line">		method.getDeclaringClass().isAssignableFrom(Advised<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">			<span class="comment">// Service invocations on ProxyConfig with the proxy config...</span></span><br><span class="line">			<span class="keyword">return</span> AopUtils.invokeJoinpointUsingReflection(</span><br><span class="line">                                  <span class="keyword">this</span>.advised, method, args);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Object retVal;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.advised.exposeProxy) &#123;</span><br><span class="line">			<span class="comment">// Make invocation available if necessary.</span></span><br><span class="line">			oldProxy = AopContext.setCurrentProxy(proxy);</span><br><span class="line">			setProxyContext = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// May be null. Get as late as possible to </span></span><br><span class="line">                <span class="comment">// minimize the time we "own" the target,</span></span><br><span class="line">		<span class="comment">// in case it comes from a pool.</span></span><br><span class="line">		target = targetSource.getTarget();</span><br><span class="line">		<span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">			targetClass = target.getClass();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Get the interception chain for this method.</span></span><br><span class="line">		List&lt;Object&gt; chain = <span class="keyword">this</span>.advised</span><br><span class="line">                .getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Check whether we have any advice. If we don't, </span></span><br><span class="line">                <span class="comment">// we can fallback on direct</span></span><br><span class="line">		<span class="comment">// reflective invocation of the target, </span></span><br><span class="line">                <span class="comment">// and avoid creating a MethodInvocation.</span></span><br><span class="line">		<span class="keyword">if</span> (chain.isEmpty()) &#123;</span><br><span class="line">			<span class="comment">// We can skip creating a MethodInvocation: </span></span><br><span class="line">                        <span class="comment">//just invoke the target directly</span></span><br><span class="line">			<span class="comment">// Note that the final invoker must be an </span></span><br><span class="line">                        <span class="comment">// InvokerInterceptor so we know it does</span></span><br><span class="line">			<span class="comment">// nothing but a reflective operation on the target, </span></span><br><span class="line">                        <span class="comment">// and no hot swapping or fancy proxying.</span></span><br><span class="line">			retVal = AopUtils.invokeJoinpointUsingReflection(target, </span><br><span class="line">                                     method, args);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// We need to create a method invocation...</span></span><br><span class="line">			invocation = <span class="keyword">new</span> ReflectiveMethodInvocation(proxy, </span><br><span class="line">                               target, method, args, targetClass, chain);</span><br><span class="line">			<span class="comment">// Proceed to the joinpoint through the interceptor chain.</span></span><br><span class="line">			retVal = invocation.proceed();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Massage return value if necessary.</span></span><br><span class="line">		Class&lt;?&gt; returnType = method.getReturnType();</span><br><span class="line">		<span class="keyword">if</span> (retVal != <span class="keyword">null</span> &amp;&amp; retVal == target &amp;&amp; </span><br><span class="line">                                returnType.isInstance(proxy) &amp;&amp;</span><br><span class="line">				!RawTargetAccess<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">                                .<span class="title">isAssignableFrom</span>(<span class="title">method</span>.<span class="title">getDeclaringClass</span>())) </span>&#123;</span><br><span class="line">			<span class="comment">// Special case: it returned "this" and </span></span><br><span class="line">                        <span class="comment">// the return type of the method</span></span><br><span class="line">			<span class="comment">// is type-compatible. Note that we can't help </span></span><br><span class="line">                        <span class="comment">// if the target sets</span></span><br><span class="line">			<span class="comment">// a reference to itself in another returned object.</span></span><br><span class="line">			retVal = proxy;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (retVal == <span class="keyword">null</span> &amp;&amp; returnType != Void.TYPE </span><br><span class="line">                        &amp;&amp; returnType.isPrimitive()) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> AopInvocationException(</span><br><span class="line">	<span class="string">"Null return value from advice does not match primitive return type for: "</span> </span><br><span class="line">                + method);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> retVal;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (target != <span class="keyword">null</span> &amp;&amp; !targetSource.isStatic()) &#123;</span><br><span class="line">			<span class="comment">// Must have come from TargetSource.</span></span><br><span class="line">			targetSource.releaseTarget(target);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (setProxyContext) &#123;</span><br><span class="line">			<span class="comment">// Restore old proxy.</span></span><br><span class="line">			AopContext.setCurrentProxy(oldProxy);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中关于<code>Advised</code>接口方法调用最核心的一句是如下这句。我们可以看到，当我们调用的目标方法是定义自<code>Advised</code>接口时，对应方法的调用将委托给<code>AopUtils.invokeJoinpointUsingReflection(this.advised, method, args)</code>，<code>invokeJoinpointUsingReflection</code>方法的逻辑比较简单，是通过Java反射来调用目标方法。在这里<code>invokeJoinpointUsingReflection</code>传递的目标对象正是<code>AdvisedSupport</code>类型的<code>this.advised</code>对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">this</span>.advised.opaque &amp;&amp; method.getDeclaringClass().isInterface() &amp;&amp;</span><br><span class="line">		method.getDeclaringClass().isAssignableFrom(Advised<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">	<span class="comment">// Service invocations on ProxyConfig with the proxy config...</span></span><br><span class="line">	<span class="keyword">return</span> AopUtils.invokeJoinpointUsingReflection(<span class="keyword">this</span>.advised, method, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AdvisedSupport</code>类是实现了<code>Advised</code>接口的，所以Spring Aop创建了基于<code>Advised</code>接口的代理对象后在调用<code>Advised</code>接口方法时可以把它委托给<code>AdvisedSupport</code>。而我们知道Spring Aop代理对象的创建正是基于<code>AdvisedSupport</code>的配置进行的（配置项主要都定义在<code>AdvisedSupport</code>的父类<code>ProxyConfig</code>类中）。创建代理对象时应用<code>AdvisedSupport</code>，调用<code>Advised</code>接口方法也用同一个实现了<code>Advised</code>接口的<code>AdvisedSupport</code>对象，所以这个过程在Spring Aop内部就可以很好的衔接。接着我们来看一下<code>Advised</code>接口的定义。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Advised</span> <span class="keyword">extends</span> <span class="title">TargetClassAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isFrozen</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isProxyTargetClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	Class&lt;?&gt;[] getProxiedInterfaces();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isInterfaceProxied</span><span class="params">(Class&lt;?&gt; intf)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setTargetSource</span><span class="params">(TargetSource targetSource)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">TargetSource <span class="title">getTargetSource</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setExposeProxy</span><span class="params">(<span class="keyword">boolean</span> exposeProxy)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isExposeProxy</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setPreFiltered</span><span class="params">(<span class="keyword">boolean</span> preFiltered)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isPreFiltered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	Advisor[] getAdvisors();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addAdvisor</span><span class="params">(Advisor advisor)</span> <span class="keyword">throws</span> AopConfigException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addAdvisor</span><span class="params">(<span class="keyword">int</span> pos, Advisor advisor)</span> <span class="keyword">throws</span> AopConfigException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">removeAdvisor</span><span class="params">(Advisor advisor)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">removeAdvisor</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> AopConfigException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Advisor advisor)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">replaceAdvisor</span><span class="params">(Advisor a, Advisor b)</span> <span class="keyword">throws</span> AopConfigException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addAdvice</span><span class="params">(Advice advice)</span> <span class="keyword">throws</span> AopConfigException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addAdvice</span><span class="params">(<span class="keyword">int</span> pos, Advice advice)</span> <span class="keyword">throws</span> AopConfigException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">removeAdvice</span><span class="params">(Advice advice)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Advice advice)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">String <span class="title">toProxyConfigString</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Advised</code>接口中定义的方法还是非常多的，通过它我们可以在运行时了解我们的代理对象是基于CGLIB的还是基于JDK代理的；可以了解我们的代理对应应用了哪些<code>Advisor</code>；也可以在运行时给我们的代理对象添加和删除<code>Advisor/Advise</code>。本文旨在描述Spring Aop在创建代理对象时是如何基于<code>Advised</code>接口创建代理的，以及我们能够应用<code>Advised</code>接口做哪些事。文中应用的是Spring创建基于JDK代理对象的过程为示例讲解的，其实基于CGLIB的代理也是一样的。关于CGLIB的代理过程、本文中描述的一些核心类以及本文的核心——<code>Advised</code>接口的接口方法说明等请有兴趣的朋友参考Spring的API文档和相关的源代码。<br>（注：本文是基于Spring4.1.0所写，Elim写于2017年5月15日）</p>
<h1 id="编程式的自定义Advisor"><a href="#编程式的自定义Advisor" class="headerlink" title="编程式的自定义Advisor"></a>编程式的自定义Advisor</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>大多数情况下，我们的Aop应用都可以通过Spring的Aop配置来进行（不管是基于注解的，还是基于XML配置的）。Spring Aop的核心就是<code>Advisor</code>，<code>Advisor</code>接口中暂时有用的就是<code>getAdvice()</code>方法，而<code>isPerInstance()</code>方法官方说暂时还没有应用到，生成的<code>Advisor</code>是单例还是多例不由<code>isPerInstance()</code>的返回结果决定，而由自己在定义bean的时候控制。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Advisor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">Advice <span class="title">getAdvice</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isPerInstance</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在使用<code>Advisor</code>时不会直接实现<code>Advisor</code>的接口，而是实现<code>Advisor</code>接口的子接口，<code>PointcutAdvisor</code>或<code>IntroductionAdvisor</code>。<code>IntroductionAdvisor</code>个人感觉用处不大，我们之前介绍的<code>@DeclareParents</code>和``就属于<code>IntroductionAdvisor</code>使用，它们对应的是<code>DeclareParentsAdvisor</code>。剩下的大部分应用的都是<code>PointcutAdvisor</code>。<code>PointcutAdvisor</code>接口的定义如下。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PointcutAdvisor</span> <span class="keyword">extends</span> <span class="title">Advisor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">Pointcut <span class="title">getPointcut</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到它在<code>Advisor接口</code>的基础上新增了一个<code>getPointcut()</code>方法，用以指定我们的Advisor需要应用到哪些<code>Pointcut</code>，即哪些方法调用。编程式的<code>Pointcut</code>定义之前已经介绍过了，它不属于本文介绍的范畴，这里就不再赘述了，对这块不是很了解的读者建议从头看起，笔者的博文是系列博文，当然了也可以暂时先略过，直接看笔者下文的示例。</p>
<h2 id="实现自定义的Advisor"><a href="#实现自定义的Advisor" class="headerlink" title="实现自定义的Advisor"></a>实现自定义的<code>Advisor</code></h2><p>以下是笔者实现的一个自定义的<code>Advisor</code>，是实现的<code>PointcutAdvisor</code>接口。应用的<code>Advice</code>是<code>MethodBeforeAdvice</code>的实现；应用的<code>Pointcut</code>简单匹配所有类的方法名为<code>find</code>的方法调用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdvisor</span> <span class="keyword">implements</span> <span class="title">PointcutAdvisor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Advice <span class="title">getAdvice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> MethodBeforeAdvice() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, </span></span></span><br><span class="line"><span class="function"><span class="params">                             Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"BeforeAdvice实现，在目标方法被调用前调用，目标方法是："</span> </span><br><span class="line">+ method.getDeclaringClass().getName() + <span class="string">"."</span></span><br><span class="line">						+ method.getName());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPerInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Pointcut <span class="title">getPointcut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 简单的Pointcut定义，匹配所有类的find方法调用。</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Pointcut() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> ClassFilter <span class="title">getClassFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> ClassFilter.TRUE;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> MethodMatcher <span class="title">getMethodMatcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">new</span> MethodMatcher() &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Method method, Class&lt;?&gt; targetClass)</span> </span>&#123;</span><br><span class="line">			String methodName = method.getName();</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"find"</span>.equals(methodName)) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">					<span class="meta">@Override</span></span><br><span class="line">					<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isRuntime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Method method, Class&lt;?&gt; targetClass,</span></span></span><br><span class="line"><span class="function"><span class="params">                    Object[] args)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">					</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置使用自定义的Advisor"><a href="#配置使用自定义的Advisor" class="headerlink" title="配置使用自定义的Advisor"></a>配置使用自定义的<code>Advisor</code></h2><p>有了自定义的<code>Advisor</code>后我们应该如何来应用它呢？这又区分好几种情况。</p>
<ul>
<li>如果是自己通过编程应用<code>ProxyFactory</code>，或者说是应用<code>ProxyCreatorSupport</code>来创建代理对象，那么我们通过<code>AdvisedSupport.addAdvisor(Advisor advisor)</code>来应用我们自定义的<code>Advisor</code>。<code>AdvisedSupport</code>的子类中有<code>ProxyCreatorSupport</code>。</li>
<li>如果我们的项目中已经应用了<code>或</code>，那么我们定义在bean容器中的<code>Advisor</code> bean会自动应用到匹配的bean上。这个在<code>《Spring Aop原理之自动创建代理对象》</code>一文中有详细介绍。</li>
<li>如果项目中没有应用<code>或</code>，我们就需要自己定义<code>BeanNameAutoProxyCreator</code>、<code>DefaultAdvisorAutoProxyCreator</code>等<code>AbstractAdvisorAutoProxyCreator</code>类型的bean了。或者是定义<code>AnnotationAwareAspectjAutoProxyCreator</code>或<code>AspectJAwareAdvisorAutoProxyCreator</code>类型的bean，其实<code>就是自动定义了`AnnotationAwareAspectjAutoProxyCreator`类型的bean，</code>就是自动定义了<code>AspectJAwareAdvisorAutoProxyCreator</code>类型的bean。这样在创建bean后都会寻找匹配的<code>Advisor</code>建立对应的代理对象。这些都在<code>《Spring Aop原理之自动创建代理对象》</code>一文中有详细介绍，细节这里就不再赘述。</li>
</ul>
<p>（注：本文是基于Spring4.1.0所写，写于2017年5月16日）</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>AOP</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot_Chapter16</title>
    <url>/2020/09/22/SpringBoot-Chapter16/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter15</title>
    <url>/2020/09/22/SpringBoot-Chapter15/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter14</title>
    <url>/2020/09/22/SpringBoot-Chapter14/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter13</title>
    <url>/2020/09/22/SpringBoot-Chapter13/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter12</title>
    <url>/2020/09/22/SpringBoot-Chapter12/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter11</title>
    <url>/2020/09/22/SpringBoot-Chapter11/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter10</title>
    <url>/2020/09/22/SpringBoot-Chapter10/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter9</title>
    <url>/2020/09/22/SpringBoot-Chapter9/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter8</title>
    <url>/2020/09/22/SpringBoot-Chapter8/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter7</title>
    <url>/2020/09/22/SpringBoot-Chapter7/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter6</title>
    <url>/2020/09/22/SpringBoot-Chapter6/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter5</title>
    <url>/2020/09/22/SpringBoot-Chapter5/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SpringBoot_Chapter4</title>
    <url>/2020/09/22/SpringBoot-Chapter4/</url>
    <content><![CDATA[<p>本章节将关注SpringBoot整合持久层和NoSQL.</p>
<a id="more"></a>



<h1 id="SpringBoot-整合持久层"><a href="#SpringBoot-整合持久层" class="headerlink" title="SpringBoot 整合持久层"></a>SpringBoot 整合持久层</h1><h2 id="整合-Mybatis"><a href="#整合-Mybatis" class="headerlink" title="整合 Mybatis"></a>整合 Mybatis</h2><p>Spring Boot 中最广泛使用的数据持久化方案当属MyBatis，在传统 SSM项目中Mybatis的整合步骤还是有点复杂的，但在Spring Boot 中对此做了进一步的简化，使 MyBatis 基本上可以做到开箱即用，本文就来看看在 Spring Boot 中 MyBatis 要如何使用。</p>
<h3 id="工程创建"><a href="#工程创建" class="headerlink" title="工程创建"></a>工程创建</h3><p>首先创建一个基本的 Spring Boot 工程，添加 Web 依赖，MyBatis 依赖以及 MySQL 驱动依赖，如下：</p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-1.png" alt="整合MyBatis依赖"></p>
<p>pom.xml :</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注意引入的是springboot的druid starter, 而不是druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><p>在<code>application.properties</code>配置JDBC信息</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql:///a?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="meta">spring.datasource.druid.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<h3 id="Mapper配置"><a href="#Mapper配置" class="headerlink" title="Mapper配置"></a>Mapper配置</h3><p>以上配置完成之后，MyBatis 就可以创建 Mapper 来使用了.</p>
<p>方式一: 直接在Mapper中使用注解指明要执行的SQL, 不需要单独xml文件.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper2</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getAllUsers</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Results</span>(&#123;</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"id"</span>, column = <span class="string">"id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"username"</span>, column = <span class="string">"u"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"address"</span>, column = <span class="string">"a"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select username as u,address as a,id as id from user where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">User <span class="title">getUserById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user where username like concat('%',#&#123;name&#125;,'%')"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getUsersByName</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span>(&#123;<span class="string">"insert into user(username,address) values(#&#123;username&#125;,#&#123;address&#125;)"</span>&#125;)</span><br><span class="line">    <span class="meta">@SelectKey</span>(statement = <span class="string">"select last_insert_id()"</span>, keyProperty = <span class="string">"id"</span>, before = <span class="keyword">false</span>, resultType = Integer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">Integer</span> <span class="title">addUser</span>(<span class="title">User</span> <span class="title">user</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update user set username=#&#123;username&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">Integer <span class="title">updateUserById</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from user where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">Integer <span class="title">deleteUserById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>以上写法中, 注意了解下<strong>@Result</strong> 注解的使用方式, </p>
<p>另外使用 <strong>@SelectKey</strong> 注解可以实现主键回填的功能，即当数据插入成功后，插入成功的数据 id 会赋值到 user 对象的id 属性上。</p>
<p>UserMapper2 创建好之后，还要配置 mapper 扫描，也有两种方式，</p>
<p>a: 直接在 UserMapper2 上面添加 <code>@Mapper</code> 注解，这种方式有一个弊端就是所有的 Mapper 都要手动添加，要是落下一个就会报错，</p>
<p>b: 直接在启动类上添加 Mapper 扫描，如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.lee.mybatis.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MybatisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>但是实际开发中的查询语句往往都很复杂, 纯注解零XML的配置方式写起来很难实现, 臃肿且不便于排错, 所以更常用的是:</p>
<p>方式二: </p>
<pre><code>先新建`UserMapper.xml`来存放SQL映射文件</code></pre><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.lee.mybatis.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAllUsers"</span> <span class="attr">resultType</span>=<span class="string">"com.lee.mybatis.pojo.User"</span>&gt;</span></span><br><span class="line">        select * from a.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code>然后创建UserMapper接口</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getAllUsers</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后创建pojo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String subject;</span><br><span class="line">    <span class="keyword">private</span> Integer grade;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", subject='"</span> + subject + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", grade="</span> + grade +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, Integer age, String subject, Integer grade)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.subject = subject;</span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSubject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubject</span><span class="params">(String subject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getGrade</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGrade</span><span class="params">(Integer grade)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此, 配置完毕.</p>
<p>但是, 有一点要注意的就是<code>UserMapper.xml</code>到底放在哪里呢？有两个位置可以放.</p>
<p>第一个是直接放在 UserMapper 所在的包下面：</p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-2.png" alt="UserMapper.xml 存放在mapper包下"></p>
<p>放在这里的 UserMapper.xml 会被自动扫描到，但是有另外一个 Maven 带来的问题，就是 java 目录下的 xml 资源在项目打包时会被忽略掉，所以，如果 UserMapper.xml 放在包下，需要在 pom.xml 文件中再添加如下配置，避免打包时 java 目录下的 XML 文件被自动忽略掉：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然，UserMapper.xml 也可以直接放在 resources 目录下，这样就不用担心打包时被忽略了，但是<strong>放在 resources 目录下，必须创建和 Mapper 接口包目录相同的目录层级</strong>，这样才能确保打包后 XML 和 Mapper 接口又处于在一起，否则 XML 文件将不能被自动扫描，这个时候就需要添加额外配置。例如我在 resources 目录下创建 mapper 目录用来放 mapper 文件，</p>
<p>方式二: </p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-3.png" alt="UserMapper.xml 存放在resources 目录下"></p>
<p>此时在 <code>application.properties</code> 中需要告诉 mybatis 去哪里扫描 mapper：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<p>最后在测试类中测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.mybatis.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.lee.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; allUsers = userMapper.getAllUsers();</span><br><span class="line">        Iterator&lt;User&gt; iterator = allUsers.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next().toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到输出结果如下:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-4.png" alt="UserMapper.xml 存放在resources 目录下"></p>
<h3 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h3><p>在 SSM 整合中，开发者需要自己提供两个 Bean，一个SqlSessionFactoryBean ，还有一个是 MapperScannerConfigurer，在 Spring Boot 中，这两个东西虽然不用开发者自己提供了，但是并不意味着这两个 Bean 不需要了，在 <code>org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration</code> 类中，我们可以看到 Spring Boot 提供了这两个 Bean，部分源码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; SqlSessionFactory<span class="class">.<span class="keyword">class</span>, <span class="title">SqlSessionFactoryBean</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnSingleCandidate</span>(<span class="title">DataSource</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">MybatisProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(<span class="title">DataSourceAutoConfiguration</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MybatisAutoConfiguration</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SqlSessionFactoryBean factory = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">    factory.setDataSource(dataSource);</span><br><span class="line">    <span class="keyword">return</span> factory.getObject();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">sqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line">    ExecutorType executorType = <span class="keyword">this</span>.properties.getExecutorType();</span><br><span class="line">    <span class="keyword">if</span> (executorType != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory, executorType);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line">  <span class="meta">@Import</span>(&#123; AutoConfiguredMapperScannerRegistrar<span class="class">.<span class="keyword">class</span> &#125;)</span></span><br><span class="line"><span class="class">  @<span class="title">ConditionalOnMissingBean</span>(<span class="title">MapperFactoryBean</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">static</span> <span class="title">class</span> <span class="title">MapperScannerRegistrarNotFoundConfiguration</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      logger.debug(<span class="string">"No &#123;&#125; found."</span>, MapperFactoryBean<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>())</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从类上的注解可以看出，当当前类路径下不存在 <code>SqlSessionFactory</code>、 <code>SqlSessionFactoryBean</code> 以及 <code>DataSource</code> 时，这里的配置才会生效，<code>SqlSessionFactory</code> 和 <code>SqlTemplate</code> 都被提供了。</p>
<h3 id="DB加密"><a href="#DB加密" class="headerlink" title="DB加密"></a>DB加密</h3><p>数据库密码直接写在配置中，对运维安全来说，是一个很大的挑战。Druid为此提供一种给数据库密码加密的手段ConfigFilter。</p>
<p>首先定位到druid依赖所在路径, 并在CMD打开:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-5.png" alt="UserMapper.xml 存放在mapper包下"></p>
<p>在终端执行: 来对明文密码加密</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -cp druid-<span class="number">1.1</span><span class="number">.10</span>.jar com.alibaba.druid.filter.config.ConfigTools DB明文密码</span><br></pre></td></tr></table></figure>

<p>然后修改<code>application.properties</code>里的密码<code>spring.datasource.druid.password</code>, 并添加公钥信息:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.datasource.druid.password</span>=<span class="string">WXPVkyQ3hxJe4du/IyePr3urPJLDBr82f5aMlZVUZ5HvUoL5O6zF/JoyTo3WW81d3aPJnv+vUGpVrH07VdXDQw==</span></span><br><span class="line"><span class="attr">publickey</span>=<span class="string">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJjGOYy+SgIPpuoBSJBbmuGpJ0PnB7egQ07HGn346BH/XhO4DgXCD4VLp3V8JnhrE5AL4ngEC/Kq046WEaAa5TkCAwEAAQ==</span></span><br><span class="line"><span class="comment"># 配置 connection-properties，启用加密，配置公钥。</span></span><br><span class="line"><span class="meta">spring.datasource.druid.connection-properties</span>=<span class="string">config.decrypt=true;config.decrypt.key=$&#123;publickey&#125;</span></span><br><span class="line"><span class="comment"># 启动ConfigFilter</span></span><br><span class="line"><span class="meta">spring.datasource.druid.filter.config.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<p>至此, 对数据库密码加密的动作也已完成. 启动项目测试也成功:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-4.png" alt="UserMapper.xml 存放在resources 目录下"></p>
<h2 id="MyBatis-多数据源"><a href="#MyBatis-多数据源" class="headerlink" title="MyBatis 多数据源"></a>MyBatis 多数据源</h2><p>项目中不少场景会需要从不同数据源出数，简单一点就是利用Mybatis多数据源。 如果业务场景更复杂, 要求更高, 则需要使用分布式数据库中间件, 此处不做讨论, 后续会涉及.</p>
<h3 id="工程创建-1"><a href="#工程创建-1" class="headerlink" title="工程创建"></a>工程创建</h3><p>首先需要创建 MyBatis 项目，项目创建和前文的一样，添加 MyBatis、 MySQL 以及 Web 依赖：</p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-7.png" alt="UserMapper.xml 存放在mapper包下"></p>
<p>项目创建完成后，添加 Druid 依赖，这里添加 Druid 依赖也必须是专为 Spring Boot 打造的 Druid starter，不能使用传统的 Druid。完整的依赖如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="application-properties-1"><a href="#application-properties-1" class="headerlink" title="application.properties"></a>application.properties</h3><p>在<code>application.properties</code>配置两个数据源</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#dsOne</span></span><br><span class="line"><span class="meta">spring.datasource.one.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.one.druid.password</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.one.url</span>=<span class="string">jdbc:mysql:///a?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="meta">spring.datasource.one.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.one.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#dsTwo        </span></span><br><span class="line"><span class="meta">spring.datasource.two.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.two.druid.password</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.two.url</span>=<span class="string">jdbc:mysql:///a?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="meta">spring.datasource.two.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.two.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<h3 id="DataSourceConfig配置"><a href="#DataSourceConfig配置" class="headerlink" title="DataSourceConfig配置"></a>DataSourceConfig配置</h3><p>然后再提供两个 DataSource，如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.multimybatis.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//主数据源配置 ds1数据源</span></span><br><span class="line">    <span class="meta">@Primary</span> </span><br><span class="line">    <span class="comment">//设置返回的bean的名称</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"ds1DataSourceProperties"</span>) </span><br><span class="line">    <span class="comment">//用application.properties里以spring.datasource.one开头的变量封装到该对象,并返回到容器中</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.one"</span>) </span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">ds1DataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"ds1DataSource"</span>)</span><br><span class="line">    <span class="comment">//从容器中查询名称为ds1DataSourceProperties, 类型为DataSourceProperties的bean进行注入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">ds1DataSource</span><span class="params">(@Qualifier(<span class="string">"ds1DataSourceProperties"</span>)</span> DataSourceProperties dataSourceProperties) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (DruidDataSource) dataSourceProperties.initializeDataSourceBuilder().type(DruidDataSource<span class="class">.<span class="keyword">class</span>).<span class="title">build</span>()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二个ds2数据源配置, 与ds1配置一致, 除了没有@Primary注解来表示其为主配置</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"ds2DataSourceProperties"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.two"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">ds2DataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二个ds2数据源</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"ds2DataSource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">ds2DataSource</span><span class="params">(@Qualifier(<span class="string">"ds2DataSourceProperties"</span>)</span> DataSourceProperties dataSourceProperties) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (DruidDataSource) dataSourceProperties.initializeDataSourceBuilder().type(DruidDataSource<span class="class">.<span class="keyword">class</span>).<span class="title">build</span>()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="MyBatis配置"><a href="#MyBatis配置" class="headerlink" title="MyBatis配置"></a>MyBatis配置</h3><p>接下来则是 MyBatis 的配置，因为要提供两个 Bean，因此这里两个数据源在两个类中分开来配置</p>
<p>MyBatisConfig1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.multimybatis.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionTemplate;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mybatis主数据源ds1配置</span></span><br><span class="line"><span class="comment"> * 多数据源配置依赖数据源配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span>  DataSourceConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// annotationClass = Repository.class 表示此配置只作用于@Repository注解修饰的类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages =<span class="string">"com.lee.**.mapper1"</span></span><br><span class="line">        , sqlSessionTemplateRef  = <span class="string">"ds1SqlSessionTemplate"</span></span><br><span class="line">        , sqlSessionFactoryRef = <span class="string">"ds1SqlSessionFactory"</span></span><br><span class="line">        ,annotationClass = Repository<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyBatisConfig1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//主数据源 ds1数据源</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"ds1SqlSessionFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">ds1SqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"ds1DataSource"</span>)</span> DataSource dataSource) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        sqlSessionFactory.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">//设置mybatis-config.xml配置文件</span></span><br><span class="line">        ClassPathResource mybatisConfig = <span class="keyword">new</span> ClassPathResource(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">        sqlSessionFactory.setConfigLocation(mybatisConfig);</span><br><span class="line">         <span class="comment">//设置从哪里扫描mapper.xml映射文件</span></span><br><span class="line">        sqlSessionFactory.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver().</span><br><span class="line">                getResources(<span class="string">"classpath:mappers1/*.xml"</span>));</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 事务管理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"ds1TransactionManager"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">ds1TransactionManager</span><span class="params">(@Qualifier(<span class="string">"ds1DataSource"</span>)</span> DataSource dataSource) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"ds1SqlSessionTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">ds1SqlSessionTemplate</span><span class="params">(@Qualifier(<span class="string">"ds1SqlSessionFactory"</span>)</span> SqlSessionFactory sqlSessionFactory) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyBatisConfig2:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.multimybatis.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionTemplate;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages =<span class="string">"com.lee.**.mapper2"</span></span><br><span class="line">        , sqlSessionTemplateRef  = <span class="string">"ds2SqlSessionTemplate"</span></span><br><span class="line">        , sqlSessionFactoryRef = <span class="string">"ds2SqlSessionFactory"</span></span><br><span class="line">        , annotationClass = com.lee.multimybatis.annotation.AuthRepository<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyBatisConfig2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"ds2SqlSessionFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">ds2SqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"ds2DataSource"</span>)</span> DataSource dataSource) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        sqlSessionFactory.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">//设置mybatis-config.xml配置文件</span></span><br><span class="line">        ClassPathResource mybatisConfig = <span class="keyword">new</span> ClassPathResource(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">        sqlSessionFactory.setConfigLocation(mybatisConfig);</span><br><span class="line">        <span class="comment">//设置从哪里扫描mapper.xml映射文件</span></span><br><span class="line">        sqlSessionFactory.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver().</span><br><span class="line">                getResources(<span class="string">"classpath:mappers2/*.xml"</span>));</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"ds2TransactionManager"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">ds2TransactionManager</span><span class="params">(@Qualifier(<span class="string">"ds2DataSource"</span>)</span> DataSource dataSource) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"ds2SqlSessionTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">ds2SqlSessionTemplate</span><span class="params">(@Qualifier(<span class="string">"ds2SqlSessionFactory"</span>)</span> SqlSessionFactory sqlSessionFactory) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建Mapper接口和映射文件"><a href="#创建Mapper接口和映射文件" class="headerlink" title="创建Mapper接口和映射文件"></a>创建Mapper接口和映射文件</h3><p>在mapper1和mapper2包下分别创建2个Mapper接口:</p>
<p>UserMapper1 (@Repository修饰)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.multimybatis.mapper1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.multimybatis.bean.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper1</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserMapper2 (@AuthRepository修饰)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.multimybatis.mapper2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.multimybatis.annotation.AuthRepository;</span><br><span class="line"><span class="keyword">import</span> com.lee.multimybatis.bean.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AuthRepository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper2</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在classpath: resources/mappers1/ 和classpath: resources/mappers2/ 下分别创建两个mapper.xml文件<code>UserMapper1.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.lee.multimybatis.mapper1.UserMapper1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">resultType</span>=<span class="string">"com.lee.multimybatis.bean.User"</span>&gt;</span></span><br><span class="line">        select * from `user` where age <span class="symbol">&amp;lt;</span>= 20</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>UserMapper2.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.lee.multimybatis.mapper2.UserMapper2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">resultType</span>=<span class="string">"com.lee.multimybatis.bean.User"</span>&gt;</span></span><br><span class="line">        select * from `user` where age <span class="symbol">&amp;gt;</span> 20</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>最后在测试类中, 注入mapper接口, 并创建测试方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.multimybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.multimybatis.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.lee.multimybatis.mapper1.UserMapper1;</span><br><span class="line"><span class="keyword">import</span> com.lee.multimybatis.mapper2.UserMapper2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MultimybatisApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper1 userMapper1;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper2 userMapper2;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMultiDataSourceMyBatisVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; allUser1 = userMapper1.get();</span><br><span class="line">        Iterator&lt;User&gt; iterator1 = allUser1.iterator();</span><br><span class="line">        System.out.println(<span class="string">"遍历结果1"</span>);</span><br><span class="line">        <span class="keyword">while</span>(iterator1.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator1.next());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;User&gt; allUser2 = userMapper2.get();</span><br><span class="line">        Iterator&lt;User&gt; iterator2 = allUser2.iterator();</span><br><span class="line">        System.out.println(<span class="string">"遍历结果2"</span>);</span><br><span class="line">        <span class="keyword">while</span>(iterator2.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator2.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果如下: </p>
<p><img src="/2020/09/22/SpringBoot-Chapter4/21-8.png" alt="UserMapper.xml 存放在mapper包下"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">**</span><br><span class="line">总结</span><br><span class="line">1:  注意<span class="code">`application.properties`</span> 配置里的两个数据源按照不同前缀区分</span><br><span class="line">2:  注意<span class="code">`DataSourceConfig`</span>配置中的<span class="code">`@Primary`</span>和<span class="code">`@ConfigurationProperties`</span>的用法.</span><br><span class="line">3:  注意<span class="code">`MyBatisConfig1(2)`</span>的<span class="code">`SqlSessionFactory`</span>方法中配置<span class="code">`mybatis-config.xml`</span>和				<span class="code">`mapperLocations`</span>的方式.</span><br><span class="line">4:  注意@Qualifier的使用.</span><br><span class="line">5:  注意<span class="code">`MyBatisConfig1(2)`</span>的<span class="code">`@MapperScan`</span>注解的<span class="code">`annotationClass`</span>属性的区分. </span><br><span class="line">**</span><br></pre></td></tr></table></figure>



<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p><img src="/2020/09/22/SpringBoot-Chapter4/21-10.png" alt="UserMapper.xml 存放在mapper包下"></p>
<h3 id="流程总结"><a href="#流程总结" class="headerlink" title="流程总结"></a>流程总结</h3><p><img src="/2020/09/22/SpringBoot-Chapter4/21-9.png" alt="UserMapper.xml 存放在mapper包下"></p>
<h1 id="SpringBoot-整合NoSQL"><a href="#SpringBoot-整合NoSQL" class="headerlink" title="SpringBoot 整合NoSQL"></a>SpringBoot 整合NoSQL</h1><p>[参考列表]</p>
<p><a href="http://www.itboyhub.com/2019/1210/springboot-mybatis.html" target="_blank" rel="noopener">http://www.itboyhub.com/2019/1210/springboot-mybatis.html</a></p>
<p><a href="http://www.itboyhub.com/2019/1211/springboot-mybatis.html" target="_blank" rel="noopener">http://www.itboyhub.com/2019/1211/springboot-mybatis.html</a></p>
<p> <a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter" target="_blank" rel="noopener">https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter</a></p>
<p><a href="https://github.com/alibaba/druid/wiki/%E5%A6%82%E4%BD%95%E5%9C%A8Spring-Boot%E4%B8%AD%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%EF%BC%9F" target="_blank" rel="noopener">https://github.com/alibaba/druid/wiki/%E5%A6%82%E4%BD%95%E5%9C%A8Spring-Boot%E4%B8%AD%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%EF%BC%9F</a></p>
<p>仅供本人学习, 非商业化使用, 如有侵权请联系删除, 感谢 !</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot_Chapter3</title>
    <url>/2020/09/22/SpringBoot-Chapter3/</url>
    <content><![CDATA[<p>本章主要介绍Springboot整合web层, 包括:</p>
<p>JSON处理,静态资源访问,文件上传,@ControllerAdvice用法,全局异常处理封装,自定义异常视图,CORS,加载XML,系统启动任务,web基础组件整合(拦截器, 过滤器,servlet),整合AOP. . . </p>
<a id="more"></a>





<h1 id="Springboot-整合Jackson"><a href="#Springboot-整合Jackson" class="headerlink" title="Springboot 整合Jackson"></a>Springboot 整合Jackson</h1><p>JSON是目前主流的前后端数据传输方式, SpringMVC中使用消息转化器HttpMessageConverter对JSON的转换提供了很好的支持,在SpringBoot中对相关配置做了进一步简化. HttpMessageConverter既可以将服务端返回的对象序列化为JSON串, 也可以将JSON串反序列化为对象.<br><br><br>常见的JSON处理器除了Jackson-databind，还有Gson和fastjson. 前者是spring/springboot处理JSON的默认的自带方案.  后两者分别由Google和阿里提供, 在使用后两者前应排除掉自身的Jackson依赖以使其生效.</p>
<h2 id="项目目录结构"><a href="#项目目录结构" class="headerlink" title="项目目录结构"></a>项目目录结构</h2><p><img src="/2020/09/22/SpringBoot-Chapter3/JacksonProjectStructure.png" alt="Jackson"></p>
<h2 id="构建过程"><a href="#构建过程" class="headerlink" title="构建过程"></a>构建过程</h2><h3 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h3><p>新建项目导入spring-boot-starter-web即可, 因为该starter内已经有Jackson相关依赖.</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/WebStarter.png" alt="web依赖目录"></p>
<h3 id="准备entity"><a href="#准备entity" class="headerlink" title="准备entity"></a>准备entity</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boy.springbootalljson.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String  username;</span><br><span class="line">    <span class="comment">//@JsonFormat(pattern="yyyy/MM/dd")</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birth="</span> + birth +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> id;  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123; <span class="keyword">this</span>.id = id; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> username;  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123; <span class="keyword">this</span>.username = username;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> birth; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;  <span class="keyword">this</span>.birth = birth;    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="准备controller"><a href="#准备controller" class="headerlink" title="准备controller"></a>准备controller</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boy.springbootalljson.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.boy.springbootalljson.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">Users</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ArrayList&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">4</span> ; i++) &#123;</span><br><span class="line">            User user = <span class="keyword">new</span> User();</span><br><span class="line">            user.setId(i);</span><br><span class="line">            user.setUsername(<span class="string">"Elo"</span>);</span><br><span class="line">            user.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">            users.add(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><img src="/2020/09/22/SpringBoot-Chapter3/JacksonTestResult.png" alt="JacksonTestResult"></p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>可以看出测试结果中日期是没有被格式化的. 因为Jackson的默认配置中并没有对日期进行特殊处理. 从源码可以看出这一点:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.http.JacksonHttpMessageConvertersConfiguration类中有如下代码片段:</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MappingJackson2HttpMessageConverterConfiguration</span> </span>&#123;</span><br><span class="line">     MappingJackson2HttpMessageConverterConfiguration() &#123;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="meta">@ConditionalOnMissingBean</span>(</span><br><span class="line">         value = &#123;MappingJackson2HttpMessageConverter<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line"><span class="class">         <span class="title">ignoredType</span> </span>= &#123;<span class="string">"org.springframework.hateoas.server.mvc.TypeConstrainedMappingJackson2HttpMessageConverter"</span>, <span class="string">"org.springframework.data.rest.webmvc.alps.AlpsJsonHttpMessageConverter"</span>&#125;</span><br><span class="line">     )</span><br><span class="line">     <span class="function">MappingJackson2HttpMessageConverter <span class="title">mappingJackson2HttpMessageConverter</span><span class="params">(ObjectMapper objectMapper)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MappingJackson2HttpMessageConverter(objectMapper);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="两种解决方案"><a href="#两种解决方案" class="headerlink" title="两种解决方案"></a>两种解决方案</h3><p>有两种方法可以解决这个问题</p>
<p>一种”简单”的方法就是在entity的日期属性上加一个注解,如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">//@JsonFormat(pattern="yyyy/MM/dd")</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>但是如果有很多实体类中都有日期字段,都需要添加该注解就显得臃肿, 不和适宜. </p>
<p>一种更为简单的方式就是单独的配置日期格式.自己提供一个MappingJackson2HttpMessageConverter类型的bean, 让autoConfiguration默认配置失效, 然后再在自建的bean中进行日期格式化处理. </p>
<p>新建一个config类.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boy.springbootalljson.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJsonConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MappingJackson2HttpMessageConverter <span class="title">mappingJackson2HttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        MappingJackson2HttpMessageConverter mappingJackson2HttpMessageConverter = <span class="keyword">new</span> MappingJackson2HttpMessageConverter();</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>));</span><br><span class="line">        mappingJackson2HttpMessageConverter.setObjectMapper(objectMapper);</span><br><span class="line">        <span class="keyword">return</span> mappingJackson2HttpMessageConverter;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用配置类处理日期格式后的测试结果:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/HttpMessageConverterTestResult.png" alt="HttpMessageConverterTestResult"></p>
<p>从源码片段最后的返回语句</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> MappingJackson2HttpMessageConverter(objectMapper);</span><br></pre></td></tr></table></figure>

<p>可以看出默认配置中返回的 MappingJackson2HttpMessageConverter bean是有一个new objectMapper的参数的, 该参数是自动注入的. </p>
<p>往上游追可以知道该参数是JacksonAutoConfiguration类提供的, 源码片段 :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line">	<span class="meta">@ConditionalOnClass</span>(Jackson2ObjectMapperBuilder<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">	<span class="title">static</span> <span class="title">class</span> <span class="title">JacksonObjectMapperConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@Primary</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">		<span class="function">ObjectMapper <span class="title">jacksonObjectMapper</span><span class="params">(Jackson2ObjectMapperBuilder builder)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> builder.createXmlMapper(<span class="keyword">false</span>).build();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说, 可以得出如下结论:</p>
<p>项目中没有自己提供ObjectMapper bean时, MappingJackson2HttpMessageConverter使用的是JacksonAutoConfiguration中提供的objectmapper bean来进行构造bean并返回到容器中的. </p>
<p>基于这样的结论, 以及最终实现日期格式化操作是objectmapper提供的setDateFormat(format) 的这一事实, 所以, 在自动一的MyJsonConfig类中也可以之定义一个objectmapper bean并返回即可. (即: 可以用如下bean替换掉MyJsonConfig类中的 mappingJackson2HttpMessageConverter bean )</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">objectMapper</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    objectMapper.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd hh:mm"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> objectMapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/objectmapperTestResult.png" alt="objectmapperTestResult"></p>
<h1 id="Springboot-整合Gson"><a href="#Springboot-整合Gson" class="headerlink" title="Springboot 整合Gson"></a>Springboot 整合Gson</h1><h2 id="引入pom依赖"><a href="#引入pom依赖" class="headerlink" title="引入pom依赖"></a>引入pom依赖</h2><p>因为Gson是第三方(Google)提供的json处理方案, 所以pom要先将自身的Jackson依赖进行排除, 然后再添加Gson依赖. 具体操作如下:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="测试依赖引入是否成功"><a href="#测试依赖引入是否成功" class="headerlink" title="测试依赖引入是否成功"></a>测试依赖引入是否成功</h2><p>reimport后可以看到, 此时spring-boot-starter-web中已经没有Jackson而是换成了gson</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/gson.png" alt="gson"></p>
<h2 id="Gson源码解析"><a href="#Gson源码解析" class="headerlink" title="Gson源码解析"></a>Gson源码解析</h2><p>从GsonHttpMessageConvertersConfiguration的源码可以看出: </p>
<p>1: 如果pom依赖中提供了gson, 那么GsonHttpMessageConvertersConfiguration配置就会生效, 因为该类有一个注解: @ConditionalOnClass(Gson.class)</p>
<p>2: 如果用户没有提供GsonHttpMessageConverter bean, 那么自动配置的GsonHttpMessageConverter bean就会生效, 其处理逻辑类似Jackson源码,只不过该bean的自动注入参数是gson而非objectmapper. </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 2012-2019 the original author or authors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Configuration for HTTP Message converters that use Gson.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Andy Wilkinson</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Eddú Meléndez</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(Gson<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">GsonHttpMessageConvertersConfiguration</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">  <span class="meta">@Configuration</span></span><br><span class="line">	<span class="meta">@ConditionalOnBean</span>(Gson<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">	@<span class="title">Conditional</span>(<span class="title">PreferGsonOrJacksonAndJsonbUnavailableCondition</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">	<span class="title">protected</span> <span class="title">static</span> <span class="title">class</span> <span class="title">GsonHttpMessageConverterConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> GsonHttpMessageConverter <span class="title">gsonHttpMessageConverter</span><span class="params">(Gson gson)</span> </span>&#123;</span><br><span class="line">			GsonHttpMessageConverter converter = <span class="keyword">new</span> GsonHttpMessageConverter();</span><br><span class="line">			converter.setGson(gson); <span class="comment">//</span></span><br><span class="line">			<span class="keyword">return</span> converter;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  .  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义GsonHttpMessageConverter-bean"><a href="#自定义GsonHttpMessageConverter-bean" class="headerlink" title="自定义GsonHttpMessageConverter bean"></a>自定义GsonHttpMessageConverter bean</h2><p>在MyJsonConfig类中提供一个GsonHttpMessageConverter bean:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> GsonHttpMessageConverter <span class="title">gsonHttpMessageConverter</span><span class="params">(Gson gson)</span></span>&#123;</span><br><span class="line">      GsonHttpMessageConverter gsonHttpMessageConverter = <span class="keyword">new</span> GsonHttpMessageConverter();</span><br><span class="line">      gsonHttpMessageConverter.setGson(<span class="keyword">new</span> GsonBuilder().setDateFormat(<span class="string">"yyyy/MM/dd hh:mm:ss"</span>).create());</span><br><span class="line">      <span class="keyword">return</span> gsonHttpMessageConverter;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>启动项目查看结果(如下图),从日期格式可以看出GsonHttpMessageConverter配置在生效了.</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/GsonTestResult.png" alt="GsonTestResult"></p>
<h2 id="自定义Gson-bean"><a href="#自定义Gson-bean" class="headerlink" title="自定义Gson bean"></a>自定义Gson bean</h2><p>对比Jackson的源码分析思路, 以及日期设置是在Gson参数中设置的, 可以对Gson进行同样的分析. org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration部分源码片段如下: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(Gson<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">GsonProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">GsonAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> GsonBuilder <span class="title">gsonBuilder</span><span class="params">(List&lt;GsonBuilderCustomizer&gt; customizers)</span> </span>&#123;</span><br><span class="line">		GsonBuilder builder = <span class="keyword">new</span> GsonBuilder();</span><br><span class="line">		customizers.forEach((c) -&gt; c.customize(builder));</span><br><span class="line">		<span class="keyword">return</span> builder;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Gson <span class="title">gson</span><span class="params">(GsonBuilder gsonBuilder)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gsonBuilder.create();</span><br><span class="line">	&#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>可以看出: </p>
<p>1: 只要pom依赖中引入了Gson, GsonAutoConfiguration配置就会会生效, 因为其被注解 @ConditionalOnClass(Gson.class)修饰</p>
<p>2: GsonHttpMessageConverter bean中的gson参数是从此处的Gson构造引入的, </p>
<p>所以类比整合Jackson时可以只在配置文件中提供一个objectmapper bean的情况, 可以推断, 整合gson也可以在MyJsonConfig类中只提供一个Gson bean, 应该也能实现同样的整合配合. </p>
<p>在MyJsonConfig注释掉GsonHttpMessageConverter bean, 然后 提供如下bean后重启项目测试:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Gson <span class="title">gson</span><span class="params">(GsonBuilder gsonBuilder)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> gsonBuilder.setDateFormat(<span class="string">"yyyy-MM-dd"</span>).create();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>测试结果:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/GBTestResult.png" alt="GsonTestResult"></p>
<h1 id="整合FastJson"><a href="#整合FastJson" class="headerlink" title="整合FastJson"></a>整合FastJson</h1><h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><p>因为Fastjson是第三方(阿里)提供的json处理方案, 所以pom要先将自身的Jackson依赖进行排除, 但你果然也要将志气啊添加的Gson排除, 然后再添加fastjson依赖. 具体操作如下:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;gson&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="测试依赖引入是否成功-1"><a href="#测试依赖引入是否成功-1" class="headerlink" title="测试依赖引入是否成功"></a>测试依赖引入是否成功</h2><p>reimport后可以看出只存在fastjson依赖相关的jar包了</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/fastjsonpom.png" alt="fastjsonpom"></p>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>与Jackson和Gson不同的是, 要整合fastjson, 则必须引入FastJsonHttpMessageConverter bean, 因为没有starter中并没有相关的autoconfiguration. </p>
<p>源码: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastJsonHttpMessageConverter</span> <span class="keyword">extends</span> <span class="title">AbstractHttpMessageConverter</span>&lt;<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Charset UTF8     = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="keyword">private</span> Charset             charset  = UTF8;</span><br><span class="line">    <span class="keyword">private</span> SerializerFeature[] features = <span class="keyword">new</span> SerializerFeature[<span class="number">0</span>];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FastJsonHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> MediaType(<span class="string">"application"</span>, <span class="string">"json"</span>, UTF8), <span class="keyword">new</span> MediaType(<span class="string">"application"</span>, <span class="string">"*+json"</span>, UTF8));</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看见, </p>
<p>1: FastJsonHttpMessageConverter 类和其构造方法并没有被任何@ConditionalOnMissingBean(…)或@ConditionalOnBean(…)之类的注解修饰, </p>
<p>2: 构造方法为空参构造, 也就是说只能提供FastJsonHttpMessageConverter  bean进行自定义配置, 而不能像Gson只提供gson bean或者Jackson只提供objectmapper bean那样进行配置.</p>
<h2 id="自定义FastJsonHttpMessageConverter"><a href="#自定义FastJsonHttpMessageConverter" class="headerlink" title="自定义FastJsonHttpMessageConverter"></a>自定义FastJsonHttpMessageConverter</h2><p>在MyJsonConfig类中提供一个FastJsonHttpMessageConverter bean后重启项目; (注意fastjson的配置是在FastJsonConfig中设置的, 这一点与Gson和jackson稍有不同)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FastJsonHttpMessageConverter <span class="title">fastJsonHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FastJsonHttpMessageConverter fastJsonHttpMessageConverter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">    FastJsonConfig fastJsonConfig = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">    fastJsonConfig.setDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">    fastJsonHttpMessageConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">    <span class="keyword">return</span>  fastJsonHttpMessageConverter;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><p>测试结果如下图:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/FastJsonResult.png" alt="FastJsonResult"></p>
<h1 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h1><p>在 Spring Boot 中，如果我们是从 <code>https://start.spring.io</code> 这个网站上创建的项目，或者使用 IntelliJ IDEA 中的 Spring Boot 初始化工具创建的项目，默认都会存在 resources/static 目录，很多小伙伴也知道静态资源只要放到这个目录下，就可以直接访问，除了这里还有没有其他可以放静态资源的位置呢？为什么放在这里就能直接访问了呢？</p>
<h2 id="整体规划"><a href="#整体规划" class="headerlink" title="整体规划"></a>整体规划</h2><p>在 Spring Boot 中，默认情况下，一共有5个位置可以放静态资源，五个路径分别是如下5个：</p>
<ol>
<li>classpath:/META-INF/resources/</li>
<li>classpath:/resources/</li>
<li>classpath:/static/</li>
<li>classpath:/public/</li>
<li>/</li>
</ol>
<p>前四个目录好理解，分别对应了resources目录下不同的目录，第5个 <code>/</code> 是啥意思呢？我们知道，在 Spring Boot 项目中，默认是没有 webapp 这个目录的，当然我们也可以自己添加（例如在需要使用JSP的时候），这里第5个 <code>/</code> 其实就是表示 webapp 目录中的静态资源也不被拦截。如果同一个文件分别出现在五个目录下，那么优先级也是按照上面列出的顺序。</p>
<p>不过，虽然有5个存储目录，除了第5个用的比较少之外，其他四个，系统默认创建了 <code>classpath:/static/</code> ， 正常情况下，我们只需要将我们的静态资源放到这个目录下即可，也不需要额外去创建其他静态资源目录，例如我在 <code>classpath:/static/</code> 目录下放了一张名为A.png 的图片，那么我的访问路径是：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://localhost:8080/1.png</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="strong">**注意，请求地址中并不需要 static，加上static反而多此一举会报404错误。那为什么不需要添加 static呢？资源明明放在 static 目录下。**</span></span><br></pre></td></tr></table></figure>



<h2 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析:"></a>源码分析:</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>(type = Type.SERVLET)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">DispatcherServlet</span>.<span class="title">class</span>, <span class="title">WebMvcConfigurer</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnMissingBean</span>(<span class="title">WebMvcConfigurationSupport</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureOrder</span>(<span class="title">Ordered</span>.<span class="title">HIGHEST_PRECEDENCE</span> + 10)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123; DispatcherServletAutoConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">TaskExecutionAutoConfiguration</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">		<span class="title">ValidationAutoConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;</span><br><span class="line">  	<span class="comment">//...</span></span><br><span class="line">  	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] SERVLET_LOCATIONS = &#123; <span class="string">"/"</span> &#125;;</span><br><span class="line">  	<span class="comment">//...</span></span><br><span class="line">  	<span class="keyword">static</span> String[] getResourceLocations(String[] staticLocations) &#123;</span><br><span class="line">		String[] locations = <span class="keyword">new</span> String[staticLocations.length + SERVLET_LOCATIONS.length];</span><br><span class="line">		System.arraycopy(staticLocations, <span class="number">0</span>, locations, <span class="number">0</span>, staticLocations.length);</span><br><span class="line">		System.arraycopy(SERVLET_LOCATIONS, <span class="number">0</span>, locations, staticLocations.length, SERVLET_LOCATIONS.length);</span><br><span class="line">		<span class="keyword">return</span> locations;</span><br><span class="line">		&#125;</span><br><span class="line">  	<span class="keyword">static</span> String[] getResourceLocations(String[] staticLocations) &#123;</span><br><span class="line">		String[] locations = <span class="keyword">new</span> String[staticLocations.length + SERVLET_LOCATIONS.length];</span><br><span class="line">		System.arraycopy(staticLocations, <span class="number">0</span>, locations, <span class="number">0</span>, staticLocations.length);</span><br><span class="line">		System.arraycopy(SERVLET_LOCATIONS, <span class="number">0</span>, locations, staticLocations.length, SERVLET_LOCATIONS.length);</span><br><span class="line">		<span class="keyword">return</span> locations;</span><br><span class="line">		&#125;</span><br><span class="line">  	<span class="comment">//...</span></span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment">  	* 该方法实现自WebMvcConfigurer接口, 其中方法注释描述如下</span></span><br><span class="line"><span class="comment">	 	* Add handlers to serve static resources such as images, js, and, css</span></span><br><span class="line"><span class="comment">	 	* files from specific locations under web application root, the classpath,</span></span><br><span class="line"><span class="comment">	 	* and others.</span></span><br><span class="line"><span class="comment">	 	*/</span></span><br><span class="line">  	<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">				logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">			CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">			<span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line">				customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">						.addResourceLocations(<span class="string">"classpath:/META-INF/resources/webjars/"</span>)</span><br><span class="line">						.setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">			&#125;</span><br><span class="line">			String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">			<span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">				customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)</span><br><span class="line">						.addResourceLocations(getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations()))</span><br><span class="line">						.setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">  	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上述源码逻辑可以看出:</p>
<p>这里静态资源的定义和我们前面提到的Java配置SSM中的配置非常相似，其中，，<code>this.resourceProperties.getStaticLocations()</code>方法返回了四个位置，分别是：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">classpath:/META-INF/resources/</span><br><span class="line">classpath:/resources/</span><br><span class="line">classpath:/static/</span><br><span class="line">classpath:/public/</span><br></pre></td></tr></table></figure>

<p>然后在<code>getResourceLocations</code>方法中，又添加了“/”，因此这里返回值一共有5个。</p>
<p>其中，/表示webapp目录，即webapp中的静态文件也可以直接访问。静态资源的匹配路径<strong>按照定义路径优先级依次降低</strong>。因此这里的配置和我们前面提到的如出一辙。这样大伙就知道了为什么Spring Boot 中支持5个静态资源位置，同时也明白了为什么静态资源请求路径中不需要<code>/static</code>，因为在路径映射中已经自动的添加上了<code>/static</code>了。</p>
<h2 id="测试求证"><a href="#测试求证" class="headerlink" title="测试求证"></a>测试求证</h2><p>新建一个项目, 在如下目录下新建一个hi.html文件, 请求:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://localhost:8081/lee/hi.html</span><br></pre></td></tr></table></figure>

<p>前端返回:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E4%BC%98%E5%85%88%E7%BA%A71.png" alt="最高优先级"></p>
<p>也就是说: classpath:/META-INF/resources/ 具有最高优先级, 然后将该目录下的hi.html重命名或删掉再次请求</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://localhost:8081/lee/hi.html</span><br></pre></td></tr></table></figure>

<p>这次前端返回:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E4%BC%98%E5%85%88%E7%BA%A72.png" alt="最高优先级"></p>
<p>重复上述步骤 可以得知优先级如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">classpath:/META-INF/resources/</span><br><span class="line">classpath:/<span class="keyword">static</span>/</span><br><span class="line">classpath:/<span class="keyword">public</span>/</span><br><span class="line">classpath:/resources/</span><br></pre></td></tr></table></figure>





<h2 id="自定义静态资源访问路径"><a href="#自定义静态资源访问路径" class="headerlink" title="自定义静态资源访问路径"></a>自定义静态资源访问路径</h2><p>当然，这个是系统默认配置，如果我们并不想将资源放在系统默认的这五个位置上，也可以自定义静态资源位置和映射，自定义的方式也有两种，可以通过 application.properties 来定义，也可以在 Java 代码中来定义，下面分别来看。</p>
<h3 id="方法一-配置文件properties"><a href="#方法一-配置文件properties" class="headerlink" title="方法一:配置文件properties"></a>方法一:配置文件properties</h3><p>在配置文件<code>application.properties</code>中定义的方式比较简单，如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring.resources.<span class="keyword">static</span>-locations=classpath:/</span><br><span class="line">spring.mvc.<span class="keyword">static</span>-path-pattern=<span class="comment">/**</span></span><br></pre></td></tr></table></figure>



<h3 id="方法二-配置类config"><a href="#方法二-配置类config" class="headerlink" title="方法二:配置类config"></a>方法二:配置类config</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMVCConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">"/**"</span>).addResourceLocations(<span class="string">"classpath:/aaa/"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="strong">** 注意:**</span></span><br><span class="line">整合了 Thymeleaf 的springboot项目，会将静态资源也放在 resources/templates 目录下，<span class="strong">**但是 templates 目录并不是静态资源目录**</span>，它是一个放页面模板的位置(你看到的 Thymeleaf 模板虽然后缀为 .html，其实并不是静态资源).</span><br></pre></td></tr></table></figure>

<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><h2 id="默认现象"><a href="#默认现象" class="headerlink" title="默认现象"></a>默认现象</h2><h3 id="a-浏览器"><a href="#a-浏览器" class="headerlink" title="a)浏览器"></a>a)浏览器</h3><h3 id="b-其他客户端-postman"><a href="#b-其他客户端-postman" class="headerlink" title="b) 其他客户端(postman)"></a>b) 其他客户端(postman)</h3><h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析:"></a>原理分析:</h2><h3 id="相关配置类"><a href="#相关配置类" class="headerlink" title="相关配置类"></a>相关配置类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//1. DefaultErrorAttributes：</span></span><br><span class="line">帮我们在页面共享信息；</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;();</span><br><span class="line">    errorAttributes.put(<span class="string">"timestamp"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">    addStatus(errorAttributes, requestAttributes);</span><br><span class="line">    addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);</span><br><span class="line">    addPath(errorAttributes, requestAttributes);</span><br><span class="line">    <span class="keyword">return</span> errorAttributes;</span><br><span class="line">  &#125;  </span><br><span class="line"><span class="comment">//2.BasicErrorController：处理默认/error请求</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(produces = <span class="string">"text/html"</span>)<span class="comment">//产生html类型的数据；浏览器发送的请求来到这个方法处理</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">        request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//去哪个页面作为错误页面；包含页面地址和页面内容</span></span><br><span class="line">    ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">    <span class="keyword">return</span> (modelAndView == <span class="keyword">null</span> ? <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model) : modelAndView);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span></span><br><span class="line">  <span class="meta">@ResponseBody</span>    <span class="comment">//产生json数据，其他客户端来到这个方法处理；</span></span><br><span class="line">  <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">    Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">        isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//3、ErrorPageCustomizer：</span></span><br><span class="line">  <span class="meta">@Value</span>(<span class="string">"$&#123;error.path:/error&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String path = <span class="string">"/error"</span>;  系统出现错误以后来到error请求进行处理；（web.xml注册的错误页面规则）</span><br><span class="line">  <span class="comment">//4、DefaultErrorViewResolver：</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span></span><br><span class="line"><span class="function"><span class="params">      Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    ModelAndView modelAndView = resolve(String.valueOf(status), model);</span><br><span class="line">    <span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">      modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//默认SpringBoot可以去找到一个页面？  error/404</span></span><br><span class="line">    String errorViewName = <span class="string">"error/"</span> + viewName;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模板引擎可以解析这个页面地址就用模板引擎解析</span></span><br><span class="line">    TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders</span><br><span class="line">        .getProvider(errorViewName, <span class="keyword">this</span>.applicationContext);</span><br><span class="line">    <span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//模板引擎可用的情况下返回到errorViewName指定的视图地址</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">//模板引擎不可用，就在静态资源文件夹下找errorViewName对应的页面   error/404.html</span></span><br><span class="line">    <span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//5. DefaultErrorViewResolver</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//所有的ErrorViewResolver得到ModelAndView</span></span><br><span class="line">   <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="keyword">this</span>.errorViewResolvers) &#123;</span><br><span class="line">      ModelAndView modelAndView = resolver.resolveErrorView(request, status, model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> modelAndView;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="定制Error信息"><a href="#定制Error信息" class="headerlink" title="定制Error信息"></a>定制Error信息</h2><h3 id="定制错误页面Page："><a href="#定制错误页面Page：" class="headerlink" title="定制错误页面Page："></a>定制错误页面Page：</h3><p>如果项目有整合模板引擎thymeleaf, 那么直接在templates目录下添加error目录, 并在里面定制404.html, 405.html,4xx.html这样的模板页面即可, 注意错误发生时, 会按照view的code先精确匹配, 无法精确匹配的情况下才模糊匹配(如找不到503错误, 则会找5XX):</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>5XX<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>5**, yet not 503!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>状态码status: [[$&#123;status&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>时间timestamp: [[$&#123;timestamp&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>错误信息error: [[$&#123;error&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>exception: [[$&#123;exception&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>异常信息: [[$&#123;message&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>异常信息errors: [[$&#123;errors&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>parameter: [[$&#123;parameter&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h4 id="有模板引擎"><a href="#有模板引擎" class="headerlink" title="有模板引擎"></a>有模板引擎</h4><h4 id="没有模板引擎-但静态资源目录下有error"><a href="#没有模板引擎-但静态资源目录下有error" class="headerlink" title="没有模板引擎, 但静态资源目录下有error"></a>没有模板引擎, 但静态资源目录下有error</h4><h4 id="什么都没有"><a href="#什么都没有" class="headerlink" title="什么都没有"></a>什么都没有</h4><h3 id="定制错误数据Json："><a href="#定制错误数据Json：" class="headerlink" title="定制错误数据Json："></a>定制错误数据Json：</h3><p>a. 封装Exception:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.exception.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserNotFoundException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"用户不存在 !"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义全局异常处理类, 在全局异常处理类里面进行数据封装返回:</p>
<p>方式一:</p>
<p>​     <strong>代码:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.exception.exp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.exception.exception.UserNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyGlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//方式一: JSON数据直接返回, 但是没有自适应效果</span></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">//无论浏览器还是其他客户端(postman等)都是返回的JSON数据 而且没有</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UserNotFoundException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Map</span>&lt;<span class="title">String</span>,<span class="title">Object</span>&gt; <span class="title">userNotFoundHandler</span>(<span class="title">Exception</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>,<span class="string">"UNF"</span>);</span><br><span class="line">        map.put(<span class="string">"msg"</span>,<span class="string">"查无此用户"</span>);</span><br><span class="line">        map.put(<span class="string">"details"</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;   </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    <strong>现象:</strong></p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/%E6%96%B9%E5%BC%8F%E4%B8%80.png" alt="方式一"></p>
<p><strong>说明:</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">方式一是JSON数据直接返回, 但是没有自适应效果, 因为指定了@ResponseBody, 所以无论浏览器还是其他客户端(postman等)都是返回的JSON数据</span><br></pre></td></tr></table></figure>

<p>方式二:</p>
<p>​     <strong>代码:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span>(UserNotFoundException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">String</span> <span class="title">userNotFoundHandler</span>(<span class="title">Exception</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">      Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">      map.put(<span class="string">"code"</span>,<span class="string">"UNF"</span>);</span><br><span class="line">      map.put(<span class="string">"msg"</span>,<span class="string">"查无此用户"</span>);</span><br><span class="line">      map.put(<span class="string">"details"</span>,e.getMessage());</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"forward:/error"</span>;  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>​     <strong>现象:</strong></p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/%E6%96%B9%E5%BC%8F%E4%BA%8C.png" alt="方式二"></p>
<p>​     <strong>说明:</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">虽然有自适应效果, 但是状态码确是200, 所以也不会进入我们自定义的页面, 而是进入springboot准备的默认页面.</span><br></pre></td></tr></table></figure>

<p>方式三:</p>
<p>​     <strong>代码:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span>(UserNotFoundException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">userNotFoundHandler</span>(<span class="title">Exception</span> <span class="title">e</span>, <span class="title">HttpServletRequest</span> <span class="title">request</span>)</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">500</span>);   <span class="comment">/** 这不是必须的*/</span></span><br><span class="line">        map.put(<span class="string">"code"</span>,<span class="string">"UNF"</span>);</span><br><span class="line">        map.put(<span class="string">"msg"</span>,<span class="string">"查无此用户"</span>);</span><br><span class="line">        map.put(<span class="string">"details"</span>,e.getMessage());</span><br><span class="line">      	request.setAttribute(<span class="string">"myErrorInfo"</span>,map);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​    这种方式在写好全局异常处理方法userNotFoundHandler后, 还需要一个自定义的错误属性封装类, 继承自DefaultErrorAttributes, 具体代码如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.exception.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.error.ErrorAttributeOptions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.error.DefaultErrorAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.WebRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, ErrorAttributeOptions options)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; errorAttributes = <span class="keyword">super</span>.getErrorAttributes(webRequest, options);</span><br><span class="line">        errorAttributes.put(<span class="string">"attribute1_company"</span>,<span class="string">"Apache"</span>);</span><br><span class="line">        Map&lt;String,Object&gt; exp= (Map&lt;String,Object&gt;) webRequest.getAttribute(<span class="string">"myErrorInfo"</span>,<span class="number">0</span>);</span><br><span class="line">        errorAttributes.put(<span class="string">"exp"</span>,exp);</span><br><span class="line">        <span class="keyword">return</span> errorAttributes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 然后再前端模板error/5xx.html取出展示</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>5XX<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>5**, yet not 503!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>状态码status: [[$&#123;status&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>时间timestamp: [[$&#123;timestamp&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>错误信息error: [[$&#123;error&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>exp: [[$&#123;exp&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span>    <span class="comment">&lt;!-- 后端封装到域的是什么属性, 这里就取出什么 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>







<p><strong>现象:</strong></p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/%E6%96%B9%E5%BC%8F%E4%B8%89.png" alt="方式三"></p>
<p><img src="/2020/09/22/SpringBoot-Chapter3/%E6%96%B9%E5%BC%8F%E4%B8%89postman.png" alt="方式三postman请求"></p>
<p>​     <strong>说明:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">必须要通过request.setAttribute(&quot;javax.servlet.error.status_code&quot;,500);设置自定义的错误状态码, 才会进入响应的错误页面, 如果需要自定义封装错误信息, 需要首先将自定义通过request.setAttribute(&quot;myErrorInfo&quot;,map);的方式放到域中, 然后再在容器中定义一个错误属性类, 获取域中的错误属性并返回</span><br></pre></td></tr></table></figure>



<p><strong>@ControllerAdvice补充</strong></p>
<p>除了上面介绍的全局异常处理外, @ControllerAdvice 注解还有两外两种用法.</p>
<p>a). 参数预处理</p>
<p>b).   </p>
<h1 id="SpringBoot-AOP"><a href="#SpringBoot-AOP" class="headerlink" title="SpringBoot-AOP"></a><a href="http://www.liweian.co.uk/2020/09/28/SpringBoot-Chapter3-AOP/" target="_blank" rel="noopener">SpringBoot-AOP</a></h1>]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot_Chapter2</title>
    <url>/2020/09/22/SpringBoot-Chapter2/</url>
    <content><![CDATA[<p>本章介绍SpringBoot整合视图层, 主要是Thymeleaf模板引擎. </p>
<a id="more"></a>

]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot_Chapter1</title>
    <url>/2020/09/22/SpringBoot-Chapter1/</url>
    <content><![CDATA[<p>此章节介绍一些springboot基础配置操作, 主要包括: </p>
<p>容器相关配置, 属性注入, 类型安全的属性注入,ymal方式配置 以及profile切换.</p>
<a id="more"></a>

<h1 id="SpringBoot基础配置"><a href="#SpringBoot基础配置" class="headerlink" title="SpringBoot基础配置"></a>SpringBoot基础配置</h1><h2 id="Web容器配置"><a href="#Web容器配置" class="headerlink" title="Web容器配置"></a>Web容器配置</h2><p>新建springboot项目后可能最常见的就是要配置一下web容器, 常见的tomcat配置, 观察pom依赖引入的jar包中已经有tomcat了, 所以直接在application.properties中配置相关属性即可:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="meta">server.servlet.context-path</span>=<span class="string">/lee</span></span><br><span class="line"></span><br><span class="line"><span class="meta">server.tomcat.accesslog.prefix</span>=<span class="string">access_log</span></span><br></pre></td></tr></table></figure>

<p>配置完新建一个测试类并启动项目,启动日志如下:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">2020-09-22 09:03:43.091  INFO 34489 --- [           main] com.lee.chapter1.Chapter1Application     : Starting Chapter1Application on Hoffman.local with PID 34489 (/Volumes/X/MyCode/chapter1/target/classes started by William.Hoffman.Leon in /Volumes/X/MyCode/chapter1)</span><br><span class="line">2020-09-22 09:03:43.134  INFO 34489 --- [           main] com.lee.chapter1.Chapter1Application     : No active profile set, falling back to default profiles: default</span><br><span class="line">2020-09-22 09:03:44.866  INFO 34489 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8081 (http)</span><br><span class="line">2020-09-22 09:03:44.878  INFO 34489 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2020-09-22 09:03:44.879  INFO 34489 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.38]</span><br><span class="line">2020-09-22 09:03:44.980  INFO 34489 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/lee]    : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2020-09-22 09:03:44.980  INFO 34489 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1750 ms</span><br><span class="line">2020-09-22 09:03:45.245  INFO 34489 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'</span><br><span class="line">2020-09-22 09:03:45.528  INFO 34489 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8081 (http) with context path '/lee'</span><br><span class="line">2020-09-22 09:03:45.544  INFO 34489 --- [           main] com.lee.chapter1.Chapter1Application     : Started Chapter1Application in 3.284 seconds (JVM running for 4.718)</span><br></pre></td></tr></table></figure>

<p>测试类:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.chapter1.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hi"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hi</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hi"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后前端访问测试访问:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter1/%E5%89%8D%E7%AB%AF%E6%B5%8B%E8%AF%95.png" alt="前端测试"></p>
<p>前端访问的同时后台输出:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">2020-09-22 09:04:05.638  INFO 34489 --- [nio-8081-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/lee]    : Initializing Spring DispatcherServlet 'dispatcherServlet'</span><br><span class="line">2020-09-22 09:04:05.639  INFO 34489 --- [nio-8081-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'</span><br><span class="line">2020-09-22 09:04:05.649  INFO 34489 --- [nio-8081-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 9 ms</span><br></pre></td></tr></table></figure>



<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="strong">**注意: 上面的配置中, 只有前两行是容器类别无关的,第三行设置的tomcat访问日之前缀才是类别相关的,  因为常见的web容器除了tomcat, 还有jetty,underdow等.如果不想使用springboot内置的tomcat作为容器, 需要再pom文件中先配除掉然后引入新的容器依赖. **</span></span><br></pre></td></tr></table></figure>

<h2 id="属性注入"><a href="#属性注入" class="headerlink" title="属性注入"></a>属性注入</h2><p>项目中可能会有这样的需求, 在application.properties中定义了变量值后, 想要绑定到对应的对象属性, 也就是属性注入.</p>
<p>例如在application.properties中: </p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">book.id</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">book.name</span>=<span class="string">三国演义</span></span><br><span class="line"><span class="meta">book.price</span>=<span class="string">99</span></span><br></pre></td></tr></table></figure>

<p>注入到Book类, 需要用 @Value注解,按如下格式注入:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.chapter1.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Book&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", price="</span> + price +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(Double price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;book.id&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;book.name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;book.price&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在测试类中注入Book. </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.chapter1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.chapter1.pojo.Book;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter1ApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Book book;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(book.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后启动测试类可以看到打印出book属性值, 但是乱码, 需要设置file encodin后重新保存即可.</p>
<p><img src="/2020/09/22/SpringBoot-Chapter1/%E8%AE%BE%E7%BD%AE%E7%BC%96%E7%A0%81.png" alt="设置编码"></p>
<p> 重新启动可以看到测试结果如下:</p>
<p><img src="/2020/09/22/SpringBoot-Chapter1/%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png" alt="测试结果"></p>
<h2 id="安全的属性注入"><a href="#安全的属性注入" class="headerlink" title="安全的属性注入"></a>安全的属性注入</h2><p>但是如果有很多变量都像这样需要注入到某对象的属性中, 如果都使用@Value挨个设置就会很臃肿, 也不便于维护. 一种更简单的注入方式就是使用@ConfigurationProperties注解注入:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"book.mine"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="comment">//@Value("$&#123;book.id&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">//@Value("$&#123;book.name&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//@Value("$&#123;book.price&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到<code>application.properties</code>文件中的变量:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">book.mine.id</span>=<span class="string">2</span></span><br><span class="line"><span class="meta">book.mine.name</span>=<span class="string">西游记</span></span><br><span class="line"><span class="meta">book.mine.price</span>=<span class="string">100</span></span><br></pre></td></tr></table></figure>

<p>都成功注入到了属性中, 如下:</p>
<p> <img src="/2020/09/22/SpringBoot-Chapter1/%E5%AE%89%E5%85%A8%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5.png" alt="安全属性注入"></p>
<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><p>还有一种配置方式: 将变量单独放到一个独立的<code>book.properties</code>文件中, 为了让项目启动时扫描时, 能将该文件中的信息扫描处理, 需要搭配注解使用, 方式如下:</p>
<p>首先配置<code>book.properties</code></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">books.id</span>=<span class="string">3</span></span><br><span class="line"><span class="meta">books.name</span>=<span class="string">红楼梦</span></span><br><span class="line"><span class="meta">books.price</span>=<span class="string">88</span></span><br></pre></td></tr></table></figure>

<p>然后在bean Book上使用@PropertySource注解, 注意该注解要和@ConfigurationProperties注解一起使用, 否则不会注入.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"books"</span>)</span><br><span class="line"><span class="meta">@PropertySource</span>(value = <span class="string">"classpath:book.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="comment">//@Value("$&#123;book.id&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">//@Value("$&#123;book.name&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//@Value("$&#123;book.price&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@ConfigurationProperties(prefix = “books”) </p>
<p>如果<code>application.properties</code>和<code>book.properties</code>都有books前缀开头的属性, 那么<code>application.properties</code>优先级高, 最终是<code>application.properties</code>里的值注入生效.</p>
<h2 id="多Profile切换"><a href="#多Profile切换" class="headerlink" title="多Profile切换"></a>多Profile切换</h2><p>新建三个配置文件:</p>
<p><code>application.properties</code> 存放公共配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.servlet.context-path</span>=<span class="string">/lee</span></span><br></pre></td></tr></table></figure>

<p><code>application-dev.properties</code> 存放开发环境的个性化配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>

<p><code>application-prod.properties存放生产环境的个性化配置</code></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8082</span></span><br></pre></td></tr></table></figure>

<p>启动项目,看到终端输出的日志中有如下两行信息:</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">**</span><br><span class="line">No active profile set, falling back to default profiles: default</span><br><span class="line">Tomcat started on port(s): 8080 (http) with context path '/lee'</span><br><span class="line">**</span><br></pre></td></tr></table></figure>

<p>说明默认的<code>application.properties</code>文件中的配置属性在生效.</p>
<p>为了动态切换配置,在<code>application.properties</code> 中添加下面一行配置:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>然后重新启动项目可以看到终端输出的日志中有如下两行信息:</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">**</span><br><span class="line">spring.profiles.active=dev</span><br><span class="line">Tomcat started on port(s): 8081 (http) with context path '/lee'</span><br><span class="line">**</span><br></pre></td></tr></table></figure>

<p>说明<code>application-dev.properties</code> 正在生效.</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot_Chapter0</title>
    <url>/2020/09/21/SpringBoot-Chapter0/</url>
    <content><![CDATA[<p>本节主要介绍传统SSM项目环境构建过程, 然后引入SpringBoot项目构建过程进行对比分析.</p>
<a id="more"></a>
<h1 id="SpringBoot基础介绍"><a href="#SpringBoot基础介绍" class="headerlink" title="SpringBoot基础介绍"></a>SpringBoot基础介绍</h1><h2 id="XML-Spring项目构建"><a href="#XML-Spring项目构建" class="headerlink" title="XML-Spring项目构建"></a>XML-Spring项目构建</h2><h3 id="新建maven项目"><a href="#新建maven项目" class="headerlink" title="新建maven项目,"></a>新建maven项目,</h3><h3 id="pom文件添加packaging标签-表示项目最终打包成war包"><a href="#pom文件添加packaging标签-表示项目最终打包成war包" class="headerlink" title="pom文件添加packaging标签,表示项目最终打包成war包"></a>pom文件添加packaging标签,表示项目最终打包成war包</h3>   <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="项目目录结构组织"><a href="#项目目录结构组织" class="headerlink" title="项目目录结构组织"></a>项目目录结构组织</h3><pre><code>在项目目录结构中添加webapp目录及其里面的web.xml文件</code></pre><p>   <img src="/2020/09/21/SpringBoot-Chapter0/%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.png" alt="创建SSM项目">   </p>
<h3 id="pom中引入webmvc相关依赖"><a href="#pom中引入webmvc相关依赖" class="headerlink" title="pom中引入webmvc相关依赖"></a>pom中引入webmvc相关依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置spring和MVC的配置文件"><a href="#配置spring和MVC的配置文件" class="headerlink" title="配置spring和MVC的配置文件:"></a>配置spring和MVC的配置文件:</h3><p>   applicationContext.xml : </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 包扫描 spring容器扫描除了Controller以外的其他类, Controller交给MVC扫描处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.lee"</span> <span class="attr">use-default-filters</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-MVC.xml :</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- include 标签来表明只扫描Controller--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.lee"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置web-xml"><a href="#配置web-xml" class="headerlink" title="配置web.xml"></a>配置web.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring 配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring-MVC 配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-MVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="创建Controller"><a href="#创建Controller" class="headerlink" title="创建Controller"></a>创建Controller</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lee.service.HiService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HiService hiService;</span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/hi"</span>,produces = <span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hi</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hiService.sayHi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@GetMapping(value = “/hi”,produces = “text/html;charset=utf-8”) 中的produces是为了解决前端乱码问题.</p>
<h3 id="创建Service"><a href="#创建Service" class="headerlink" title="创建Service"></a>创建Service</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.ws.ServiceMode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hi Spring,久仰!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此, 整个项目的目录结构:</p>
<p><img src="/2020/09/21/SpringBoot-Chapter0/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt="目录结构"></p>
<h3 id="配置本地Tomcat"><a href="#配置本地Tomcat" class="headerlink" title="配置本地Tomcat"></a>配置本地Tomcat</h3><p><img src="/2020/09/21/SpringBoot-Chapter0/%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0tomcat.png" alt="配置本地tomcat"></p>
<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p><img src="/2020/09/21/SpringBoot-Chapter0/%E5%89%8D%E7%AB%AF%E8%AE%BF%E9%97%AE.png" alt="配置本地tomcat"></p>
<h2 id="Annotation-Spring项目构建"><a href="#Annotation-Spring项目构建" class="headerlink" title="Annotation-Spring项目构建"></a>Annotation-Spring项目构建</h2><h3 id="新建maven项目-1"><a href="#新建maven项目-1" class="headerlink" title="新建maven项目"></a>新建maven项目</h3><p>并添加package和webMVC依赖 (和XML方式构建spring项目一致)</p>
<h3 id="新建Spring配置类"><a href="#新建Spring配置类" class="headerlink" title="新建Spring配置类"></a>新建Spring配置类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.lee"</span>&#125;</span><br><span class="line">                ,useDefaultFilters = <span class="keyword">true</span>,</span><br><span class="line">                excludeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(type = FilterType.ANNOTATION,classes = &#123;Controller<span class="class">.<span class="keyword">class</span>&#125;)&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新建MVC配置类"><a href="#新建MVC配置类" class="headerlink" title="新建MVC配置类"></a>新建MVC配置类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.lee"</span>&#125;</span><br><span class="line">        ,useDefaultFilters = <span class="keyword">false</span>,</span><br><span class="line">        includeFilters  = &#123;<span class="meta">@ComponentScan</span>.Filter(type = FilterType.ANNOTATION,classes = &#123;Controller<span class="class">.<span class="keyword">class</span>&#125;)&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MvcConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新建初始化配置加载类WebInit"><a href="#新建初始化配置加载类WebInit" class="headerlink" title="新建初始化配置加载类WebInit"></a>新建初始化配置加载类WebInit</h3><p>该类功能等效于XML配置中的web.xml, 用来加载spring和mvc的配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.WebApplicationInitializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.support.AnnotationConfigWebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.DispatcherServlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRegistration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebInit</span> <span class="keyword">implements</span> <span class="title">WebApplicationInitializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(javax.servlet.ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        AnnotationConfigWebApplicationContext context = <span class="keyword">new</span> AnnotationConfigWebApplicationContext();</span><br><span class="line">        context.setServletContext(servletContext);</span><br><span class="line">        context.register(MvcConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        ServletRegistration.Dynamic springMVC = servletContext.addServlet(<span class="string">"springMVC"</span>, <span class="keyword">new</span> DispatcherServlet(context));</span><br><span class="line">        springMVC.addMapping(<span class="string">"/"</span>);</span><br><span class="line">        springMVC.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意, 该类需要实现WebApplicationInitializer, 需要servlet相关支持, 所以要在pom中添加servlet的依赖, 最终pom.xml:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lee<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>annotationSSM<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.16.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="创建controller类并配置"><a href="#创建controller类并配置" class="headerlink" title="创建controller类并配置"></a>创建controller类并配置</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/hi"</span>,produces = <span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hi</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"注解构建Spring成功!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="本地tomcat"><a href="#本地tomcat" class="headerlink" title="本地tomcat"></a>本地tomcat</h3><p>启动项目进行测试结果如下:</p>
<p><img src="/2020/09/21/SpringBoot-Chapter0/%E5%89%8D%E7%AB%AF%E8%AE%BF%E9%97%AE2.png" alt="配置本地tomcat"></p>
<h2 id="注解方式构建的补充"><a href="#注解方式构建的补充" class="headerlink" title="注解方式构建的补充"></a>注解方式构建的补充</h2><p>上面已经用最简单的方式进行了注解方式构建spring项目, 但是, 如果要一些其他的附加功能又该如何整合呢? 下面对几种常见功能进行了简要介绍, 更具体的细节会在后续章节进行详细展开.</p>
<h3 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h3><p>让MvcConfig类继承WebMvcConfigurationSupport, 重写addResourceHandlers方法,如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">"/static/**"</span>).addResourceLocations(<span class="string">"classpath:/static/"</span>);</span><br><span class="line">        <span class="keyword">super</span>.addResourceHandlers(registry);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>然后在resources目录下创建静态资源</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>你好, 静态资源 !<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>重启应用访问, 测试结果如下:</p>
<p><img src="/2020/09/21/SpringBoot-Chapter0/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE.png" alt="配置本地tomcat"></p>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p>新建一个类MyInterceptor实现HandlerInterceptor</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lee.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"pre"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"post"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"after"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在MvcConfig类中注册该拦截器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        MyInterceptor myInterceptor = <span class="keyword">new</span> MyInterceptor();</span><br><span class="line">        registry.addInterceptor(myInterceptor).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">        <span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在controller中添加一个方法进行测试:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(value = <span class="string">"/interceptor"</span>,produces = <span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">interceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Anthing"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>前端测试访问后发现控制台输出结果如下 :</p>
<p><img src="/2020/09/21/SpringBoot-Chapter0/%E5%90%8E%E5%8F%B0%E8%BE%93%E5%87%BA.png" alt="后台输出"></p>
<h3 id="Json数据访问"><a href="#Json数据访问" class="headerlink" title="Json数据访问"></a>Json数据访问</h3><p>添加FastJson依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加controller方法进行测试:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(value = <span class="string">"/json"</span>,produces = <span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">json</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; strings = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            strings.add(<span class="string">"www.eloise "</span>.concat(String.valueOf(i)).concat(<span class="string">".com"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> strings;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>在MvcConfig类中重写方法配置JSON:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">    FastJsonHttpMessageConverter fastJsonHttpMessageConverter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">    FastJsonConfig config=<span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">    config.setCharset(Charset.defaultCharset());</span><br><span class="line">    config.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date()));</span><br><span class="line">    fastJsonHttpMessageConverter.setFastJsonConfig(config);</span><br><span class="line">    converters.add(fastJsonHttpMessageConverter);</span><br><span class="line">    <span class="keyword">super</span>.configureMessageConverters(converters);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>config相关的配置不是必须的, 这里仅仅只是列出来做展示而已.</p>
<p>测试结果如下:</p>
<p><img src="/2020/09/21/SpringBoot-Chapter0/JSON%E6%A0%BC%E5%BC%8F%E7%BB%93%E6%9E%9C.png" alt="JSON格式结果"> </p>
<p>更多整合教程请继续浏览springboot系列博客 .</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Into SpringBoot</title>
    <url>/2020/09/21/springbootContent/</url>
    <content><![CDATA[<p>SpringBoot from Scratch …</p>
<a id="more"></a>


<p>post 1<br>    <a href="http://localhost:4000/2020/09/21/SpringBoot-Chapter0/" target="_blank" rel="noopener">回顾SSM构建过程</a><br>post 2<br>    Springboot三种构建方式<br>    启动类Application上的注解<br>    深入理解parent标签<br>post 3基础配置<br>    banner,<br>    容器相关<br>    属性注入<br>    类型安全的属性注入<br>    ymal方式配置<br>    profile切换<br>post 4. 整合视图层<br>    Freemarker<br>    FM常用指令<br>    Thymeleaf<br>    JSP基础</p>
<p>post 5.整合Web开发<br>    整合Json (fastJson, jackson, Gson)<br>    默认静态资源位置/访问<br>    (多))文件上传/下载<br>    @ControllerAdvice注解的三种使用(全局异常配置,预设全局数据,请求参数预处理)<br>    自定义错误页<br>    异常源码分析, 自定义异常数据,自定义异常视图<br>    CORS实现跨域<br>    拦截器<br>    系统自动启动任务(ComandLineRunner,Application Runner)<br>    整合web基础组件(I,S,F)<br>    AOP<br>    自定义 welcome<br>    自定义favicon<br>    disable autoconfig<br>post 6.整合持久层<br>    整合持久层总览<br>    JdbcTemplate<br>    Mybatis<br>    Spring Data 和 Jpa<br>post 7. 整合NoSql<br>    整合Redis<br>    Redis+Nginx+Spring Session 实现session共享<br>    整合MongoDB<br>post 8. REST服务<br>post 9. 开发者工具和单元测试(DevTools, LiveReload,Junit)<br>post10. 整合缓存<br>post11. 安全管理(SpringSecurity,授权, 表单登录及其自定义,整合mybatis,用户数据入库,多HTTPSecurity,密码加密,方法安全,角色继承,动态权限配置,CSRF(cross site request forgery) Oauth2 etc…)<br>post12. 整合websocket<br>post13. 整合MQ<br>post14. 企业开发整合Mail<br>post15. 应用监控<br>post16. 项目构建与部署<br>post17. 项目vHr</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring</title>
    <url>/2020/09/20/spring/</url>
    <content><![CDATA[<p>随着互联网的发展,网站应用的规模不断扩大,常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。</p>
<a id="more"></a>


<h1 id="1-spring初识"><a href="#1-spring初识" class="headerlink" title="1. spring初识"></a>1. spring初识</h1><h3 id="1-1-框架"><a href="#1-1-框架" class="headerlink" title="1.1 框架"></a>1.1 框架</h3><pre><code>框架就是一些类和接口的集合，通过这些类和接口协调来完成一系列的程序实现。JAVA框架可以分为三层：表示层，业务层和物理层。框架又叫做开发中的半成品，它不能提供整个WEB应用程序的所有东西，但是有了框架，我们就可以集中精力进行业务逻辑的开发而不用去关心它的技术实现以及一些辅助的业务逻辑。大家熟知的Structs和Spring就是表示层和业务层框架的强力代表。（说的太官方了）

人话:

框架就是某些个人或者组织定义了一系列的类或者接口，提前定义好了一些实现，用户可以在这些类和接口的基础之上，使用这些类来迅速的形成某个领域或者某个行业的解决方案，简化开发的过程，提高开发的效率。就好比：你要盖一座房子，先把柱子，房梁等先建设好，然后只需要向房子中填充就可以了，可以按照自己的需求进行设计，其实我们做的项目、系统都是类似的方式，如果所有的代码全部都需要自己实现，那么这个工程就太庞大了，所以可以先创建出一些基础的模板框架，开发人员只需要按照自己的需求向架子中填充内容，完成自己独特需求即可，这就是框架存在的意义。其实我们之前定义的简单的工具类这些东西也是类似的原理，只不过比较单一简单而已，因此，在现在的很多项目系统开发的过程中都是利用框架进行开发。</code></pre><h3 id="1-2-spring（春天）"><a href="#1-2-spring（春天）" class="headerlink" title="1.2 spring（春天）"></a>1.2 spring（春天）</h3><p><strong>架构设计</strong></p>
<pre><code>随着互联网的发展,网站应用的规模不断扩大,常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。</code></pre><p><img src="/2020/09/20/spring/dubbo-architecture-roadmap.jpg" alt="架构演进图"></p>
<pre><code>单一应用架构

当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。

垂直应用架构

当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，提升效率的方法之一是将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。

分布式服务架构

当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的分布式服务框架(RPC)是关键。

流动计算架构

当服务越来越多，容量的评估,小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的资源调度和治理中心(SOA)是关键。</code></pre><p><strong>Java主流框架演变之路</strong></p>
<pre><code>1、JSP+Servlet+JavaBean

2、MVC三层架构</code></pre><p><img src="/2020/09/20/spring/mvc.png" alt="mvc"></p>
<pre><code>3、使用EJB进行应用的开发，但是EJB是重量级框架（在使用的时候，过多的接口和依赖，侵入性强），在使用上比较麻烦

4、Struts1/Struts2+Hibernate+Spring

5、SpringMVC+Mybatis+Spring

6、SpringBoot开发，约定大于配置</code></pre><p><strong>Spring官网</strong></p>
<p><a href="https://spring.io/projects/spring-framework#overview" target="_blank" rel="noopener">官网地址</a></p>
<p><a href="https://repo.spring.io/release/org/springframework/spring/" target="_blank" rel="noopener">Repo</a></p>
<p><a href="https://github.com/spring-projects/spring-framework" target="_blank" rel="noopener">源码地址</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Spring 使创建 Java 企业应用程序变得更加容易。它提供了在企业环境中接受 Java 语言所需的一切,，并支持 Groovy 和 Kotlin 作为 JVM 上的替代语言，并可根据应用程序的需要灵活地创建多种体系结构。 从 Spring Framework 5.0 开始，Spring 需要 JDK 8(Java SE 8+)，并且已经为 JDK 9 提供了现成的支持。</span><br><span class="line"></span><br><span class="line">Spring支持各种应用场景， 在大型企业中, 应用程序通常需要运行很长时间，而且必须运行在 jdk 和应用服务器上，这种场景开发人员无法控制其升级周期。 其他可能作为一个单独的jar嵌入到服务器去运行，也有可能在云环境中。还有一些可能是不需要服务器的独立应用程序(如批处理或集成的工作任务)。</span><br><span class="line"></span><br><span class="line">Spring 是开源的。它拥有一个庞大而且活跃的社区，提供不同范围的，真实用户的持续反馈。这也帮助Spring不断地改进,不断发展。</span><br></pre></td></tr></table></figure>

<p><strong>核心解释</strong></p>
<pre><code>spring是一个开源框架。

spring是为了简化企业开发而生的，使得开发变得更加优雅和简洁。

spring是一个**IOC**和**AOP**的容器框架。

IOC：控制反转

AOP：面向切面编程

容器：包含并管理应用对象的生命周期，就好比用桶装水一样，spring就是桶，而对象就是水</code></pre><p><strong>使用spring的优点</strong></p>
<pre><code>1、Spring通过DI、AOP和消除样板式代码来简化企业级Java开发

2、Spring框架之外还存在一个构建在核心框架之上的庞大生态圈，它将Spring扩展到不同的领域，如Web服务、REST、移动开发以及NoSQL

3、低侵入式设计，代码的污染极低

4、独立于各种应用服务器，基于Spring框架的应用，可以真正实现Write Once,Run Anywhere的承诺

5、Spring的IoC容器降低了业务对象替换的复杂性，提高了组件之间的解耦

6、Spring的AOP支持允许将一些通用任务如安全、事务、日志等进行集中式处理，从而提供了更好的复用

7、Spring的ORM和DAO提供了与第三方持久层框架的的良好整合，并简化了底层的数据库访问

8、Spring的高度开放性，并不强制应用完全依赖于Spring，开发者可自由选用Spring框架的部分或全部</code></pre><p><strong>如何简化开发</strong></p>
<pre><code>基于POJO的轻量级和最小侵入性编程

通过依赖注入和面向接口实现松耦合

基于切面和惯例进行声明式编程

通过切面和模板减少样板式代码</code></pre><p><strong>spring的模块划分图</strong></p>
<p><img src="/2020/09/20/spring/spring-overview.png" alt="overview"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">模块解释：</span><br><span class="line">Test:Spring的单元测试模块</span><br><span class="line">Core Container:核心容器模块</span><br><span class="line">AOP+Aspects:面向切面编程模块</span><br><span class="line">Instrumentation:提供了class instrumentation支持和类加载器的实现来在特定的应用服务器上使用,几乎不用</span><br><span class="line">Messaging:包括一系列的用来映射消息到方法的注解,几乎不用</span><br><span class="line">Data Access&#x2F;Integration:数据的获取&#x2F;整合模块，包括了JDBC,ORM,OXM,JMS和事务模块</span><br><span class="line">Web:提供面向web整合特性</span><br></pre></td></tr></table></figure>

<h3 id="1-3-IOC（Inversion-of-Control）-控制反转"><a href="#1-3-IOC（Inversion-of-Control）-控制反转" class="headerlink" title="1.3 IOC（Inversion of Control）:控制反转"></a>1.3 IOC（Inversion of Control）:控制反转</h3><p><strong>为什么要引入IOC</strong></p>
<p>创建一个普通的java项目，完成下述功能</p>
<p>UserDao.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserDaoImpl.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.UserDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span>  <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"获取用户数据"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.impl.UserDaoMysqlImpl;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpringDemoTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDemoTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       UserService service = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">       service.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在之前的代码编写过程中，我们都是这么完成我们的功能的，但是如果增加一个UserDao的实现类呢？</p>
<p>UserDaoMysqlImpl.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.UserDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoMysqlImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mysql"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们想要使用mysql的话，那么就必须要修改UserServiceImpl.java的代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.impl.UserDaoMysqlImpl;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是如果我们再增加一个oracle的类呢？</p>
<p>UserDaoOracleImpl.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.UserDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoOracleImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"oracle"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时UserService还是要继续修改，很显然这样的方式已经不适用于我们的需求了，那么怎么解决呢，可以使用如下的方式</p>
<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类SpringDemoTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.impl.UserDaoMysqlImpl;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.impl.UserDaoOracleImpl;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDemoTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        userService.setUserDao(<span class="keyword">new</span> UserDaoMysqlImpl());</span><br><span class="line">        userService.getUser();</span><br><span class="line"></span><br><span class="line">        userService.setUserDao(<span class="keyword">new</span> UserDaoOracleImpl());</span><br><span class="line">        userService.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实从刚刚的代码中，大家应该能体会解耦的重要性了，下面我们就开始学习Spring的IOC。</p>
<p><strong>IOC初始</strong></p>
<pre><code>想要搞明白IOC，那么需要搞清楚如下几个问题：</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1、谁控制谁</span><br><span class="line">2、控制什么</span><br><span class="line">3、什么是反转</span><br><span class="line">4、哪些方面被反转</span><br></pre></td></tr></table></figure>

<p><strong>基本概念</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">IOC与大家熟知的依赖注入同理，. 这是一个通过依赖注入对象的过程 也就是说，它们所使用的对象，是通过构造函数参数，工厂方法的参数或这是从工厂方法的构造函数或返回值的对象实例设置的属性，然后容器在创建bean时注入这些需要的依赖。 这个过程相对普通创建对象的过程是反向的（因此称之为IoC），bean本身通过直接构造类来控制依赖关系的实例化或位置，或提供诸如服务定位器模式之类的机制。</span><br></pre></td></tr></table></figure>

<p>如果这个过程比较难理解的话，那么可以想象自己找女朋友和婚介公司找女朋友的过程。如果这个过程能够想明白的话，那么我们现在回答上面的问题：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1、谁控制谁：在之前的编码过程中，都是需要什么对象自己去创建什么对象，有程序员自己来控制对象，而有了IOC容器之后，就会变成由IOC容器来控制对象，</span><br><span class="line">2、控制什么：在实现过程中所需要的对象及需要依赖的对象</span><br><span class="line">3、什么是反转：在没有IOC容器之前我们都是在对象中主动去创建依赖的对象，这是正转的，而有了IOC之后，依赖的对象直接由IOC容器创建后注入到对象中，由主动创建变成了被动接受，这是反转</span><br><span class="line">4、哪些方面被反转：依赖的对象</span><br></pre></td></tr></table></figure>

<p><strong>DI与IOC</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">很多人把IOC和DI说成一个东西，笼统来说的话是没有问题的，但是本质上还是有所区别的,希望大家能够严谨一点，IOC和DI是从不同的角度描述的同一件事，IOC是从容器的角度描述，而DI是从应用程序的角度来描述，也可以这样说，IOC是设计思想，而DI是具体的实现方式</span><br></pre></td></tr></table></figure>

<h3 id="1-4-总结"><a href="#1-4-总结" class="headerlink" title="1.4 总结"></a>1.4 总结</h3><pre><code>在此处总结中，希望大家能够能够明白两件事：

**1、解耦**

在面向对象设计的软件系统中，底层的实现都是由N个对象组成的，所有的对象通过彼此的合作，最终实现系统的业务逻辑。</code></pre><p><img src="/2020/09/20/spring/%E8%80%A6%E5%90%88%E5%AF%B9%E8%B1%A1.jpg" alt="img"></p>
<pre><code>需要注意的是，在这样的组合关系中，一旦某一个对象出现了问题，那么其他对象肯定回有所影响，这就是耦合性太高的缘故，但是对象的耦合关系是无法避免的，也是必要的。随着应用程序越来越庞大，对象的耦合关系可能越来越复杂，经常需要多重依赖关系，因此，无论是架构师还是程序员，在面临这样的场景的时候，都需要减少这些对象的耦合性。</code></pre><p><img src="/2020/09/20/spring/ioc.jpg" alt="ioc"></p>
<pre><code>耦合的关系不仅仅是对象与对象之间，也会出现在软件系统的各个模块之间，是我们需要重点解决的问题。而为了解决对象之间的耦合度过高的问题，我们就可以通过IOC来实现对象之间的解耦，spring框架就是IOC理论最最广泛的应用。

从上图中可以看到，当引入了第三方的容器之后，几个对象之间就没有了耦合关系，全部对象都交由容器来控制，这个容器就相当于粘合剂，将系统的对象粘合在一起发挥作用。

**2、生态**

任何一个语言或者任何一个框架想要立于不败之地，那么很重要的就是它的生态。</code></pre><h1 id="2-spring-IOC基本使用"><a href="#2-spring-IOC基本使用" class="headerlink" title="2. spring IOC基本使用"></a>2. spring IOC基本使用</h1><pre><code>通过前面的介绍我们已经知道了Spring中非常重要的一个特性就是IOC,下面我们将要来看一下如何使用IOC容器，帮助大家更好的体会spring的优势。</code></pre><h3 id="2-1-spring-helloworld"><a href="#2-1-spring-helloworld" class="headerlink" title="2.1 spring_helloworld"></a>2.1 spring_helloworld</h3><h5 id="1-使用手动加载jar包的方式实现，分为三个步骤，现在几乎不用"><a href="#1-使用手动加载jar包的方式实现，分为三个步骤，现在几乎不用" class="headerlink" title="(1)使用手动加载jar包的方式实现，分为三个步骤，现在几乎不用"></a><strong>(1)使用手动加载jar包的方式实现，分为三个步骤，现在几乎不用</strong></h5><ul>
<li><p><strong>导包：导入这五个包即可</strong></p>
<p>commons-logging-1.2.jar spring-beans-5.2.3.RELEASE.jar spring-context-5.2.3.RELEASE.jar spring-core-5.2.3.RELEASE.jar spring-expression-5.2.3.RELEASE.jar</p>
</li>
<li><p><strong>写配置</strong></p>
<p>Person.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", gender='"</span> + gender + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--注册一个对象，spring回自动创建这个对象--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    一个bean标签就表示一个对象</span></span><br><span class="line"><span class="comment">    id:这个对象的唯一标识</span></span><br><span class="line"><span class="comment">    class:注册对象的完全限定名</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用property标签给对象的属性赋值</span></span><br><span class="line"><span class="comment">        name:表示属性的名称</span></span><br><span class="line"><span class="comment">        value：表示属性的值</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"zhangsan"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"男"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
</li>
</ul>
<p>SpringDemoTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDemoTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ApplicationContext:表示ioc容器</span></span><br><span class="line">        <span class="comment">//ClassPathXmlApplicationContext:表示从当前classpath路径中获取xml文件的配置</span></span><br><span class="line">        <span class="comment">//根据spring的配置文件来获取ioc容器对象</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc.xml"</span>);</span><br><span class="line">        Person person = (Person) context.getBean(<span class="string">"person"</span>);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-使用maven的方式来构建项目"><a href="#2-使用maven的方式来构建项目" class="headerlink" title="(2)使用maven的方式来构建项目"></a><strong>(2)使用maven的方式来构建项目</strong></h5><ul>
<li><p><strong>创建maven项目</strong></p>
<p>定义项目的groupId、artifactId</p>
</li>
<li><p><strong>添加对应的pom依赖</strong></p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mashibing<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring_demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写代码</strong></p>
<p>Person.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", gender='"</span> + gender + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<p>MyTest.java</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc.xml"</span>);</span><br><span class="line">        Person person = (Person) context.getBean(<span class="string">"person"</span>);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结：</strong></p>
<pre><code>以上两种方式创建spring的项目都是可以的，但是在现在的企业开发环境中使用更多的还是maven这样的方式，无须自己处理jar之间的依赖关系，也无须提前下载jar包，只需要配置相关的pom即可，因此推荐大家使用maven的方式，具体的maven操作大家可以看maven的详细操作文档。

**搭建spring项目需要注意的点：**

1、一定要将配置文件添加到类路径中，使用idea创建项目的时候要放在resource目录下

2、导包的时候别忘了commons-logging-1.2.jar包

**细节点：**

1、ApplicationContext就是IOC容器的接口，可以通过此对象获取容器中创建的对象

2、对象在Spring容器创建完成的时候就已经创建完成，不是需要用的时候才创建

3、对象在IOC容器中存储的时候都是单例的，如果需要多例需要修改属性

4、创建对象给属性赋值的时候是通过setter方法实现的

5、对象的属性是由setter/getter方法决定的，而不是定义的成员属性</code></pre><h3 id="2-2-spring对象的获取及属性赋值方式"><a href="#2-2-spring对象的获取及属性赋值方式" class="headerlink" title="2.2 spring对象的获取及属性赋值方式"></a>2.2 spring对象的获取及属性赋值方式</h3><h5 id="1、通过bean的id获取IOC容器中的对象（上面已经用过）"><a href="#1、通过bean的id获取IOC容器中的对象（上面已经用过）" class="headerlink" title="1、通过bean的id获取IOC容器中的对象（上面已经用过）"></a><strong>1、通过bean的id获取IOC容器中的对象（上面已经用过）</strong></h5><h5 id="2、通过bean的类型获取对象"><a href="#2、通过bean的类型获取对象" class="headerlink" title="2、通过bean的类型获取对象"></a><strong>2、通过bean的类型获取对象</strong></h5><pre><code>MyTest.java</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc.xml"</span>);</span><br><span class="line">        Person bean = context.getBean(Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：通过bean的类型在查找对象的时候，在配置文件中不能存在两个类型一致的bean对象，如果有的话，可以通过如下方法</p>
<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc.xml"</span>);</span><br><span class="line">        Person person = context.getBean(<span class="string">"person"</span>, Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3、通过构造器给bean对象赋值"><a href="#3、通过构造器给bean对象赋值" class="headerlink" title="3、通过构造器给bean对象赋值"></a><strong>3、通过构造器给bean对象赋值</strong></h5><p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--给person类添加构造方法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"lisi"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"女"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--在使用构造器赋值的时候可以省略name属性，但是此时就要求必须严格按照构造器参数的顺序来填写了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person3"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"lisi"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"女"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--如果想不按照顺序来添加参数值，那么可以搭配index属性来使用--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person4"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"lisi"</span> <span class="attr">index</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">index</span>=<span class="string">"0"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"女"</span> <span class="attr">index</span>=<span class="string">"3"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"20"</span> <span class="attr">index</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--当有多个参数个数相同，不同类型的构造器的时候，可以通过type来强制类型--&gt;</span></span><br><span class="line">将person的age类型设置为Integer类型</span><br><span class="line">public Person(int id, String name, Integer age) &#123;</span><br><span class="line">       this.id = id;</span><br><span class="line">       this.name = name;</span><br><span class="line">       this.age = age;</span><br><span class="line">       System.out.println("Age");</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public Person(int id, String name, String gender) &#123;</span><br><span class="line">       this.id = id;</span><br><span class="line">       this.name = name;</span><br><span class="line">       this.gender = gender;</span><br><span class="line">       System.out.println("gender");</span><br><span class="line">   &#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person5"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"lisi"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"20"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果不修改为integer类型，那么需要type跟index组合使用--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person5"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"lisi"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"20"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">index</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="4、通过命名空间为bean赋值，简化配置文件中属性声明的写法"><a href="#4、通过命名空间为bean赋值，简化配置文件中属性声明的写法" class="headerlink" title="4、通过命名空间为bean赋值，简化配置文件中属性声明的写法"></a><strong>4、通过命名空间为bean赋值，简化配置文件中属性声明的写法</strong></h5><pre><code>1、导入命名空间</code></pre><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code>2、添加配置</code></pre><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person6"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">p:id</span>=<span class="string">"3"</span> <span class="attr">p:name</span>=<span class="string">"wangwu"</span> <span class="attr">p:age</span>=<span class="string">"22"</span> <span class="attr">p:gender</span>=<span class="string">"男"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="5、为复杂类型进行赋值操作"><a href="#5、为复杂类型进行赋值操作" class="headerlink" title="5、为复杂类型进行赋值操作"></a><strong>5、为复杂类型进行赋值操作</strong></h5><pre><code>在之前的测试代码中，我们都是给最基本的属性进行赋值操作，在正常的企业级开发中还会遇到给各种复杂类型赋值，如集合、数组、其他对象等。

Person.java</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name=<span class="string">"dahuang"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> String[] hobbies;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; books;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; sets;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> id, String name, <span class="keyword">int</span> age, String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        System.out.println(<span class="string">"有参构造器"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> id, String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        System.out.println(<span class="string">"Age"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> id, String name, String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        System.out.println(<span class="string">"gender"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBooks</span><span class="params">(List&lt;Book&gt; books)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.books = books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getMaps</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaps</span><span class="params">(Map&lt;String, Object&gt; maps)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.maps = maps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Properties <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getHobbies() &#123;</span><br><span class="line">        <span class="keyword">return</span> hobbies;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHobbies</span><span class="params">(String[] hobbies)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hobbies = hobbies;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Integer&gt; <span class="title">getSets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSets</span><span class="params">(Set&lt;Integer&gt; sets)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sets = sets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", gender='"</span> + gender + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address="</span> + address +</span><br><span class="line">                <span class="string">", hobbies="</span> + Arrays.toString(hobbies) +</span><br><span class="line">                <span class="string">", books="</span> + books +</span><br><span class="line">                <span class="string">", sets="</span> + sets +</span><br><span class="line">                <span class="string">", maps="</span> + maps +</span><br><span class="line">                <span class="string">", properties="</span> + properties +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Book.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(String name, String author, <span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.author = author;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAuthor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthor</span><span class="params">(String author)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.author = author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Book&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", author='"</span> + author + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", price="</span> + price +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Address.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String town;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String province, String city, String town)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.province = province;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">        <span class="keyword">this</span>.town = town;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProvince</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> province;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProvince</span><span class="params">(String province)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.province = province;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> town;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTown</span><span class="params">(String town)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.town = town;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Address&#123;"</span> +</span><br><span class="line">                <span class="string">"province='"</span> + province + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", city='"</span> + city + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", town='"</span> + town + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/util https://www.springframework.org/schema/util/spring-util.xsd"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--给复杂类型的赋值都在property标签内进行--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--赋空值--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">null</span>&gt;</span><span class="tag">&lt;/<span class="name">null</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--通过ref引用其他对象，引用外部bean--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">ref</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引用内部bean--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- &lt;property name="address"&gt;</span></span><br><span class="line"><span class="comment">            &lt;bean class="com.mashibing.bean.Address"&gt;</span></span><br><span class="line"><span class="comment">                &lt;property name="province" value="北京"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">                &lt;property name="city" value="北京"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">                &lt;property name="town" value="西城区"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">            &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--为list赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"books"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--内部bean--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book1"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Book"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"多线程与高并发"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"马士兵"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--外部bean--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"book2"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给map赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maps"</span> <span class="attr">ref</span>=<span class="string">"myMap"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给property赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"aaa"</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"bbb"</span>&gt;</span>222<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给数组赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hobbies"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>book<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>movie<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>game<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给set赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sets"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>111<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>222<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>222<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Address"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"province"</span> <span class="attr">value</span>=<span class="string">"河北"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"city"</span> <span class="attr">value</span>=<span class="string">"邯郸"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"town"</span> <span class="attr">value</span>=<span class="string">"武安"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book2"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Book"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"JVM"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"马士兵"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"1200"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--级联属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">ref</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address.province"</span> <span class="attr">value</span>=<span class="string">"北京"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--util名称空间创建集合类型的bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">"myMap"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key1"</span> <span class="attr">value</span>=<span class="string">"value1"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key2"</span> <span class="attr">value-ref</span>=<span class="string">"book2"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key03"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Book"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"西游记"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"吴承恩"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"100"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="6、继承关系bean的配置"><a href="#6、继承关系bean的配置" class="headerlink" title="6、继承关系bean的配置"></a>6、继承关系bean的配置</h5><p>ioc.xml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean id&#x3D;&quot;person&quot; class&#x3D;&quot;com.mashibing.bean.Person&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;id&quot; value&#x3D;&quot;1&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;name&quot; value&#x3D;&quot;zhangsan&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;age&quot; value&#x3D;&quot;21&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;gender&quot; value&#x3D;&quot;男&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;!--parent:指定bean的配置信息继承于哪个bean--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;person2&quot; class&#x3D;&quot;com.mashibing.bean.Person&quot; parent&#x3D;&quot;person&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;name&quot; value&#x3D;&quot;lisi&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<p>如果想实现Java文件的抽象类，不需要将当前bean实例化的话，可以使用abstract属性</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">abstract</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"zhangsan"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"21"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"男"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--parent:指定bean的配置信息继承于哪个bean--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">parent</span>=<span class="string">"person"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"lisi"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="7、bean对象创建的依赖关系"><a href="#7、bean对象创建的依赖关系" class="headerlink" title="7、bean对象创建的依赖关系"></a>7、bean对象创建的依赖关系</h5><pre><code>bean对象在创建的时候是按照bean在配置文件的顺序决定的，也可以使用depend-on标签来决定顺序</code></pre><p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Book"</span> <span class="attr">depends-on</span>=<span class="string">"person,address"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Address"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="8、bean的作用域控制，是否是单例"><a href="#8、bean的作用域控制，是否是单例" class="headerlink" title="8、bean的作用域控制，是否是单例"></a>8、bean的作用域控制，是否是单例</h5><p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">bean的作用域：singleton、prototype、request、session</span></span><br><span class="line"><span class="comment">默认情况下是单例的</span></span><br><span class="line"><span class="comment">prototype：多实例的</span></span><br><span class="line"><span class="comment">    容器启动的时候不会创建多实例bean，只有在获取对象的时候才会创建该对象</span></span><br><span class="line"><span class="comment">    每次创建都是一个新的对象</span></span><br><span class="line"><span class="comment">singleton：默认的单例对象</span></span><br><span class="line"><span class="comment">    在容器启动完成之前就已经创建好对象</span></span><br><span class="line"><span class="comment">    获取的所有对象都是同一个</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person4"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="9、利用工厂模式创建bean对象"><a href="#9、利用工厂模式创建bean对象" class="headerlink" title="9、利用工厂模式创建bean对象"></a>9、利用工厂模式创建bean对象</h5><pre><code>在之前的案例中，所有bean对象的创建都是通过反射得到对应的bean实例，其实在spring中还包含另外一种创建bean实例的方式，就是通过工厂模式进行对象的创建

在利用工厂模式创建bean实例的时候有两种方式，分别是静态工厂和实例工厂。

静态工厂：工厂本身不需要创建对象，但是可以通过静态方法调用，对象=工厂类.静态工厂方法名（）；

实例工厂：工厂本身需要创建对象，工厂类 工厂对象=new 工厂类；工厂对象.get对象名（）；</code></pre><p>PersonStaticFactory.java</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">package com.mashibing.factory;</span><br><span class="line"></span><br><span class="line">import com.mashibing.bean.Person;</span><br><span class="line"></span><br><span class="line">public class PersonStaticFactory &#123;</span><br><span class="line"></span><br><span class="line">    public static Person getPerson(String name)&#123;</span><br><span class="line">        Person person = new Person();</span><br><span class="line">        person.setId(1);</span><br><span class="line">        person.setName(name);</span><br><span class="line">        return person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">静态工厂的使用：</span></span><br><span class="line"><span class="comment">class:指定静态工厂类</span></span><br><span class="line"><span class="comment">factory-method:指定哪个方法是工厂方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person5"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.factory.PersonStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getPerson"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--constructor-arg：可以为方法指定参数--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"lisi"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>PersonInstanceFactory.java</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">package com.mashibing.factory;</span><br><span class="line"></span><br><span class="line">import com.mashibing.bean.Person;</span><br><span class="line"></span><br><span class="line">public class PersonInstanceFactory &#123;</span><br><span class="line">    public Person getPerson(String name)&#123;</span><br><span class="line">        Person person = new Person();</span><br><span class="line">        person.setId(1);</span><br><span class="line">        person.setName(name);</span><br><span class="line">        return person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--实例工厂使用--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--创建实例工厂类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"personInstanceFactory"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.factory.PersonInstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">factory-bean:指定使用哪个工厂实例</span></span><br><span class="line"><span class="comment">factory-method:指定使用哪个工厂实例的方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person6"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">factory-bean</span>=<span class="string">"personInstanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getPerson"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"wangwu"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="10、继承FactoryBean来创建对象"><a href="#10、继承FactoryBean来创建对象" class="headerlink" title="10、继承FactoryBean来创建对象"></a>10、继承FactoryBean来创建对象</h5><pre><code>FactoryBean是Spring规定的一个接口，当前接口的实现类，Spring都会将其作为一个工厂，但是在ioc容器启动的时候不会创建实例，只有在使用的时候才会创建对象</code></pre><p>MyFactoryBean.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现了FactoryBean接口的类是Spring中可以识别的工厂类，spring会自动调用工厂方法创建实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 工厂方法，返回需要创建的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person();</span><br><span class="line">        person.setName(<span class="string">"maliu"</span>);</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回创建对象的类型,spring会自动调用该方法返回对象的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Person<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建的对象是否是单例对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myfactorybean"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.factory.MyFactoryBean"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="11、bean对象的初始化和销毁方法"><a href="#11、bean对象的初始化和销毁方法" class="headerlink" title="11、bean对象的初始化和销毁方法"></a>11、bean对象的初始化和销毁方法</h5><pre><code>在创建对象的时候，我们可以根据需要调用初始化和销毁的方法</code></pre><p>Address.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String town;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"address被创建了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String province, String city, String town)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.province = province;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">        <span class="keyword">this</span>.town = town;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProvince</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> province;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProvince</span><span class="params">(String province)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.province = province;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> town;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTown</span><span class="params">(String town)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.town = town;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"对象被初始化"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"对象被销毁"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Address&#123;"</span> +</span><br><span class="line">                <span class="string">"province='"</span> + province + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", city='"</span> + city + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", town='"</span> + town + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--bean生命周期表示bean的创建到销毁</span></span><br><span class="line"><span class="comment">        如果bean是单例，容器在启动的时候会创建好，关闭的时候会销毁创建的bean</span></span><br><span class="line"><span class="comment">        如果bean是多礼，获取的时候创建对象，销毁的时候不会有任何的调用</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Address"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"destory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.bean.Address;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc2.xml"</span>);</span><br><span class="line">        Address address = context.getBean(<span class="string">"address"</span>, Address<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(address);</span><br><span class="line">        <span class="comment">//applicationContext没有close方法，需要使用具体的子类</span></span><br><span class="line">        ((ClassPathXmlApplicationContext)context).close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="12、配置bean对象初始化方法的前后处理方法"><a href="#12、配置bean对象初始化方法的前后处理方法" class="headerlink" title="12、配置bean对象初始化方法的前后处理方法"></a>12、配置bean对象初始化方法的前后处理方法</h5><pre><code>spring中包含一个BeanPostProcessor的接口，可以在bean的初始化方法的前后调用该方法，如果配置了初始化方法的前置和后置处理器，无论是否包含初始化方法，都会进行调用</code></pre><p>MyBeanPostProcessor.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在初始化方法调用之前执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean  初始化的bean对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName  xml配置文件中的bean的id属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"postProcessBeforeInitialization:"</span>+beanName+<span class="string">"调用初始化前置方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在初始化方法调用之后执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"postProcessAfterInitialization:"</span>+beanName+<span class="string">"调用初始化后缀方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myBeanPostProcessor"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.MyBeanPostProcessor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-spring创建第三方bean对象"><a href="#2-3-spring创建第三方bean对象" class="headerlink" title="2.3 spring创建第三方bean对象"></a>2.3 spring创建第三方bean对象</h3><pre><code>在Spring中，很多对象都是单实例的，在日常的开发中，我们经常需要使用某些外部的单实例对象，例如数据库连接池，下面我们来讲解下如何在spring中创建第三方bean实例。

1、导入数据库连接池的pom文件</code></pre><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code>2、编写配置文件</code></pre><p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code>3、编写测试文件</code></pre><p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Address;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc3.xml"</span>);</span><br><span class="line">        DruidDataSource dataSource = context.getBean(<span class="string">"dataSource"</span>, DruidDataSource<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(dataSource);</span><br><span class="line">        System.out.println(dataSource.getConnection());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-spring引用外部配置文件"><a href="#2-4-spring引用外部配置文件" class="headerlink" title="2.4 spring引用外部配置文件"></a>2.4 spring引用外部配置文件</h3><p>在resource中添加dbconfig.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/demo</span></span><br><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>编写配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--加载外部配置文件</span></span><br><span class="line"><span class="comment">		在加载外部依赖文件的时候需要context命名空间</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;driverClassName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-spring基于xml文件的自动装配"><a href="#2-5-spring基于xml文件的自动装配" class="headerlink" title="2.5 spring基于xml文件的自动装配"></a>2.5 spring基于xml文件的自动装配</h3><pre><code>当一个对象中需要引用另外一个对象的时候，在之前的配置中我们都是通过property标签来进行手动配置的，其实在spring中还提供了一个非常强大的功能就是自动装配，可以按照我们指定的规则进行配置，配置的方式有以下几种：

default/no：不自动装配

byName：按照名字进行装配，以属性名作为id去容器中查找组件，进行赋值，如果找不到则装配null

byType：按照类型进行装配,以属性的类型作为查找依据去容器中找到这个组件，如果有多个类型相同的bean对象，那么会报异常，如果找不到则装配null

constructor：按照构造器进行装配，先按照有参构造器参数的类型进行装配，没有就直接装配null；如果按照类型找到了多个，那么就使用参数名作为id继续匹配，找到就装配，找不到就装配null</code></pre><p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Address"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"province"</span> <span class="attr">value</span>=<span class="string">"河北"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"city"</span> <span class="attr">value</span>=<span class="string">"邯郸"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"town"</span> <span class="attr">value</span>=<span class="string">"武安"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">autowire</span>=<span class="string">"byName"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">autowire</span>=<span class="string">"byType"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person3"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span> <span class="attr">autowire</span>=<span class="string">"constructor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-6-SpEL的使用"><a href="#2-6-SpEL的使用" class="headerlink" title="2.6 SpEL的使用"></a>2.6 SpEL的使用</h3><pre><code>SpEL:Spring Expression Language,spring的表达式语言，支持运行时查询操作对象

使用#{...}作为语法规则，所有的大括号中的字符都认为是SpEL.</code></pre><p>ioc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person4"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.bean.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--支持任何运算符--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"#&#123;12*2&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--可以引用其他bean的某个属性值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#&#123;address.province&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引用其他bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">value</span>=<span class="string">"#&#123;address&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--调用静态方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hobbies"</span> <span class="attr">value</span>=<span class="string">"#&#123;T(java.util.UUID).randomUUID().toString().substring(0,4)&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--调用非静态方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"#&#123;address.getCity()&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="3-SpringIOC的注解应用"><a href="#3-SpringIOC的注解应用" class="headerlink" title="3. SpringIOC的注解应用"></a>3. SpringIOC的注解应用</h1><pre><code>在之前的项目中，我们都是通过xml文件进行bean或者某些属性的赋值，其实还有另外一种注解的方式，在企业开发中使用的很多，在bean上添加注解，可以快速的将bean注册到ioc容器。</code></pre><h3 id="3-1-使用注解的方式注册bean到IOC容器中"><a href="#3-1-使用注解的方式注册bean到IOC容器中" class="headerlink" title="3.1 使用注解的方式注册bean到IOC容器中"></a>3.1 使用注解的方式注册bean到IOC容器中</h3><p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    如果想要将自定义的bean对象添加到IOC容器中，需要在类上添加某些注解</span></span><br><span class="line"><span class="comment">    Spring中包含4个主要的组件添加注解：</span></span><br><span class="line"><span class="comment">    @Controller:控制器，推荐给controller层添加此注解</span></span><br><span class="line"><span class="comment">    @Service:业务逻辑，推荐给业务逻辑层添加此注解</span></span><br><span class="line"><span class="comment">    @Repository:仓库管理，推荐给数据访问层添加此注解</span></span><br><span class="line"><span class="comment">    @Component:给不属于以上基层的组件添加此注解</span></span><br><span class="line"><span class="comment">    注意：我们虽然人为的给不同的层添加不同的注解，但是在spring看来，可以在任意层添加任意注解</span></span><br><span class="line"><span class="comment">           spring底层是不会给具体的层次验证注解，这样写的目的只是为了提高可读性，最偷懒的方式</span></span><br><span class="line"><span class="comment">           就是给所有想交由IOC容器管理的bean对象添加component注解</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    使用注解需要如下步骤：</span></span><br><span class="line"><span class="comment">    1、添加上述四个注解中的任意一个</span></span><br><span class="line"><span class="comment">    2、添加自动扫描注解的组件，此操作需要依赖context命名空间</span></span><br><span class="line"><span class="comment">    3、添加自动扫描的标签context:component-scan</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	注意：当使用注解注册组件和使用配置文件注册组件是一样的，但是要注意：</span></span><br><span class="line"><span class="comment">		1、组件的id默认就是组件的类名首字符小写，如果非要改名字的话，直接在注解中添加即可</span></span><br><span class="line"><span class="comment">		2、组件默认情况下都是单例的,如果需要配置多例模式的话，可以在注解下添加@Scope注解</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    定义自动扫描的基础包:</span></span><br><span class="line"><span class="comment">    base-package:指定扫描的基础包，spring在启动的时候会将基础包及子包下所有加了注解的类都自动</span></span><br><span class="line"><span class="comment">                扫描进IOC容器</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mashibing"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>PersonController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建对象"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PersonService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PersonDao.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span>(<span class="string">"personDao"</span>)</span><br><span class="line"><span class="meta">@Scope</span>(value=<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDao</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-定义扫描包时要包含的类和不要包含的类"><a href="#3-2-定义扫描包时要包含的类和不要包含的类" class="headerlink" title="3.2 定义扫描包时要包含的类和不要包含的类"></a>3.2 定义扫描包时要包含的类和不要包含的类</h3><pre><code>当定义好基础的扫描包后，在某些情况下可能要有选择性的配置是否要注册bean到IOC容器中，此时可以通过如下的方式进行配置。</code></pre><h4 id="3-2-1-XML方式"><a href="#3-2-1-XML方式" class="headerlink" title="3.2.1 XML方式"></a>3.2.1 XML方式</h4><p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mashibing"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        当定义好基础扫描的包之后，可以排除包中的某些类，使用如下的方式:</span></span><br><span class="line"><span class="comment">        type:表示指定过滤的规则</span></span><br><span class="line"><span class="comment">            annotation：按照注解进行排除，标注了指定注解的组件不要,expression表示要过滤的注解</span></span><br><span class="line"><span class="comment">            assignable：指定排除某个具体的类，按照类排除，expression表示不注册的具体类名</span></span><br><span class="line"><span class="comment">            aspectj：后面讲aop的时候说明要使用的aspectj表达式，不用</span></span><br><span class="line"><span class="comment">            custom：定义一个typeFilter,自己写代码决定哪些类被过滤掉，不用</span></span><br><span class="line"><span class="comment">            regex：使用正则表达式过滤，不用</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--指定只扫描哪些组件，默认情况下是全部扫描的，所以此时要配置的话需要在component-scan标签中添加 use-default-filters="false"--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"assignable"</span> <span class="attr">expression</span>=<span class="string">"com.mashibing.service.PersonService"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-使用-AutoWired进行自动注入"><a href="#3-3-使用-AutoWired进行自动注入" class="headerlink" title="3.3 使用@AutoWired进行自动注入"></a>3.3 使用@AutoWired进行自动注入</h3><pre><code>使用注解的方式实现自动注入需要使用@AutoWired注解。</code></pre><p>PersonController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.PersonService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonService personService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建对象"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        personService.getPerson();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PersonService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.PersonDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonDao personDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        personDao.getPerson();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PersonDao.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"PersonDao:getPerson"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：当使用AutoWired注解的时候，自动装配的时候是根据类型实现的。</p>
<pre><code>1、如果只找到一个，则直接进行赋值，

2、如果没有找到，则直接抛出异常，

3、如果找到多个，那么会按照变量名作为id继续匹配,

1、匹配上直接进行装配

2、如果匹配不上则直接报异常</code></pre><p>PersonServiceExt.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.PersonDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceExt</span> <span class="keyword">extends</span> <span class="title">PersonService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonDao personDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"PersonServiceExt......"</span>);</span><br><span class="line">        personDao.getPerson();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PersonController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.PersonService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonService personServiceExt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建对象"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        personServiceExt.getPerson();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>还可以使用@Qualifier注解来指定id的名称，让spring不要使用变量名,当使用@Qualifier注解的时候也会有两种情况：

1、找到，则直接装配

2、找不到，就会报错</code></pre><p>PersonController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.PersonService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"personService"</span>)</span><br><span class="line">    <span class="keyword">private</span> PersonService personServiceExt2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建对象"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        personServiceExt2.getPerson();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>通过上述的代码我们能够发现，使用@AutoWired肯定是能够装配上的，如果装配不上就会报错。</code></pre><h3 id="3-4-AutoWired可以进行定义在方法上"><a href="#3-4-AutoWired可以进行定义在方法上" class="headerlink" title="3.4 @AutoWired可以进行定义在方法上"></a>3.4 @AutoWired可以进行定义在方法上</h3><pre><code>当我们查看@AutoWired注解的源码的时候发现，此注解不仅可以使用在成员变量上，也可以使用在方法上。</code></pre><p>PersonController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.PersonDao;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.PersonService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"personService"</span>)</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonService personServiceExt2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建对象"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"personController..."</span>+personServiceExt2);</span><br><span class="line"><span class="comment">//        personServiceExt2.getPerson();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当方法上有<span class="doctag">@AutoWired</span>注解时：</span></span><br><span class="line"><span class="comment">     *  1、此方法在bean创建的时候会自动调用</span></span><br><span class="line"><span class="comment">     *  2、这个方法的每一个参数都会自动注入值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> personDao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(PersonDao personDao)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"此方法被调用:"</span>+personDao);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Qualifier</span>注解也可以作用在属性上，用来被当作id去匹配容器中的对象，如果没有</span></span><br><span class="line"><span class="comment">     * 此注解，那么直接按照类型进行匹配</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> personService</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(@Qualifier(<span class="string">"personServiceExt"</span>)</span> PersonService personService)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"此方法被调用："</span>+personService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-自动装配的注解-AutoWired，-Resource"><a href="#3-5-自动装配的注解-AutoWired，-Resource" class="headerlink" title="3.5 自动装配的注解@AutoWired，@Resource"></a>3.5 自动装配的注解@AutoWired，@Resource</h3><pre><code>在使用自动装配的时候，出了可以使用@AutoWired注解之外，还可以使用@Resource注解，大家需要知道这两个注解的区别。

1、@AutoWired:是spring中提供的注解，@Resource:是jdk中定义的注解，依靠的是java的标准

2、@AutoWired默认是按照类型进行装配，默认情况下要求依赖的对象必须存在，@Resource默认是按照名字进行匹配的，同时可以指定name属性。

3、@AutoWired只适合spring框架，而@Resource扩展性更好</code></pre><p>PersonController.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.PersonDao;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.PersonService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"personService"</span>)</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PersonService personServiceExt2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建对象"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"personController..."</span>+personServiceExt2);</span><br><span class="line">        personServiceExt2.getPerson();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当方法上有<span class="doctag">@AutoWired</span>注解时：</span></span><br><span class="line"><span class="comment">     *  1、此方法在bean创建的时候会自动调用</span></span><br><span class="line"><span class="comment">     *  2、这个方法的每一个参数都会自动注入值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> personDao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(PersonDao personDao)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"此方法被调用:"</span>+personDao);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Qualifier</span>注解也可以作用在属性上，用来被当作id去匹配容器中的对象，如果没有</span></span><br><span class="line"><span class="comment">     * 此注解，那么直接按照类型进行匹配</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> personService</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(@Qualifier(<span class="string">"personServiceExt"</span>)</span> PersonService personService)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"此方法被调用："</span>+personService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-泛型依赖注入"><a href="#3-6-泛型依赖注入" class="headerlink" title="3.6 泛型依赖注入"></a>3.6 泛型依赖注入</h3><pre><code>为了讲解泛型依赖注入，首先我们需要先写一个基本的案例，按照我们之前学习的知识：</code></pre><p>Student.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Teacher.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BaseDao.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StudentDao.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Student;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentDao</span> <span class="keyword">extends</span> <span class="title">BaseDao</span>&lt;<span class="title">Student</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"保存学生"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TeacherDao.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDao</span> <span class="keyword">extends</span> <span class="title">BaseDao</span>&lt;<span class="title">Teacher</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"保存老师"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StudentService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.StudentDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentDao studentDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">        studentDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TeacherService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.TeacherDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeacherDao teacherDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">        teacherDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.service.TeacherService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        StudentService studentService = context.getBean(<span class="string">"studentService"</span>,StudentService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        studentService.save();</span><br><span class="line"></span><br><span class="line">        TeacherService teacherService = context.getBean(<span class="string">"teacherService"</span>,TeacherService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        teacherService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>上述代码是我们之前的可以完成的功能，但是可以思考，Service层的代码是否能够改写：</code></pre><p>BaseService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.BaseDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseService</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BaseDao&lt;T&gt; baseDao;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"自动注入的对象："</span>+baseDao);</span><br><span class="line">        baseDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StudentService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Student;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.StudentDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentService</span> <span class="keyword">extends</span> <span class="title">BaseService</span>&lt;<span class="title">Student</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TeacherService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.dao.TeacherDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherService</span> <span class="keyword">extends</span> <span class="title">BaseService</span>&lt;<span class="title">Teacher</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-Spring-AOP介绍与使用"><a href="#4-Spring-AOP介绍与使用" class="headerlink" title="4. Spring AOP介绍与使用"></a>4. Spring AOP介绍与使用</h1><p>AOP：Aspect Oriented Programming 面向切面编程</p>
<p>OOP：Object Oriented Programming 面向对象编程</p>
<pre><code>面向切面编程：基于OOP基础之上新的编程思想，OOP面向的主要对象是类，而AOP面向的主要对象是切面，在处理日志、安全管理、事务管理等方面有非常重要的作用。AOP是Spring中重要的核心点，虽然IOC容器没有依赖AOP，但是AOP提供了非常强大的功能，用来对IOC做补充。通俗点说的话就是在程序运行期间，将**某段代码动态切入**到**指定方法**的**指定位置**进行运行的这种编程方式。</code></pre><h3 id="4-1-AOP的概念"><a href="#4-1-AOP的概念" class="headerlink" title="4.1 AOP的概念"></a>4.1 AOP的概念</h3><h5 id="a-为什么要引入AOP"><a href="#a-为什么要引入AOP" class="headerlink" title="a. 为什么要引入AOP?"></a>a. 为什么要引入AOP?</h5><p>Calculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.inter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyCalculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.inter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i + j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i - j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i * j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i / j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        MyCalculator myCalculator = <span class="keyword">new</span> MyCalculator();</span><br><span class="line">        System.out.println(myCalculator.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>此代码非常简单，就是基础的javase的代码实现，此时如果需要添加日志功能应该怎么做呢，只能在每个方法中添加日志输出，同时如果需要修改的话会变得非常麻烦。</code></pre><p>MyCalculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.inter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"add 方法开始执行，参数为："</span>+i+<span class="string">","</span>+j);</span><br><span class="line">        <span class="keyword">int</span> result = i + j;</span><br><span class="line">        System.out.println(<span class="string">"add 方法开始完成结果为："</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"sub 方法开始执行，参数为："</span>+i+<span class="string">","</span>+j);</span><br><span class="line">        <span class="keyword">int</span> result = i - j;</span><br><span class="line">        System.out.println(<span class="string">"add 方法开始完成结果为："</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mult 方法开始执行，参数为："</span>+i+<span class="string">","</span>+j);</span><br><span class="line">        <span class="keyword">int</span> result = i * j;</span><br><span class="line">        System.out.println(<span class="string">"add 方法开始完成结果为："</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"div 方法开始执行，参数为："</span>+i+<span class="string">","</span>+j);</span><br><span class="line">        <span class="keyword">int</span> result = i / j;</span><br><span class="line">        System.out.println(<span class="string">"add 方法开始完成结果为："</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>可以考虑将日志的处理抽象出来，变成工具类来进行实现：</code></pre><p>LogUtil.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(Object ... objects)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"XXX方法开始执行，使用的参数是："</span>+ Arrays.asList(objects));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">(Object ... objects)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"XXX方法执行结束，结果是："</span>+ Arrays.asList(objects));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyCalculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.inter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.util.LogUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        LogUtil.start(i,j);</span><br><span class="line">        <span class="keyword">int</span> result = i + j;</span><br><span class="line">        LogUtil.stop(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        LogUtil.start(i,j);</span><br><span class="line">        <span class="keyword">int</span> result = i - j;</span><br><span class="line">        LogUtil.stop(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        LogUtil.start(i,j);</span><br><span class="line">        <span class="keyword">int</span> result = i * j;</span><br><span class="line">        LogUtil.stop(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        LogUtil.start(i,j);</span><br><span class="line">        <span class="keyword">int</span> result = i / j;</span><br><span class="line">        LogUtil.stop(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>按照上述方式抽象之后，代码确实简单很多，但是大家应该已经发现在输出的信息中并不包含具体的方法名称，我们更多的是想要在程序运行过程中动态的获取方法的名称及参数、结果等相关信息，此时可以通过使用**动态代理**的方式来进行实现。</code></pre><p>CalculatorProxy.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.inter.Calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 帮助Calculator生成代理对象的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  为传入的参数对象创建一个动态代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> calculator 被代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calculator <span class="title">getProxy</span><span class="params">(<span class="keyword">final</span> Calculator calculator)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//被代理对象的类加载器</span></span><br><span class="line">        ClassLoader loader = calculator.getClass().getClassLoader();</span><br><span class="line">        <span class="comment">//被代理对象的接口</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = calculator.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">//方法执行器，执行被代理对象的目标方法</span></span><br><span class="line">        InvocationHandler h = <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             *  执行目标方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> proxy 代理对象，给jdk使用，任何时候都不要操作此对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method 当前将要执行的目标对象的方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args 这个方法调用时外界传入的参数值</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//利用反射执行目标方法,目标方法执行后的返回值</span></span><br><span class="line"><span class="comment">//                System.out.println("这是动态代理执行的方法");</span></span><br><span class="line">                Object result = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(method.getName()+<span class="string">"方法开始执行，参数是："</span>+ Arrays.asList(args));</span><br><span class="line">                    result = method.invoke(calculator, args);</span><br><span class="line">                    System.out.println(method.getName()+<span class="string">"方法执行完成，结果是："</span>+ result);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    System.out.println(method.getName()+<span class="string">"方法出现异常："</span>+ e.getMessage());</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.out.println(method.getName()+<span class="string">"方法执行结束了......"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//将结果返回回去</span></span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Object proxy = Proxy.newProxyInstance(loader, interfaces, h);</span><br><span class="line">        <span class="keyword">return</span> (Calculator) proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>我们可以看到这种方式更加灵活，而且不需要在业务方法中添加额外的代码，这才是常用的方式。如果想追求完美的同学，还可以使用上述的日志工具类来完善。</code></pre><p>LogUtil.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(Method method, Object ... objects)</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println("XXX方法开始执行，使用的参数是："+ Arrays.asList(objects));</span></span><br><span class="line">        System.out.println(method.getName()+<span class="string">"方法开始执行，参数是："</span>+ Arrays.asList(objects));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">(Method method,Object ... objects)</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println("XXX方法执行结束，结果是："+ Arrays.asList(objects));</span></span><br><span class="line">        System.out.println(method.getName()+<span class="string">"方法开始执行，参数是："</span>+ Arrays.asList(objects));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(Method method,Exception e)</span></span>&#123;</span><br><span class="line">        System.out.println(method.getName()+<span class="string">"方法出现异常："</span>+ e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">(Method method)</span></span>&#123;</span><br><span class="line">        System.out.println(method.getName()+<span class="string">"方法执行结束了......"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CalculatorProxy.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.inter.Calculator;</span><br><span class="line"><span class="keyword">import</span> com.mashibing.util.LogUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 帮助Calculator生成代理对象的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  为传入的参数对象创建一个动态代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> calculator 被代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calculator <span class="title">getProxy</span><span class="params">(<span class="keyword">final</span> Calculator calculator)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//被代理对象的类加载器</span></span><br><span class="line">        ClassLoader loader = calculator.getClass().getClassLoader();</span><br><span class="line">        <span class="comment">//被代理对象的接口</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = calculator.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">//方法执行器，执行被代理对象的目标方法</span></span><br><span class="line">        InvocationHandler h = <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             *  执行目标方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> proxy 代理对象，给jdk使用，任何时候都不要操作此对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method 当前将要执行的目标对象的方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args 这个方法调用时外界传入的参数值</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//利用反射执行目标方法,目标方法执行后的返回值</span></span><br><span class="line"><span class="comment">//                System.out.println("这是动态代理执行的方法");</span></span><br><span class="line">                Object result = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    LogUtil.start(method,args);</span><br><span class="line">                    result = method.invoke(calculator, args);</span><br><span class="line">                    LogUtil.stop(method,args);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    LogUtil.logException(method,e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    LogUtil.end(method);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//将结果返回回去</span></span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Object proxy = Proxy.newProxyInstance(loader, interfaces, h);</span><br><span class="line">        <span class="keyword">return</span> (Calculator) proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>很多同学看到上述代码之后可能感觉已经非常完美了，但是要说明的是，这种动态代理的实现方式调用的是jdk的基本实现，如果需要代理的目标对象没有实现任何接口，那么是无法为他创建代理对象的，这也是致命的缺陷。而在Spring中我们可以不编写上述如此复杂的代码，只需要利用AOP，就能够轻轻松松实现上述功能，当然，Spring AOP的底层实现也依赖的是动态代理。</code></pre><h5 id="b-AOP的核心概念及术语"><a href="#b-AOP的核心概念及术语" class="headerlink" title="b. AOP的核心概念及术语"></a>b. AOP的核心概念及术语</h5><ul>
<li>切面（Aspect）: 指关注点模块化，这个关注点可能会横切多个对象。事务管理是企业级Java应用中有关横切关注点的例子。 在Spring AOP中，切面可以使用通用类基于模式的方式（schema-based approach）或者在普通类中以<code>@Aspect</code>注解（@AspectJ 注解方式）来实现。</li>
<li>连接点（Join point）: 在程序执行过程中某个特定的点，例如某个方法调用的时间点或者处理异常的时间点。在Spring AOP中，一个连接点总是代表一个方法的执行。</li>
<li>通知（Advice）: 在切面的某个特定的连接点上执行的动作。通知有多种类型，包括“around”, “before” and “after”等等。通知的类型将在后面的章节进行讨论。 许多AOP框架，包括Spring在内，都是以拦截器做通知模型的，并维护着一个以连接点为中心的拦截器链。</li>
<li>切点（Pointcut）: 匹配连接点的断言。通知和切点表达式相关联，并在满足这个切点的连接点上运行（例如，当执行某个特定名称的方法时）。切点表达式如何和连接点匹配是AOP的核心：Spring默认使用AspectJ切点语义。</li>
<li>引入（Introduction）: 声明额外的方法或者某个类型的字段。Spring允许引入新的接口（以及一个对应的实现）到任何被通知的对象上。例如，可以使用引入来使bean实现 <code>IsModified</code>接口， 以便简化缓存机制（在AspectJ社区，引入也被称为内部类型声明（inter））。</li>
<li>目标对象（Target object）: 被一个或者多个切面所通知的对象。也被称作被通知（advised）对象。既然Spring AOP是通过运行时代理实现的，那么这个对象永远是一个被代理（proxied）的对象。</li>
<li>AOP代理（AOP proxy）:AOP框架创建的对象，用来实现切面契约（aspect contract）（包括通知方法执行等功能）。在Spring中，AOP代理可以是JDK动态代理或CGLIB代理。</li>
<li>织入（Weaving）: 把切面连接到其它的应用程序类型或者对象上，并创建一个被被通知的对象的过程。这个过程可以在编译时（例如使用AspectJ编译器）、类加载时或运行时中完成。 Spring和其他纯Java AOP框架一样，是在运行时完成织入的。</li>
</ul>
<h5 id="c-AOP的通知类型"><a href="#c-AOP的通知类型" class="headerlink" title="c. AOP的通知类型"></a>c. AOP的通知类型</h5><ul>
<li>前置通知（Before advice）: 在连接点之前运行但无法阻止执行流程进入连接点的通知（除非它引发异常）。</li>
<li>后置返回通知（After returning advice）:在连接点正常完成后执行的通知（例如，当方法没有抛出任何异常并正常返回时）。</li>
<li>后置异常通知（After throwing advice）: 在方法抛出异常退出时执行的通知。</li>
<li>后置通知（总会执行）（After (finally) advice）: 当连接点退出的时候执行的通知（无论是正常返回还是异常退出）。</li>
<li>环绕通知（Around Advice）:环绕连接点的通知，例如方法调用。这是最强大的一种通知类型，。环绕通知可以在方法调用前后完成自定义的行为。它可以选择是否继续执行连接点或直接返回自定义的返回值又或抛出异常将执行结束。</li>
</ul>
<h5 id="d-AOP的应用场景"><a href="#d-AOP的应用场景" class="headerlink" title="d. AOP的应用场景"></a>d. AOP的应用场景</h5><ul>
<li>日志管理</li>
<li>权限认证</li>
<li>安全检查</li>
<li>事务控制</li>
</ul>
<h3 id="4-2-Spring-AOP的简单配置"><a href="#4-2-Spring-AOP的简单配置" class="headerlink" title="4.2 Spring AOP的简单配置"></a>4.2 Spring AOP的简单配置</h3><pre><code>在上述代码中我们是通过动态代理的方式实现日志功能的，但是比较麻烦，现在我们将要使用spring aop的功能实现此需求，其实通俗点说的话，就是把LogUtil的工具类换成另外一种实现方式。</code></pre><h5 id="4-2-1-添加pom依赖"><a href="#4-2-1-添加pom依赖" class="headerlink" title="4.2.1 添加pom依赖"></a>4.2.1 添加pom依赖</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/aopalliance/aopalliance --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aspects --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="4-2-2-编写配置"><a href="#4-2-2-编写配置" class="headerlink" title="4.2.2 编写配置"></a>4.2.2 编写配置</h5><ul>
<li><p>将目标类和切面类加入到IOC容器中，在对应的类上添加组件注解</p>
<ul>
<li><p>给LogUtil添加@Component注解</p>
</li>
<li><p>给MyCalculator添加@Service注解</p>
</li>
<li><p>添加自动扫描的配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--别忘了添加context命名空间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mashibing"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>设置程序中的切面类</p>
<ul>
<li>在LogUtil.java中添加@Aspect注解</li>
</ul>
</li>
<li><p>设置切面类中的方法是什么时候在哪里执行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    设置下面方法在什么时候运行</span></span><br><span class="line"><span class="comment">        @Before:在目标方法之前运行：前置通知</span></span><br><span class="line"><span class="comment">        @After:在目标方法之后运行：后置通知</span></span><br><span class="line"><span class="comment">        @AfterReturning:在目标方法正常返回之后：返回通知</span></span><br><span class="line"><span class="comment">        @AfterThrowing:在目标方法抛出异常后开始运行：异常通知</span></span><br><span class="line"><span class="comment">        @Around:环绕：环绕通知</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        当编写完注解之后还需要设置在哪些方法上执行，使用表达式</span></span><br><span class="line"><span class="comment">        execution(访问修饰符  返回值类型 方法全称)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution( public int com.mashibing.inter.MyCalculator.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println("XXX方法开始执行，使用的参数是："+ Arrays.asList(objects));</span></span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法开始执行，参数是："+ Arrays.asList(objects));</span></span><br><span class="line">        System.out.println(<span class="string">"方法开始执行，参数是："</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(<span class="string">"execution( public int com.mashibing.inter.MyCalculator.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println("XXX方法执行结束，结果是："+ Arrays.asList(objects));</span></span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法执行结束，结果是："+ Arrays.asList(objects));</span></span><br><span class="line">        System.out.println(<span class="string">"方法执行完成，结果是："</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(<span class="string">"execution( public int com.mashibing.inter.MyCalculator.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法出现异常："+ e.getMessage());</span></span><br><span class="line">        System.out.println(<span class="string">"方法出现异常："</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"execution( public int com.mashibing.inter.MyCalculator.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法执行结束了......");</span></span><br><span class="line">        System.out.println(<span class="string">"方法执行结束了......"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启基于注解的aop的功能</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mashibing"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="4-2-3-测试"><a href="#4-2-3-测试" class="headerlink" title="4.2.3 测试"></a>4.2.3 测试</h5><p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.inter.Calculator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"aop.xml"</span>);</span><br><span class="line">        Calculator bean = context.getBean(Calculator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        bean.add(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>spring AOP的动态代理方式是jdk自带的方式，容器中保存的组件是代理对象com.sun.proxy.$Proxy对象</code></pre><h5 id="4-2-4-通过cglib来创建代理对象"><a href="#4-2-4-通过cglib来创建代理对象" class="headerlink" title="4.2.4 通过cglib来创建代理对象"></a>4.2.4 通过cglib来创建代理对象</h5><p>MyCalculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.inter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i + j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i - j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i * j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i / j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"aop.xml"</span>);</span><br><span class="line">        MyCalculator bean = context.getBean(MyCalculator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        bean.add(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">        System.out.println(bean.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>可以通过cglib的方式来创建代理对象，此时不需要实现任何接口，代理对象是</code></pre><p>class com.mashibing.inter.MyCalculator$$EnhancerBySpringCGLIB$$1f93b605类型</p>
<pre><code>**综上所述：在spring容器中，如果有接口，那么会使用jdk自带的动态代理，如果没有接口，那么会使用cglib的动态代理。动态代理的实现原理，后续会详细讲。**</code></pre><h5 id="4-2-5-注意："><a href="#4-2-5-注意：" class="headerlink" title="4.2.5 注意："></a>4.2.5 注意：</h5><h6 id="1、切入点表达式"><a href="#1、切入点表达式" class="headerlink" title="1、切入点表达式"></a>1、切入点表达式</h6><pre><code>在使用表达式的时候，除了之前的写法之外，还可以使用通配符的方式：

1、匹配一个或者多个字符</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution( <span class="keyword">public</span> <span class="keyword">int</span> com.mashibing.inter.My*alculator.*(<span class="keyword">int</span>,<span class="keyword">int</span>))</span><br></pre></td></tr></table></figure>

<pre><code>2、匹配任意一个参数，</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution( <span class="keyword">public</span> <span class="keyword">int</span> com.mashibing.inter.MyCalculator.*(<span class="keyword">int</span>,*))</span><br></pre></td></tr></table></figure>

<pre><code>3、只能匹配一层路径，如果项目路径下有多层目录，那么*只能匹配一层路径

4、权限位置不能使用*，如果想表示全部权限，那么不写即可</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution( * com.mashibing.inter.MyCalculator.*(<span class="keyword">int</span>,*))</span><br></pre></td></tr></table></figure>

<pre><code>1、匹配多个参数，任意类型参数</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution( * com.mashibing.inter.MyCalculator.*(..))</span><br></pre></td></tr></table></figure>

<pre><code>2、匹配任意多层路径</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution( * com.mashibing..MyCalculator.*(..))</span><br></pre></td></tr></table></figure>

<pre><code>在写表达式的时候，可以有N多种写法，但是有一种最偷懒和最精确的方式：</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 最偷懒的方式：</span></span><br><span class="line">   execution(* *(..)) 或者 execution(* *.*(..))</span><br><span class="line"><span class="comment">// 最精确的方式：</span></span><br><span class="line">   execution( <span class="keyword">public</span> <span class="keyword">int</span> com.mashibing.inter.MyCalculator.add(<span class="keyword">int</span>,<span class="keyword">int</span>))</span><br></pre></td></tr></table></figure>

<pre><code>除此之外，在表达式中还支持 &amp;&amp;、||、！的方式

&amp;&amp;：两个表达式同时

execution( public int com.mashibing.inter.MyCalculator.*(..)) &amp;&amp; execution(* *.*(int,int) )

||：任意满足一个表达式即可

execution( public int com.mashibing.inter.MyCalculator.*(..)) &amp;&amp; execution(* *.*(int,int) )

！：只要不是这个位置都可以进行切入

&amp;&amp;：两个表达式同时

execution( public int com.mashibing.inter.MyCalculator.*(..))</code></pre><h6 id="2、通知方法的执行顺序"><a href="#2、通知方法的执行顺序" class="headerlink" title="2、通知方法的执行顺序"></a>2、通知方法的执行顺序</h6><pre><code>在之前的代码中大家一直对通知的执行顺序有疑问，其实执行的结果并没有错，大家需要注意：

1、正常执行：@Before---&gt;@After---&gt;@AfterReturning

2、异常执行：@Before---&gt;@After---&gt;@AfterThrowing</code></pre><h6 id="3、获取方法的详细信息"><a href="#3、获取方法的详细信息" class="headerlink" title="3、获取方法的详细信息"></a>3、获取方法的详细信息</h6><pre><code>在上面的案例中，我们并没有获取Method的详细信息，例如方法名、参数列表等信息，想要获取的话其实非常简单，只需要添加JoinPoint参数即可。</code></pre><p>LogUtil.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.util;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.*;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class LogUtil &#123;</span><br><span class="line"></span><br><span class="line">    @Before(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    public static void start(JoinPoint joinPoint)&#123;</span><br><span class="line">        Object[] args &#x3D; joinPoint.getArgs();</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法开始执行，参数是：&quot;+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterReturning(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    public static void stop(JoinPoint joinPoint)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法执行完成，结果是：&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterThrowing(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    public static void logException(JoinPoint joinPoint)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法出现异常：&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    public static void end(JoinPoint joinPoint)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法执行结束了......&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>刚刚只是获取了方法的信息，但是如果需要获取结果，还需要添加另外一个方法参数，并且告诉spring使用哪个参数来进行结果接收</code></pre><p>LogUtil.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@AfterReturning(value &#x3D; &quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;,returning &#x3D; &quot;result&quot;)</span><br><span class="line">public static void stop(JoinPoint joinPoint,Object result)&#123;</span><br><span class="line">    String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">    System.out.println(name+&quot;方法执行完成，结果是：&quot;+result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>也可以通过相同的方式来获取异常的信息</code></pre><p>LogUtil.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@AfterThrowing(value &#x3D; &quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;,throwing &#x3D; &quot;exception&quot;)</span><br><span class="line">public static void logException(JoinPoint joinPoint,Exception exception)&#123;</span><br><span class="line">    String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">    System.out.println(name+&quot;方法出现异常：&quot;+exception);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="4、spring对通过方法的要求"><a href="#4、spring对通过方法的要求" class="headerlink" title="4、spring对通过方法的要求"></a>4、spring对通过方法的要求</h6><pre><code>spring对于通知方法的要求并不是很高，你可以任意改变方法的返回值和方法的访问修饰符，但是唯一不能修改的就是方法的参数，会出现参数绑定的错误，原因在于通知方法是spring利用反射调用的，每次方法调用得确定这个方法的参数的值。</code></pre><p>LogUtil.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    @After(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    private int end(JoinPoint joinPoint,String aa)&#123;</span><br><span class="line">&#x2F;&#x2F;        System.out.println(method.getName()+&quot;方法执行结束了......&quot;);</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法执行结束了......&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h6 id="5、表达式的抽取"><a href="#5、表达式的抽取" class="headerlink" title="5、表达式的抽取"></a>5、表达式的抽取</h6><p>如果在实际使用过程中，多个方法的表达式是一致的话，那么可以考虑将切入点表达式抽取出来：</p>
<pre><code>a、随便生命一个没有实现的返回void的空方法

b、给方法上标注@Potintcut注解</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.util;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.*;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class LogUtil &#123;</span><br><span class="line">    </span><br><span class="line">    @Pointcut(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    public void myPoint()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    @Before(&quot;myPoint()&quot;)</span><br><span class="line">    public static void start(JoinPoint joinPoint)&#123;</span><br><span class="line">        Object[] args &#x3D; joinPoint.getArgs();</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法开始执行，参数是：&quot;+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterReturning(value &#x3D; &quot;myPoint()&quot;,returning &#x3D; &quot;result&quot;)</span><br><span class="line">    public static void stop(JoinPoint joinPoint,Object result)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法执行完成，结果是：&quot;+result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterThrowing(value &#x3D; &quot;myPoint()&quot;,throwing &#x3D; &quot;exception&quot;)</span><br><span class="line">    public static void logException(JoinPoint joinPoint,Exception exception)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法出现异常：&quot;+exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After(&quot;myPoint()&quot;)</span><br><span class="line">    private int end(JoinPoint joinPoint)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(name+&quot;方法执行结束了......&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="6、环绕通知的使用"><a href="#6、环绕通知的使用" class="headerlink" title="6、环绕通知的使用"></a>6、环绕通知的使用</h6><p>LogUtil.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.util;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.*;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class LogUtil &#123;</span><br><span class="line">    @Pointcut(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    public void myPoint()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 环绕通知是spring中功能最强大的通知</span><br><span class="line">     * @param proceedingJoinPoint</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Around(&quot;myPoint()&quot;)</span><br><span class="line">    public Object myAround(ProceedingJoinPoint proceedingJoinPoint)&#123;</span><br><span class="line">        Object[] args &#x3D; proceedingJoinPoint.getArgs();</span><br><span class="line">        String name &#x3D; proceedingJoinPoint.getSignature().getName();</span><br><span class="line">        Object proceed &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            System.out.println(&quot;环绕前置通知:&quot;+name+&quot;方法开始，参数是&quot;+Arrays.asList(args));</span><br><span class="line">            &#x2F;&#x2F;利用反射调用目标方法，就是method.invoke()</span><br><span class="line">            proceed &#x3D; proceedingJoinPoint.proceed(args);</span><br><span class="line">            System.out.println(&quot;环绕返回通知:&quot;+name+&quot;方法返回，返回值是&quot;+proceed);</span><br><span class="line">        &#125; catch (Throwable e) &#123;</span><br><span class="line">            System.out.println(&quot;环绕异常通知&quot;+name+&quot;方法出现异常，异常信息是：&quot;+e);</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            System.out.println(&quot;环绕后置通知&quot;+name+&quot;方法结束&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>总结：环绕通知的执行顺序是优于普通通知的，具体的执行顺序如下：</code></pre><p>环绕前置–&gt;普通前置–&gt;目标方法执行–&gt;环绕正常结束/出现异常–&gt;环绕后置–&gt;普通后置–&gt;普通返回或者异常。</p>
<p>但是需要注意的是，如果出现了异常，那么环绕通知会处理或者捕获异常，普通异常通知是接收不到的，因此最好的方式是在环绕异常通知中向外抛出异常。</p>
<h6 id="7、多切面运行的顺序"><a href="#7、多切面运行的顺序" class="headerlink" title="7、多切面运行的顺序"></a>7、多切面运行的顺序</h6><pre><code>如果有多个切面要进行执行，那么顺序是什么样的呢？</code></pre><p>LogUtil.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.util;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.*;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class LogUtil &#123;</span><br><span class="line">    @Pointcut(&quot;execution( public int com.mashibing.inter.MyCalculator.*(int,int))&quot;)</span><br><span class="line">    public void myPoint()&#123;&#125;</span><br><span class="line">    @Before(&quot;myPoint()&quot;)</span><br><span class="line">    public static void start(JoinPoint joinPoint)&#123;</span><br><span class="line">&#x2F;&#x2F;        System.out.println(&quot;XXX方法开始执行，使用的参数是：&quot;+ Arrays.asList(objects));</span><br><span class="line">&#x2F;&#x2F;        System.out.println(method.getName()+&quot;方法开始执行，参数是：&quot;+ Arrays.asList(objects));</span><br><span class="line">        Object[] args &#x3D; joinPoint.getArgs();</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Log:&quot;+name+&quot;方法开始执行，参数是：&quot;+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterReturning(value &#x3D; &quot;myPoint()&quot;,returning &#x3D; &quot;result&quot;)</span><br><span class="line">    public static void stop(JoinPoint joinPoint,Object result)&#123;</span><br><span class="line">&#x2F;&#x2F;        System.out.println(&quot;XXX方法执行结束，结果是：&quot;+ Arrays.asList(objects));</span><br><span class="line">&#x2F;&#x2F;        System.out.println(method.getName()+&quot;方法执行结束，结果是：&quot;+ Arrays.asList(objects));</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Log:&quot;+name+&quot;方法执行完成，结果是：&quot;+result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterThrowing(value &#x3D; &quot;myPoint()&quot;,throwing &#x3D; &quot;exception&quot;)</span><br><span class="line">    public static void logException(JoinPoint joinPoint,Exception exception)&#123;</span><br><span class="line">&#x2F;&#x2F;        System.out.println(method.getName()+&quot;方法出现异常：&quot;+ e.getMessage());</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Log:&quot;+name+&quot;方法出现异常：&quot;+exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After(&quot;myPoint()&quot;)</span><br><span class="line">    private int end(JoinPoint joinPoint)&#123;</span><br><span class="line">&#x2F;&#x2F;        System.out.println(method.getName()+&quot;方法执行结束了......&quot;);</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Log:&quot;+name+&quot;方法执行结束了......&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 环绕通知是spring中功能最强大的通知</span><br><span class="line">     * @param proceedingJoinPoint</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    &#x2F;&#x2F;@Around(&quot;myPoint()&quot;)</span><br><span class="line">    public Object myAround(ProceedingJoinPoint proceedingJoinPoint)&#123;</span><br><span class="line">        Object[] args &#x3D; proceedingJoinPoint.getArgs();</span><br><span class="line">        String name &#x3D; proceedingJoinPoint.getSignature().getName();</span><br><span class="line">        Object proceed &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            System.out.println(&quot;环绕前置通知:&quot;+name+&quot;方法开始，参数是&quot;+Arrays.asList(args));</span><br><span class="line">            &#x2F;&#x2F;利用反射调用目标方法，就是method.invoke()</span><br><span class="line">            proceed &#x3D; proceedingJoinPoint.proceed(args);</span><br><span class="line">            System.out.println(&quot;环绕返回通知:&quot;+name+&quot;方法返回，返回值是&quot;+proceed);</span><br><span class="line">        &#125; catch (Throwable e) &#123;</span><br><span class="line">            System.out.println(&quot;环绕异常通知&quot;+name+&quot;方法出现异常，异常信息是：&quot;+e);</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            System.out.println(&quot;环绕后置通知&quot;+name+&quot;方法结束&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecurityAspect.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.util;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.*;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class SecurityAspect &#123;</span><br><span class="line"></span><br><span class="line">    @Before(&quot;com.mashibing.util.LogUtil.myPoint()&quot;)</span><br><span class="line">    public static void start(JoinPoint joinPoint)&#123;</span><br><span class="line">        Object[] args &#x3D; joinPoint.getArgs();</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Security:&quot;+name+&quot;方法开始执行，参数是：&quot;+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterReturning(value &#x3D; &quot;com.mashibing.util.LogUtil.myPoint()&quot;,returning &#x3D; &quot;result&quot;)</span><br><span class="line">    public static void stop(JoinPoint joinPoint,Object result)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Security:&quot;+name+&quot;方法执行完成，结果是：&quot;+result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterThrowing(value &#x3D; &quot;com.mashibing.util.LogUtil.myPoint()&quot;,throwing &#x3D; &quot;exception&quot;)</span><br><span class="line">    public static void logException(JoinPoint joinPoint,Exception exception)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Security:&quot;+name+&quot;方法出现异常：&quot;+exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After(&quot;com.mashibing.util.LogUtil.myPoint()&quot;)</span><br><span class="line">    private int end(JoinPoint joinPoint)&#123;</span><br><span class="line">        String name &#x3D; joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(&quot;Security:&quot;+name+&quot;方法执行结束了......&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 环绕通知是spring中功能最强大的通知</span><br><span class="line">     * @param proceedingJoinPoint</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    &#x2F;&#x2F;@Around(&quot;myPoint()&quot;)</span><br><span class="line">    public Object myAround(ProceedingJoinPoint proceedingJoinPoint)&#123;</span><br><span class="line">        Object[] args &#x3D; proceedingJoinPoint.getArgs();</span><br><span class="line">        String name &#x3D; proceedingJoinPoint.getSignature().getName();</span><br><span class="line">        Object proceed &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            System.out.println(&quot;环绕前置通知:&quot;+name+&quot;方法开始，参数是&quot;+Arrays.asList(args));</span><br><span class="line">            &#x2F;&#x2F;利用反射调用目标方法，就是method.invoke()</span><br><span class="line">            proceed &#x3D; proceedingJoinPoint.proceed(args);</span><br><span class="line">            System.out.println(&quot;环绕返回通知:&quot;+name+&quot;方法返回，返回值是&quot;+proceed);</span><br><span class="line">        &#125; catch (Throwable e) &#123;</span><br><span class="line">            System.out.println(&quot;环绕异常通知&quot;+name+&quot;方法出现异常，异常信息是：&quot;+e);</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            System.out.println(&quot;环绕后置通知&quot;+name+&quot;方法结束&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>在spring中，默认是按照切面名称的字典顺序进行执行的，但是如果想自己改变具体的执行顺序的话，可以使用@Order注解来解决，数值越小，优先级越高。</code></pre><p>LogUtil.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtil</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution( public int com.mashibing.inter.MyCalculator.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myPoint</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"myPoint()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println("XXX方法开始执行，使用的参数是："+ Arrays.asList(objects));</span></span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法开始执行，参数是："+ Arrays.asList(objects));</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">"Log:"</span>+name+<span class="string">"方法开始执行，参数是："</span>+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(value = <span class="string">"myPoint()"</span>,returning = <span class="string">"result"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">(JoinPoint joinPoint,Object result)</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println("XXX方法执行结束，结果是："+ Arrays.asList(objects));</span></span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法执行结束，结果是："+ Arrays.asList(objects));</span></span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">"Log:"</span>+name+<span class="string">"方法执行完成，结果是："</span>+result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(value = <span class="string">"myPoint()"</span>,throwing = <span class="string">"exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(JoinPoint joinPoint,Exception exception)</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法出现异常："+ e.getMessage());</span></span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">"Log:"</span>+name+<span class="string">"方法出现异常："</span>+exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"myPoint()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">end</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(method.getName()+"方法执行结束了......");</span></span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">"Log:"</span>+name+<span class="string">"方法执行结束了......"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知是spring中功能最强大的通知</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proceedingJoinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@Around("myPoint()")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span></span>&#123;</span><br><span class="line">        Object[] args = proceedingJoinPoint.getArgs();</span><br><span class="line">        String name = proceedingJoinPoint.getSignature().getName();</span><br><span class="line">        Object proceed = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"环绕前置通知:"</span>+name+<span class="string">"方法开始，参数是"</span>+Arrays.asList(args));</span><br><span class="line">            <span class="comment">//利用反射调用目标方法，就是method.invoke()</span></span><br><span class="line">            proceed = proceedingJoinPoint.proceed(args);</span><br><span class="line">            System.out.println(<span class="string">"环绕返回通知:"</span>+name+<span class="string">"方法返回，返回值是"</span>+proceed);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"环绕异常通知"</span>+name+<span class="string">"方法出现异常，异常信息是："</span>+e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"环绕后置通知"</span>+name+<span class="string">"方法结束"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecurityAspect.java</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">package com.mashibing.util;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.*;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">@Order(1)</span><br><span class="line">public class SecurityAspect &#123;</span><br><span class="line"></span><br><span class="line">    @Before("com.mashibing.util.LogUtil.myPoint()")</span><br><span class="line">    public static void start(JoinPoint joinPoint)&#123;</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println("Security:"+name+"方法开始执行，参数是："+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterReturning(value = "com.mashibing.util.LogUtil.myPoint()",returning = "result")</span><br><span class="line">    public static void stop(JoinPoint joinPoint,Object result)&#123;</span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println("Security:"+name+"方法执行完成，结果是："+result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterThrowing(value = "com.mashibing.util.LogUtil.myPoint()",throwing = "exception")</span><br><span class="line">    public static void logException(JoinPoint joinPoint,Exception exception)&#123;</span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println("Security:"+name+"方法出现异常："+exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After("com.mashibing.util.LogUtil.myPoint()")</span><br><span class="line">    private int end(JoinPoint joinPoint)&#123;</span><br><span class="line">        String name = joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println("Security:"+name+"方法执行结束了......");</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 环绕通知是spring中功能最强大的通知</span><br><span class="line">     * @param proceedingJoinPoint</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    //@Around("myPoint()")</span><br><span class="line">    public Object myAround(ProceedingJoinPoint proceedingJoinPoint)&#123;</span><br><span class="line">        Object[] args = proceedingJoinPoint.getArgs();</span><br><span class="line">        String name = proceedingJoinPoint.getSignature().getName();</span><br><span class="line">        Object proceed = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            System.out.println("环绕前置通知:"+name+"方法开始，参数是"+Arrays.asList(args));</span><br><span class="line">            //利用反射调用目标方法，就是method.invoke()</span><br><span class="line">            proceed = proceedingJoinPoint.proceed(args);</span><br><span class="line">            System.out.println("环绕返回通知:"+name+"方法返回，返回值是"+proceed);</span><br><span class="line">        &#125; catch (Throwable e) &#123;</span><br><span class="line">            System.out.println("环绕异常通知"+name+"方法出现异常，异常信息是："+e);</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            System.out.println("环绕后置通知"+name+"方法结束");</span><br><span class="line">        &#125;</span><br><span class="line">        return proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>如果需要添加环绕通知呢，具体的执行顺序又会是什么顺序呢？

因为环绕通知在进行添加的时候，是在切面层引入的，所以在哪个切面添加环绕通知，那么就会在哪个切面执行。</code></pre><h3 id="4-3-基于xml的AOP配置"><a href="#4-3-基于xml的AOP配置" class="headerlink" title="4.3 基于xml的AOP配置"></a>4.3 基于xml的AOP配置</h3><pre><code>之前我们讲解了基于注解的AOP配置方式，下面我们开始讲一下基于xml的配置方式，虽然在现在的企业级开发中使用注解的方式比较多，但是你不能不会，因此需要简单的进行配置，注解配置快速简单，配置的方式共呢个完善。</code></pre><p>1、将所有的注解都进行删除</p>
<p>2、添加配置文件</p>
<p>aop.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mashibing"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logUtil"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.util.LogUtil2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"securityAspect"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.util.SecurityAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myCalculator"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.inter.MyCalculator"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"globalPoint"</span> <span class="attr">expression</span>=<span class="string">"execution(public int com.mashibing.inter.MyCalculator.*(int,int))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"logUtil"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"mypoint"</span> <span class="attr">expression</span>=<span class="string">"execution(public int com.mashibing.inter.MyCalculator.*(int,int))"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"start"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"end"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"stop"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span> <span class="attr">returning</span>=<span class="string">"result"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"logException"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span> <span class="attr">throwing</span>=<span class="string">"exception"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"myAround"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"securityAspect"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"start"</span> <span class="attr">pointcut-ref</span>=<span class="string">"globalPoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"end"</span> <span class="attr">pointcut-ref</span>=<span class="string">"globalPoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"stop"</span> <span class="attr">pointcut-ref</span>=<span class="string">"globalPoint"</span> <span class="attr">returning</span>=<span class="string">"result"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"logException"</span> <span class="attr">pointcut-ref</span>=<span class="string">"globalPoint"</span> <span class="attr">throwing</span>=<span class="string">"exception"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"myAround"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="5-Spring-AOP的高级应用配置"><a href="#5-Spring-AOP的高级应用配置" class="headerlink" title="5. Spring AOP的高级应用配置"></a>5. Spring AOP的高级应用配置</h1><h3 id="5-1、Spring-JdbcTemplate"><a href="#5-1、Spring-JdbcTemplate" class="headerlink" title="5.1、Spring JdbcTemplate"></a>5.1、Spring JdbcTemplate</h3><pre><code>在spring中为了更加方便的操作JDBC，在JDBC的基础之上定义了一个抽象层，此设计的目的是为不同类型的JDBC操作提供模板方法，每个模板方法都能控制整个过程，并允许覆盖过程中的特定任务，通过这种方式，可以尽可能保留灵活性，将数据库存取的工作量讲到最低。</code></pre><h5 id="5-1-1、配置并测试数据源"><a href="#5-1-1、配置并测试数据源" class="headerlink" title="5.1.1、配置并测试数据源"></a>5.1.1、配置并测试数据源</h5><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mashibing<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring_demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/aopalliance/aopalliance --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aspects --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>dbconfig.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root123</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/demo</span></span><br><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"jdbcTemplate.xml"</span>);</span><br><span class="line">        DruidDataSource dataSource = context.getBean(<span class="string">"dataSource"</span>, DruidDataSource<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(dataSource);</span><br><span class="line">        System.out.println(dataSource.getConnection());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-2、给spring容器添加JdbcTemplate"><a href="#5-1-2、给spring容器添加JdbcTemplate" class="headerlink" title="5.1.2、给spring容器添加JdbcTemplate"></a>5.1.2、给spring容器添加JdbcTemplate</h5><pre><code>spring容器提供了一个JdbcTemplate类，用来方便操作数据库。</code></pre><p>1、添加pom依赖</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-orm --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>jdbcTemplate.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"jdbcTemplate.xml"</span>);</span><br><span class="line">        JdbcTemplate jdbcTemplate = context.getBean(<span class="string">"jdbcTemplate"</span>, JdbcTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(jdbcTemplate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-3、插入数据"><a href="#5-1-3、插入数据" class="headerlink" title="5.1.3、插入数据"></a>5.1.3、插入数据</h5><p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"jdbcTemplate.xml"</span>);</span><br><span class="line">        JdbcTemplate jdbcTemplate = context.getBean(<span class="string">"jdbcTemplate"</span>, JdbcTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        String sql = <span class="string">"insert into emp(empno,ename) values(?,?)"</span>;</span><br><span class="line">        <span class="keyword">int</span> result = jdbcTemplate.update(sql, <span class="number">1111</span>, <span class="string">"zhangsan"</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-4、批量插入数据"><a href="#5-1-4、批量插入数据" class="headerlink" title="5.1.4、批量插入数据"></a>5.1.4、批量插入数据</h5><p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"jdbcTemplate.xml"</span>);</span><br><span class="line">        JdbcTemplate jdbcTemplate = context.getBean(<span class="string">"jdbcTemplate"</span>, JdbcTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        String sql = <span class="string">"insert into emp(empno,ename) values(?,?)"</span>;</span><br><span class="line">        List&lt;Object[]&gt; list = <span class="keyword">new</span> ArrayList&lt;Object[]&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> Object[]&#123;<span class="number">1</span>,<span class="string">"zhangsan1"</span>&#125;);</span><br><span class="line">        list.add(<span class="keyword">new</span> Object[]&#123;<span class="number">2</span>,<span class="string">"zhangsan2"</span>&#125;);</span><br><span class="line">        list.add(<span class="keyword">new</span> Object[]&#123;<span class="number">3</span>,<span class="string">"zhangsan3"</span>&#125;);</span><br><span class="line">        <span class="keyword">int</span>[] result = jdbcTemplate.batchUpdate(sql, list);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : result) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-5、查询某个值，并以对象的方式返回"><a href="#5-1-5、查询某个值，并以对象的方式返回" class="headerlink" title="5.1.5、查询某个值，并以对象的方式返回"></a>5.1.5、查询某个值，并以对象的方式返回</h5><p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.bean.Emp;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"jdbcTemplate.xml"</span>);</span><br><span class="line">        JdbcTemplate jdbcTemplate = context.getBean(<span class="string">"jdbcTemplate"</span>, JdbcTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        String sql = <span class="string">"select * from emp where empno = ?"</span>;</span><br><span class="line">        Emp emp = jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(Emp<span class="class">.<span class="keyword">class</span>), 7369)</span>;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-6、查询返回集合对象"><a href="#5-1-6、查询返回集合对象" class="headerlink" title="5.1.6、查询返回集合对象"></a>5.1.6、查询返回集合对象</h5><p>MyTest.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import com.mashibing.bean.Emp;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">import org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class MyTest &#123;</span><br><span class="line">    public static void main(String[] args) throws SQLException &#123;</span><br><span class="line">        ApplicationContext context &#x3D; new ClassPathXmlApplicationContext(&quot;jdbcTemplate.xml&quot;);</span><br><span class="line">        JdbcTemplate jdbcTemplate &#x3D; context.getBean(&quot;jdbcTemplate&quot;, JdbcTemplate.class);</span><br><span class="line">        String sql &#x3D; &quot;select * from emp where sal &gt; ?&quot;;</span><br><span class="line">        List&lt;Emp&gt; query &#x3D; jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;&gt;(Emp.class), 1500);</span><br><span class="line">        for (Emp emp : query) &#123;</span><br><span class="line">            System.out.println(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-7、返回组合函数的值"><a href="#5-1-7、返回组合函数的值" class="headerlink" title="5.1.7、返回组合函数的值"></a>5.1.7、返回组合函数的值</h5><p>MyTest.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import com.mashibing.bean.Emp;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">import org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class MyTest &#123;</span><br><span class="line">    public static void main(String[] args) throws SQLException &#123;</span><br><span class="line">        ApplicationContext context &#x3D; new ClassPathXmlApplicationContext(&quot;jdbcTemplate.xml&quot;);</span><br><span class="line">        JdbcTemplate jdbcTemplate &#x3D; context.getBean(&quot;jdbcTemplate&quot;, JdbcTemplate.class);</span><br><span class="line">        String sql &#x3D; &quot;select max(sal) from emp&quot;;</span><br><span class="line">        Double aDouble &#x3D; jdbcTemplate.queryForObject(sql, Double.class);</span><br><span class="line">        System.out.println(aDouble);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-8、使用具备具名函数的JdbcTemplate"><a href="#5-1-8、使用具备具名函数的JdbcTemplate" class="headerlink" title="5.1.8、使用具备具名函数的JdbcTemplate"></a>5.1.8、使用具备具名函数的JdbcTemplate</h5><p>jdbcTemplate.xml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">       xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context.xsd</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">       https:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd</span><br><span class="line">&quot;&gt;</span><br><span class="line">    &lt;context:property-placeholder location&#x3D;&quot;classpath:dbconfig.properties&quot;&gt;&lt;&#x2F;context:property-placeholder&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;dataSource&quot; class&#x3D;&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;jdbc.username&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;jdbc.password&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;jdbc.url&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;driverClassName&quot; value&#x3D;&quot;$&#123;jdbc.driverClassName&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;jdbcTemplate&quot; class&#x3D;&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span><br><span class="line">        &lt;constructor-arg name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;constructor-arg&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;namedParameterJdbcTemplate&quot; class&#x3D;&quot;org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate&quot;&gt;</span><br><span class="line">        &lt;constructor-arg name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;constructor-arg&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import com.mashibing.bean.Emp;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">import org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;</span><br><span class="line"></span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class MyTest &#123;</span><br><span class="line">    public static void main(String[] args) throws SQLException &#123;</span><br><span class="line">        ApplicationContext context &#x3D; new ClassPathXmlApplicationContext(&quot;jdbcTemplate.xml&quot;);</span><br><span class="line">        NamedParameterJdbcTemplate jdbcTemplate &#x3D; context.getBean(&quot;namedParameterJdbcTemplate&quot;, NamedParameterJdbcTemplate.class);</span><br><span class="line">        String sql &#x3D; &quot;insert into emp(empno,ename) values(:empno,:ename)&quot;;</span><br><span class="line">        Map&lt;String,Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;empno&quot;,2222);</span><br><span class="line">        map.put(&quot;ename&quot;,&quot;sili&quot;);</span><br><span class="line">        int update &#x3D; jdbcTemplate.update(sql, map);</span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-1-9、整合EmpDao"><a href="#5-1-9、整合EmpDao" class="headerlink" title="5.1.9、整合EmpDao"></a>5.1.9、整合EmpDao</h5><p>jdbcTemplate.xml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;context:component-scan base-package&#x3D;&quot;com.mashibing&quot;&gt;&lt;&#x2F;context:component-scan&gt;</span><br></pre></td></tr></table></figure>

<p>EmpDao.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.dao;</span><br><span class="line"></span><br><span class="line">import com.mashibing.bean.Emp;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line">public class EmpDao &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    public void save(Emp emp)&#123;</span><br><span class="line">        String sql &#x3D; &quot;insert into emp(empno,ename) values(?,?)&quot;;</span><br><span class="line">        int update &#x3D; jdbcTemplate.update(sql, emp.getEmpno(), emp.getEname());</span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import com.mashibing.bean.Emp;</span><br><span class="line">import com.mashibing.dao.EmpDao;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;</span><br><span class="line"></span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class MyTest &#123;</span><br><span class="line">    public static void main(String[] args) throws SQLException &#123;</span><br><span class="line">        ApplicationContext context &#x3D; new ClassPathXmlApplicationContext(&quot;jdbcTemplate.xml&quot;);</span><br><span class="line">        EmpDao empDao &#x3D; context.getBean(&quot;empDao&quot;, EmpDao.class);</span><br><span class="line">        empDao.save(new Emp(3333,&quot;wangwu&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2、声明式事务"><a href="#5-2、声明式事务" class="headerlink" title="5.2、声明式事务"></a>5.2、声明式事务</h3><h5 id="5-2-1、环境准备"><a href="#5-2-1、环境准备" class="headerlink" title="5.2.1、环境准备"></a>5.2.1、环境准备</h5><p>tx.sql</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">Navicat MySQL Data Transfer</span><br><span class="line"></span><br><span class="line">Source Server         : localhost</span><br><span class="line">Source Server Version : 50528</span><br><span class="line">Source Host           : localhost:3306</span><br><span class="line">Source Database       : tx</span><br><span class="line"></span><br><span class="line">Target Server Type    : MYSQL</span><br><span class="line">Target Server Version : 50528</span><br><span class="line">File Encoding         : 65001</span><br><span class="line"></span><br><span class="line">Date: 2020-02-13 19:19:32</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS&#x3D;0;</span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for &#96;account&#96;</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;account&#96;;</span><br><span class="line">CREATE TABLE &#96;account&#96; (</span><br><span class="line">  &#96;username&#96; varchar(10) NOT NULL DEFAULT &#39;&#39;,</span><br><span class="line">  &#96;balance&#96; double DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;username&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of account</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO account VALUES (&#39;lisi&#39;, &#39;1000&#39;);</span><br><span class="line">INSERT INTO account VALUES (&#39;zhangsan&#39;, &#39;1000&#39;);</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for &#96;book&#96;</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;book&#96;;</span><br><span class="line">CREATE TABLE &#96;book&#96; (</span><br><span class="line">  &#96;id&#96; int(10) NOT NULL,</span><br><span class="line">  &#96;book_name&#96; varchar(10) DEFAULT NULL,</span><br><span class="line">  &#96;price&#96; double DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of book</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO book VALUES (&#39;1&#39;, &#39;西游记&#39;, &#39;100&#39;);</span><br><span class="line">INSERT INTO book VALUES (&#39;2&#39;, &#39;水浒传&#39;, &#39;100&#39;);</span><br><span class="line">INSERT INTO book VALUES (&#39;3&#39;, &#39;三国演义&#39;, &#39;100&#39;);</span><br><span class="line">INSERT INTO book VALUES (&#39;4&#39;, &#39;红楼梦&#39;, &#39;100&#39;);</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for &#96;book_stock&#96;</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;book_stock&#96;;</span><br><span class="line">CREATE TABLE &#96;book_stock&#96; (</span><br><span class="line">  &#96;id&#96; int(255) NOT NULL DEFAULT &#39;0&#39;,</span><br><span class="line">  &#96;stock&#96; int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of book_stock</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO book_stock VALUES (&#39;1&#39;, &#39;1000&#39;);</span><br><span class="line">INSERT INTO book_stock VALUES (&#39;2&#39;, &#39;1000&#39;);</span><br><span class="line">INSERT INTO book_stock VALUES (&#39;3&#39;, &#39;1000&#39;);</span><br><span class="line">INSERT INTO book_stock VALUES (&#39;4&#39;, &#39;1000&#39;);</span><br></pre></td></tr></table></figure>

<p>BookDao.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.dao;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public class BookDao &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 减去某个用户的余额</span><br><span class="line">     * @param userName</span><br><span class="line">     * @param price</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void updateBalance(String userName,int price)&#123;</span><br><span class="line">        String sql &#x3D; &quot;update account set balance&#x3D;balance-? where username&#x3D;?&quot;;</span><br><span class="line">        jdbcTemplate.update(sql,price,userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 按照图书的id来获取图书的价格</span><br><span class="line">     * @param id</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public int getPrice(int id)&#123;</span><br><span class="line">        String sql &#x3D; &quot;select price from book where id&#x3D;?&quot;;</span><br><span class="line">        return jdbcTemplate.queryForObject(sql,Integer.class,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 减库存，减去某本书的库存</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void updateStock(int id)&#123;</span><br><span class="line">        String sql &#x3D; &quot;update book_stock set stock&#x3D;stock-1 where id&#x3D;?&quot;;</span><br><span class="line">        jdbcTemplate.update(sql,id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookService.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.service;</span><br><span class="line"></span><br><span class="line">import com.mashibing.dao.BookDao;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class BookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 结账：传入哪个用户买了哪本书</span><br><span class="line">     * @param username</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void checkout(String username,int id)&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import com.mashibing.service.BookService;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">public class MyTest &#123;</span><br><span class="line">    public static void main(String[] args) throws SQLException &#123;</span><br><span class="line">        ApplicationContext context &#x3D; new ClassPathXmlApplicationContext(&quot;jdbcTemplate.xml&quot;);</span><br><span class="line">        BookService bookService &#x3D; context.getBean(&quot;bookService&quot;, BookService.class);</span><br><span class="line">        bookService.checkout(&quot;zhangsan&quot;,&quot;1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：在事务控制方面，主要有两个分类：</p>
<p>编程式事务：在代码中直接加入处理事务的逻辑，可能需要在代码中显式调用beginTransaction()、commit()、rollback()等事务管理相关的方法</p>
<p>声明式事务：在方法的外部添加注解或者直接在配置文件中定义，将事务管理代码从业务方法中分离出来，以声明的方式来实现事务管理。spring的AOP恰好可以完成此功能：事务管理代码的固定模式作为一种横切关注点，通过AOP方法模块化，进而实现声明式事务。</p>
<h5 id="5-2-2、声明式事务的简单配置"><a href="#5-2-2、声明式事务的简单配置" class="headerlink" title="5.2.2、声明式事务的简单配置"></a>5.2.2、声明式事务的简单配置</h5><pre><code>Spring从不同的事务管理API中抽象出了一整套事务管理机制，让事务管理代码从特定的事务技术中独立出来。开发人员通过配置的方式进行事务管理，而不必了解其底层是如何实现的。

Spring的核心事务管理抽象是PlatformTransactionManager。它为事务管理封装了一组独立于技术的方法。无论使用Spring的哪种事务管理策略(编程式或声明式)，事务管理器都是必须的。

事务管理器可以以普通的bean的形式声明在Spring IOC容器中。下图是spring提供的事务管理器 [![事务管理器](https://github.com/bjmashibing/java/raw/master/javaframework/spring/07SpringAOP%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AE%B2%E8%A7%A32/image%5C%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8.png)](https://github.com/bjmashibing/java/blob/master/javaframework/spring/07SpringAOP的详细讲解2/image\事务管理器.png)</code></pre><p>1、在配置文件中添加事务管理器</p>
<p>jdbcTemplate.xml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">       xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">       xmlns:tx&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context.xsd</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">       https:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx</span><br><span class="line">       https:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;tx&#x2F;spring-tx.xsd</span><br><span class="line">&quot;&gt;</span><br><span class="line">    &lt;context:component-scan base-package&#x3D;&quot;com.mashibing&quot;&gt;&lt;&#x2F;context:component-scan&gt;</span><br><span class="line">    &lt;context:property-placeholder location&#x3D;&quot;classpath:dbconfig.properties&quot;&gt;&lt;&#x2F;context:property-placeholder&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;dataSource&quot; class&#x3D;&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;jdbc.username&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;jdbc.password&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;jdbc.url&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;driverClassName&quot; value&#x3D;&quot;$&#123;jdbc.driverClassName&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;jdbcTemplate&quot; class&#x3D;&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span><br><span class="line">        &lt;constructor-arg name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;constructor-arg&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;!--事务控制--&gt;</span><br><span class="line">    &lt;!--配置事务管理器的bean--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;transactionManager&quot; class&#x3D;&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;!--开启基于注解的事务控制模式，依赖tx名称空间--&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager&#x3D;&quot;transactionManager&quot;&gt;&lt;&#x2F;tx:annotation-driven&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<p>BookService.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.service;</span><br><span class="line"></span><br><span class="line">import com.mashibing.dao.BookDao;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class BookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 结账：传入哪个用户买了哪本书</span><br><span class="line">     * @param username</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Transactional</span><br><span class="line">    public void checkout(String username,int id)&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-3、事务配置的属性"><a href="#5-2-3、事务配置的属性" class="headerlink" title="5.2.3、事务配置的属性"></a>5.2.3、事务配置的属性</h5><pre><code>isolation：设置事务的隔离级别

propagation：事务的传播行为

noRollbackFor：那些异常事务可以不回滚

noRollbackForClassName：填写的参数是全类名

rollbackFor：哪些异常事务需要回滚

rollbackForClassName：填写的参数是全类名

readOnly：设置事务是否为只读事务

timeout：事务超出指定执行时长后自动终止并回滚,单位是秒</code></pre><h5 id="5-2-4、测试超时属性"><a href="#5-2-4、测试超时属性" class="headerlink" title="5.2.4、测试超时属性"></a>5.2.4、测试超时属性</h5><p>BookService.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.service;</span><br><span class="line"></span><br><span class="line">import com.mashibing.dao.BookDao;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class BookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 结账：传入哪个用户买了哪本书</span><br><span class="line">     * @param username</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Transactional(timeout &#x3D; 3)</span><br><span class="line">    public void checkout(String username,int id)&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(3000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-5、设置事务只读"><a href="#5-2-5、设置事务只读" class="headerlink" title="5.2.5、设置事务只读"></a>5.2.5、设置事务只读</h5><pre><code>如果你一次执行单条查询语句，则没有必要启用事务支持，数据库默认支持SQL执行期间的读一致性；

如果你一次执行多条查询语句，例如统计查询，报表查询，在这种场景下，多条查询SQL必须保证整体的读一致性，否则，在前条SQL查询之后，后条SQL查询之前，数据被其他用户改变，则该次整体的统计查询将会出现读数据不一致的状态，此时，应该启用事务支持。

对于只读查询，可以指定事务类型为readonly，即只读事务。由于只读事务不存在数据的修改，因此数据库将会为只读事务提供一些优化手段</code></pre><p>BookService.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.service;</span><br><span class="line"></span><br><span class="line">import com.mashibing.dao.BookDao;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class BookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 结账：传入哪个用户买了哪本书</span><br><span class="line">     * @param username</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Transactional(timeout &#x3D; 3,readOnly &#x3D; true)</span><br><span class="line">    public void checkout(String username,int id)&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-6、设置哪些异常不回滚"><a href="#5-2-6、设置哪些异常不回滚" class="headerlink" title="5.2.6、设置哪些异常不回滚"></a>5.2.6、设置哪些异常不回滚</h5><pre><code>注意：运行时异常默认回滚，编译时异常默认不回滚</code></pre><p>BookService.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.service;</span><br><span class="line"></span><br><span class="line">import com.mashibing.dao.BookDao;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class BookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 结账：传入哪个用户买了哪本书</span><br><span class="line">     * @param username</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Transactional(timeout &#x3D; 3,noRollbackFor &#x3D; &#123;ArithmeticException.class,NullPointerException.class&#125;)</span><br><span class="line">    public void checkout(String username,int id)&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">        int i &#x3D; 1&#x2F;0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">        @Transactional(timeout &#x3D; 3,noRollbackForClassName &#x3D; &#123;&quot;java.lang.ArithmeticException&quot;&#125;)</span><br><span class="line">    public void checkout(String username,int id)&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">        int i &#x3D; 1&#x2F;0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-7、设置哪些异常回滚"><a href="#5-2-7、设置哪些异常回滚" class="headerlink" title="5.2.7、设置哪些异常回滚"></a>5.2.7、设置哪些异常回滚</h5><p>BookService.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.service;</span><br><span class="line"></span><br><span class="line">import com.mashibing.dao.BookDao;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class BookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 结账：传入哪个用户买了哪本书</span><br><span class="line">     * @param username</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Transactional(timeout &#x3D; 3,rollbackFor &#x3D; &#123;FileNotFoundException.class&#125;)</span><br><span class="line">    public void checkout(String username,int id) throws FileNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">&#x2F;&#x2F;        int i &#x3D; 1&#x2F;0;</span><br><span class="line">        new FileInputStream(&quot;aaa.txt&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-8、设置隔离级别"><a href="#5-2-8、设置隔离级别" class="headerlink" title="5.2.8、设置隔离级别"></a>5.2.8、设置隔离级别</h5><pre><code>隔离级别没有接触的同学可以看我之前的事务视频，里面有详细讲解，此处不再赘述。</code></pre><p>BookService.java</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package com.mashibing.service;</span><br><span class="line"></span><br><span class="line">import com.mashibing.dao.BookDao;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Isolation;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class BookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 结账：传入哪个用户买了哪本书</span><br><span class="line">     * @param username</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Transactional(timeout &#x3D; 3,isolation &#x3D; Isolation.READ_COMMITTED)</span><br><span class="line">    public void checkout(String username,int id) throws FileNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        int price &#x3D; bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">&#x2F;&#x2F;        int i &#x3D; 1&#x2F;0;</span><br><span class="line">        new FileInputStream(&quot;aaa.txt&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-9、事务的传播特性"><a href="#5-2-9、事务的传播特性" class="headerlink" title="5.2.9、事务的传播特性"></a>5.2.9、事务的传播特性</h5><p>事务的传播特性指的是当一个事务方法被另一个事务方法调用时，这个事务方法应该如何进行？</p>
<p>spring的事务传播行为一共有7种：</p>
<p><img src="/2020/09/20/spring/%E4%BC%A0%E6%92%AD%E7%89%B9%E6%80%A7.jpg" alt="传播特性"></p>
<h5 id="5-2-10、测试事务的传播特性"><a href="#5-2-10、测试事务的传播特性" class="headerlink" title="5.2.10、测试事务的传播特性"></a>5.2.10、测试事务的传播特性</h5><p>BookDao.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 减去某个用户的余额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> price</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBalance</span><span class="params">(String userName,<span class="keyword">int</span> price)</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">"update account set balance=balance-? where username=?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql,price,userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照图书的id来获取图书的价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">"select price from book where id=?"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql,Integer<span class="class">.<span class="keyword">class</span>,<span class="title">id</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 减库存，减去某本书的库存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStock</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">"update book_stock set stock=stock-1 where id=?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改图书价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> price</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> price)</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">"update book set price=? where id =?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql,price,id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> java.io.File;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结账：传入哪个用户买了哪本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username,<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> price)</span></span>&#123;</span><br><span class="line">        bookDao.updatePrice(id,price);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MulService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MulService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mulTx</span><span class="params">()</span></span>&#123;</span><br><span class="line">        bookService.checkout(<span class="string">"zhangsan"</span>,<span class="number">1</span>);</span><br><span class="line">        bookService.updatePrice(<span class="number">1</span>,<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mashibing.service.MulService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"jdbcTemplate.xml"</span>);</span><br><span class="line">        MulService mulService = context.getBean(<span class="string">"mulService"</span>, MulService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        mulService.mulTx();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>通过上图的结果发现，如果设置的传播特性是Required，那么所有的事务都会统一成一个事务，一旦发生错误，所有的数据都要进行回滚。</code></pre><hr>
<p>BookService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> com.mashibing.dao.BookDao;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> java.io.File;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结账：传入哪个用户买了哪本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username,<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> price)</span></span>&#123;</span><br><span class="line">        bookDao.updatePrice(id,price);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>通过修改checkout方法的传播特性为Required_new,发现价格进行了回滚，而其他的数据没有进行回滚。</code></pre><hr>
<p>BookService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> com.mashibing.dao.BookDao;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> java.io.File;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结账：传入哪个用户买了哪本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username,<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> price)</span></span>&#123;</span><br><span class="line">        bookDao.updatePrice(id,price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MulService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Book;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MulService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mulTx</span><span class="params">()</span></span>&#123;</span><br><span class="line">        bookService.checkout(<span class="string">"zhangsan"</span>,<span class="number">1</span>);</span><br><span class="line">        bookService.updatePrice(<span class="number">1</span>,<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>将bookservice方法的传播行为为Required，并且将报错设置在MulService中，发现会都进行回滚。</code></pre><hr>
<p>BookService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> com.mashibing.dao.BookDao;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> java.io.File;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结账：传入哪个用户买了哪本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username,<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> price)</span></span>&#123;</span><br><span class="line">        bookDao.updatePrice(id,price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MulService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.bean.Book;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MulService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mulTx</span><span class="params">()</span></span>&#123;</span><br><span class="line">        bookService.checkout(<span class="string">"zhangsan"</span>,<span class="number">1</span>);</span><br><span class="line">        bookService.updatePrice(<span class="number">1</span>,<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>将bookservice方法的传播行为为Requires_new，并且将报错设置在MulService中，发现都不会进行回滚。</code></pre><hr>
<p>BookService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.service;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> com.mashibing.dao.BookDao;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line">        <span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> java.io.File;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line">        <span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结账：传入哪个用户买了哪本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username,<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        bookDao.updateStock(id);</span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(id);</span><br><span class="line">        bookDao.updateBalance(username,price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> price)</span></span>&#123;</span><br><span class="line">        bookDao.updatePrice(id,price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mulTx</span><span class="params">()</span></span>&#123;</span><br><span class="line">        checkout(<span class="string">"zhangsan"</span>,<span class="number">1</span>);</span><br><span class="line">        updatePrice(<span class="number">1</span>,<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>如果在bookservice执行的话，会发现刚刚的效果就没有了，原因是外层调用的时候使用的AOP，但是本类方法自己的调用就是最最普通的调用，就是同一个事务。</code></pre><p>总结：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1、事务传播级别是REQUIRED，当checkout()被调用时（假定被另一类中commit()调用），如果checkout()中的代码抛出异常，即便被捕获，commit()中的其他代码都会roll back</span><br><span class="line"></span><br><span class="line">2、是REQUIRES_NEW，如果checkout()中的代码抛出异常，并且被捕获，commit()中的其他代码不会roll back；如果commit()中的其他代码抛出异常，而且没有捕获，不会导致checkout()回滚</span><br><span class="line"></span><br><span class="line">3、是NESTED，如果checkout()中的代码抛出异常，并且被捕获，commit()中的其他代码不会roll back；如果commit()中的其他代码抛出异常，而且没有捕获，会导致checkout()回滚</span><br><span class="line"></span><br><span class="line">    PROPAGATION_REQUIRES_NEW 启动一个新的, 不依赖于环境的 &quot;内部&quot; 事务. 这个事务将被完全 commited 或 rolled back 而不依赖于外部事务, 它拥有自己的隔离范围, 自己的锁, 等等. 当内部事务开始执行时, 外部事务将被挂起, 内务事务结束时, 外部事务将继续执行. </span><br><span class="line">    另一方面, PROPAGATION_NESTED 开始一个 &quot;嵌套的&quot; 事务,  它是已经存在事务的一个真正的子事务. 嵌套事务开始执行时,  它将取得一个 savepoint. 如果这个嵌套事务失败, 我们将回滚到此 savepoint. 潜套事务是外部事务的一部分, 只有外部事务结束后它才会被提交. </span><br><span class="line">    由此可见, PROPAGATION_REQUIRES_NEW 和 PROPAGATION_NESTED 的最大区别在于, PROPAGATION_REQUIRES_NEW 完全是一个新的事务, 而 PROPAGATION_NESTED 则是外部事务的子事务, 如果外部事务 commit, 嵌套事务也会被 commit, 这个规则同样适用于 roll back.</span><br></pre></td></tr></table></figure>

<h3 id="5-3、基于xml的事务配置"><a href="#5-3、基于xml的事务配置" class="headerlink" title="5.3、基于xml的事务配置"></a>5.3、基于xml的事务配置</h3><p>jdbcTemplate.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.mashibing"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"namedParameterJdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事务控制--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器的bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    基于xml配置的事务：依赖tx名称空间和aop名称空间</span></span><br><span class="line"><span class="comment">        1、spring中提供事务管理器（切面），配置这个事务管理器</span></span><br><span class="line"><span class="comment">        2、配置出事务方法</span></span><br><span class="line"><span class="comment">        3、告诉spring哪些方法是事务方法（事务切面按照我们的切入点表达式去切入事务方法）</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookService"</span> <span class="attr">class</span>=<span class="string">"com.mashibing.service.BookService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"txPoint"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.mashibing.service.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--事务建议：advice-ref:指向事务管理器的配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txPoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"myAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--事务属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指明哪些方法是事务方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"checkout"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="6-Spring原理讲解"><a href="#6-Spring原理讲解" class="headerlink" title="6. Spring原理讲解"></a>6. Spring原理讲解</h1><h3 id="6-1、什么是Spring框架，Spring框架主要包含哪些模块"><a href="#6-1、什么是Spring框架，Spring框架主要包含哪些模块" class="headerlink" title="6.1、什么是Spring框架，Spring框架主要包含哪些模块"></a>6.1、什么是Spring框架，Spring框架主要包含哪些模块</h3><pre><code>Spring是一个开源框架，Spring是一个轻量级的Java 开发框架。它是为了解决企业应用开发的复杂性而创建的。框架的主要优势之一就是其分层架构，分层架构允许使用者选择使用哪一个组件，同时为 J2EE 应用程序开发提供集成的框架。Spring使用基本的JavaBean来完成以前只可能由EJB完成的事情。然而，Spring的用途不仅限于服务器端的开发。从简单性、可测试性和松耦合的角度而言，任何Java应用都可以从Spring中受益。Spring的核心是控制反转（IoC）和面向切面（AOP）。简单来说，Spring是一个分层的full-stack(一站式) 轻量级开源框架。</code></pre><p>主要包含的模块：</p>
<p><a href="https://github.com/bjmashibing/java/blob/master/javaframework/spring/08Spring源码讲解/image\spring-overview.png" target="_blank" rel="noopener"><img src="https://github.com/bjmashibing/java/raw/master/javaframework/spring/08Spring%E6%BA%90%E7%A0%81%E8%AE%B2%E8%A7%A3/image%5Cspring-overview.png" alt="img"></a></p>
<h3 id="6-2、Spring框架的优势"><a href="#6-2、Spring框架的优势" class="headerlink" title="6.2、Spring框架的优势"></a>6.2、Spring框架的优势</h3><pre><code>1、Spring通过DI、AOP和消除样板式代码来简化企业级Java开发

2、Spring框架之外还存在一个构建在核心框架之上的庞大生态圈，它将Spring扩展到不同的领域，如Web服务、REST、移动开发以及NoSQL

3、低侵入式设计，代码的污染极低

4、独立于各种应用服务器，基于Spring框架的应用，可以真正实现Write Once,Run Anywhere的承诺

5、Spring的IoC容器降低了业务对象替换的复杂性，提高了组件之间的解耦

6、Spring的AOP允许将一些通用任务如安全、事务、日志等进行集中式处理，从而提供了更好的复用

7、Spring的ORM和DAO提供了与第三方持久层框架的的良好整合，并简化了底层的数据库访问

8、Spring的高度开放性，并不强制应用完全依赖于Spring，开发者可自由选用Spring框架的部分或全部</code></pre><h3 id="6-3、IOC和DI是什么？"><a href="#6-3、IOC和DI是什么？" class="headerlink" title="6.3、IOC和DI是什么？"></a>6.3、IOC和DI是什么？</h3><pre><code>控制反转是就是应用本身不负责依赖对象的创建和维护,依赖对象的创建及维护是由外部容器负责的,这样控制权就有应用转移到了外部容器,控制权的转移就是控制反转。

依赖注入是指:在程序运行期间,由外部容器动态地将依赖对象注入到组件中如：一般，通过构造函数注入或者setter注入。</code></pre><h3 id="6-4、描述下Spring-IOC容器的初始化过程"><a href="#6-4、描述下Spring-IOC容器的初始化过程" class="headerlink" title="6.4、描述下Spring IOC容器的初始化过程"></a>6.4、描述下Spring IOC容器的初始化过程</h3><pre><code>Spring IOC容器的初始化简单的可以分为三个过程：

第一个过程是Resource资源定位。这个Resouce指的是BeanDefinition的资源定位。这个过程就是容器找数据的过程，就像水桶装水需要先找到水一样。

第二个过程是BeanDefinition的载入过程。这个载入过程是把用户定义好的Bean表示成Ioc容器内部的数据结构，而这个容器内部的数据结构就是BeanDefition。

第三个过程是向IOC容器注册这些BeanDefinition的过程，这个过程就是将前面的BeanDefition保存到HashMap中的过程。</code></pre><h3 id="6-5、BeanFactory-和-FactoryBean的区别？"><a href="#6-5、BeanFactory-和-FactoryBean的区别？" class="headerlink" title="6.5、BeanFactory 和 FactoryBean的区别？"></a>6.5、BeanFactory 和 FactoryBean的区别？</h3><ul>
<li><pre><code class="prop">BF 是个Factory，也就是IOC容器或对象工厂，在Spring中，所有的Bean都是由BeanFactory(也就是IOC容器)来进行管理的，提供了实例化对象和拿对象的功能。

  使用场景：

  - 从Ioc容器中获取Bean(byName or byType)
  - 检索Ioc容器中是否包含指定的Bean
  - 判断Bean是否为单例

FB是个Bean，这个Bean不是简单的Bean，而是一个能生产或者修饰对象生成的工厂Bean,它的实现与设计模式中的工厂模式和修饰器模式类似。

  使用场景

  - ProxyFactoryBean
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- </span><br><span class="line"></span><br><span class="line">### 6.6、BeanFactory和ApplicationContext的异同![img](spring&#x2F;ApplicationContext类图.png)</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;properties</span><br><span class="line">相同：</span><br><span class="line"></span><br><span class="line">- Spring提供了两种不同的IOC 容器，一个是BeanFactory，另外一个是ApplicationContext，它们都是Java interface，ApplicationContext继承于BeanFactory(ApplicationContext继承ListableBeanFactory。</span><br><span class="line">- 它们都可以用来配置XML属性，也支持属性的自动注入。</span><br><span class="line">- 而ListableBeanFactory继承BeanFactory)，BeanFactory 和 ApplicationContext 都提供了一种方式，使用getBean(&quot;bean name&quot;)获取bean。</span><br><span class="line"></span><br><span class="line">不同：</span><br><span class="line"></span><br><span class="line">- 当你调用getBean()方法时，BeanFactory仅实例化bean，而ApplicationContext 在启动容器的时候实例化单例bean，不会等待调用getBean()方法时再实例化。</span><br><span class="line">- BeanFactory不支持国际化，即i18n，但ApplicationContext提供了对它的支持。</span><br><span class="line">- BeanFactory与ApplicationContext之间的另一个区别是能够将事件发布到注册为监听器的bean。</span><br><span class="line">- BeanFactory 的一个核心实现是XMLBeanFactory 而ApplicationContext 的一个核心实现是ClassPathXmlApplicationContext，Web容器的环境我们使用WebApplicationContext并且增加了getServletContext 方法。</span><br><span class="line">- 如果使用自动注入并使用BeanFactory，则需要使用API注册AutoWiredBeanPostProcessor，如果使用ApplicationContext，则可以使用XML进行配置。</span><br><span class="line">- 简而言之，BeanFactory提供基本的IOC和DI功能，而ApplicationContext提供高级功能，BeanFactory可用于测试和非生产使用，但ApplicationContext是功能更丰富的容器实现，应该优于BeanFactory</span><br></pre></td></tr></table></figure>


</code></pre>
</li>
</ul>
<h3 id="6-7、Spring-Bean-的生命周期？"><a href="#6-7、Spring-Bean-的生命周期？" class="headerlink" title="6.7、Spring Bean 的生命周期？"></a>6.7、Spring Bean 的生命周期？</h3><p><img src="/2020/09/20/spring/bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="springbean生命周期"></p>
<p>总结：</p>
<table>
<thead>
<tr>
<th>—</th>
<th>—&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th>具体操作</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>实例化Bean</td>
<td>对于BeanFactory容器，当客户向容器请求一个尚未初始化的bean时，或初始化bean的时候需要注入另一个尚未初始化的依赖时，容器就会调用createBean进行实例化。对于ApplicationContext容器，当容器启动结束后，通过获取BeanDefinition对象中的信息，实例化所有的bean。</td>
</tr>
<tr>
<td>2</td>
<td>设置对象属性（依赖注入）</td>
<td>实例化后的对象被封装在BeanWrapper对象中，紧接着，Spring根据BeanDefinition中的信息 以及 通过BeanWrapper提供的设置属性的接口完成依赖注入。</td>
</tr>
<tr>
<td>3</td>
<td>处理Aware接口</td>
<td>接着，Spring会检测该对象是否实现了xxxAware接口，并将相关的xxxAware实例注入给Bean：①如果这个Bean已经实现了BeanNameAware接口，会调用它实现的setBeanName(String beanId)方法，此处传递的就是Spring配置文件中Bean的id值；②如果这个Bean已经实现了BeanFactoryAware接口，会调用它实现的setBeanFactory()方法，传递的是Spring工厂自身。③如果这个Bean已经实现了ApplicationContextAware接口，会调用setApplicationContext(ApplicationContext)方法，传入Spring上下文；</td>
</tr>
<tr>
<td>4</td>
<td>BeanPostProcessor</td>
<td>如果想对Bean进行一些自定义的处理，那么可以让Bean实现了BeanPostProcessor接口，那将会调用postProcessBeforeInitialization(Object obj, String s)方法。</td>
</tr>
<tr>
<td>5</td>
<td>InitializingBean 与 init-method</td>
<td>如果Bean在Spring配置文件中配置了 init-method 属性，则会自动调用其配置的初始化方法。</td>
</tr>
<tr>
<td>6</td>
<td>如果这个Bean实现了BeanPostProcessor接口**</td>
<td>将会调用postProcessAfterInitialization(Object obj, String s)方法；由于这个方法是在Bean初始化结束时调用的，所以可以被应用于内存或缓存技术以上几个步骤完成后，Bean就已经被正确创建了，之后就可以使用这个Bean了。</td>
</tr>
<tr>
<td>7</td>
<td>DisposableBean</td>
<td>当Bean不再需要时，会经过清理阶段，如果Bean实现了DisposableBean这个接口，会调用其实现的destroy()方法；</td>
</tr>
<tr>
<td>8</td>
<td>destroy-method</td>
<td>最后，如果这个Bean的Spring配置中配置了destroy-method属性，会自动调用其配置的销毁方法。</td>
</tr>
</tbody></table>
<h3 id="6-8、Spring-AOP的实现原理？"><a href="#6-8、Spring-AOP的实现原理？" class="headerlink" title="6.8、Spring AOP的实现原理？"></a>6.8、Spring AOP的实现原理？</h3><pre><code>Spring AOP使用的动态代理，所谓的动态代理就是说AOP框架不会去修改字节码，而是在内存中临时为方法生成一个AOP对象，这个AOP对象包含了目标对象的全部方法，并且在特定的切点做了增强处理，并回调原对象的方法。

Spring AOP中的动态代理主要有两种方式，JDK动态代理和CGLIB动态代理。JDK动态代理通过反射来接收被代理的类，并且要求被代理的类必须实现一个接口。JDK动态代理的核心是InvocationHandler接口和Proxy类。

如果目标类没有实现接口，那么Spring AOP会选择使用CGLIB来动态代理目标类。CGLIB（Code Generation Library），是一个代码生成的类库，可以在运行时动态的生成某个类的子类，注意，CGLIB是通过继承的方式做的动态代理，因此如果某个类被标记为final，那么它是无法使用CGLIB做动态代理的。</code></pre><h3 id="6-9、Spring-是如何管理事务的？"><a href="#6-9、Spring-是如何管理事务的？" class="headerlink" title="6.9、Spring 是如何管理事务的？"></a>6.9、Spring 是如何管理事务的？</h3><pre><code>Spring事务管理主要包括3个接口，Spring的事务主要是由它们三个共同完成的。事务的配置信息，都可以通过配置文件进行配置。</code></pre><table>
<thead>
<tr>
<th>–</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>PlatformTransactionManager</strong></td>
<td>平台事务管理器主要用于平台相关事务的管理&#10;主要有三个方法：&#10;commit 事务提交； &#10;rollback 事务回滚；&#10;getTransaction: 获取/创建事务.</td>
</tr>
<tr>
<td><strong>TransactionDefinition</strong></td>
<td>事务定义信息用来定义事务相关的属性,给事务管理器使用&#10; getIsolationLevel：获取隔离级别；&#10; getPropagationBehavior：获取传播行为； &#10;getTimeout：获取超时时间；&#10; isReadOnly：是否只读（保存、更新、删除时属性变为false–可读写，&#10;查询时为true–只读）</td>
</tr>
<tr>
<td><strong>TransactionStatus</strong></td>
<td>事务具体运行状态–事务管理过程中，每个时间点事务的状态信息。hasSavepoint()：当前事务是否包含一个保存点&#10;isCompleted()： 返回该事务是否已完成 &#10;isNewTransaction()：判断当前事务是否是一个新事务</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This is the central interface in Spring's transaction infrastructure.</span></span><br><span class="line"><span class="comment"> * Applications can use this directly, but it is not primarily meant as API:</span></span><br><span class="line"><span class="comment"> * Typically, applications will work with either TransactionTemplate or</span></span><br><span class="line"><span class="comment"> * declarative transaction demarcation through AOP.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PlatformTransactionManager</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return a currently active transaction or create a new one, according to</span></span><br><span class="line"><span class="comment">	 * the specified propagation behavior.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(TransactionDefinition definition)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit the given transaction, with regard to its status. If the transaction</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Perform a rollback of the given transaction.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interface that defines Spring-compliant transaction properties.</span></span><br><span class="line"><span class="comment"> * Based on the propagation behavior definitions analogous to EJB CMT attributes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Support a current transaction; create a new one if none exists.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_REQUIRED = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Support a current transaction; execute non-transactionally if none exists.</span></span><br><span class="line"><span class="comment">	 * Analogous to the EJB transaction attribute of the same name.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_SUPPORTS = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Support a current transaction; throw an exception if no current transaction</span></span><br><span class="line"><span class="comment">	 * exists. Analogous to the EJB transaction attribute of the same name.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_MANDATORY = <span class="number">2</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new transaction, suspending the current transaction if one exists.</span></span><br><span class="line"><span class="comment">	 * Analogous to the EJB transaction attribute of the same name.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_REQUIRES_NEW = <span class="number">3</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Do not support a current transaction; rather always execute non-transactionally.</span></span><br><span class="line"><span class="comment">	 * Analogous to the EJB transaction attribute of the same name.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NOT_SUPPORTED = <span class="number">4</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Do not support a current transaction; throw an exception if a current transaction</span></span><br><span class="line"><span class="comment">	 * exists. </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NEVER = <span class="number">5</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Execute within a nested transaction if a current transaction exists,</span></span><br><span class="line"><span class="comment">	 * behave like &#123;<span class="doctag">@link</span> #PROPAGATION_REQUIRED&#125; else. </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NESTED = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Use the default isolation level of the underlying datastore.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> ISOLATION_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Indicates that dirty reads, non-repeatable reads and phantom reads</span></span><br><span class="line"><span class="comment">	 * can occur.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> ISOLATION_READ_UNCOMMITTED = Connection.TRANSACTION_READ_UNCOMMITTED;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Indicates that dirty reads are prevented; non-repeatable reads and</span></span><br><span class="line"><span class="comment">	 * phantom reads can occur.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> ISOLATION_READ_COMMITTED = Connection.TRANSACTION_READ_COMMITTED;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Indicates that dirty reads and non-repeatable reads are prevented;</span></span><br><span class="line"><span class="comment">	 * phantom reads can occur.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> ISOLATION_REPEATABLE_READ = Connection.TRANSACTION_REPEATABLE_READ;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Indicates that dirty reads, non-repeatable reads and phantom reads</span></span><br><span class="line"><span class="comment">	 * are prevented.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> ISOLATION_SERIALIZABLE = Connection.TRANSACTION_SERIALIZABLE;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Use the default timeout of the underlying transaction system,</span></span><br><span class="line"><span class="comment">	 * or none if timeouts are not supported.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">int</span> TIMEOUT_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the propagation behavior.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the isolation level.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the transaction timeout.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return whether to optimize as a read-only transaction.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the name of this transaction. Can be &#123;<span class="doctag">@code</span> null&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"><span class="keyword">import</span> java.io.Flushable;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Representation of the status of a transaction.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionStatus</span> <span class="keyword">extends</span> <span class="title">SavepointManager</span>, <span class="title">Flushable</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return whether the present transaction is new</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isNewTransaction</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return whether this transaction internally carries a savepoint,</span></span><br><span class="line"><span class="comment">	 * that is, has been created as nested transaction based on a savepoint.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">hasSavepoint</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setRollbackOnly</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isRollbackOnly</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Flush the underlying session to the datastore, if applicable:</span></span><br><span class="line"><span class="comment">	 * for example, all affected Hibernate/JPA sessions.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;This is effectively just a hint and may be a no-op if the underlying</span></span><br><span class="line"><span class="comment">	 * transaction manager does not have a flush concept. A flush signal may</span></span><br><span class="line"><span class="comment">	 * get applied to the primary resource or to transaction synchronizations,</span></span><br><span class="line"><span class="comment">	 * depending on the underlying resource.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return whether this transaction is completed, that is,</span></span><br><span class="line"><span class="comment">	 * whether it has already been committed or rolled back.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isCompleted</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">声明式事务的优缺点：</span></span><br><span class="line"><span class="attr">优点：不需要在业务逻辑代码中编写事务相关代码，只需要在配置文件配置或使用注解（@Transaction），这种方式没有侵入性。</span></span><br><span class="line"><span class="attr">缺点：声明式事务的最细粒度作用于方法上，如果像代码块也有事务需求，只能变通下，将代码块变为法。</span></span><br></pre></td></tr></table></figure>

<h3 id="6-10、Spring-的不同事务传播行为有哪些，干什么用的？"><a href="#6-10、Spring-的不同事务传播行为有哪些，干什么用的？" class="headerlink" title="6.10、Spring 的不同事务传播行为有哪些，干什么用的？"></a>6.10、Spring 的不同事务传播行为有哪些，干什么用的？</h3><p><img src="/2020/09/20/spring/%E4%BC%A0%E6%92%AD%E7%89%B9%E6%80%A7.jpg" alt="img"></p>
<h3 id="6-11、Spring-中用到了那些设计模式？"><a href="#6-11、Spring-中用到了那些设计模式？" class="headerlink" title="6.11、Spring 中用到了那些设计模式？"></a>6.11、Spring 中用到了那些设计模式？</h3><ul>
<li>代理模式—在AOP中被用的比较多。</li>
<li>单例模式—在spring配置文件中定义的bean默认为单例模式。</li>
<li>模板方法—用来解决代码重复的问题。比如. RestTemplate, JmsTemplate, JpaTemplate。</li>
<li>工厂模式—BeanFactory用来创建对象的实例。</li>
<li>适配器–spring aop</li>
<li>装饰器–spring data hashmapper</li>
<li>观察者– spring 事件驱动模型</li>
<li>回调–Spring Aware回调接口</li>
</ul>
<h3 id="6-12、Spring如何解决循环依赖？"><a href="#6-12、Spring如何解决循环依赖？" class="headerlink" title="6.12、Spring如何解决循环依赖？"></a>6.12、Spring如何解决循环依赖？</h3><p><a href="https://blog.csdn.net/qq_36381855/article/details/79752689" target="_blank" rel="noopener">https://blog.csdn.net/qq_36381855/article/details/79752689</a></p>
<h3 id="6-13、bean的作用域"><a href="#6-13、bean的作用域" class="headerlink" title="6.13、bean的作用域"></a>6.13、bean的作用域</h3><p>（1）singleton：默认，每个容器中只有一个bean的实例，单例的模式由BeanFactory自身来维护。</p>
<p>（2）prototype：为每一个bean请求提供一个实例。</p>
<p>（3）request：为每一个网络请求创建一个实例，在请求完成以后，bean会失效并被垃圾回收器回收。</p>
<p>（4）session：与request范围类似，确保每个session中有一个bean的实例，在session过期后，bean会随之失效。</p>
<h3 id="6-14、Spring框架中有哪些不同类型的事件"><a href="#6-14、Spring框架中有哪些不同类型的事件" class="headerlink" title="6.14、Spring框架中有哪些不同类型的事件"></a>6.14、Spring框架中有哪些不同类型的事件</h3><p>（1）上下文更新事件（ContextRefreshedEvent）：在调用ConfigurableApplicationContext 接口中的refresh()方法时被触发。</p>
<p>（2）上下文开始事件（ContextStartedEvent）：当容器调用ConfigurableApplicationContext的Start()方法开始/重新开始容器时触发该事件。</p>
<p>（3）上下文停止事件（ContextStoppedEvent）：当容器调用ConfigurableApplicationContext的Stop()方法停止容器时触发该事件。</p>
<p>（4）上下文关闭事件（ContextClosedEvent）：当ApplicationContext被关闭时触发该事件。容器被关闭时，其管理的所有单例Bean都被销毁。</p>
<p>（5）请求处理事件（RequestHandledEvent）：在Web应用中，当一个http请求（request）结束触发该事件。</p>
<h3 id="6-15、Spring通知有哪些类型"><a href="#6-15、Spring通知有哪些类型" class="headerlink" title="6.15、Spring通知有哪些类型"></a>6.15、Spring通知有哪些类型</h3><p>（1）前置通知（Before advice）：在某连接点（join point）之前执行的通知，但这个通知不能阻止连接点前的执行（除非它抛出一个异常）。</p>
<p>（2）返回后通知（After returning advice）：在某连接点（join point）正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</p>
<p>（3）抛出异常后通知（After throwing advice）：在方法抛出异常退出时执行的通知。</p>
<p>（4）后通知（After (finally) advice）：当某连接点退出的时候执行的通知（不论是正常返回还是异常退出）。</p>
<p>（5）环绕通知（Around Advice）：包围一个连接点（join point）的通知，如方法调用。这是最强大的一种通知类型。 环绕通知可以在方法调用前后完成自定义的行为。它也会选择是否继续执行连接点或直接返回它们自己的返回值或抛出异常来结束执行。 环绕通知是最常用的一种通知类型。</p>
<h3 id="6-16、Spring的自动装配"><a href="#6-16、Spring的自动装配" class="headerlink" title="6.16、Spring的自动装配"></a>6.16、Spring的自动装配</h3><p>在spring中，对象无需自己查找或创建与其关联的其他对象，由容器负责把需要相互协作的对象引用赋予各个对象，使用autowire来配置自动装载模式。</p>
<p>在Spring框架xml配置中共有5种自动装配：</p>
<p>（1）no：默认的方式是不进行自动装配的，通过手工设置ref属性来进行装配bean。</p>
<p>（2）byName：通过 bean的名称进行自动装配，如果一个bean的 property 与另一bean 的name 相同，就进行自动装配。</p>
<p>（3）byType：通过参数的数据类型进行自动装配。</p>
<p>（4）constructor：利用构造函数进行装配，并且构造函数的参数通过byType进行装配。</p>
<p>（5）autodetect：自动探测，如果有构造方法，通过 construct的方式自动装配，否则使用 byType的方式自动装配。</p>
<p>基于注解的方式：</p>
<p>使用@Autowired注解来自动装配指定的bean。在使用@Autowired注解之前需要在Spring配置文件进行配置，&lt;context:annotation-config /&gt;。在启动spring IoC时，容器自动装载了一个AutowiredAnnotationBeanPostProcessor后置处理器，当容器扫描到@Autowied、@Resource或@Inject时，就会在IoC容器自动查找需要的bean，并装配给该对象的属性。在使用@Autowired时，首先在容器中查询对应类型的bean：</p>
<p>如果查询结果刚好为一个，就将该bean装配给@Autowired指定的数据；</p>
<p>如果查询的结果不止一个，那么@Autowired会根据名称来查找；</p>
<p>如果上述查找的结果为空，那么会抛出异常。解决方法时，使用required=false。</p>
<p>@Autowired可用于：构造函数、成员变量、Setter方法</p>
<p>注：@Autowired和@Resource之间的区别</p>
<p>(1) @Autowired默认是按照类型装配注入的，默认情况下它要求依赖对象必须存在（可以设置它required属性为false）。</p>
<p>(2) @Resource默认是按照名称来装配注入的，只有当找不到与名称匹配的bean才会按照类型来装配注入。</p>
<h1 id="7-动态代理"><a href="#7-动态代理" class="headerlink" title="7. 动态代理"></a>7. 动态代理</h1><h3 id="7-1、jdk的动态代理"><a href="#7-1、jdk的动态代理" class="headerlink" title="7.1、jdk的动态代理"></a>7.1、jdk的动态代理</h3><pre><code>动态代理与静态代理的区别此处不再赘述，大家可以看马老师的设计模式视频，我们主要讲一下动态代理的实现原理，说明白原理的话肯定是要看源码了，大家不要慌，干就完了！！！

其实在使用动态代理的时候最最核心的就是Proxy.newProxyInstance(loader, interfaces, h);废话不多说，直接干源码。</code></pre><p><strong>动态代理的样例代码：</strong></p>
<p>Calculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyCalculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i + j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i - j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i * j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i / j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CalculatorProxy.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calculator <span class="title">getProxy</span><span class="params">(<span class="keyword">final</span> Calculator calculator)</span></span>&#123;</span><br><span class="line">        ClassLoader loader = calculator.getClass().getClassLoader();</span><br><span class="line">        Class&lt;?&gt;[] interfaces = calculator.getClass().getInterfaces();</span><br><span class="line">        InvocationHandler h = <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Object result = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    result = method.invoke(calculator, args);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Object proxy = Proxy.newProxyInstance(loader, interfaces, h);</span><br><span class="line">        <span class="keyword">return</span> (Calculator) proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Test.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Calculator proxy = CalculatorProxy.getProxy(<span class="keyword">new</span> MyCalculator());</span><br><span class="line">        proxy.add(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        System.out.println(proxy.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>动态代理的源码：</strong></p>
<p>Proxy.java的newProxyInstance方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader,</span></span></span><br><span class="line"><span class="function"><span class="params">                                          Class&lt;?&gt;[] interfaces,</span></span></span><br><span class="line"><span class="function"><span class="params">                                          InvocationHandler h)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IllegalArgumentException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">//判断InvocationHandler是否为空，若为空，抛出空指针异常</span></span><br><span class="line">        Objects.requireNonNull(h);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class="line">        <span class="keyword">final</span> SecurityManager sm = System.getSecurityManager();</span><br><span class="line">        <span class="keyword">if</span> (sm != <span class="keyword">null</span>) &#123;</span><br><span class="line">            checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Look up or generate the designated proxy class.</span></span><br><span class="line"><span class="comment">         * 生成接口的代理类的字节码文件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Invoke its constructor with the designated invocation handler.</span></span><br><span class="line"><span class="comment">         * 使用自定义的InvocationHandler作为参数，调用构造函数获取代理类对象实例</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (sm != <span class="keyword">null</span>) &#123;</span><br><span class="line">                checkNewProxyPermission(Reflection.getCallerClass(), cl);</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">//获取代理对象的构造方法</span></span><br><span class="line">            <span class="keyword">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class="line">            <span class="keyword">final</span> InvocationHandler ih = h;</span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class="line">                AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        cons.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//生成代理类的实例并把InvocationHandlerImpl的实例传给构造方法</span></span><br><span class="line">            <span class="keyword">return</span> cons.newInstance(<span class="keyword">new</span> Object[]&#123;h&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException|InstantiationException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(e.toString(), e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            Throwable t = e.getCause();</span><br><span class="line">            <span class="keyword">if</span> (t <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (RuntimeException) t;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(t.toString(), t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(e.toString(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>getProxyClass0(ClassLoader loader,Class&lt;?&gt;… interfaces)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; getProxyClass0(ClassLoader loader,</span><br><span class="line">                                       Class&lt;?&gt;... interfaces) &#123;</span><br><span class="line">    <span class="comment">//限定代理的接口不能超过65535个</span></span><br><span class="line">    <span class="keyword">if</span> (interfaces.length &gt; <span class="number">65535</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"interface limit exceeded"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the proxy class defined by the given loader implementing</span></span><br><span class="line">    <span class="comment">// the given interfaces exists, this will simply return the cached copy;</span></span><br><span class="line">    <span class="comment">// otherwise, it will create the proxy class via the ProxyClassFactory</span></span><br><span class="line">    <span class="comment">// 如果缓存中已经存在相应接口的代理类，直接返回，否则，使用ProxyClassFactory创建代理类</span></span><br><span class="line">    <span class="keyword">return</span> proxyClassCache.get(loader, interfaces);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * a cache of proxy classes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> WeakCache&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt;</span><br><span class="line">    proxyClassCache = <span class="keyword">new</span> WeakCache&lt;&gt;(<span class="keyword">new</span> KeyFactory(), <span class="keyword">new</span> ProxyClassFactory());</span><br></pre></td></tr></table></figure>

<p>get()方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key, P parameter)</span> </span>&#123;</span><br><span class="line">       Objects.requireNonNull(parameter);</span><br><span class="line"></span><br><span class="line">       expungeStaleEntries();</span><br><span class="line"></span><br><span class="line">       Object cacheKey = CacheKey.valueOf(key, refQueue);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// lazily install the 2nd level valuesMap for the particular cacheKey</span></span><br><span class="line">       ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey);</span><br><span class="line">       <span class="keyword">if</span> (valuesMap == <span class="keyword">null</span>) &#123;</span><br><span class="line">           ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap</span><br><span class="line">               = map.putIfAbsent(cacheKey,</span><br><span class="line">                                 valuesMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;());</span><br><span class="line">           <span class="keyword">if</span> (oldValuesMap != <span class="keyword">null</span>) &#123;</span><br><span class="line">               valuesMap = oldValuesMap;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// create subKey and retrieve the possible Supplier&lt;V&gt; stored by that</span></span><br><span class="line">       <span class="comment">// subKey from valuesMap</span></span><br><span class="line">       Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter));</span><br><span class="line">       Supplier&lt;V&gt; supplier = valuesMap.get(subKey);</span><br><span class="line">       Factory factory = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (supplier != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="comment">// supplier might be a Factory or a CacheValue&lt;V&gt; instance</span></span><br><span class="line">               V value = supplier.get();</span><br><span class="line">               <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="keyword">return</span> value;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// else no supplier in cache</span></span><br><span class="line">           <span class="comment">// or a supplier that returned null (could be a cleared CacheValue</span></span><br><span class="line">           <span class="comment">// or a Factory that wasn't successful in installing the CacheValue)</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">// lazily construct a Factory</span></span><br><span class="line">           <span class="keyword">if</span> (factory == <span class="keyword">null</span>) &#123;</span><br><span class="line">               factory = <span class="keyword">new</span> Factory(key, parameter, subKey, valuesMap);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (supplier == <span class="keyword">null</span>) &#123;</span><br><span class="line">               supplier = valuesMap.putIfAbsent(subKey, factory);</span><br><span class="line">               <span class="keyword">if</span> (supplier == <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="comment">// successfully installed Factory</span></span><br><span class="line">                   supplier = factory;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">// else retry with winning supplier</span></span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">if</span> (valuesMap.replace(subKey, supplier, factory)) &#123;</span><br><span class="line">                   <span class="comment">// successfully replaced</span></span><br><span class="line">                   <span class="comment">// cleared CacheEntry / unsuccessful Factory</span></span><br><span class="line">                   <span class="comment">// with our Factory</span></span><br><span class="line">                   supplier = factory;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="comment">// retry with current supplier</span></span><br><span class="line">                   supplier = valuesMap.get(subKey);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>在此方法中会调用suppier.get方法，suppier就是Factory,此类定义在WeakCache内部</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="comment">// serialize access</span></span><br><span class="line">           <span class="comment">// re-check</span></span><br><span class="line">           Supplier&lt;V&gt; supplier = valuesMap.get(subKey);</span><br><span class="line">           <span class="keyword">if</span> (supplier != <span class="keyword">this</span>) &#123;</span><br><span class="line">               <span class="comment">// something changed while we were waiting:</span></span><br><span class="line">               <span class="comment">// might be that we were replaced by a CacheValue</span></span><br><span class="line">               <span class="comment">// or were removed because of failure -&gt;</span></span><br><span class="line">               <span class="comment">// return null to signal WeakCache.get() to retry</span></span><br><span class="line">               <span class="comment">// the loop</span></span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// else still us (supplier == this)</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">// create new value</span></span><br><span class="line">           V value = <span class="keyword">null</span>;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               value = Objects.requireNonNull(valueFactory.apply(key, parameter));</span><br><span class="line">           &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123; <span class="comment">// remove us on failure</span></span><br><span class="line">                   valuesMap.remove(subKey, <span class="keyword">this</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// the only path to reach here is with non-null value</span></span><br><span class="line">           <span class="keyword">assert</span> value != <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// wrap value with CacheValue (WeakReference)</span></span><br><span class="line">           CacheValue&lt;V&gt; cacheValue = <span class="keyword">new</span> CacheValue&lt;&gt;(value);</span><br><span class="line"></span><br><span class="line">           <span class="comment">// put into reverseMap</span></span><br><span class="line">           reverseMap.put(cacheValue, Boolean.TRUE);</span><br><span class="line"></span><br><span class="line">           <span class="comment">// try replacing us with CacheValue (this should always succeed)</span></span><br><span class="line">           <span class="keyword">if</span> (!valuesMap.replace(subKey, <span class="keyword">this</span>, cacheValue)) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"Should not reach here"</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// successfully replaced us with new CacheValue -&gt; return the value</span></span><br><span class="line">           <span class="comment">// wrapped by it</span></span><br><span class="line">           <span class="keyword">return</span> value;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>发现在此方法中调用了valueFactory.apply(key, parameter)方法，此对象其实就是Proxy中的ProxyClassFactory，会调用其apply方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> 		<span class="comment">// prefix for all proxy class names</span></span><br><span class="line">		<span class="comment">//代理类的前缀</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String proxyClassNamePrefix = <span class="string">"$Proxy"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// next number to use for generation of unique proxy class names</span></span><br><span class="line">		<span class="comment">//生成代理类名称的计数器</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicLong nextUniqueNumber = <span class="keyword">new</span> AtomicLong(); </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123;</span><br><span class="line"></span><br><span class="line">            Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = <span class="keyword">new</span> IdentityHashMap&lt;&gt;(interfaces.length);</span><br><span class="line">            <span class="keyword">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Verify that the class loader resolves the name of this</span></span><br><span class="line"><span class="comment">                 * interface to the same Class object.</span></span><br><span class="line"><span class="comment">                 * 家安眼泪加载器是否能通接口名称加载该类</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                Class&lt;?&gt; interfaceClass = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    interfaceClass = Class.forName(intf.getName(), <span class="keyword">false</span>, loader);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (interfaceClass != intf) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                        intf + <span class="string">" is not visible from class loader"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Verify that the Class object actually represents an</span></span><br><span class="line"><span class="comment">                 * interface.</span></span><br><span class="line"><span class="comment">                 * 检测该类是否是接口类型</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (!interfaceClass.isInterface()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                        interfaceClass.getName() + <span class="string">" is not an interface"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Verify that this interface is not a duplicate.</span></span><br><span class="line"><span class="comment">                 * 检验接口是否重复</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (interfaceSet.put(interfaceClass, Boolean.TRUE) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                        <span class="string">"repeated interface: "</span> + interfaceClass.getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//代理类包名</span></span><br><span class="line">            String proxyPkg = <span class="keyword">null</span>;     <span class="comment">// package to define proxy class in</span></span><br><span class="line">            <span class="keyword">int</span> accessFlags = Modifier.PUBLIC | Modifier.FINAL;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * Record the package of a non-public proxy interface so that the</span></span><br><span class="line"><span class="comment">             * proxy class will be defined in the same package.  Verify that</span></span><br><span class="line"><span class="comment">             * all non-public proxy interfaces are in the same package.</span></span><br><span class="line"><span class="comment">             * 非public接口，代理类的包名与接口的包名相同</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class="line">                <span class="keyword">int</span> flags = intf.getModifiers();</span><br><span class="line">                <span class="keyword">if</span> (!Modifier.isPublic(flags)) &#123;</span><br><span class="line">                    accessFlags = Modifier.FINAL;</span><br><span class="line">                    String name = intf.getName();</span><br><span class="line">                    <span class="keyword">int</span> n = name.lastIndexOf(<span class="string">'.'</span>);</span><br><span class="line">                    String pkg = ((n == -<span class="number">1</span>) ? <span class="string">""</span> : name.substring(<span class="number">0</span>, n + <span class="number">1</span>));</span><br><span class="line">                    <span class="keyword">if</span> (proxyPkg == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        proxyPkg = pkg;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pkg.equals(proxyPkg)) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                            <span class="string">"non-public interfaces from different packages"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (proxyPkg == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// if no non-public proxy interfaces, use com.sun.proxy package</span></span><br><span class="line">                <span class="comment">// public代理接口，使用com.sun.proxy包名</span></span><br><span class="line">                proxyPkg = ReflectUtil.PROXY_PACKAGE + <span class="string">"."</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * Choose a name for the proxy class to generate.</span></span><br><span class="line"><span class="comment">             * 为代理类生成名字</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">long</span> num = nextUniqueNumber.getAndIncrement();</span><br><span class="line">            String proxyName = proxyPkg + proxyClassNamePrefix + num;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * Generate the specified proxy class.</span></span><br><span class="line"><span class="comment">             * 真正生成代理类的字节码文件的地方</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">byte</span>[] proxyClassFile = ProxyGenerator.generateProxyClass(</span><br><span class="line">                proxyName, interfaces, accessFlags);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//使用类加载器将代理类的字节码文件加载到JVM中</span></span><br><span class="line">                <span class="keyword">return</span> defineClass0(loader, proxyName,</span><br><span class="line">                                    proxyClassFile, <span class="number">0</span>, proxyClassFile.length);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassFormatError e) &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * A ClassFormatError here means that (barring bugs in the</span></span><br><span class="line"><span class="comment">                 * proxy class generation code) there was some other</span></span><br><span class="line"><span class="comment">                 * invalid aspect of the arguments supplied to the proxy</span></span><br><span class="line"><span class="comment">                 * class creation (such as virtual machine limitations</span></span><br><span class="line"><span class="comment">                 * exceeded).</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(e.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>实际生成的方法是generateProxyClass</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] generateProxyClass(<span class="keyword">final</span> String var0, Class&lt;?&gt;[] var1, <span class="keyword">int</span> var2) &#123;</span><br><span class="line">    ProxyGenerator var3 = <span class="keyword">new</span> ProxyGenerator(var0, var1, var2);</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">byte</span>[] var4 = var3.generateClassFile();</span><br><span class="line">    <span class="comment">//将要生成代理类的字节码文件保存在磁盘中</span></span><br><span class="line">    <span class="keyword">if</span> (saveGeneratedFiles) &#123;</span><br><span class="line">        AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">int</span> var1 = var0.lastIndexOf(<span class="number">46</span>);</span><br><span class="line">                    Path var2;</span><br><span class="line">                    <span class="keyword">if</span> (var1 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        Path var3 = Paths.get(var0.substring(<span class="number">0</span>, var1).replace(<span class="string">'.'</span>, File.separatorChar));</span><br><span class="line">                        Files.createDirectories(var3);</span><br><span class="line">                        var2 = var3.resolve(var0.substring(var1 + <span class="number">1</span>, var0.length()) + <span class="string">".class"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        var2 = Paths.get(var0 + <span class="string">".class"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    Files.write(var2, var4, <span class="keyword">new</span> OpenOption[<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException var4x) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(<span class="string">"I/O exception saving generated file: "</span> + var4x);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果想要生成的话可以添加如下参数：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.getProperties().put(<span class="string">"sun.misc.ProxyGenerator.saveGeneratedFiles"</span>, <span class="string">"true"</span>);</span><br></pre></td></tr></table></figure>

<p>生成的代理类的反编译码为：</p>
<p>$Proxy.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.sun.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mashibing.Calculator;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> $<span class="title">Proxy0</span> <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m4;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m5;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m6;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $Proxy0(InvocationHandler var1) <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> var1, <span class="keyword">int</span> var2)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, <span class="keyword">new</span> Object[]&#123;var1, var2&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var4;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var5);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> var1, <span class="keyword">int</span> var2)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m4, <span class="keyword">new</span> Object[]&#123;var1, var2&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var4;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var5);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> var1, <span class="keyword">int</span> var2)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m5, <span class="keyword">new</span> Object[]&#123;var1, var2&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var4;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var5);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> var1, <span class="keyword">int</span> var2)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m6, <span class="keyword">new</span> Object[]&#123;var1, var2&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var4;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var5);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"equals"</span>, Class.forName(<span class="string">"java.lang.Object"</span>));</span><br><span class="line">            m2 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"toString"</span>);</span><br><span class="line">            m3 = Class.forName(<span class="string">"com.mashibing.Calculator"</span>).getMethod(<span class="string">"add"</span>, Integer.TYPE, Integer.TYPE);</span><br><span class="line">            m4 = Class.forName(<span class="string">"com.mashibing.Calculator"</span>).getMethod(<span class="string">"sub"</span>, Integer.TYPE, Integer.TYPE);</span><br><span class="line">            m5 = Class.forName(<span class="string">"com.mashibing.Calculator"</span>).getMethod(<span class="string">"mult"</span>, Integer.TYPE, Integer.TYPE);</span><br><span class="line">            m6 = Class.forName(<span class="string">"com.mashibing.Calculator"</span>).getMethod(<span class="string">"div"</span>, Integer.TYPE, Integer.TYPE);</span><br><span class="line">            m0 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"hashCode"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id><a href="#" class="headerlink" title></a></h1><h3 id="7-2、cglib的动态代理"><a href="#7-2、cglib的动态代理" class="headerlink" title="7.2、cglib的动态代理"></a>7.2、cglib的动态代理</h3><pre><code>CGLIB(Code Generation Library)是一个开源项目！是一个强大的，高性能，高质量的Code生成类库，它可以在运行期扩展Java类与实现Java接口。

CGLIB是一个强大的高性能的代码生成包。它广泛的被许多AOP的框架使用，例如Spring AOP为他们提供方法的interception（拦截）。CGLIB包的底层是通过使用一个小而快的字节码处理框架ASM，来转换字节码并生成新的类。除了CGLIB包，脚本语言例如Groovy和BeanShell，也是使用ASM来生成java的字节码。当然不鼓励直接使用ASM，因为它要求你必须对JVM内部结构包括class文件的格式和指令集都很熟悉。</code></pre><p><strong>操作代码：</strong></p>
<p>MyCalculator.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.cglib;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i + j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i - j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i * j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = i / j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyCglib.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.cglib;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCglib</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Object o1 = methodProxy.invokeSuper(o, objects);</span><br><span class="line">        <span class="keyword">return</span> o1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.cglib;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.core.DebuggingClassWriter;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//动态代理创建的class文件存储到本地</span></span><br><span class="line">        System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY,<span class="string">"d:\\code"</span>);</span><br><span class="line">        <span class="comment">//通过cglib动态代理获取代理对象的过程，创建调用的对象</span></span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">//设置enhancer对象的父类</span></span><br><span class="line">        enhancer.setSuperclass(MyCalculator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//设置enhancer的回调对象</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> MyCglib());</span><br><span class="line">        <span class="comment">//创建代理对象</span></span><br><span class="line">        MyCalculator myCalculator = (MyCalculator) enhancer.create();</span><br><span class="line">        <span class="comment">//通过代理对象调用目标方法</span></span><br><span class="line">        myCalculator.add(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        System.out.println(myCalculator.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现原理：</p>
<pre><code>利用cglib实现动态代理的时候，必须要实现MethodInterceptor接口，此接口源码如下：</code></pre><p>MethodInterceptor.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sf.cglib.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MethodInterceptor</span></span></span><br><span class="line"><span class="class"><span class="keyword">extends</span> <span class="title">Callback</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> 	<span class="comment">/*</span></span><br><span class="line"><span class="comment"> 	此方法用来实现方法的拦截，四个参数分别表示的含义：</span></span><br><span class="line"><span class="comment"> 	obj:表示增强的对象，即实现这个接口类的一个对象</span></span><br><span class="line"><span class="comment"> 	method：表示要拦截的方法</span></span><br><span class="line"><span class="comment"> 	args：表示被拦截的方法的参数</span></span><br><span class="line"><span class="comment"> 	proxy:表示要触发父类的方法对象</span></span><br><span class="line"><span class="comment"> 	*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, java.lang.reflect.Method method, Object[] args,</span></span></span><br><span class="line"><span class="function"><span class="params">                               MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>在我们的测试类中，大家发现了，我们创建了一个cglib的Enhancer对象，并且设置了父类、回调函数等参数，最重要的入口函数是create()方法：</code></pre><h4 id="1、Enhancer-create"><a href="#1、Enhancer-create" class="headerlink" title="1、Enhancer.create()"></a>1、Enhancer.create()</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generate a new class if necessary and uses the specified</span></span><br><span class="line"><span class="comment"> * callbacks (if any) to create a new object instance.</span></span><br><span class="line"><span class="comment"> * Uses the no-arg constructor of the superclass.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a new instance</span></span><br><span class="line"><span class="comment"> * 如果必须要创建一个新类，那么就用指定的回调对象创建一个新的对象实例，使用的父类的参数的构造方法来实	 * 例化父类的部分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//不作代理类限制</span></span><br><span class="line">    classOnly = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//没有构造参数类型</span></span><br><span class="line">    argumentTypes = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//执行创建</span></span><br><span class="line">    <span class="keyword">return</span> createHelper();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、Enhancer-createHelper"><a href="#2、Enhancer-createHelper" class="headerlink" title="2、Enhancer.createHelper()"></a>2、Enhancer.createHelper()</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">createHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//校验callbackTypes、filter是否为空，以及为空时的处理</span></span><br><span class="line">       preValidate();</span><br><span class="line">    	<span class="comment">// 通过newInstance方法来创建EnhancerKey对象</span></span><br><span class="line">       Object key = KEY_FACTORY.newInstance((superclass != <span class="keyword">null</span>) ? superclass.getName() : <span class="keyword">null</span>,</span><br><span class="line">               ReflectUtils.getNames(interfaces),</span><br><span class="line">               filter == ALL_ZERO ? <span class="keyword">null</span> : <span class="keyword">new</span> WeakCacheKey&lt;CallbackFilter&gt;(filter),</span><br><span class="line">               callbackTypes,</span><br><span class="line">               useFactory,</span><br><span class="line">               interceptDuringConstruction,</span><br><span class="line">               serialVersionUID);</span><br><span class="line">    	<span class="comment">// 设置当前enhancer的代理类的key标识</span></span><br><span class="line">       <span class="keyword">this</span>.currentKey = key;</span><br><span class="line">    	<span class="comment">// 调用父类即AbstractClassGenerator的创建代理类</span></span><br><span class="line">       Object result = <span class="keyword">super</span>.create(key);</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>preValidate()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">preValidate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (callbackTypes == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//确定传入的callback类型</span></span><br><span class="line">            callbackTypes = CallbackInfo.determineTypes(callbacks, <span class="keyword">false</span>);</span><br><span class="line">            validateCallbackTypes = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (filter == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (callbackTypes.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Multiple callback types possible but no filter specified"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            filter = ALL_ZERO;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CallbackInfo[] CALLBACKS = &#123;</span><br><span class="line">        <span class="keyword">new</span> CallbackInfo(NoOp<span class="class">.<span class="keyword">class</span>, <span class="title">NoOpGenerator</span>.<span class="title">INSTANCE</span>),</span></span><br><span class="line"><span class="class">        <span class="title">new</span> <span class="title">CallbackInfo</span>(<span class="title">MethodInterceptor</span>.<span class="title">class</span>, <span class="title">MethodInterceptorGenerator</span>.<span class="title">INSTANCE</span>),</span></span><br><span class="line"><span class="class">        <span class="title">new</span> <span class="title">CallbackInfo</span>(<span class="title">InvocationHandler</span>.<span class="title">class</span>, <span class="title">InvocationHandlerGenerator</span>.<span class="title">INSTANCE</span>),</span></span><br><span class="line"><span class="class">        <span class="title">new</span> <span class="title">CallbackInfo</span>(<span class="title">LazyLoader</span>.<span class="title">class</span>, <span class="title">LazyLoaderGenerator</span>.<span class="title">INSTANCE</span>),</span></span><br><span class="line"><span class="class">        <span class="title">new</span> <span class="title">CallbackInfo</span>(<span class="title">Dispatcher</span>.<span class="title">class</span>, <span class="title">DispatcherGenerator</span>.<span class="title">INSTANCE</span>),</span></span><br><span class="line"><span class="class">        <span class="title">new</span> <span class="title">CallbackInfo</span>(<span class="title">FixedValue</span>.<span class="title">class</span>, <span class="title">FixedValueGenerator</span>.<span class="title">INSTANCE</span>),</span></span><br><span class="line"><span class="class">        <span class="title">new</span> <span class="title">CallbackInfo</span>(<span class="title">ProxyRefDispatcher</span>.<span class="title">class</span>, <span class="title">DispatcherGenerator</span>.<span class="title">PROXY_REF_INSTANCE</span>),</span></span><br><span class="line"><span class="class">    &#125;</span>;</span><br></pre></td></tr></table></figure>

<pre><code>该方法主要是做验证并确定CallBack类型，我们使用的是MethodInterceptor,然后创建当前代理类的标识代理类，用这个标识代理类调用（AbstractClassGenerator）的create(key)方法创建，下面我们开始分析标识代理类创建逻辑 以及后面父类创建我们需要的代理类的逻辑。

标识代理类的创建类成员变量即KEY_FACTORY是创建代理类的核心</code></pre><h4 id="3、标识代理类"><a href="#3、标识代理类" class="headerlink" title="3、标识代理类"></a>3、标识代理类</h4><h5 id="1、KEY-FACTORY"><a href="#1、KEY-FACTORY" class="headerlink" title="1、KEY_FACTORY"></a>1、KEY_FACTORY</h5><pre><code>追踪源码可以看到，KEY_FACTORY在Enhancer的初始化即会创建一个final的静态变量</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EnhancerKey KEY_FACTORY =</span><br><span class="line">  (EnhancerKey)KeyFactory.create(EnhancerKey<span class="class">.<span class="keyword">class</span>, <span class="title">KeyFactory</span>.<span class="title">HASH_ASM_TYPE</span>, <span class="title">null</span>)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="2、Keyfactory-create方法"><a href="#2、Keyfactory-create方法" class="headerlink" title="2、Keyfactory_create方法"></a>2、Keyfactory_create方法</h5><p>　    这儿可以看到使用key工厂创建出对应class的代理类，后面的KeyFactory_HASH_ASM_TYPE即代理类中创建HashCode方法的策略。我们接着点击源码查看</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> KeyFactory <span class="title">create</span><span class="params">(ClassLoader loader, Class keyInterface, KeyFactoryCustomizer customizer,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    List&lt;KeyFactoryCustomizer&gt; next)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个最简易的代理类生成器 即只会生成HashCode equals toString newInstance方法</span></span><br><span class="line">        Generator gen = <span class="keyword">new</span> Generator();</span><br><span class="line">        <span class="comment">//设置接口为enhancerKey类型</span></span><br><span class="line">        gen.setInterface(keyInterface);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customizer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//添加定制器</span></span><br><span class="line">            gen.addCustomizer(customizer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (next != <span class="keyword">null</span> &amp;&amp; !next.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (KeyFactoryCustomizer keyFactoryCustomizer : next) &#123;</span><br><span class="line">                <span class="comment">//添加定制器</span></span><br><span class="line">                gen.addCustomizer(keyFactoryCustomizer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//设置生成器的类加载器</span></span><br><span class="line">        gen.setClassLoader(loader);</span><br><span class="line">        <span class="comment">//生成enhancerKey的代理类</span></span><br><span class="line">        <span class="keyword">return</span> gen.create();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="3、Generator的create方法"><a href="#3、Generator的create方法" class="headerlink" title="3、Generator的create方法"></a>3、Generator的create方法</h5><p>　　这儿创建了一个简易的代理类生成器(KeyFactory的内部类Generator ，与Enhancer一样继承自抽象类AbstractClassGenerator)来生成我们需要的标识代理类，我们接着看gen.create()方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> KeyFactory <span class="title">create</span><span class="params">()</span> </span>&#123;　　　　　　　　</span><br><span class="line">    <span class="comment">//设置了该生成器生成代理类的名字前缀，即我们的接口名Enhancer.enhancerKey</span></span><br><span class="line">            setNamePrefix(keyInterface.getName());</span><br><span class="line">            <span class="keyword">return</span> (KeyFactory)<span class="keyword">super</span>.create(keyInterface.getName());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h5 id="4、AbstractClassGenerator的create-Key-方法"><a href="#4、AbstractClassGenerator的create-Key-方法" class="headerlink" title="4、AbstractClassGenerator的create(Key)方法"></a>4、AbstractClassGenerator的create(Key)方法</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">create</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取到当前生成器的类加载器</span></span><br><span class="line">            ClassLoader loader = getClassLoader();</span><br><span class="line">            <span class="comment">//当前类加载器对应的缓存  缓存key为类加载器，缓存的value为ClassLoaderData  这个类后面会再讲</span></span><br><span class="line">            Map&lt;ClassLoader, ClassLoaderData&gt; cache = CACHE;</span><br><span class="line">            <span class="comment">//先从缓存中获取下当前类加载器所有加载过的类</span></span><br><span class="line">            ClassLoaderData data = cache.get(loader);</span><br><span class="line">            <span class="comment">//如果为空</span></span><br><span class="line">            <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (AbstractClassGenerator<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                    cache = CACHE;</span><br><span class="line">                    data = cache.get(loader);</span><br><span class="line">                    <span class="comment">//经典的防止并发修改 二次判断</span></span><br><span class="line">                    <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">//新建一个缓存Cache  并将之前的缓存Cache的数据添加进来 并将已经被gc回收的数据给清除掉</span></span><br><span class="line">                        Map&lt;ClassLoader, ClassLoaderData&gt; newCache = <span class="keyword">new</span> WeakHashMap&lt;ClassLoader, ClassLoaderData&gt;(cache);</span><br><span class="line">                        <span class="comment">//新建一个当前加载器对应的ClassLoaderData 并加到缓存中  但ClassLoaderData中此时还没有数据</span></span><br><span class="line">                        data = <span class="keyword">new</span> ClassLoaderData(loader);</span><br><span class="line">                        newCache.put(loader, data);</span><br><span class="line">                        <span class="comment">//刷新全局缓存</span></span><br><span class="line">                        CACHE = newCache;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//设置一个全局key </span></span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//在刚创建的data(ClassLoaderData)中调用get方法 并将当前生成器，</span></span><br><span class="line">            <span class="comment">//以及是否使用缓存的标识穿进去 系统参数 System.getProperty("cglib.useCache", "true")  </span></span><br><span class="line">            <span class="comment">//返回的是生成好的代理类的class信息</span></span><br><span class="line">            Object obj = data.get(<span class="keyword">this</span>, getUseCache());</span><br><span class="line">            <span class="comment">//如果为class则实例化class并返回  就是我们需要的代理类</span></span><br><span class="line">            <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Class) &#123;</span><br><span class="line">                <span class="keyword">return</span> firstInstance((Class) obj);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果不是则说明是实体  则直接执行另一个方法返回实体</span></span><br><span class="line">            <span class="keyword">return</span> nextInstance(obj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Error e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CodeGenerationException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<pre><code>这个方法可以看到主要为根据类加载器定义一个缓存，里面装载了缓存的类信息，然后调用这个ClassLoaderData的get方法获取到数据，如果为class信息 那么直接使用反射实例化，如果返回的是实体类，则解析实体类的信息，调用其newInstance方法重新生成一个实例(cglib的代理类都会生成newInstance方法)</code></pre><h5 id="5、data-get-this-getUseCache"><a href="#5、data-get-this-getUseCache" class="headerlink" title="5、data.get(this,getUseCache)"></a>5、data.get(this,getUseCache)</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(AbstractClassGenerator gen, <span class="keyword">boolean</span> useCache)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//如果不用缓存  (默认使用)</span></span><br><span class="line">            <span class="keyword">if</span> (!useCache) &#123;</span><br><span class="line">                <span class="comment">//则直接调用生成器的命令</span></span><br><span class="line">              <span class="keyword">return</span> gen.generate(ClassLoaderData.<span class="keyword">this</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//从缓存中获取值</span></span><br><span class="line">              Object cachedValue = generatedClasses.get(gen);</span><br><span class="line">              <span class="comment">//解包装并返回</span></span><br><span class="line">              <span class="keyword">return</span> gen.unwrapCachedValue(cachedValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<pre><code>如果可以用缓存则调用缓存，不能调用缓存则直接生成， 这儿我们先看调用缓存的，在之前的步骤中，我们设置了一个key为ClassLoader，值为ClassLoaderData的缓存，这儿我们new了一个ClassLoaderData 并将类加载器传了进去 ，并且设置了这个Generator的key，我们看下new的逻辑</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassLoaderData</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//判断类加载器不能为空 </span></span><br><span class="line">            <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"classLoader == null is not yet supported"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//设置类加载器   弱引用 即在下次垃圾回收时就会进行回收</span></span><br><span class="line">            <span class="keyword">this</span>.classLoader = <span class="keyword">new</span> WeakReference&lt;ClassLoader&gt;(classLoader);</span><br><span class="line">            <span class="comment">//新建一个回调函数  这个回调函数的作用在于缓存中没获取到值时  调用传入的生成的生成代理类并返回</span></span><br><span class="line">            Function&lt;AbstractClassGenerator, Object&gt; load =</span><br><span class="line">                    <span class="keyword">new</span> Function&lt;AbstractClassGenerator, Object&gt;() &#123;</span><br><span class="line">                        <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">(AbstractClassGenerator gen)</span> </span>&#123;</span><br><span class="line">                            Class klass = gen.generate(ClassLoaderData.<span class="keyword">this</span>);</span><br><span class="line">                            <span class="keyword">return</span> gen.wrapCachedClass(klass);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">            <span class="comment">//为这个ClassLoadData新建一个缓存类   这个loadingcache稍后会讲        </span></span><br><span class="line">            generatedClasses = <span class="keyword">new</span> LoadingCache&lt;AbstractClassGenerator, Object, Object&gt;(GET_KEY, load);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Function&lt;AbstractClassGenerator, Object&gt; GET_KEY = <span class="keyword">new</span> Function&lt;AbstractClassGenerator, Object&gt;() &#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">(AbstractClassGenerator gen)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> gen.key;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<pre><code>可以看到每个类加载器都对应着一个代理类缓存对象 ，这里面定义了类加载器，缓存调用没查询到的调用函数，以及新建了一个LoadingCache来缓存这个类加载器对应的缓存，这儿传入的两个参数，load代表缓存查询失败时的回调函数，而GET_KEY则是回调时获取调用生成器的key 即4中传入的key 也即是我们的代理类标识符。 然后我们接着看generatedClasses.get(gen);的方法</code></pre><h5 id="6、generatedClasses-get-gen"><a href="#6、generatedClasses-get-gen" class="headerlink" title="6、generatedClasses.get(gen);"></a>6、generatedClasses.get(gen);</h5><pre><code>这个方法主要传入代理类生成器 并根据代理类生成器获取值返回。这儿主要涉及到的类就是LoadingCache，这个类可以看做是某个CLassLoader对应的所有代理类缓存库，是真正缓存东西的地方。我们分析下这个类</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sf.cglib.core.internal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadingCache</span>&lt;<span class="title">K</span>, <span class="title">KK</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> ConcurrentMap&lt;KK, Object&gt; map;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Function&lt;K, V&gt; loader;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Function&lt;K, KK&gt; keyMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Function IDENTITY = <span class="keyword">new</span> Function() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//初始化类  kemapper代表获取某个代理类生成器的标识，loader即缓存查找失败后的回调函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoadingCache</span><span class="params">(Function&lt;K, KK&gt; keyMapper, Function&lt;K, V&gt; loader)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.keyMapper = keyMapper;</span><br><span class="line">        <span class="keyword">this</span>.loader = loader;</span><br><span class="line">        <span class="comment">//这个map是缓存代理类的地方</span></span><br><span class="line">        <span class="keyword">this</span>.map = <span class="keyword">new</span> ConcurrentHashMap&lt;KK, Object&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;K&gt; <span class="function">Function&lt;K, K&gt; <span class="title">identity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> IDENTITY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这儿key是代理类生成器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取到代理类生成器的标识</span></span><br><span class="line">        <span class="keyword">final</span> KK cacheKey = keyMapper.apply(key);</span><br><span class="line">        <span class="comment">//根据缓代理类生成器的标识获取代理类</span></span><br><span class="line">        Object v = map.get(cacheKey);</span><br><span class="line">        <span class="comment">//如果结果不为空且不是FutureTask 即线程池中用于获取返回结果的接口</span></span><br><span class="line">        <span class="keyword">if</span> (v != <span class="keyword">null</span> &amp;&amp; !(v <span class="keyword">instanceof</span> FutureTask)) &#123;</span><br><span class="line">            <span class="comment">//直接返回</span></span><br><span class="line">            <span class="keyword">return</span> (V) v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则就是没查询到  或者还未处理完</span></span><br><span class="line">        <span class="keyword">return</span> createEntry(key, cacheKey, v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> V <span class="title">createEntry</span><span class="params">(<span class="keyword">final</span> K key, KK cacheKey, Object v)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//初始化任务task</span></span><br><span class="line">        FutureTask&lt;V&gt; task;</span><br><span class="line">        <span class="comment">//初始化创建标识</span></span><br><span class="line">        <span class="keyword">boolean</span> creator = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (v != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 则说明这是一个FutureTask </span></span><br><span class="line">            task = (FutureTask&lt;V&gt;) v;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//否则还没开始创建这个代理类  直接创建任务  </span></span><br><span class="line">            task = <span class="keyword">new</span> FutureTask&lt;V&gt;(<span class="keyword">new</span> Callable&lt;V&gt;() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    <span class="comment">//这儿会直接调用生成器的generate方法</span></span><br><span class="line">                    <span class="keyword">return</span> loader.apply(key);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//将这个任务推入缓存Map  如果对应key已经有则返回已经有的task，</span></span><br><span class="line">            Object prevTask = map.putIfAbsent(cacheKey, task);</span><br><span class="line">            <span class="comment">//如果为null则代表还没有创建  标识更新为true 且运行这个任务</span></span><br><span class="line">            <span class="keyword">if</span> (prevTask == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// creator does the load</span></span><br><span class="line">                creator = <span class="keyword">true</span>;</span><br><span class="line">                task.run();</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">//如果是task  说明另一个线程已经创建了task</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (prevTask <span class="keyword">instanceof</span> FutureTask) &#123;</span><br><span class="line">                task = (FutureTask&lt;V&gt;) prevTask;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">//到这儿说明另一个线程已经执行完了  直接返回</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> (V) prevTask;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//上面的一堆判断主要是为了防止并发出现的问题</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        V result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//到这儿说明任务执行完并拿到对应的代理类了</span></span><br><span class="line">            result = task.get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Interrupted while loading cache item"</span>, e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            Throwable cause = e.getCause();</span><br><span class="line">            <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">                <span class="keyword">throw</span> ((RuntimeException) cause);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unable to load cache item"</span>, cause);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果这次执行是新建的</span></span><br><span class="line">        <span class="keyword">if</span> (creator) &#123;</span><br><span class="line">            <span class="comment">//将之前的FutureTask缓存直接覆盖为实际的代理类信息</span></span><br><span class="line">            map.put(cacheKey, result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回结果</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　通过上面的分析可以得知，这个类主要作用是传入代理类生成器，根据这个代理类生成器以及代理类生成器的key来获取缓存，如果没有获取到则构建一个FutureTask来回调我们之前初始化时传入的 回调函数，并调用其中的apply方法，而具体调用的则是我们传入的代理类生成器的generate(LoadClassData)方法，将返回值覆盖之前的FutureTask成为真正的缓存。所以这个类的主要作用还是缓存。 这样则和5中不使用缓存时调用了一样的方法。所以我们接着来分析生成方法 generate(ClassLoadData),这儿因为我们使用的代理类生成器是Genrator，该类没有重写generate方法，所以回到了父类AbstractClassGenerator的generate方法</p>
<h5 id="7、AbstractClassGenerator-generate-方法"><a href="#7、AbstractClassGenerator-generate-方法" class="headerlink" title="7、AbstractClassGenerator.generate 方法"></a>7、AbstractClassGenerator.generate 方法</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Class <span class="title">generate</span><span class="params">(ClassLoaderData data)</span> </span>&#123;</span><br><span class="line">        Class gen;</span><br><span class="line">        Object save = CURRENT.get();</span><br><span class="line">        <span class="comment">//当前的代理类生成器存入ThreadLocal中</span></span><br><span class="line">        CURRENT.set(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取到ClassLoader</span></span><br><span class="line">            ClassLoader classLoader = data.getClassLoader();</span><br><span class="line">            <span class="comment">//判断不能为空</span></span><br><span class="line">            <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"ClassLoader is null while trying to define class "</span> +</span><br><span class="line">                        getClassName() + <span class="string">". It seems that the loader has been expired from a weak reference somehow. "</span> +</span><br><span class="line">                        <span class="string">"Please file an issue at cglib's issue tracker."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (classLoader) &#123;</span><br><span class="line">             <span class="comment">//生成代理类名字</span></span><br><span class="line">              String name = generateClassName(data.getUniqueNamePredicate()); </span><br><span class="line">             <span class="comment">//缓存中存入这个名字</span></span><br><span class="line">              data.reserveName(name);</span><br><span class="line">              <span class="comment">//当前代理类生成器设置类名</span></span><br><span class="line">              <span class="keyword">this</span>.setClassName(name);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//尝试从缓存中获取类</span></span><br><span class="line">            <span class="keyword">if</span> (attemptLoad) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//要是能获取到就直接返回了  即可能出现并发 其他线程已经加载</span></span><br><span class="line">                    gen = classLoader.loadClass(getClassName());</span><br><span class="line">                    <span class="keyword">return</span> gen;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    <span class="comment">// 发现异常说明没加载到 不管了</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//生成字节码</span></span><br><span class="line">            <span class="keyword">byte</span>[] b = strategy.generate(<span class="keyword">this</span>);</span><br><span class="line">            <span class="comment">//获取到字节码代表的class的名字</span></span><br><span class="line">            String className = ClassNameReader.getClassName(<span class="keyword">new</span> ClassReader(b));</span><br><span class="line">            <span class="comment">//核实是否为protect</span></span><br><span class="line">            ProtectionDomain protectionDomain = getProtectionDomain();</span><br><span class="line">            <span class="keyword">synchronized</span> (classLoader) &#123; <span class="comment">// just in case</span></span><br><span class="line">                <span class="comment">//如果不是protect</span></span><br><span class="line">                <span class="keyword">if</span> (protectionDomain == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//根据字节码 类加载器 以及类名字  将class加载到内存中</span></span><br><span class="line">                    gen = ReflectUtils.defineClass(className, b, classLoader);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//根据字节码 类加载器 以及类名字 以及找到的Protect级别的实体 将class加载到内存中</span></span><br><span class="line">                    gen = ReflectUtils.defineClass(className, b, classLoader, protectionDomain);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">　　　　　　　 <span class="comment">//返回生成的class信息</span></span><br><span class="line">            <span class="keyword">return</span> gen;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Error e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CodeGenerationException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            CURRENT.set(save);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<pre><code>这个方法主要设置了下当前类生成器的类名，然后调用stratege的generate方法返回字节码，根据字节码 类名 类加载器将字节码所代表的类加载到内存中，这个功能看一下大概就懂，我们接下来主要分析字节码生成方法</code></pre><h5 id="8、DefaultGeneratorStrategy-generate-ClassGenerator-cg"><a href="#8、DefaultGeneratorStrategy-generate-ClassGenerator-cg" class="headerlink" title="8、DefaultGeneratorStrategy.generate(ClassGenerator cg)"></a>8、DefaultGeneratorStrategy.generate(ClassGenerator cg)</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] generate(ClassGenerator cg) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//创建一个写入器</span></span><br><span class="line">        DebuggingClassWriter cw = getClassVisitor();</span><br><span class="line">        <span class="comment">//加入自己的转换逻辑后执行代理类生成器的generateClass方法</span></span><br><span class="line">        transform(cg).generateClass(cw);</span><br><span class="line">        <span class="comment">//将cw写入的东西转换为byte数组返回</span></span><br><span class="line">        <span class="keyword">return</span> transform(cw.toByteArray());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<pre><code>这里面主要是新建一个写入器，然后执行我们代理类生成器的generateClass方法将class信息写入这个ClassWriter 最后将里面的东西转换为byte数组返回，所以又回到了我们的代理类生成器的generateClass方法，这儿进入的是Generator的generateClass方法</code></pre><h5 id="9、Generator-generateClass（ClassVisitor-v）"><a href="#9、Generator-generateClass（ClassVisitor-v）" class="headerlink" title="9、Generator.generateClass（ClassVisitor v）"></a>9、Generator.generateClass（ClassVisitor v）</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//该方法为字节码写入方法 为最后一步</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateClass</span><span class="params">(ClassVisitor v)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//创建类写入聚合对象</span></span><br><span class="line">            ClassEmitter ce = <span class="keyword">new</span> ClassEmitter(v);</span><br><span class="line">            <span class="comment">//找到被代理类的newInstance方法 如果没有会报异常  由此可知 如果想用Generator代理类生成器  必须要有newInstance方法</span></span><br><span class="line">            Method newInstance = ReflectUtils.findNewInstance(keyInterface);</span><br><span class="line">            <span class="comment">//如果被代理类的newInstance不为Object则报异常  此处我们代理的Enchaer.EnhancerKey newInstance方法返回值为Object</span></span><br><span class="line">            <span class="keyword">if</span> (!newInstance.getReturnType().equals(Object<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"newInstance method must return Object"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//找到newInstance方法的所有参数类型 并当做成员变量 </span></span><br><span class="line">            Type[] parameterTypes = TypeUtils.getTypes(newInstance.getParameterTypes());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//1.创建类开始写入类头   版本号  访问权限  类名等通用信息</span></span><br><span class="line">            ce.begin_class(Constants.V1_8,</span><br><span class="line">                           Constants.ACC_PUBLIC,</span><br><span class="line">                           getClassName(), </span><br><span class="line">                           KEY_FACTORY,</span><br><span class="line">                           <span class="keyword">new</span> Type[]&#123; Type.getType(keyInterface) &#125;,</span><br><span class="line">                           Constants.SOURCE_FILE);</span><br><span class="line">            <span class="comment">//2.写入无参构造方法               </span></span><br><span class="line">            EmitUtils.null_constructor(ce);</span><br><span class="line">            <span class="comment">//3.写入newInstance方法</span></span><br><span class="line">            EmitUtils.factory_method(ce, ReflectUtils.getSignature(newInstance));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">int</span> seed = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">//4.开始构造 有参构造方法</span></span><br><span class="line">            CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC,</span><br><span class="line">                                            TypeUtils.parseConstructor(parameterTypes),</span><br><span class="line">                                            <span class="keyword">null</span>);</span><br><span class="line">            e.load_this();</span><br><span class="line">            <span class="comment">//4.1有参构造中调用父类构造方法  即super.构造方法() </span></span><br><span class="line">            e.super_invoke_constructor();</span><br><span class="line">            e.load_this();</span><br><span class="line">            <span class="comment">//4.2找到传入的定制器 例如一开始传入的hashCode方法定制器</span></span><br><span class="line">            List&lt;FieldTypeCustomizer&gt; fieldTypeCustomizers = getCustomizers(FieldTypeCustomizer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="comment">//4.3遍历成员变量即newInstance方法的所有参数</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameterTypes.length; i++) &#123;</span><br><span class="line">                Type parameterType = parameterTypes[i];</span><br><span class="line">                Type fieldType = parameterType;</span><br><span class="line">                <span class="keyword">for</span> (FieldTypeCustomizer customizer : fieldTypeCustomizers) &#123;</span><br><span class="line">                    fieldType = customizer.getOutType(i, fieldType);</span><br><span class="line">                &#125;</span><br><span class="line">                seed += fieldType.hashCode();</span><br><span class="line">                <span class="comment">//4.3将这些参数全部声明到写入类中</span></span><br><span class="line">                ce.declare_field(Constants.ACC_PRIVATE | Constants.ACC_FINAL,</span><br><span class="line">                                 getFieldName(i),</span><br><span class="line">                                 fieldType,</span><br><span class="line">                                 <span class="keyword">null</span>);</span><br><span class="line">                e.dup();</span><br><span class="line">                e.load_arg(i);</span><br><span class="line">                <span class="keyword">for</span> (FieldTypeCustomizer customizer : fieldTypeCustomizers) &#123;</span><br><span class="line">                    customizer.customize(e, i, parameterType);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//4.4设置每个成员变量的值  即我们常见的有参构造中的this.xx = xx</span></span><br><span class="line">                e.putfield(getFieldName(i));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//设置返回值</span></span><br><span class="line">            e.return_value();</span><br><span class="line">            <span class="comment">//有参构造及成员变量写入完成</span></span><br><span class="line">            e.end_method();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/*************************到此已经在class中写入了成员变量  写入实现了newInstance方法  写入无参构造  写入了有参构造 *************************/</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5.写入hashcode方法</span></span><br><span class="line">            e = ce.begin_method(Constants.ACC_PUBLIC, HASH_CODE, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">int</span> hc = (constant != <span class="number">0</span>) ? constant : PRIMES[(<span class="keyword">int</span>)(Math.abs(seed) % PRIMES.length)];</span><br><span class="line">            <span class="keyword">int</span> hm = (multiplier != <span class="number">0</span>) ? multiplier : PRIMES[(<span class="keyword">int</span>)(Math.abs(seed * <span class="number">13</span>) % PRIMES.length)];</span><br><span class="line">            e.push(hc);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameterTypes.length; i++) &#123;</span><br><span class="line">                e.load_this();</span><br><span class="line">                e.getfield(getFieldName(i));</span><br><span class="line">                EmitUtils.hash_code(e, parameterTypes[i], hm, customizers);</span><br><span class="line">            &#125;</span><br><span class="line">            e.return_value();</span><br><span class="line">            <span class="comment">//hashcode方法结束</span></span><br><span class="line">            e.end_method();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6.写入equals方法</span></span><br><span class="line">            e = ce.begin_method(Constants.ACC_PUBLIC, EQUALS, <span class="keyword">null</span>);</span><br><span class="line">            Label fail = e.make_label();</span><br><span class="line">            e.load_arg(<span class="number">0</span>);</span><br><span class="line">            e.instance_of_this();</span><br><span class="line">            e.if_jump(e.EQ, fail);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameterTypes.length; i++) &#123;</span><br><span class="line">                e.load_this();</span><br><span class="line">                e.getfield(getFieldName(i));</span><br><span class="line">                e.load_arg(<span class="number">0</span>);</span><br><span class="line">                e.checkcast_this();</span><br><span class="line">                e.getfield(getFieldName(i));</span><br><span class="line">                EmitUtils.not_equals(e, parameterTypes[i], fail, customizers);</span><br><span class="line">            &#125;</span><br><span class="line">            e.push(<span class="number">1</span>);</span><br><span class="line">            e.return_value();</span><br><span class="line">            e.mark(fail);</span><br><span class="line">            e.push(<span class="number">0</span>);</span><br><span class="line">            e.return_value();</span><br><span class="line">            <span class="comment">//equals方法结束</span></span><br><span class="line">            e.end_method();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7.写入toString方法</span></span><br><span class="line">            e = ce.begin_method(Constants.ACC_PUBLIC, TO_STRING, <span class="keyword">null</span>);</span><br><span class="line">            e.new_instance(Constants.TYPE_STRING_BUFFER);</span><br><span class="line">            e.dup();</span><br><span class="line">            e.invoke_constructor(Constants.TYPE_STRING_BUFFER);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameterTypes.length; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    e.push(<span class="string">", "</span>);</span><br><span class="line">                    e.invoke_virtual(Constants.TYPE_STRING_BUFFER, APPEND_STRING);</span><br><span class="line">                &#125;</span><br><span class="line">                e.load_this();</span><br><span class="line">                e.getfield(getFieldName(i));</span><br><span class="line">                EmitUtils.append_string(e, parameterTypes[i], EmitUtils.DEFAULT_DELIMITERS, customizers);</span><br><span class="line">            &#125;</span><br><span class="line">            e.invoke_virtual(Constants.TYPE_STRING_BUFFER, TO_STRING);</span><br><span class="line">            e.return_value();</span><br><span class="line">            <span class="comment">//toString方法结束</span></span><br><span class="line">            e.end_method();</span><br><span class="line">            <span class="comment">//类写入结束  至此类信息收集完成 并全部写入ClassVisitor</span></span><br><span class="line">            ce.end_class();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<pre><code>这个方法主要将一个完整的类信息写入ClassVisitor中，例如目前实现的Enhancer.EnhancerKey代理，即实现了newInstance方法， 重写了HashCode,toSting,equals方法，并将newInstance的所有参数作为了成员变量，这儿我们也可以看下具体实现newInstance方法的逻辑 即这个代码 EmitUtils.factory_method(ce, ReflectUtils.getSignature(newInstance)); 如果有兴趣可以去研究asm字节码写入的操作</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">factory_method</span><span class="params">(ClassEmitter ce, Signature sig)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//开始写入方法</span></span><br><span class="line">        CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC, sig, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//写入 一个创建对象命令  即new命令</span></span><br><span class="line">        e.new_instance_this();</span><br><span class="line">        e.dup();</span><br><span class="line">        <span class="comment">//加载参数命令</span></span><br><span class="line">        e.load_args();</span><br><span class="line">        <span class="comment">//执行该类的有参构造命令</span></span><br><span class="line">        e.invoke_constructor_this(TypeUtils.parseConstructor(sig.getArgumentTypes()));</span><br><span class="line">        <span class="comment">//将上面指令执行的值返回</span></span><br><span class="line">        e.return_value();</span><br><span class="line">        <span class="comment">//结束写入方法</span></span><br><span class="line">        e.end_method();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<pre><code>可以得知 我们通过Generator创建的代理类大致内容应该如下，Enhancer.EhancerKey代理类字节码的class内容应该是把参数换为newInstance中的参数</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnhancerKeyProxy</span> <span class="keyword">extends</span> <span class="title">xxx</span> <span class="keyword">implements</span> <span class="title">xxx</span></span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> paramA;</span><br><span class="line"> <span class="keyword">private</span> paramB;</span><br><span class="line"> <span class="keyword">private</span> paramC;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">EnhancerKeyProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">super</span>.xxx();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">EnhancerKeyProxy</span><span class="params">(paramA, paramB,paramC)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.xxx();</span><br><span class="line">       <span class="keyword">this</span>.paramA = paramA</span><br><span class="line">       <span class="keyword">this</span>.paramB = paramB</span><br><span class="line">       <span class="keyword">this</span>.paramC = paramC</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(paramA,paramB,paramC)</span></span>&#123;</span><br><span class="line">        EnhancerKeyProxy param = <span class="keyword">new</span> EnhancerKeyProxy(o);</span><br><span class="line">        <span class="keyword">return</span> param;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>最后执行传入的ClassVisitor 即我们传入的实例DebuggingClassWriter的toByteArray即可以将写入的内容转换为byte[]返回

至此 我们的成功的生成了Enhancer.EnhancerKey的代理类，也就是我们需要的代理类标识类 用来标识被代理的类，这个代理类主要用来作为被代理类的标识，在进行缓存时作为判断相等的依据。可以看到 cglib代理主要也是利用我们传入的被代理类信息来生成对应的代理类字节码，然后用类加载器加载到内存中。虽然我们的实际的代理任务才刚刚开始，但是要了解的东西已经基本上差不多了，对具体的我们案例中的ProxyFactory代理时，只是生成器Enhancer对比生成器Generator在生成过程中重写了一些操作而已。</code></pre><h4 id="4、回到步骤2，接着向下看执行的过程"><a href="#4、回到步骤2，接着向下看执行的过程" class="headerlink" title="4、回到步骤2，接着向下看执行的过程"></a>4、回到步骤2，接着向下看执行的过程</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">createHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        preValidate();</span><br><span class="line">        <span class="comment">//获取到了代理类标识类</span></span><br><span class="line">        Object key = KEY_FACTORY.newInstance((superclass != <span class="keyword">null</span>) ? superclass.getName() : <span class="keyword">null</span>,</span><br><span class="line">                ReflectUtils.getNames(interfaces),</span><br><span class="line">                filter == ALL_ZERO ? <span class="keyword">null</span> : <span class="keyword">new</span> WeakCacheKey&lt;CallbackFilter&gt;(filter),</span><br><span class="line">                callbackTypes,</span><br><span class="line">                useFactory,</span><br><span class="line">                interceptDuringConstruction,</span><br><span class="line">                serialVersionUID);</span><br><span class="line">        <span class="comment">//设置当前enhancer正在代理生成的类信息</span></span><br><span class="line">        <span class="keyword">this</span>.currentKey = key;</span><br><span class="line">        <span class="comment">//调用父类的create(key方法)</span></span><br><span class="line">        Object result = <span class="keyword">super</span>.create(key);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<pre><code>可以看到获取到代理类标志类后 将其设置为当前代理类生成器的正在代理的类 并同样调用父类AbstractClassGenerator中create(key)的方法,下面开始分析Ehancer生成器的逻辑，由于部分逻辑和Generator生成器一致</code></pre><h4 id="5、AbstractClassGenerator-create方法"><a href="#5、AbstractClassGenerator-create方法" class="headerlink" title="5、AbstractClassGenerator.create方法"></a>5、AbstractClassGenerator.create方法</h4><pre><code>这个逻辑和上述步骤一致，查询当前key即代理类标志类对应的ClassLoadData缓存，如果没有则建一个空的缓存并初始化一个对应的ClassLoadData,传入相应的生成器，生成失败回调函数等</code></pre><p>　　按照同样的逻辑一直走到generate(ClassLoadData)方法时，由于Enhancer生成器重写了这个方法 所以我们分析Enahncer的生成逻辑</p>
<h4 id="6、Enhancer-generate-ClassLoadData-data"><a href="#6、Enhancer-generate-ClassLoadData-data" class="headerlink" title="6、Enhancer.generate(ClassLoadData data)"></a>6、Enhancer.generate(ClassLoadData data)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Class <span class="title">generate</span><span class="params">(ClassLoaderData data)</span> </span>&#123;</span><br><span class="line">        validate();</span><br><span class="line">        <span class="keyword">if</span> (superclass != <span class="keyword">null</span>) &#123;</span><br><span class="line">            setNamePrefix(superclass.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (interfaces != <span class="keyword">null</span>) &#123;</span><br><span class="line">            setNamePrefix(interfaces[ReflectUtils.findPackageProtected(interfaces)].getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.generate(data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<pre><code>可以发现ehancer生成器只是做了个检查命名操作 在上面的Generator中也是做了个命名操作，然后继续执行父类的generate(data)方法，这个和上述步骤一致，我们主要看其中生成字节码的方法，即最后调用的Enhancer.generatorClass(ClassVisitor c)方法，</code></pre><h4 id="7、Enhancer-generatorClass-ClassVisitor-c"><a href="#7、Enhancer-generatorClass-ClassVisitor-c" class="headerlink" title="7、Enhancer.generatorClass(ClassVisitor c)"></a>7、Enhancer.generatorClass(ClassVisitor c)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateClass</span><span class="params">(ClassVisitor v)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//声明需代理的类 或者接口</span></span><br><span class="line">        Class sc = (superclass == null) ? Object.class : superclass;</span><br><span class="line">        <span class="comment">//检查 final类无法被继承</span></span><br><span class="line">        <span class="keyword">if</span> (TypeUtils.isFinal(sc.getModifiers()))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Cannot subclass final class "</span> + sc.getName());</span><br><span class="line">        <span class="comment">//找到该类所有声明了的构造函数</span></span><br><span class="line">        List constructors = <span class="keyword">new</span> ArrayList(Arrays.asList(sc.getDeclaredConstructors()));</span><br><span class="line">        <span class="comment">//去掉private之类的不能被继承的构造函数</span></span><br><span class="line">        filterConstructors(sc, constructors);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Order is very important: must add superclass, then</span></span><br><span class="line">        <span class="comment">// its superclass chain, then each interface and</span></span><br><span class="line">        <span class="comment">// its superinterfaces.</span></span><br><span class="line">        <span class="comment">//这儿顺序非常重要  上面是源码的注释  直接留着  相信大家都能看懂 </span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//声明代理类方法集合</span></span><br><span class="line">        List actualMethods = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="comment">//声明代理接口接口方法集合</span></span><br><span class="line">        List interfaceMethods = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="comment">//声明所有必须为public的方法集合  这儿主要是代理接口接口的方法</span></span><br><span class="line">        <span class="keyword">final</span> Set forcePublic = <span class="keyword">new</span> HashSet();</span><br><span class="line">        <span class="comment">//即通过传入的代理类 代理接口，遍历所有的方法并放入对应的集合</span></span><br><span class="line">        getMethods(sc, interfaces, actualMethods, interfaceMethods, forcePublic);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//对所有代理类方法修饰符做处理 </span></span><br><span class="line">        List methods = CollectionUtils.transform(actualMethods, <span class="keyword">new</span> Transformer() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object value)</span> </span>&#123;</span><br><span class="line">                Method method = (Method)value;</span><br><span class="line">                <span class="keyword">int</span> modifiers = Constants.ACC_FINAL</span><br><span class="line">                    | (method.getModifiers()</span><br><span class="line">                       &amp; ~Constants.ACC_ABSTRACT</span><br><span class="line">                       &amp; ~Constants.ACC_NATIVE</span><br><span class="line">                       &amp; ~Constants.ACC_SYNCHRONIZED);</span><br><span class="line">                <span class="keyword">if</span> (forcePublic.contains(MethodWrapper.create(method))) &#123;</span><br><span class="line">                    modifiers = (modifiers &amp; ~Constants.ACC_PROTECTED) | Constants.ACC_PUBLIC;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ReflectUtils.getMethodInfo(method, modifiers);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//创建类写入器</span></span><br><span class="line">        ClassEmitter e = <span class="keyword">new</span> ClassEmitter(v);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1.开始创建类  并写入基本信息  如java版本，类修饰符 类名等</span></span><br><span class="line">        <span class="keyword">if</span> (currentData == <span class="keyword">null</span>) &#123;</span><br><span class="line">        e.begin_class(Constants.V1_8,</span><br><span class="line">                      Constants.ACC_PUBLIC,</span><br><span class="line">                      getClassName(),</span><br><span class="line">                      Type.getType(sc),</span><br><span class="line">                      (useFactory ?</span><br><span class="line">                       TypeUtils.add(TypeUtils.getTypes(interfaces), FACTORY) :</span><br><span class="line">                       TypeUtils.getTypes(interfaces)),</span><br><span class="line">                      Constants.SOURCE_FILE);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            e.begin_class(Constants.V1_8,</span><br><span class="line">                    Constants.ACC_PUBLIC,</span><br><span class="line">                    getClassName(),</span><br><span class="line">                    <span class="keyword">null</span>,</span><br><span class="line">                    <span class="keyword">new</span> Type[]&#123;FACTORY&#125;,</span><br><span class="line">                    Constants.SOURCE_FILE);</span><br><span class="line">        &#125;</span><br><span class="line">        List constructorInfo = CollectionUtils.transform(constructors, MethodInfoTransformer.getInstance());</span><br><span class="line">        <span class="comment">//2. 声明一个private boolean 类型的属性：CGLIB$BOUND</span></span><br><span class="line">        e.declare_field(Constants.ACC_PRIVATE, BOUND_FIELD, Type.BOOLEAN_TYPE, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//3. 声明一个public static Object 类型的属性：CGLIB$FACTORY_DATA</span></span><br><span class="line">        e.declare_field(Constants.ACC_PUBLIC | Constants.ACC_STATIC, FACTORY_DATA_FIELD, OBJECT_TYPE, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 这个默认为true  如果为false则会声明一个private boolean 类型的属性：CGLIB$CONSTRUCTED</span></span><br><span class="line">        <span class="keyword">if</span> (!interceptDuringConstruction) &#123;</span><br><span class="line">            e.declare_field(Constants.ACC_PRIVATE, CONSTRUCTED_FIELD, Type.BOOLEAN_TYPE, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4. 声明一个public static final 的ThreadLocal：ThreadLocal</span></span><br><span class="line">        e.declare_field(Constants.PRIVATE_FINAL_STATIC, THREAD_CALLBACKS_FIELD, THREAD_LOCAL, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//5. 声明一个public static final 的CallBack类型的数组：CGLIB$STATIC_CALLBACKS</span></span><br><span class="line">        e.declare_field(Constants.PRIVATE_FINAL_STATIC, STATIC_CALLBACKS_FIELD, CALLBACK_ARRAY, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//如果serialVersionUID不为null  则设置一个public static final 的Long类型 serialVersionUID</span></span><br><span class="line">        <span class="keyword">if</span> (serialVersionUID != <span class="keyword">null</span>) &#123;</span><br><span class="line">            e.declare_field(Constants.PRIVATE_FINAL_STATIC, Constants.SUID_FIELD_NAME, Type.LONG_TYPE, serialVersionUID);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//遍历CallBackTypes 即我们构建Enhancer是setCallBack的所有类的类型  本案例中是methodInterceptor 并且只传入了一个</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; callbackTypes.length; i++) &#123;</span><br><span class="line">            <span class="comment">//6.声明一个private 的传入的CallBack类型的属性：CGLIB$CALLBACK_0 (从0开始编号，)</span></span><br><span class="line">            e.declare_field(Constants.ACC_PRIVATE, getCallbackField(i), callbackTypes[i], <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//7声明一个private static 的传入的Object类型的属性：CGLIB$CALLBACK_FILTER</span></span><br><span class="line">        e.declare_field(Constants.ACC_PRIVATE | Constants.ACC_STATIC, CALLBACK_FILTER_FIELD, OBJECT_TYPE, <span class="keyword">null</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//判断currentData</span></span><br><span class="line">        <span class="keyword">if</span> (currentData == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//8.为null则开始声明所有的代理类方法的变量 以及其具体的重写实现方法，还有static初始化执行代码块</span></span><br><span class="line">            emitMethods(e, methods, actualMethods);</span><br><span class="line">            <span class="comment">//9.声明构造函数</span></span><br><span class="line">            emitConstructors(e, constructorInfo);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//声明默认构造函数</span></span><br><span class="line">            emitDefaultConstructor(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        emitSetThreadCallbacks(e);</span><br><span class="line">        emitSetStaticCallbacks(e);</span><br><span class="line">        emitBindCallbacks(e);</span><br><span class="line">        <span class="comment">//如果currentData不为null</span></span><br><span class="line">        <span class="keyword">if</span> (useFactory || currentData != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//获取到所有CallBack索引数组</span></span><br><span class="line">            <span class="keyword">int</span>[] keys = getCallbackKeys();</span><br><span class="line">            <span class="comment">//10.声明三个newInstance方法</span></span><br><span class="line">            <span class="comment">//只有一个callback参数</span></span><br><span class="line">            emitNewInstanceCallbacks(e);</span><br><span class="line">            <span class="comment">//参数为callback数组</span></span><br><span class="line">            emitNewInstanceCallback(e);</span><br><span class="line">            <span class="comment">//参数为callback数组 以及附带的一些参数</span></span><br><span class="line">            emitNewInstanceMultiarg(e, constructorInfo);</span><br><span class="line">            <span class="comment">//11.声明getCallBack方法</span></span><br><span class="line">            emitGetCallback(e, keys);</span><br><span class="line">            <span class="comment">//12.声明setCallBack方法</span></span><br><span class="line">            emitSetCallback(e, keys);</span><br><span class="line">            <span class="comment">//12.声明setCallBacks方法</span></span><br><span class="line">            emitGetCallbacks(e);</span><br><span class="line">            <span class="comment">//12.声明setCallBacks方法</span></span><br><span class="line">            emitSetCallbacks(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//类声明结束</span></span><br><span class="line">        e.end_class();</span><br></pre></td></tr></table></figure>

<pre><code>可以看到这儿也是声明一个写入类 然后按照Ehancer的代理生成策略写入符合的class信息然后返回，最红依旧会执行toByteArray方法返回byte[]数组，这样则又回到了步骤中 根据类加载器 字节码数组来动态将代理类加载进内存中的方法了。最后我们回到根据class获取实例的代码即可返回被代理实例。 而我们执行方法时执行的是代理类中对应的方法，然后调用我们传入的callback执行 原理和jdk动态代理类似，至此 cglib动态代理源码分析到此结束。</code></pre>]]></content>
      <categories>
        <category>Java</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Dictionary</title>
    <url>/2020/08/04/Dictionary/</url>
    <content><![CDATA[<p>本站点所有文章的元信息归纳整理.</p>
<a id="more"></a>



<table>
<thead>
<tr>
<th>–</th>
<th>博客名</th>
<th>日期</th>
<th>tag</th>
<th>cat</th>
<th>cover</th>
<th>top</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Dictionary</td>
<td>2020-08-04 12:41:57</td>
<td>Dictionary</td>
<td>Dictionary</td>
<td>/image/post_cover_image_springboot-01.jpeg</td>
<td>9999</td>
</tr>
<tr>
<td>2</td>
<td>Spring Boot Part.1  简介与入门</td>
<td>2020-02-14 18:37:35</td>
<td>[Java,SpringBoot]</td>
<td>[Java, SpringBoot]</td>
<td>/image/post_cover_image_springboot-01.jpeg</td>
<td>2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Dictionary</category>
      </categories>
      <tags>
        <tag>Dictionary</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx_01</title>
    <url>/2020/08/04/nginx-01/</url>
    <content><![CDATA[<p>Nginx 背景介绍, 安装 及常用配置.</p>
<a id="more"></a>





<h1 id="Tengine"><a href="#Tengine" class="headerlink" title="Tengine"></a>Tengine</h1><h2 id="Nginx和Tengine"><a href="#Nginx和Tengine" class="headerlink" title="Nginx和Tengine"></a>Nginx和Tengine</h2><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>Nginx (“engine x”) 是一个高性能的 <strong>HTTP</strong> 和 <strong>反向代理</strong> 服务器，也是一个 IMAP/POP3/SMTP 代理服务器。</p>
<p>•第一个公开版本0.1.0发布于2004年10月4日。</p>
<p>  其将源代码以类BSD许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名</p>
<p>  官方测试nginx能够支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定</p>
<p>2011年6月1日，nginx 1.0.4发布。</p>
<p>  Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。由俄罗斯的程序设计师Igor Sysoev所开发，</p>
<p>  其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：新浪、网易、腾讯等。</p>
<p><img src="/2020/08/04/nginx-01/20200103154530929.png" alt="image-20200103154530929"></p>
<p>功能：</p>
<ul>
<li><p>web服务器</p>
</li>
<li><p>web reverse proxy</p>
</li>
<li><p>smtp reverse proxy</p>
</li>
</ul>
<h3 id="Nginx和apache的优缺点"><a href="#Nginx和apache的优缺点" class="headerlink" title="Nginx和apache的优缺点"></a>Nginx和apache的优缺点</h3><h4 id="nginx相对于apache的优点："><a href="#nginx相对于apache的优点：" class="headerlink" title="nginx相对于apache的优点："></a>nginx相对于apache的优点：</h4><ul>
<li>轻量级，同样起web 服务，比apache 占用更少的内存及资源 </li>
<li>抗并发，nginx 处理请求是异步非阻塞的，而apache 则是阻塞型的，在高并发下nginx 能保持低资源低消耗高性能 </li>
<li>高度模块化的设计，编写模块相对简单</li>
<li>社区活跃，各种高性能模块出品迅速</li>
</ul>
<h4 id="apache-相对于nginx-的优点："><a href="#apache-相对于nginx-的优点：" class="headerlink" title="apache 相对于nginx 的优点："></a>apache 相对于nginx 的优点：</h4><ul>
<li>rewrite ，比nginx 的rewrite 强大</li>
<li>模块超多，基本想到的都可以找到</li>
<li>少bug ，nginx 的bug 相对较多 </li>
</ul>
<p>Nginx 配置简洁, Apache 复杂 </p>
<p>最核心的区别在于apache是同步多进程模型，一个连接对应一个进程；</p>
<p>nginx是异步的，多个连接（万级别）可以对应一个进程</p>
<h2 id="Nginx解决的问题"><a href="#Nginx解决的问题" class="headerlink" title="Nginx解决的问题"></a>Nginx解决的问题</h2><ul>
<li><p>高并发</p>
</li>
<li><p>负载均衡</p>
</li>
<li><p>高可用</p>
</li>
<li><p>虚拟主机</p>
</li>
<li><p>伪静态</p>
</li>
<li><p>动静分离</p>
</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h4><p>最好使用linux操作系统，课上使用VirtualBox或VMware虚拟机搭建centos6.x做实验。</p>
<p>系统依赖组件 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">gcc </span><br><span class="line">openssl-devel </span><br><span class="line">pcre-devel </span><br><span class="line">zlib-devel</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install gcc openssl-devel pcre-devel zlib-devel</span><br></pre></td></tr></table></figure>



<h4 id="Tengine下载和文档"><a href="#Tengine下载和文档" class="headerlink" title="Tengine下载和文档"></a>Tengine下载和文档</h4><p><a href="http://tengine.taobao.org/" target="_blank" rel="noopener">http://tengine.taobao.org/</a></p>
<h4 id="Nginx官网和文档"><a href="#Nginx官网和文档" class="headerlink" title="Nginx官网和文档"></a>Nginx官网和文档</h4><p><a href="http://nginx.org" target="_blank" rel="noopener">http://nginx.org</a></p>
<p>上传Nginx压缩包到服务器，一般安装在/usr/local目录下</p>
<h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./ configure --prefix=/安装路径</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>



<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><h3 id="脚本自启动"><a href="#脚本自启动" class="headerlink" title="脚本自启动"></a>脚本自启动</h3><p>拷贝附件提供的Nginx启动脚本文件内容到<code>/etc/init.d/nginx</code>这个文件中</p>
<p>目录下如果没有这个文件的话需要手动创建</p>
<h4 id="修改可执行权限"><a href="#修改可执行权限" class="headerlink" title="修改可执行权限"></a>修改可执行权限</h4><p>chmod 777 nginx</p>
<h4 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h4><p>service Nginx start  启动服务</p>
<p>service Nginx stop 停止</p>
<p>service Nginx status 状态</p>
<p>service Nginx reload 动态重载配置文件</p>
<h4 id="脚本内容："><a href="#脚本内容：" class="headerlink" title="脚本内容："></a>脚本内容：</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx - this script starts and stops the nginx daemon</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig:   - 85 15 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> description:  Nginx is an HTTP(S) server, HTTP(S) reverse \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               proxy and IMAP/POP3 proxy server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> processname: nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> config:      /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> config:      /etc/sysconfig/nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pidfile:     /var/run/nginx.pid</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> Source <span class="keyword">function</span> library.</span></span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> Check that networking is up.</span></span><br><span class="line">[ "$NETWORKING" = "no" ] &amp;&amp; exit 0</span><br><span class="line"> </span><br><span class="line">nginx="/usr/local/tengine/sbin/nginx"</span><br><span class="line">prog=$(basename $nginx)</span><br><span class="line"> </span><br><span class="line">NGINX_CONF_FILE="/usr/local/tengine/conf/nginx.conf"</span><br><span class="line"> </span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line"> </span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line"> </span><br><span class="line">make_dirs() &#123;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> make required directories</span></span><br><span class="line">   user=`nginx -V 2&gt;&amp;1 | grep "configure arguments:" | sed 's/[^*]*--user=\([^ ]*\).*/\1/g' -`</span><br><span class="line">   options=`$nginx -V 2&gt;&amp;1 | grep 'configure arguments:'`</span><br><span class="line">   for opt in $options; do</span><br><span class="line">       if [ `echo $opt | grep '.*-temp-path'` ]; then</span><br><span class="line">           value=`echo $opt | cut -d "=" -f 2`</span><br><span class="line">           if [ ! -d "$value" ]; then</span><br><span class="line">               # echo "creating" $value</span><br><span class="line">               mkdir -p $value &amp;&amp; chown -R $user $value</span><br><span class="line">           fi</span><br><span class="line">       fi</span><br><span class="line">   done</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">start() &#123;</span><br><span class="line">    [ -x $nginx ] || exit 5</span><br><span class="line">    [ -f $NGINX_CONF_FILE ] || exit 6</span><br><span class="line">    make_dirs</span><br><span class="line">    echo -n $"Starting $prog: "</span><br><span class="line">    daemon $nginx -c $NGINX_CONF_FILE</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; touch $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $"Stopping $prog: "</span><br><span class="line">    killproc $prog -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">restart() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">reload() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    echo -n $"Reloading $prog: "</span><br><span class="line">    killproc $nginx -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">force_reload() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">configtest() &#123;</span><br><span class="line"><span class="meta">  $</span><span class="bash">nginx -t -c <span class="variable">$NGINX_CONF_FILE</span></span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">rh_status() &#123;</span><br><span class="line">    status $prog</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">rh_status_q() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">case "$1" in</span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || exit 7</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">        echo $"Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;"</span><br><span class="line">        exit 2</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h2 id="Nginx配置解析"><a href="#Nginx配置解析" class="headerlink" title="Nginx配置解析"></a>Nginx配置解析</h2><h3 id="定义Nginx运行的用户和用户组"><a href="#定义Nginx运行的用户和用户组" class="headerlink" title="定义Nginx运行的用户和用户组"></a>定义Nginx运行的用户和用户组</h3><p><code>user www www;</code></p>
<h3 id="进程数"><a href="#进程数" class="headerlink" title="进程数"></a>进程数</h3><p>建议设置为等于CPU总核心数。</p>
<p><code>worker_processes 8;</code></p>
<h3 id="全局错误日志"><a href="#全局错误日志" class="headerlink" title="全局错误日志"></a>全局错误日志</h3><p>全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</p>
<p><code>error_log /var/log/nginx/error.log info;</code></p>
<h3 id="进程文件"><a href="#进程文件" class="headerlink" title="进程文件"></a>进程文件</h3><p><code>pid /var/run/nginx.pid;</code></p>
<h3 id="打开的最多文件描述符"><a href="#打开的最多文件描述符" class="headerlink" title="打开的最多文件描述符"></a>打开的最多文件描述符</h3><p>一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</p>
<p><code>worker_rlimit_nofile 65535;</code></p>
<h3 id="event"><a href="#event" class="headerlink" title="event"></a>event</h3><h4 id="单个进程最大连接数"><a href="#单个进程最大连接数" class="headerlink" title="单个进程最大连接数"></a>单个进程最大连接数</h4><p>并发总数是 worker_processes 和 worker_connections 的乘积</p>
<p>即 max_clients = worker_processes * worker_connections</p>
<p>在设置了反向代理的情况下，max_clients = worker_processes * worker_connections / 4  为什么<br>为什么上面反向代理要除以4，应该说是一个经验值根据以上条件，正常情况下的Nginx Server可以应付的最大连接数为：4 * 8000 = 32000worker_connections 值的设置跟物理内存大小有关</p>
<p>因为并发受IO约束，max_clients的值须小于系统可以打开的最大文件数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">工作模式与连接数上限</span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line">参考事件模型，use [ kqueue | rtsig | epoll | &#x2F;dev&#x2F;poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I&#x2F;O模型，如果跑在FreeBSD上面，就用kqueue模型。</span><br><span class="line">use epoll;</span><br><span class="line">单个进程最大连接数（最大连接数&#x3D;连接数*进程数）</span><br><span class="line">worker_connections 65535;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>可以打开的文件句柄数是多少</strong></p>
<p><code>–$ cat /proc/sys/fs/file-max</code></p>
<p>输出：<code>97320</code></p>
<p>并发连接总数小于系统可以打开的文件句柄总数，这样就在操作系统可以承受的范围之内</p>
<p>所以，worker_connections 的值需根据 worker_processes 进程数目和系统可以打开的最大文件总数进行适当地进行设置,使得并发总数小于操作系统可以打开的最大文件数目</p>
<p>–    # 其实质也就是根据主机的物理CPU和内存进行配置</p>
<p>当然，理论上的并发总数可能会和实际有所偏差，因为主机还有其他的工作进程需要消耗系统资源。</p>
<p><strong>查看系统限制</strong> <code>ulimit -a</code></p>
<h4 id="打开文件句柄数量限制"><a href="#打开文件句柄数量限制" class="headerlink" title="打开文件句柄数量限制"></a>打开文件句柄数量限制</h4><p>是Linux操作系统对一个进程打开的文件句柄数量的限制(也包含打开的SOCKET数量，可影响MySQL的并发连接数目)</p>
<p>系统总限制： <code>/proc/sys/fs/file-max</code> 当前使用句柄数：<code>/proc/sys/fs/file-nr</code></p>
<p>修改句柄数：<code>ulimit -SHn 65535</code></p>
<h3 id="http"><a href="#http" class="headerlink" title="http"></a>http</h3><p>include mime.types; #文件扩展名与文件类型映射表</p>
<p>default_type application/octet-stream; #默认文件类型</p>
<p>charset utf-8; #默认编码</p>
<p>client_header_buffer_size 32k; #上传文件大小限制</p>
<h4 id="sendfile"><a href="#sendfile" class="headerlink" title="sendfile"></a>sendfile</h4><p>sendfile on; #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</p>
<p>sendfile()还能够用来在两个文件夹之间移动数据</p>
<p><code>tcp_nopush</code> 在linux/Unix系统中优化tcp数据传输，仅在sendfile开启时有效</p>
<p><code>autoindex on;</code>#开启目录列表访问，合适下载服务器，默认关闭。</p>
<p><code>keepalive_timeout 120;</code>#长连接超时时间，单位是秒</p>
<h4 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h4><p><code>gzip on;</code> 开启gzip压缩输出</p>
<p><code>gzip_min_length 1k;</code>  设置允许压缩的页面最小字节数，页面字节数从header头得content-length中进行获取。默认值是0，不管页面多大都压缩。建议设置成大于2k的字节数，小于2k可能会越压越大。  </p>
<p><code>gzip_buffers 4 16k;</code> 设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。 例如 4 4k 代表以4k为单位，按照原始数据大小以4k为单位的4倍申请内存。 4 8k 代表以8k为单位，按照原始数据大小以8k为单位的4倍申请内存。    如果没有设置，默认值是申请跟原始数据相同大小的内存空间去存储gzip压缩结果。</p>
<p><code>gzip_http_version 1.0;</code>压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</p>
<p><code>gzip_comp_level 2;</code> 压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间  </p>
<p><code>gzip_types text/plain application/x-javascript text/css application/xml;</code><br>#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</p>
<p> 默认值: gzip_types text/html (默认不对js/css文件进行压缩) </p>
<p>压缩类型，匹配MIME类型进行压缩 </p>
<p>设置哪压缩种文本文件可参考 conf/mime.types</p>
<p> <code>gzip_disable &quot;MSIE [1-6]\.&quot;;</code>E6及以下禁止压缩</p>
<p><code>gzip_vary on;</code>给CDN和代理服务器使用，针对相同url，可以根据头信息返回压缩和非压缩副本  </p>
<h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><p><code>listen       80;</code>  监听端口<br><code>server_name www.mashibing.com mashibing.com;</code> 域名可以有多个，用空格隔开</p>
<p><code>charset koi8-r;</code> 编码集</p>
 <figure class="highlight plain"><figcaption><span>logs/host.access.log  main;</span></figcaption><table><tr><td class="code"><pre><span class="line">日志相关</span><br><span class="line">access_log  &quot;pipe:rollback logs&#x2F;host.access_log interval&#x3D;1d baknum&#x3D;7 maxsize&#x3D;2G&quot;  main;</span><br></pre></td></tr></table></figure>

<p><code>index index.html index.htm index.jsp;</code> 默认页<br><code>root /data/www/ha97;</code> 主目录</p>
<h4 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h4><p>虚拟主机是一种特殊的软硬件技术，它可以将网络上的每一台计算机分成多个虚拟主机，每个虚拟主机可以独立对外提供www服务，这样就可以实现一台主机对外提供多个web服务，每个虚拟主机之间是独立的，互不影响的</p>
<p><img src="/2020/08/04/nginx-01/C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562927031929.png" alt="1562927031929"></p>
<p>通过nginx可以实现虚拟主机的配置，nginx支持三种类型的虚拟主机配置</p>
<ul>
<li>基于ip的虚拟主机， （一块主机绑定多个ip地址）</li>
<li>基于域名的虚拟主机（servername）</li>
<li>基于端口的虚拟主机（listen如果不写ip端口模式）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">	server&#123;</span><br><span class="line">		#表示一个虚拟主机</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="location"><a href="#location" class="headerlink" title="location"></a>location</h5><p>映射/虚拟目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x3D; &#x2F; &#123;</span><br><span class="line">    [ configuration A ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">    [ configuration B ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location &#x2F;documents&#x2F; &#123;</span><br><span class="line">    [ configuration C ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ^~ &#x2F;images&#x2F; &#123;</span><br><span class="line">    [ configuration D ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~* \.(gif|jpg|jpeg)$ &#123;</span><br><span class="line">    [ configuration E ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>location [ = | ~ | <del>* | ^</del> ] uri { … }</p>
<p><code>location URI {}</code> 对当前路径及子路径下的所有对象都生效；</p>
<p><code>location = URI {}</code> 注意URL最好为具体路径。  精确匹配指定的路径，不包括子路径，因此，只对当前资源生效；</p>
<p><code>location ~ URI {}   location ~* URI {}</code>  模式匹配URI，此处的URI可使用正则表达式，<del>区分字符大小写，</del>*不区分字符大小写；</p>
<p><code>location ^~ URI {}</code> 禁用正则表达式</p>
<p><strong>优先级</strong>：= &gt; ^~ &gt; <del>|</del>* &gt;  /|/dir/</p>
<h6 id="location配置规则"><a href="#location配置规则" class="headerlink" title="location配置规则"></a>location配置规则</h6><p>location 的执行逻辑跟 location 的编辑顺序无关。<br>矫正：这句话不全对，“普通 location ”的匹配规则是“最大前缀”，因此“普通 location ”的确与 location 编辑顺序无关；</p>
<p>但是“正则 location ”的匹配规则是“顺序匹配，且只要匹配到第一个就停止后面的匹配”；</p>
<p>“普通location ”与“正则 location ”之间的匹配顺序是？先匹配普通 location ，再“考虑”匹配正则 location 。</p>
<p>注意这里的“考虑”是“可能”的意思，也就是说匹配完“普通 location ”后，有的时候需要继续匹配“正则 location ”，有的时候则不需要继续匹配“正则 location ”。两种情况下，不需要继续匹配正则 location ：</p>
<ul>
<li>（ 1 ）当普通 location 前面指定了“ ^~ ”，特别告诉 Nginx 本条普通 location 一旦匹配上，则不需要继续正则匹配；</li>
<li>（ 2 ）当普通location 恰好严格匹配上，不是最大前缀匹配，则不再继续匹配正则</li>
</ul>
<h3 id="IP访问控制"><a href="#IP访问控制" class="headerlink" title="IP访问控制"></a>IP访问控制</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location  &#123;</span><br><span class="line">	   deny  IP &#x2F;IP段</span><br><span class="line">	   deny  192.168.1.109;</span><br><span class="line">	   allow 192.168.1.0&#x2F;24;192.168.0.0&#x2F;16;192.0.0.0&#x2F;8</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用户认证访问"><a href="#用户认证访问" class="headerlink" title="用户认证访问"></a>用户认证访问</h3><p>模块ngx_http_auth_basic_module 允许使用“HTTP基本认证”协议验证用户名和密码来限制对资源的访问。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location ~ (.*)\.avi$ &#123;</span><br><span class="line">         auth_basic  &quot;closed site&quot;;</span><br><span class="line">         auth_basic_user_file conf&#x2F;users;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="httpd-tools"><a href="#httpd-tools" class="headerlink" title="httpd-tools"></a><strong>httpd-tools</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install httpd</span><br><span class="line"></span><br><span class="line">htpasswd -c -d &#x2F;usr&#x2F;local&#x2F;users zhangyang</span><br></pre></td></tr></table></figure>



<h3 id="nginx访问状态监控"><a href="#nginx访问状态监控" class="headerlink" title="nginx访问状态监控"></a>nginx访问状态监控</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x2F;basic_status &#123;</span><br><span class="line">    stub_status on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>通常的代理服务器，只用于代理内部网络对Internet的连接请求，客户机必须指定代理服务器,并将本来要直接发送到Web服务器上的http请求发送到代理服务器中由代理服务器向Internet上的web服务器发起请求，最终达到客户机上网的目的。</p>
<p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器</p>
<p><img src="/2020/08/04/nginx-01/image-20200103154711795.png" alt="image-20200103154711795"></p>
<h4 id="经典的反向代理结构"><a href="#经典的反向代理结构" class="headerlink" title="经典的反向代理结构"></a>经典的反向代理结构</h4><p><img src="/2020/08/04/nginx-01/image-20200103154652173.png" alt="image-20200103154652173"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Proxy_pass http:&#x2F;&#x2F;192.168.43.152&#x2F;</span><br></pre></td></tr></table></figure>



<p>301重定向问题</p>
<h4 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h4><p>反向代理配合upstream使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  upstream httpds &#123;</span><br><span class="line">    server 192.168.43.152:80;</span><br><span class="line">    server 192.168.43.153:80;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="weight-权重"><a href="#weight-权重" class="headerlink" title="weight(权重)"></a><strong>weight(权重)</strong></h5><p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream httpds &#123;</span><br><span class="line">    server 127.0.0.1:8050       weight&#x3D;10 down;</span><br><span class="line">    server 127.0.0.1:8060       weight&#x3D;1;</span><br><span class="line">     server 127.0.0.1:8060      weight&#x3D;1 backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>down：表示当前的server暂时不参与负载 </li>
<li>weight：默认为1.weight越大，负载的权重就越大。 </li>
<li>backup： 其它所有的非backup机器down或者忙的时候，请求backup机器。</li>
</ul>
<h5 id="max-conns"><a href="#max-conns" class="headerlink" title="max_conns"></a><strong>max_conns</strong></h5><p>可以根据服务的好坏来设置最大连接数，防止挂掉，比如1000，我们可以设置800</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream httpds &#123;</span><br><span class="line">    server 127.0.0.1:8050    weight&#x3D;5  max_conns&#x3D;800;</span><br><span class="line">    server 127.0.0.1:8060    weight&#x3D;1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="max-fails、-fail-timeout"><a href="#max-fails、-fail-timeout" class="headerlink" title="max_fails、 fail_timeout"></a><strong>max_fails、 fail_timeout</strong></h5><p>max_fails:失败多少次 认为主机已挂掉则，踢出，公司资源少的话一般设置2~3次，多的话设置1次</p>
<p>max_fails=3 fail_timeout=30s代表在30秒内请求某一应用失败3次，认为该应用宕机，后等待30秒，这期间内不会再把新请求发送到宕机应用，而是直接发到正常的那一台，时间到后再有请求进来继续尝试连接宕机应用且仅尝试1次，如果还是失败，则继续等待30秒…以此循环，直到恢复。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream httpds &#123;</span><br><span class="line">    server 127.0.0.1:8050    weight&#x3D;1  max_fails&#x3D;1  fail_timeout&#x3D;20;</span><br><span class="line">    server 127.0.0.1:8060    weight&#x3D;1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h5><p><strong>轮询+weight</strong>  <strong>ip_hash</strong> <strong>url_hash</strong> <strong>least_conn</strong> <strong>least_time</strong> </p>
<h4 id="健康检查模块"><a href="#健康检查模块" class="headerlink" title="健康检查模块"></a>健康检查模块</h4><p>配置一个status的location</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x2F;status &#123;</span><br><span class="line">            check_status;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>在upstream配置如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">check interval&#x3D;3000 rise&#x3D;2 fall&#x3D;5 timeout&#x3D;1000 type&#x3D;http;</span><br><span class="line">check_http_send &quot;HEAD &#x2F; HTTP&#x2F;1.0\r\n\r\n&quot;;</span><br><span class="line">check_http_expect_alive http_2xx http_3xx;</span><br></pre></td></tr></table></figure>

<h3 id="session共享"><a href="#session共享" class="headerlink" title="session共享"></a>session共享</h3><h4 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h4><h5 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h5><ul>
<li>安装libevent</li>
<li>安装memcached</li>
</ul>
<p>可以用yum方式安装 <code>yum –y install memcached</code></p>
<h5 id="启动memcached"><a href="#启动memcached" class="headerlink" title="启动memcached"></a>启动memcached</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">memcached -d -m 128 -u root -l 192.168.43.151 -p 11211 -c 256 -P &#x2F;tmp&#x2F;memcached.pid</span><br><span class="line">memcached-tool 192.168.2.51:11211</span><br><span class="line">参数解释：</span><br><span class="line">	-d:后台启动服务</span><br><span class="line">	-m:缓存大小</span><br><span class="line">	-p：端口</span><br><span class="line">	-l:IP</span><br><span class="line">	-P:服务器启动后的系统进程ID，存储的文件</span><br><span class="line">	-u:服务器启动是以哪个用户名作为管理用户</span><br></pre></td></tr></table></figure>

<h4 id="Nginx配置"><a href="#Nginx配置" class="headerlink" title="Nginx配置"></a>Nginx配置</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat&#123;</span><br><span class="line">        server 192.168.2.52:8080;</span><br><span class="line">        server 192.168.2.53:8080;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">        location &#x2F;tomcat &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;tomcat&#x2F;;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Tomcat配置"><a href="#Tomcat配置" class="headerlink" title="Tomcat配置"></a>Tomcat配置</h4><p>到tomcat的lib下，jar包见附件</p>
<p>每个tomcat里面的context.xml中加入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Manager className&#x3D;&quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&quot; </span><br><span class="line">	memcachedNodes&#x3D;&quot;n1:192.168.43.151:11211&quot; </span><br><span class="line">    sticky&#x3D;&quot;false&quot; </span><br><span class="line">    lockingMode&#x3D;&quot;auto&quot;</span><br><span class="line">    sessionBackupAsync&#x3D;&quot;false&quot;</span><br><span class="line">	requestUriIgnorePattern&#x3D;&quot;.*\.(ico|png|gif|jpg|css|js)$&quot;</span><br><span class="line">    sessionBackupTimeout&#x3D;&quot;1000&quot; transcoderFactoryClass&#x3D;&quot;de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory&quot; </span><br><span class="line">&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="http-proxy-本地磁盘缓存"><a href="#http-proxy-本地磁盘缓存" class="headerlink" title="http_proxy 本地磁盘缓存"></a>http_proxy 本地磁盘缓存</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">proxy_cache_path &#x2F;path&#x2F;to&#x2F;cache levels&#x3D;1:2 keys_zone&#x3D;my_cache:10m max_size&#x3D;10g inactive&#x3D;60m use_temp_path&#x3D;off;</span><br><span class="line">server &#123;</span><br><span class="line">     set $upstream http:&#x2F;&#x2F;ip:port</span><br><span class="line">          location &#x2F; &#123;</span><br><span class="line">                   proxy_cache my_cache;</span><br><span class="line">                   proxy_pass $upstream;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#x2F;path&#x2F;to&#x2F;cache  #本地路径，用来设置Nginx缓存资源的存放地址</span><br><span class="line">	levels          #默认所有缓存文件都放在同一个&#x2F;path&#x2F;to&#x2F;cache下，但是会影响缓存的性能，因此通常会在&#x2F;path&#x2F;to&#x2F;cache下面建立子目录用来分别存放不同的文件。假设levels&#x3D;1:2，Nginx为将要缓存的资源生成的key为f4cd0fbc769e94925ec5540b6a4136d0，那么key的最后一位0，以及倒数第2-3位6d作为两级的子目录，也就是该资源最终会被缓存到&#x2F;path&#x2F;to&#x2F;cache&#x2F;0&#x2F;6d目录中</span><br><span class="line">	key_zone        #在共享内存中设置一块存储区域来存放缓存的key和metadata（类似使用次数），这样nginx可以快速判断一个request是否命中或者未命中缓存，1m可以存储8000个key，10m可以存储80000个key</span><br><span class="line">	max_size        #最大cache空间，如果不指定，会使用掉所有disk space，当达到配额后，会删除最少使用的cache文件</span><br><span class="line">	inactive        #未被访问文件在缓存中保留时间，本配置中如果60分钟未被访问则不论状态是否为expired，缓存控制程序会删掉文件。inactive默认是10分钟。需要注意的是，inactive和expired配置项的含义是不同的，expired只是缓存过期，但不会被删除，inactive是删除指定时间内未被访问的缓存文件</span><br><span class="line">	use_temp_path   #如果为off，则nginx会将缓存文件直接写入指定的cache文件中，而不是使用temp_path存储，official建议为off，避免文件在不同文件系统中不必要的拷贝</span><br><span class="line">	proxy_cache     #启用proxy cache，并指定key_zone。另外，如果proxy_cache off表示关闭掉缓存。</span><br></pre></td></tr></table></figure>

<h1 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a>课后作业</h1><p>1 . 在虚拟机里 搭上Nginx环境</p>
<ol start="2">
<li>location </li>
</ol>
]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis_02</title>
    <url>/2020/07/24/redis-02/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>CV</title>
    <url>/2020/07/23/CV/</url>
    <content><![CDATA[<p>Guideline for interviews.</p>
<a id="more"></a>

<p>Have a good command of :</p>
<ol>
<li><p>Java SE, Collections, I/O, Class Loader mechanism &amp; GC recycle mechanism.</p>
</li>
<li><p>Principle of  distributed data storage &amp; HDFS, principle of  distributed data calculation &amp;Map-reduce,  and Resource allocation &amp; management framework Yarn.</p>
</li>
<li><p>Flume Configuration.</p>
</li>
<li><p>Common Usage of Redis (as distributed lock, cache and bloom filter) together with Jedis APIs, sharding &amp; sentinel mechanism and Redis  cluster configuration.</p>
</li>
<li><p>Relational Database Mysql, JDBC, Transaction mechanism, SQL optimization, persistence framework MyBatis.</p>
</li>
<li><p>Kafka as  <a href="http://www.liweian.co.uk/2020/07/12/ActiveMQ-01/#more" target="_blank" rel="noopener">MQ</a>.</p>
</li>
<li><p>Core components of Spring Suite including but not restricted to IOC, AOP, MVC and spring boot.</p>
</li>
<li><p>Zookeeper for service registry, discovery and supervision.</p>
</li>
</ol>
<p>​    </p>
<p>Familiar with </p>
<ol>
<li><p>JVM </p>
</li>
<li><p>Scala as a script Programming Language </p>
</li>
<li><p>Spark streaming and Spark SQL</p>
</li>
<li><p>Nginx configuration </p>
</li>
</ol>
<p><img src="/2020/07/23/CV/Architecture.png" alt="Architecture"></p>
]]></content>
      <categories>
        <category>overall</category>
      </categories>
      <tags>
        <tag>interview</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis_01</title>
    <url>/2020/07/19/redis-01/</url>
    <content><![CDATA[<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams. Redis has built-in replication, Lua scripting, LRU eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster. <a href="https://redis.io/topics/introduction" target="_blank" rel="noopener">Learn more →</a></p>
<a id="more"></a>

<p><a href="https://redis.io/commands" target="_blank" rel="noopener">官网</a></p>
<h1 id="String-类型操作"><a href="#String-类型操作" class="headerlink" title="String 类型操作"></a><a href="https://redis.io/commands/get" target="_blank" rel="noopener">String</a> 类型操作</h1><h2 id="APPEND"><a href="#APPEND" class="headerlink" title="APPEND"></a><a href="https://redis.io/commands/append" target="_blank" rel="noopener">APPEND</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾。</span><br><span class="line">如果 key 不存在， APPEND 就简单地将给定 key 设为 value ，就像执行 SET key value 一样。</span><br></pre></td></tr></table></figure>



<h2 id="BITCOUNT"><a href="#BITCOUNT" class="headerlink" title="BITCOUNT"></a><a href="https://redis.io/commands/bitcount" target="_blank" rel="noopener">BITCOUNT</a></h2><p><strong>Count the number of set bits (population counting) in a string.</strong></p>
<p>By default all the bytes contained in the string are examined. It is possible to specify the counting operation only in an interval passing the additional arguments start and end.</p>
<p>Like for the GETRANGE command start and end can contain negative values in order to index bytes starting from the end of the string, where -1 is the last byte, -2 is the penultimate, and so forth.</p>
<p>Non-existent keys are treated as empty strings, so the command will return zero.</p>
<h2 id="BITFIELD"><a href="#BITFIELD" class="headerlink" title="BITFIELD"></a><a href="https://redis.io/commands/bitfield" target="_blank" rel="noopener">BITFIELD</a></h2><p><strong>The command treats a Redis string as a array of bits, and is capable of addressing specific integer fields of varying bit widths and arbitrary non (necessary) aligned offset. In practical terms using this command you can set, for example, a signed 5 bits integer at bit offset 1234 to a specific value, retrieve a 31 bit unsigned integer from offset 4567. Similarly the command handles increments and decrements of the specified integers, providing guaranteed and well specified overflow and underflow behavior that the user can configure.</strong></p>
<p>BITFIELD is able to operate with multiple bit fields in the same command call. It takes a list of operations to perform, and returns an array of replies, where each array matches the corresponding operation in the list of arguments.</p>
<p>For example the following command increments an 5 bit signed integer at bit offset 100, and gets the value of the 4 bit unsigned integer at bit offset 0:</p>
<blockquote>
<p>BITFIELD mykey INCRBY i5 100 1 GET u4 0</p>
<p>1) (integer) 1<br>2) (integer) 0</p>
</blockquote>
<h2 id="BITOP"><a href="#BITOP" class="headerlink" title="BITOP"></a><a href="https://redis.io/commands/bitop" target="_blank" rel="noopener">BITOP</a></h2><p><strong>Perform a bitwise operation between multiple keys (containing string values) and store the result in the destination key.</strong></p>
<ul>
<li><p><code>BITOP AND destkey srckey1 srckey2 srckey3 ... srckeyN</code></p>
</li>
<li><p><code>BITOP OR destkey srckey1 srckey2 srckey3 ... srckeyN</code></p>
</li>
<li><p><code>BITOP XOR destkey srckey1 srckey2 srckey3 ... srckeyN</code></p>
</li>
<li><p><code>BITOP NOT destkey srckey</code></p>
</li>
</ul>
<p>  As you can see NOT is special as it only takes an input key, because it performs inversion of bits so it only makes sense as an unary operator.</p>
<p>  The result of the operation is always stored at destkey.</p>
<p>  Handling of strings with different lengths<br>  When an operation is performed between strings having different lengths, all the strings shorter than the longest string in the set are treated as if they were zero-padded up to the length of the longest string.</p>
<p>  The same holds true for non-existent keys, that are considered as a stream of zero bytes up to the length of the longest string.</p>
<h2 id="BITPOS"><a href="#BITPOS" class="headerlink" title="BITPOS"></a><a href="https://redis.io/commands/bitpos" target="_blank" rel="noopener">BITPOS</a></h2><p><strong>Return the position of the first bit set to 1 or 0 in a string.</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The position is returned, thinking of the string as an array of bits from left to right, where the first byte&#39;s most significant bit is at position 0, the second byte&#39;s most significant bit is at position 8, and so forth.</span><br><span class="line"></span><br><span class="line">The same bit position convention is followed by GETBIT and SETBIT.</span><br><span class="line"></span><br><span class="line">By default, all the bytes contained in the string are examined. It is possible to look for bits only in a specified interval passing the additional arguments start and end (it is possible to just pass start, the operation will assume that the end is the last byte of the string. However there are semantic differences as explained later). The range is interpreted as a range of bytes and not a range of bits, so start&#x3D;0 and end&#x3D;2 means to look at the first three bytes.</span><br><span class="line"></span><br><span class="line">Note that bit positions are returned always as absolute values starting from bit zero even when start and end are used to specify a range.</span><br><span class="line"></span><br><span class="line">Like for the GETRANGE command start and end can contain negative values in order to index bytes starting from the end of the string, where -1 is the last byte, -2 is the penultimate, and so forth.</span><br><span class="line"></span><br><span class="line">Non-existent keys are treated as empty strings.</span><br></pre></td></tr></table></figure>


<h2 id="DECR"><a href="#DECR" class="headerlink" title="DECR"></a><a href="https://redis.io/commands/decr" target="_blank" rel="noopener">DECR</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将key对应的值减去 如果key不存在, 会在减之前将key的值设为0. 操作类型不对会报错. decrby只能作用于64位有符号整形数据(64-bit signed integer.)</span><br></pre></td></tr></table></figure>



<h2 id="DECRBY"><a href="#DECRBY" class="headerlink" title="DECRBY"></a><a href="https://redis.io/commands/decrby" target="_blank" rel="noopener">DECRBY</a></h2> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将key对应的值减去步长decrement. 如果key不存在, 会在减之前将key的值设为0. 操作类型不对会报错. decrby只能作用于64位有符号整形数据(64-bit signed integer.)</span><br></pre></td></tr></table></figure>



<h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a><a href="https://redis.io/commands/get" target="_blank" rel="noopener">GET</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">获取key对应的value值. 若key不存在, 则返回nil.只能作用于string类型, 操作其他类型会报错.</span><br></pre></td></tr></table></figure>

<h2 id="GETBIT"><a href="#GETBIT" class="headerlink" title="GETBIT"></a><a href="https://redis.io/commands/getbit" target="_blank" rel="noopener">GETBIT</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">字符串值指定偏移量上的位(bit)。</span><br><span class="line">当偏移量 OFFSET 比字符串值的长度大，或者 key 不存在时，返回 0 。</span><br></pre></td></tr></table></figure>

<h2 id="GETRANGE"><a href="#GETRANGE" class="headerlink" title="GETRANGE"></a><a href="https://redis.io/commands/getrange" target="_blank" rel="noopener">GETRANGE</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Getrange 命令用于获取存储在指定 key 中字符串的子字符串。字符串的截取范围由 start 和 end 两个偏移量决定(包括 start 和 end 在内)。</span><br><span class="line">SET mykey &quot;This is my test key&quot;</span><br><span class="line">GETRANGE mykey 0 3</span><br><span class="line">&gt; &quot;This&quot;</span><br><span class="line">GETRANGE mykey 0 -1</span><br><span class="line">&gt; &quot;This is my test key&quot;</span><br></pre></td></tr></table></figure>



<h2 id="GETSET"><a href="#GETSET" class="headerlink" title="GETSET"></a><a href="https://redis.io/commands/getset" target="_blank" rel="noopener"><strong>GETSET</strong></a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当 key 存在但不是字符串类型时，返回一个错误。Redis Getset 命令用于设置指定 key 的值，并返回 key 的旧值。当 key 没有旧值时，即 key 不存在时，返回 nil 。</span><br></pre></td></tr></table></figure>

<h2 id="INCR"><a href="#INCR" class="headerlink" title="INCR"></a><a href="https://redis.io/commands/incr" target="_blank" rel="noopener">INCR</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将key对应的值加上步长. 如果key不存在, 会在加之前将key的值设为0. 操作类型不对会报错. incrby只能作用于64位有符号整形数据(64-bit signed integer.)</span><br></pre></td></tr></table></figure>

<h2 id="INCRBY"><a href="#INCRBY" class="headerlink" title="INCRBY"></a><a href="https://redis.io/commands/incrby" target="_blank" rel="noopener">INCRBY</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将key对应的值加上步长. 如果key不存在, 会在加之前将key的值设为0. 操作类型不对会报错. incrby只能作用于64位有符号整形数据(64-bit signed integer.)</span><br></pre></td></tr></table></figure>

<h2 id="INCRBYFLOAT"><a href="#INCRBYFLOAT" class="headerlink" title="INCRBYFLOAT"></a><a href="https://redis.io/commands/incrbyfloat" target="_blank" rel="noopener">INCRBYFLOAT</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Incrbyfloat 命令为 key 中所储存的值加上指定的浮点数增量值。</span><br><span class="line">如果 key 不存在，那么 INCRBYFLOAT 会先将 key 的值设为 0 ，再执行加法操作。</span><br></pre></td></tr></table></figure>

<p><strong>注意: 改命令只有incrbyfloat, 没有对应的减浮点数的操作</strong></p>
<h2 id="MGET"><a href="#MGET" class="headerlink" title="MGET"></a><a href="https://redis.io/commands/mget" target="_blank" rel="noopener">MGET</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Mget 命令返回所有(一个或多个)给定 key 的值。 如果给定的 key 里面，有某个 key 不存在，那么这个 key 返回特殊值 nil 。</span><br></pre></td></tr></table></figure>

<h2 id="MSET"><a href="#MSET" class="headerlink" title="MSET"></a><a href="https://redis.io/commands/mset" target="_blank" rel="noopener">MSET</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Mset 命令用于同时设置一个或多个 key-value 对。</span><br></pre></td></tr></table></figure>

<h2 id="MSETNX"><a href="#MSETNX" class="headerlink" title="MSETNX"></a><a href="https://redis.io/commands/msetnx" target="_blank" rel="noopener">MSETNX</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Msetnx 命令用于所有给定 key 都不存在时，同时设置一个或多个 key-value 对。</span><br></pre></td></tr></table></figure>



<h2 id="PSETEX"><a href="#PSETEX" class="headerlink" title="PSETEX"></a><a href="https://redis.io/commands/psetex" target="_blank" rel="noopener">PSETEX</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">这个命令和 SETEX 命令相似，但它以毫秒为单位设置 key 的生存时间，而不是像 SETEX 命令那样，以秒为单位。</span><br></pre></td></tr></table></figure>

<h2 id="SET"><a href="#SET" class="headerlink" title="SET"></a><a href="https://redis.io/commands/set" target="_blank" rel="noopener">SET</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis SET 命令用于设置给定 key 的值。如果 key 已经存储其他值， SET 就覆写旧值，且无视类型。</span><br></pre></td></tr></table></figure>



<h2 id="SETBIT"><a href="#SETBIT" class="headerlink" title="SETBIT"></a><a href="https://redis.io/commands/setbit" target="_blank" rel="noopener">SETBIT</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Setbit 命令用于对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。</span><br></pre></td></tr></table></figure>

<h2 id="SETEX"><a href="#SETEX" class="headerlink" title="SETEX"></a><a href="https://redis.io/commands/setex" target="_blank" rel="noopener">SETEX</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Setex 命令为指定的 key 设置值及其过期时间。如果 key 已经存在， SETEX 命令将会替换旧的值。</span><br></pre></td></tr></table></figure>



<h2 id="SETNX"><a href="#SETNX" class="headerlink" title="SETNX"></a><a href="https://redis.io/commands/setnx" target="_blank" rel="noopener">SETNX</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Setnx（SET if Not eXists） 命令在指定的 key 不存在时，为 key 设置指定的值。</span><br></pre></td></tr></table></figure>



<h2 id="SETRANGE"><a href="#SETRANGE" class="headerlink" title="SETRANGE"></a><a href="https://redis.io/commands/setrange" target="_blank" rel="noopener">SETRANGE</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Setrange 命令用指定的字符串覆盖给定 key 所储存的字符串值，覆盖的位置从偏移量 offset 开始。</span><br></pre></td></tr></table></figure>



<h2 id="STRALGO"><a href="#STRALGO" class="headerlink" title="STRALGO"></a><a href="https://redis.io/commands/stralgo" target="_blank" rel="noopener">STRALGO</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The STRALGO implements complex algorithms that operate on strings. Right now the only algorithm implemented is the LCS algorithm (longest common substring). However new algorithms could be implemented in the future. The goal of this command is to provide to Redis users algorithms that need fast implementations and are normally not provided in the standard library of most programming languages.</span><br><span class="line"></span><br><span class="line">The first argument of the command selects the algorithm to use, right now the argument must be &quot;LCS&quot;, since this is the only implemented one.</span><br></pre></td></tr></table></figure>



<h2 id="STRLEN"><a href="#STRLEN" class="headerlink" title="STRLEN"></a><a href="https://redis.io/commands/strlen" target="_blank" rel="noopener">STRLEN</a></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis Strlen 命令用于获取指定 key 所储存的字符串值的长度。当 key 储存的不是字符串值时，返回一个错误。</span><br></pre></td></tr></table></figure>



<h1 id="List-类型操作"><a href="#List-类型操作" class="headerlink" title="List 类型操作"></a><a href="https://redis.io/commands/lrange" target="_blank" rel="noopener">List</a> 类型操作</h1><h2 id="BLPOP"><a href="#BLPOP" class="headerlink" title="BLPOP"></a><a href="https://redis.io/commands/blpop" target="_blank" rel="noopener"><strong>BLPOP</strong></a></h2><h2 id="BRPOP"><a href="#BRPOP" class="headerlink" title="BRPOP"></a><a href="https://redis.io/commands/brpop" target="_blank" rel="noopener">BRPOP</a></h2><h2 id="BRPOPLPUSH"><a href="#BRPOPLPUSH" class="headerlink" title="BRPOPLPUSH"></a><a href="https://redis.io/commands/brpoplpush" target="_blank" rel="noopener">BRPOPLPUSH</a></h2><h2 id="LINDEX"><a href="#LINDEX" class="headerlink" title="LINDEX"></a><a href="https://redis.io/commands/lindex" target="_blank" rel="noopener">LINDEX</a></h2><h2 id="LINSERT"><a href="#LINSERT" class="headerlink" title="LINSERT"></a><a href="https://redis.io/commands/linsert" target="_blank" rel="noopener">LINSERT</a></h2><h2 id="LLEN"><a href="#LLEN" class="headerlink" title="LLEN"></a><a href="https://redis.io/commands/llen" target="_blank" rel="noopener">LLEN</a></h2><h2 id="LPOP"><a href="#LPOP" class="headerlink" title="LPOP"></a><a href="https://redis.io/commands/lpop" target="_blank" rel="noopener">LPOP</a></h2><h2 id="LPOS"><a href="#LPOS" class="headerlink" title="LPOS"></a><a href="https://redis.io/commands/lpos" target="_blank" rel="noopener">LPOS</a></h2><h2 id="LPUSH"><a href="#LPUSH" class="headerlink" title="LPUSH"></a><a href="https://redis.io/commands/lpush" target="_blank" rel="noopener">LPUSH</a></h2><h2 id="LPUSHX"><a href="#LPUSHX" class="headerlink" title="LPUSHX"></a><a href="https://redis.io/commands/lpushx" target="_blank" rel="noopener">LPUSHX</a></h2><h2 id="LRANGE"><a href="#LRANGE" class="headerlink" title="LRANGE"></a><a href="https://redis.io/commands/lrange" target="_blank" rel="noopener">LRANGE</a></h2><h2 id="LREM"><a href="#LREM" class="headerlink" title="LREM"></a><a href="https://redis.io/commands/lrem" target="_blank" rel="noopener">LREM</a></h2><h2 id="LSET"><a href="#LSET" class="headerlink" title="LSET"></a><a href="https://redis.io/commands/lset" target="_blank" rel="noopener">LSET</a></h2><h2 id="LTRIM"><a href="#LTRIM" class="headerlink" title="LTRIM"></a><a href="https://redis.io/commands/ltrim" target="_blank" rel="noopener">LTRIM</a></h2><h2 id="RPOP"><a href="#RPOP" class="headerlink" title="RPOP"></a><a href="https://redis.io/commands/rpop" target="_blank" rel="noopener">RPOP</a></h2><h2 id="RPOPLPUSH"><a href="#RPOPLPUSH" class="headerlink" title="RPOPLPUSH"></a><a href="https://redis.io/commands/rpoplpush" target="_blank" rel="noopener">RPOPLPUSH</a></h2><h2 id="RPUSH"><a href="#RPUSH" class="headerlink" title="RPUSH"></a><a href="https://redis.io/commands/rpush" target="_blank" rel="noopener">RPUSH</a></h2><h2 id="RPUSHX"><a href="#RPUSHX" class="headerlink" title="RPUSHX"></a><a href="https://redis.io/commands/rpushx" target="_blank" rel="noopener">RPUSHX</a></h2><h1 id="Set-类型操作"><a href="#Set-类型操作" class="headerlink" title="Set 类型操作"></a><a href="https://redis.io/commands/sadd" target="_blank" rel="noopener">Set</a> 类型操作</h1><h2 id="SADD"><a href="#SADD" class="headerlink" title="SADD"></a><a href="https://redis.io/commands/sadd" target="_blank" rel="noopener"><strong>SADD</strong></a></h2><h2 id="SCARD"><a href="#SCARD" class="headerlink" title="SCARD"></a><a href="https://redis.io/commands/scard" target="_blank" rel="noopener">SCARD</a></h2><h2 id="SDIFF"><a href="#SDIFF" class="headerlink" title="SDIFF"></a><a href="https://redis.io/commands/sdiff" target="_blank" rel="noopener">SDIFF</a></h2><h2 id="SDIFFSTORE"><a href="#SDIFFSTORE" class="headerlink" title="SDIFFSTORE"></a><a href="https://redis.io/commands/sdiffstore" target="_blank" rel="noopener">SDIFFSTORE</a></h2><h2 id="SINTER"><a href="#SINTER" class="headerlink" title="SINTER"></a><a href="https://redis.io/commands/sinter" target="_blank" rel="noopener">SINTER</a></h2><h2 id="SINTERSTORE"><a href="#SINTERSTORE" class="headerlink" title="SINTERSTORE"></a><a href="https://redis.io/commands/sinterstore" target="_blank" rel="noopener">SINTERSTORE</a></h2><h2 id="SISMEMBER"><a href="#SISMEMBER" class="headerlink" title="SISMEMBER"></a><a href="https://redis.io/commands/sismember" target="_blank" rel="noopener">SISMEMBER</a></h2><h2 id="SMEMBERS"><a href="#SMEMBERS" class="headerlink" title="SMEMBERS"></a><a href="https://redis.io/commands/smembers" target="_blank" rel="noopener">SMEMBERS</a></h2><h2 id="SMOVE"><a href="#SMOVE" class="headerlink" title="SMOVE"></a><a href="https://redis.io/commands/smove" target="_blank" rel="noopener">SMOVE</a></h2><h2 id="SPOP"><a href="#SPOP" class="headerlink" title="SPOP"></a><a href="https://redis.io/commands/spop" target="_blank" rel="noopener">SPOP</a></h2><h2 id="SRANDMEMBER"><a href="#SRANDMEMBER" class="headerlink" title="SRANDMEMBER"></a><a href="https://redis.io/commands/srandmember" target="_blank" rel="noopener">SRANDMEMBER</a></h2><h2 id="SREM"><a href="#SREM" class="headerlink" title="SREM"></a><a href="https://redis.io/commands/srem" target="_blank" rel="noopener">SREM</a></h2><h2 id="SSCAN"><a href="#SSCAN" class="headerlink" title="SSCAN"></a><a href="https://redis.io/commands/sscan" target="_blank" rel="noopener">SSCAN</a></h2><h2 id="SUNION"><a href="#SUNION" class="headerlink" title="SUNION"></a><a href="https://redis.io/commands/sunion" target="_blank" rel="noopener">SUNION</a></h2><h2 id="SUNIONSTORE"><a href="#SUNIONSTORE" class="headerlink" title="SUNIONSTORE"></a><a href="https://redis.io/commands/sunionstore" target="_blank" rel="noopener">SUNIONSTORE</a></h2><h2 id="Hash-类型操作"><a href="#Hash-类型操作" class="headerlink" title="Hash 类型操作"></a><a href="https://redis.io/commands/lrange" target="_blank" rel="noopener">Hash</a> 类型操作</h2><h2 id="HDEL"><a href="#HDEL" class="headerlink" title="HDEL"></a><a href="https://redis.io/commands/hdel" target="_blank" rel="noopener">HDEL</a></h2><h2 id="HEXISTS"><a href="#HEXISTS" class="headerlink" title="HEXISTS"></a><a href="https://redis.io/commands/hexists" target="_blank" rel="noopener">HEXISTS</a></h2><h2 id="HGET"><a href="#HGET" class="headerlink" title="HGET"></a><a href="https://redis.io/commands/hget" target="_blank" rel="noopener">HGET</a></h2><h2 id="HGETALL"><a href="#HGETALL" class="headerlink" title="HGETALL"></a><a href="https://redis.io/commands/hgetall" target="_blank" rel="noopener">HGETALL</a></h2><h2 id="HINCRBY"><a href="#HINCRBY" class="headerlink" title="HINCRBY"></a><a href="https://redis.io/commands/hincrby" target="_blank" rel="noopener">HINCRBY</a></h2><h2 id="HINCRBYFLOAT"><a href="#HINCRBYFLOAT" class="headerlink" title="HINCRBYFLOAT"></a><a href="https://redis.io/commands/hincrbyfloat" target="_blank" rel="noopener">HINCRBYFLOAT</a></h2><h2 id="HKEYS"><a href="#HKEYS" class="headerlink" title="HKEYS"></a><a href="https://redis.io/commands/hkeys" target="_blank" rel="noopener">HKEYS</a></h2><h2 id="HLEN"><a href="#HLEN" class="headerlink" title="HLEN"></a><a href="https://redis.io/commands/hlen" target="_blank" rel="noopener">HLEN</a></h2><h2 id="HMGET"><a href="#HMGET" class="headerlink" title="HMGET"></a><a href="https://redis.io/commands/hmget" target="_blank" rel="noopener">HMGET</a></h2><h2 id="HMSET"><a href="#HMSET" class="headerlink" title="HMSET"></a><a href="https://redis.io/commands/hmset" target="_blank" rel="noopener">HMSET</a></h2><h2 id="HSCAN"><a href="#HSCAN" class="headerlink" title="HSCAN"></a><a href="https://redis.io/commands/hscan" target="_blank" rel="noopener">HSCAN</a></h2><h2 id="HSET"><a href="#HSET" class="headerlink" title="HSET"></a><a href="https://redis.io/commands/hset" target="_blank" rel="noopener">HSET</a></h2><h2 id="HSETNX"><a href="#HSETNX" class="headerlink" title="HSETNX"></a><a href="https://redis.io/commands/hsetnx" target="_blank" rel="noopener">HSETNX</a></h2><h2 id="HSTRLEN"><a href="#HSTRLEN" class="headerlink" title="HSTRLEN"></a><a href="https://redis.io/commands/hstrlen" target="_blank" rel="noopener"><strong>HSTRLEN</strong></a></h2><h2 id="HVALS"><a href="#HVALS" class="headerlink" title="HVALS"></a><a href="https://redis.io/commands/hvals" target="_blank" rel="noopener">HVALS</a></h2><h2 id="Zset-类型操作"><a href="#Zset-类型操作" class="headerlink" title="Zset 类型操作"></a><a href="https://redis.io/commands/lrange" target="_blank" rel="noopener">Zset</a> 类型操作</h2><h2 id="BZPOPMAX"><a href="#BZPOPMAX" class="headerlink" title="BZPOPMAX"></a><a href="https://redis.io/commands/bzpopmax" target="_blank" rel="noopener">BZPOPMAX</a></h2><h2 id="BZPOPMIN"><a href="#BZPOPMIN" class="headerlink" title="BZPOPMIN"></a><a href="https://redis.io/commands/bzpopmin" target="_blank" rel="noopener">BZPOPMIN</a></h2><h2 id="ZADD"><a href="#ZADD" class="headerlink" title="ZADD"></a><a href="https://redis.io/commands/zadd" target="_blank" rel="noopener"><strong>ZADD</strong></a></h2><h2 id="ZCARD"><a href="#ZCARD" class="headerlink" title="ZCARD"></a><a href="https://redis.io/commands/zcard" target="_blank" rel="noopener">ZCARD</a></h2><h2 id="ZCOUNT"><a href="#ZCOUNT" class="headerlink" title="ZCOUNT"></a><a href="https://redis.io/commands/zcount" target="_blank" rel="noopener">ZCOUNT</a></h2><h2 id="ZINCRBY"><a href="#ZINCRBY" class="headerlink" title="ZINCRBY"></a><a href="https://redis.io/commands/zincrby" target="_blank" rel="noopener">ZINCRBY</a></h2><h2 id="ZINTERSTORE"><a href="#ZINTERSTORE" class="headerlink" title="ZINTERSTORE"></a><a href="https://redis.io/commands/zinterstore" target="_blank" rel="noopener">ZINTERSTORE</a></h2><h2 id="ZLEXCOUNT"><a href="#ZLEXCOUNT" class="headerlink" title="ZLEXCOUNT"></a><a href="https://redis.io/commands/zlexcount" target="_blank" rel="noopener">ZLEXCOUNT</a></h2><h2 id="ZPOPMAX"><a href="#ZPOPMAX" class="headerlink" title="ZPOPMAX"></a><a href="https://redis.io/commands/zpopmax" target="_blank" rel="noopener">ZPOPMAX</a></h2><h2 id="ZPOPMIN"><a href="#ZPOPMIN" class="headerlink" title="ZPOPMIN"></a><a href="https://redis.io/commands/zpopmin" target="_blank" rel="noopener">ZPOPMIN</a></h2><h2 id="ZRANGE"><a href="#ZRANGE" class="headerlink" title="ZRANGE"></a><a href="https://redis.io/commands/zrange" target="_blank" rel="noopener">ZRANGE</a></h2><h2 id="ZRANGEBYLEX"><a href="#ZRANGEBYLEX" class="headerlink" title="ZRANGEBYLEX"></a><a href="https://redis.io/commands/zrangebylex" target="_blank" rel="noopener">ZRANGEBYLEX</a></h2><h2 id="ZRANGEBYSCORE"><a href="#ZRANGEBYSCORE" class="headerlink" title="ZRANGEBYSCORE"></a><a href="https://redis.io/commands/zrangebyscore" target="_blank" rel="noopener">ZRANGEBYSCORE</a></h2><h2 id="ZRANK"><a href="#ZRANK" class="headerlink" title="ZRANK"></a><a href="https://redis.io/commands/zrank" target="_blank" rel="noopener">ZRANK</a></h2><h2 id="ZREM"><a href="#ZREM" class="headerlink" title="ZREM"></a><a href="https://redis.io/commands/zrem" target="_blank" rel="noopener">ZREM</a></h2><h2 id="ZREMRANGEBYLEX"><a href="#ZREMRANGEBYLEX" class="headerlink" title="ZREMRANGEBYLEX"></a><a href="https://redis.io/commands/zremrangebylex" target="_blank" rel="noopener">ZREMRANGEBYLEX</a></h2><h2 id="ZREMRANGEBYRANK"><a href="#ZREMRANGEBYRANK" class="headerlink" title="ZREMRANGEBYRANK"></a><a href="https://redis.io/commands/zremrangebyrank" target="_blank" rel="noopener">ZREMRANGEBYRANK</a></h2><h2 id="ZREMRANGEBYSCORE"><a href="#ZREMRANGEBYSCORE" class="headerlink" title="ZREMRANGEBYSCORE"></a><a href="https://redis.io/commands/zremrangebyscore" target="_blank" rel="noopener">ZREMRANGEBYSCORE</a></h2><h2 id="ZREVRANGE"><a href="#ZREVRANGE" class="headerlink" title="ZREVRANGE"></a><a href="https://redis.io/commands/zrevrange" target="_blank" rel="noopener">ZREVRANGE</a></h2><h2 id="ZREVRANGEBYLEX"><a href="#ZREVRANGEBYLEX" class="headerlink" title="ZREVRANGEBYLEX"></a><a href="https://redis.io/commands/zrevrangebylex" target="_blank" rel="noopener">ZREVRANGEBYLEX</a></h2><h2 id="ZREVRANGEBYSCORE"><a href="#ZREVRANGEBYSCORE" class="headerlink" title="ZREVRANGEBYSCORE"></a><a href="https://redis.io/commands/zrevrangebyscore" target="_blank" rel="noopener">ZREVRANGEBYSCORE</a></h2><h2 id="ZREVRANK"><a href="#ZREVRANK" class="headerlink" title="ZREVRANK"></a><a href="https://redis.io/commands/zrevrank" target="_blank" rel="noopener">ZREVRANK</a></h2><h2 id="ZSCAN"><a href="#ZSCAN" class="headerlink" title="ZSCAN"></a><a href="https://redis.io/commands/zscan" target="_blank" rel="noopener">ZSCAN</a></h2><h2 id="ZSCORE"><a href="#ZSCORE" class="headerlink" title="ZSCORE"></a><a href="https://redis.io/commands/zscore" target="_blank" rel="noopener">ZSCORE</a></h2><h2 id="ZUNIONSTORE"><a href="#ZUNIONSTORE" class="headerlink" title="ZUNIONSTORE"></a><a href="https://redis.io/commands/zunionstore" target="_blank" rel="noopener">ZUNIONSTORE</a></h2><h1 id="公共命令-可操作性所有数据类型"><a href="#公共命令-可操作性所有数据类型" class="headerlink" title="公共命令 (可操作性所有数据类型)"></a><a href="https://redis.io/commands/del" target="_blank" rel="noopener">公共命令</a> <font color="red">(可操作性所有数据类型)</font></h1><h2 id="del-删除key"><a href="#del-删除key" class="headerlink" title="del 删除key"></a>del 删除key</h2><p>dump 序列化key</p>
<p>exists 判断key是否存在</p>
<p>ttl 查看key的有效期</p>
<p>expire 设置key的有效期</p>
<p>persist 移除key的过期时间</p>
<h2 id="DEL"><a href="#DEL" class="headerlink" title="DEL"></a><a href="https://redis.io/commands/del" target="_blank" rel="noopener"><strong>DEL</strong></a></h2><h2 id="DUMP"><a href="#DUMP" class="headerlink" title="DUMP"></a><a href="https://redis.io/commands/dump" target="_blank" rel="noopener">DUMP</a></h2><h2 id="EXISTS"><a href="#EXISTS" class="headerlink" title="EXISTS"></a><a href="https://redis.io/commands/exists" target="_blank" rel="noopener">EXISTS</a></h2><h2 id="EXPIRE"><a href="#EXPIRE" class="headerlink" title="EXPIRE"></a><a href="https://redis.io/commands/expire" target="_blank" rel="noopener">EXPIRE</a></h2><h2 id="EXPIREAT"><a href="#EXPIREAT" class="headerlink" title="EXPIREAT"></a><a href="https://redis.io/commands/expireat" target="_blank" rel="noopener">EXPIREAT</a></h2><h2 id="KEYS"><a href="#KEYS" class="headerlink" title="KEYS"></a><a href="https://redis.io/commands/keys" target="_blank" rel="noopener">KEYS</a></h2><h2 id="MIGRATE"><a href="#MIGRATE" class="headerlink" title="MIGRATE"></a><a href="https://redis.io/commands/migrate" target="_blank" rel="noopener">MIGRATE</a></h2><h2 id="MOVE"><a href="#MOVE" class="headerlink" title="MOVE"></a><a href="https://redis.io/commands/move" target="_blank" rel="noopener">MOVE</a></h2><h2 id="OBJECT"><a href="#OBJECT" class="headerlink" title="OBJECT"></a><a href="https://redis.io/commands/object" target="_blank" rel="noopener">OBJECT</a></h2><h2 id="PERSIST"><a href="#PERSIST" class="headerlink" title="PERSIST"></a><a href="https://redis.io/commands/persist" target="_blank" rel="noopener">PERSIST</a></h2><h2 id="PEXPIRE"><a href="#PEXPIRE" class="headerlink" title="PEXPIRE"></a><a href="https://redis.io/commands/pexpire" target="_blank" rel="noopener">PEXPIRE</a></h2><h2 id="PEXPIREAT"><a href="#PEXPIREAT" class="headerlink" title="PEXPIREAT"></a><a href="https://redis.io/commands/pexpireat" target="_blank" rel="noopener">PEXPIREAT</a></h2><h2 id="PTTL"><a href="#PTTL" class="headerlink" title="PTTL"></a><a href="https://redis.io/commands/pttl" target="_blank" rel="noopener">PTTL</a></h2><h2 id="RANDOMKEY"><a href="#RANDOMKEY" class="headerlink" title="RANDOMKEY"></a><a href="https://redis.io/commands/randomkey" target="_blank" rel="noopener">RANDOMKEY</a></h2><h2 id="RENAME"><a href="#RENAME" class="headerlink" title="RENAME"></a><a href="https://redis.io/commands/rename" target="_blank" rel="noopener">RENAME</a></h2><h2 id="RENAMENX"><a href="#RENAMENX" class="headerlink" title="RENAMENX"></a><a href="https://redis.io/commands/renamenx" target="_blank" rel="noopener">RENAMENX</a></h2><h2 id="RESTORE"><a href="#RESTORE" class="headerlink" title="RESTORE"></a><a href="https://redis.io/commands/restore" target="_blank" rel="noopener">RESTORE</a></h2><h2 id="SCAN"><a href="#SCAN" class="headerlink" title="SCAN"></a><a href="https://redis.io/commands/scan" target="_blank" rel="noopener">SCAN</a></h2><h2 id="SORT"><a href="#SORT" class="headerlink" title="SORT"></a><a href="https://redis.io/commands/sort" target="_blank" rel="noopener">SORT</a></h2><h2 id="TOUCH"><a href="#TOUCH" class="headerlink" title="TOUCH"></a><a href="https://redis.io/commands/touch" target="_blank" rel="noopener">TOUCH</a></h2><h2 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a><a href="https://redis.io/commands/ttl" target="_blank" rel="noopener">TTL</a></h2><h2 id="TYPE"><a href="#TYPE" class="headerlink" title="TYPE"></a><a href="https://redis.io/commands/type" target="_blank" rel="noopener">TYPE</a></h2><h2 id="UNLINK"><a href="#UNLINK" class="headerlink" title="UNLINK"></a><a href="https://redis.io/commands/unlink" target="_blank" rel="noopener">UNLINK</a></h2><h2 id="WAIT"><a href="#WAIT" class="headerlink" title="WAIT"></a><a href="https://redis.io/commands/wait" target="_blank" rel="noopener">WAIT</a></h2><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p> 四种数据类型(, 除string外的: list/set/zset/hash) 在第一次使用时, 如果容器不存在, 就自动创建一个. 如果里面没元素了, 就自动删除容器释放内存.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>NoSQL</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Jt_day01</title>
    <url>/2020/07/12/jt-day01/</url>
    <content><![CDATA[<p>电商项目从零到一, SSM-based</p>
<a id="more"></a>


<h1 id="1-电商项目概述"><a href="#1-电商项目概述" class="headerlink" title="1 电商项目概述"></a>1 <strong>电商项目概述</strong></h1><h2 id="1-1-电商行业特点"><a href="#1-1-电商行业特点" class="headerlink" title="1.1 电商行业特点"></a>1.1 电商行业特点</h2><ol>
<li><ol>
<li><ol>
<li><strong>高并发</strong></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>概念:单位时间内,<strong>用户大量的请求需求</strong>,需要服务器快速响应.</p>
<p>案例:</p>
<p>新浪微博,明显并发能力不足.</p>
<p>天猫双11. 12万笔/秒 —-à银行 数据库处理能力4200万/秒</p>
<p>常识:</p>
<p>Tomcat并发能力 150个/秒</p>
<p>并发量计算:</p>
<p>日活量:每天接收用户请求数量</p>
<p>一台tomcat: 150/s  折中计算每天可以处理680万次用户请求</p>
<ol>
<li><p><strong>分布式</strong></p>
</li>
<li><ol>
<li><strong>分布式计算</strong></li>
</ol>
</li>
</ol>
<p>说明:假设一项任务由一个人完成需要10个小时.如果这个任务由10个人同时工作.1个小时完成.</p>
<p>特点:每个线程完成不同的任务</p>
<p>行业发展:一项任务由一个线程完成,可能会出错.出错后需要重新开始计算.不符合行业发展的需要.—-à大数据</p>
<p>对比:如果由10个人工作10个小时同样完成10项任务.</p>
<p>每个线程完成相同的任务.</p>
<ol>
<li><strong>分布式系统</strong></li>
</ol>
<p>知识回顾:</p>
<p><img src="/2020/07/12/jt-day01/1.png" alt="管理 "></p>
<p>问题描述:</p>
<p>当前项目所有的<strong>模块都部署到一台**</strong>tomcat**服务器中,如果有一个模块</p>
<p>出现了问题.可能会对整个服务产生影响.</p>
<ol>
<li><strong>什么是项目拆分</strong></li>
</ol>
<p>说明:根据特定的规则.将项目中的模块或者层级代码.拆分到不同的tomcat服务器中.</p>
<ol>
<li><strong>项目垂直拆分</strong></li>
</ol>
<p><strong>概念</strong>:根据<strong>模块**</strong>(<strong><strong>业务</strong></strong>)**将项目进行拆分</p>
<p>特点:对外是统一的,对内是独立的.</p>
<p>目的:降低系统架构之间的耦合</p>
<p><img src="/2020/07/12/jt-day01/2.png" alt="www.jd.com"></p>
<ol>
<li><strong>项目水平拆分</strong></li>
</ol>
<p>概念:根据<strong>层级代码</strong>(Controller/Service/Mapper/POJO/接口)将项目进行拆分.</p>
<p>说明:因为项目足够的复杂.项目进行不能同时得到保证.</p>
<p>拆分案例:淘宝taobao-manage(c/s/m/p)  pom(聚合项目)</p>
<p>​    Taobao-manage-controller war</p>
<p>Taobao-manage-service   jar</p>
<p>Taobao-manage-mapper   jar</p>
<p>Taobao-manage-pojo      jar</p>
<ol>
<li><p><strong>项目水平拆分 **</strong>—<strong>**聚合项目</strong></p>
</li>
<li><p>创建父级项目</p>
</li>
</ol>
<p><img src="/2020/07/12/jt-day01/3.png" alt="pom项目"></p>
<ol>
<li>创建层级项目—pojo</li>
</ol>
<p>明确关系:子父级项目</p>
<p><img src="/2020/07/12/jt-day01/4.png" alt="p*ts SCM  М — М они "> </p>
<p><img src="data:image/png;base64,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" alt="一 凵 一 。 d 5 ~ , u •u•eN PON "></p>
<ol>
<li><p>项目创建的结构</p>
<p>图中表示为一个聚合项目.一个大型项目中包含了小的项目.</p>
</li>
</ol>
<p><img src="/2020/07/12/jt-day01/5.png" alt="目录层级"></p>
<p><strong>聚合项目中**</strong>jar<strong>**包依赖问题</strong></p>
<p>说明:根据项目拆分规则.导致将层级代码进行了拆分,拆分为多个项目.但是程序需要进行依次的调用.需要</p>
<p>Controller—àService—-àMapper—àPOJO.</p>
<p>该方式可以通过依赖的形式解决.<strong>根据依赖的传递性</strong>,可以进行最简配置</p>
<p>打包:只需要将taobao-manage直接打包,则全部的子项目自动打包.比较方便.</p>
<ol>
<li><strong>集群搭建</strong></li>
</ol>
<p>说明:<strong>抗击高并发的最为有效的手段就是搭建集群</strong>.集群中的服务都是相同.</p>
<p>如果有不同的服务则搭建不同的集群.</p>
<p>问题:如果集群中的服务器宕机,则影响程序的运行.</p>
<p>解决:实现集群的高可用(HA) 核心思想:当服务器出现故障时,可以<strong>自动</strong>的实现故障迁移.</p>
<p>检测机制:心跳检测(默认检测次数3次)</p>
<ol>
<li><strong>海量数据处理</strong></li>
</ol>
<p>说明:随着公司的发展.后台的数据量会激增.如何快速的处理/检索.是现在企业中面临的主要的问题.</p>
<p>大数据….</p>
<ol>
<li><strong>网络安全</strong></li>
</ol>
<p>阿里每天遭受16亿/天  神盾局  1.高薪工作 2.100万(违法)</p>
<ol>
<li><p><strong>京淘环境搭建</strong></p>
</li>
<li><ol>
<li><strong>JDK**</strong>配置**</li>
</ol>
</li>
</ol>
<p>1.检查JDK配置 </p>
<p><img src="/2020/07/12/jt-day01/6.png" alt="JDK环境"> </p>
<p>![C: —version  java version “1. 8.0 45”  Java(TM)  sEyctJ/GRnFoEsUJ1m4/42WKdCk9bJSW5R55R7OPGcht24VC4+yoj7UHcQyHXOfFTpm+KuX8hqBHE29nKBMU/T+u1hXiqstIm+jRenbcbxZa8uiACfwnoHtoSrTqn/N9sYst3rXrENb8tfYrzoVD3Og17NQnT3e213a0zFy42gM88fkMqlwU4dTKlkYDUtzWk7+RiYtPtdR2cUdi51PDJZfDty49VdCTJ38fPpLTPxfTdEd0z0baKV0zJ85xrqJzPXzqyLScO4p7zmW13IGSKWsePCyWp+iSkre318/Pj+XyvYgnYfK4gcuWbumyBxKttCO8BLRLpIiaJ2KGkIufF1g0QIcDnIeTdOd3XLFZuXXP3cK8SKr6yM6kL2yWrh0yz0DgsiUJFKqeI5OBFS9PREaFChJWmEw962J6UgPJlpknVr5sFEp3ZVRORpnFgctW9upqnRW48YnUWbddGt/eJtdog4QoNhNSMtNnyTPcXuinnovyE5fqVP901AR0nwodHHZc1iyt1yt5Mk5vX6bJc/a8p0Lj/9llUsTLq0x6SZlbsq4KFl33YCkiqiOMV1wU/UfRgdjBmslEXKPSp7mvV8VO0nfmR+A8fOUctW2WtApNap1fQaM5N3IVqaeI7LbfNHTg4UETwGOJrxxX+asWMoPq4l7a6yyioXi0c7AFdSWNDZaQ24JGFEkCJLDHBHbSLu1x/qkaCeCVmP0mq0GAAN6b5Wcab4dmfErO0NCXp5wGstzmMp4hmp5twDEOCfzDBLbdLv3DaJn1AyDAfvMACukHVdTmpzXBp37C9w/qy6RJgARIgARIgARIgAQOlYCe92lNL1qv3mR+URdzXA6VCvUmARIgARIgAT+B0ETbUmh3RmspAC+QAAmQAAmQAAmQAAmQAAmQAAmQAAn8DIFtz1fjfKCfKVemevgEtv1sHj4h5oAESKB7Auy1u2dKiS4B1DLTDc293cn5LtLoRFEKIYE9IsDnZo8Kg6qQwD9FgK3PP1Xcu88sljzYjX+/rK2wdSN39/yYIglsi8DOns1tZYBySYAEDpkAe+1DLr09112WQNjZ2lKsyXteG6jePhHwPJt9+W15tbk6BEoHaKE2vmv0Oqlj/rD6ddnby/uKHMHtTdkcSk3uQs+ueu3/maVX4cjn7MVgxtq3Y6C5n+hNRKCa4XNoZ2/rOVIbhQwHvXQ/E7WUwN+PP39OF4vlvjEr9MF25NhE8czR0EZXhE6PNOQCvAE9D2uIMNDLhn7D+/nV3/OIPU1yWTEH6JGL/U8id00RHd3NaWLSkjBG/uwo6/X6u3KnEnzLwK436+e7851WjMOsnzbbbZ0VVVlSsKqzWc6ru8uvadrYWIFSvYywRp1vrbTn2cwrOTaJby23JmJd/exfXcyHsm1k0pPGbl0jzritYqoWcjP147bcsQvVUMMpYetO45NQG9Jt6u3KXdrEdIOtyt2b4ng2RrOlCHX1c0vJWmK7qsmW0C2cdKPn9nptnWU8Q/YC9FsgsU2RIf3RBiBj2x/ak3Rk8+EsjzI8ISnvIu0szRb/ldrWrldKiKKZ58Zmi4wZNUXz9QBOb3juiN3W8fd3lViBHwuKAXztmIzKl0/BeJBKhJkQyl3VuIpy18lG6BevRn1IVdB5iWKvhsOon/UZ6y5EsCqrneCMQg4GTG9sVqXyDKkiKz+buC81yNAnj9HNQYP6qTLcWJMN1ZeGVZ71rK1Na3J57hC0w4wi78+LtQ0+DcvXv2wh9WbgdAeUPvO6WfIWVTTPNny2EKdB/dxC6pbIZgViRd3pSRd6diHDGvvcKYGDTgxNSbojvDcb49v7ybe18fz7+/L6/ENGZY9O0EzuajHVGj1d5ccXE4zB/XW1658cYXP0a/8SsMjY3ehldKoz9f75jSGQZDAaJ0tz/LT/Z5gPR7upLh+eMYB0MV5g++sufkI/wU7v+Wjq+6eI7Q3/9Bfvbt7yBGVgKT/Z6OD7s0gE5f5+/pGg3AfTq/4yV8lIYHl9+TE+Pf1Y+vkaIRuWphHTOdyb+unotVen73/f1pPiI4qt2+qpKMo2dd6WFnMWeDZjom4WJr5+bpZOu9jy2DpNLVraBB8xBrPb8dJpUr6frp0r7VINxKppQ7acekApfVlUQ9t+mbbi78vFeXL8Mru//TyziDTjWZnkjm7ud/3cEYTdJ9NFr/3f3av9G1I8PQ7aUsjeeDRIVq9lU+p98bTabe6r9XR06V9NobfRrWb3T4+T54dydrLbyfJ1pWzq/EKSuOeVikg/rwxWQ0DrQ2k+1883hXEASXhSVqvnp5JZXSSCWEfPz1sqHV3uYv0WCZpHMFHrTU9EqIRoCqw53p/6WaPoz95W1dJXL/E8fH2UdWtU58vRK68En83KWB3djK2fHSXXQIzCsi4XBh54TACQd2DjFyg2I8Rmh9VtyLZTr9RdcXLbdjTbYISX4iJqI55FtB8+2t/6+cNgtpp8B702rc82JSTdd/gnQ4WeFlEiYJzw+xjDhDv6VevpKKGGJ716f7xWGW4Qs3x4+sylYZ4jBhrtXALJerUKzgjroCKnyevm8821M98X19cV23epfuNmUeQhz8w+HTQqzQrF96d+Vii5D7fUoGbpRQovl0duBWtR5xtlMPxsNhLzOwOHX+t2md99bkNk3DwpD4go87NMr3xllxyZ1qEQ2LzXpvXZtKxlxkz9N9rgE7zc6qcfIzNxehoRZGRt7Xar6j6G5opvyUaM4tAM8f2GkUx73AGdZ/L2+lWEd49UP++OHbmBIs71B37z03dEpLTfqMlihKBgELH3kiSoFtwQx1djYwiiLKhxaZZFWFd+vn5a6uzpie6e7Rcpn/GZtKnzTfIcfjabSEFY1KNbc7ArjR64nN2tr58N1eg2eLAyd5tMlbTttyFVqdfc06+tnq9xH18yUFD6JlO+UpNAZ7fFIbu5sIj2s7nQncdol/edq2kkuHGv3WreJ9qqi2nuzZ3Afc7dGR5TUg0LLff3xMS13B3d8RGtl2lkewuHmKtuuEivV2UvZVN5KDCYvcBBOv3lOZRzeSeYTCbz28+bwFzJNBaWKDlNTk5Gw+PX8+sPgToZqC/6FQ6JHeqZapEpIxZS0ECyw1affaq5n8qWTC06dJ7frx/JMBxP2sGBdPOb2YDq27R3/DaY9Ph2evR8c71ZukHp6oYeuXInL6hnRAbNtKfw8+XCJyW61vki+69F108julntPLUT5skpCu9kNDo+GuTz8IpIxZoDzVsGaFEIgnty+dmMT93IUdShqpb2JGa8SXiekjZ1PkoDFUi9vXhSLUmwQK3uzPYnB4+J3Ua8wGWEiKufhqjIw5KOkfF8weB8e/kpc6bdx9fTEPgLzie18bWINmSLqUPdElMTiKo93q9xesay+k6lATbh2ZhSZYSsnUNP+vAntRLUMiAfmZ9+0YZoQXH1M6/fKpLqp7Okiiu2ZhbMcmtTBLYCytNW3Gp0lCkUn3cRb6buaxULFcyQ62o9raBVeVfSN+21G499gtTL/Wz49XRzlv1u3o4mmL5szrFZXp+dXcrUG3irnBXTmt8X52d3mGwCy/OscApRPqT1MguanR/Bze9+dvT9dKmzdPn0fTS7d11VRXn9kyyojGUEihwq1WSeH4yKAWSYzpiu2v1T9NbTibI4xfY9fk2Z6vQ9Dokd62kppNpr60rrE3fICO/enhfvsviNBz91O6sEy2iOXmRA3N0L/3cnVfQbyZNRFZ3bm5/icX68H36bTlCpUHlGzs7x0w9KIKn4WhcQ4LkcWT/zmLravWWPx81TIjXbGkL7M5LfcXKkX58QFZHmo9cbPDN4XHqDyVyHb9YyiApdpp5nKfKg/O0dbxLfnindMvfZmm8SW+ejFIl7NgviqFiXd99of4xCKsBbSQYuI0xc/bSE1Z+4hfk6mj9O1WpN9XG9Ifxz/tRon28KOzrtK2zjJouPyC/cMHgT819s0oZ0n7r5pPnKvXK6uBr8tOaWNObpZ9L4Kto51Q4eTW8vPqUfxFlvMn28lUYEp2hEBvBMNeTG1U9Vv1WHLT22crCSJlXSwnpphm2SSnYrqKet0yHdgBvU5OZ5TxvFGotFKdpATzdoMO9GKZRdPKyb1SdNrU81g2QlKxMWb5uy+pPHa0RNC7BqdqqK6xPSQGZ1Zty7vcm9bmSKv/nQaxEW9jTGaWEe5AOV4p+O6jmYGY13ET7mSATcPacmKHpqr/UDv8Pra0GHcVTpp830cRnaWxb9NvSMyUuLMKpRy+f8wyZsNhzZIkUdRffS358JxtgNY/7uDYTvy0uw4BmG7Wm5fLpJy8tW7c8qJj0qnseRtxq8FS+Kx8VN4ifOo+qnViyvdvkjj8dDdQ2pPSnBZF6t+qVudYg0/cpqtKoNa2PoLrplEFshfTi7S70R79LUuKDzyE/V+Sw7w3lBXEoEU8xh9WdGvw6ljeksRv4/cDm/39kBvk8PembvIS3tzVtn8lNBkgxsC8+DPbp9vEjUKxEMGljoumGw3qOaKlPfhuQSa1Nv09rElLtoYDx/uUKRB2GekQIaBMNHMt0P6nHZ5Csdv1++YjGVlsMT+lkwHazGF8NvzyIuUa2NysxWanJs3nM1TYvBb7HE65kLrWppGxRkTNCm1qeS6a8EpavK1dedQ+KZst9EZkye8jAyxOr85J3H/mnbt+TprZW337bsiDVnYlueX17eia9NLx8H9UcqL2ekkrcmT25LT79Gm121hozUpE/XDWgz+dWxj6bz4Zv1MrE4V+NvlnunjBnU2Z5iVmUD3k5FMk+dbk6G+/Pf5eVTMpUx8I26uOoMt7obWT+l2rmvi4IFZmYv9HSgAI6NAWXFEO9WhZrRLcNWUi/0iDhSRmXhQxdqvoBE5ptk/ePO6zyamG+3DStZzhHZ3WYQ7RHoTkBJwXWXsHS4amkhRyReTQdHMGby3hUWum4YbBPdiVZ9GtOGKAlRqbdobbZf7iGe1WDa3nU+km1gM1saqEUQsgYrVGjRrc2WanJk3uMtgQZ6RufdwrrhSVPrUw93WyM5mC2LAQHvT9o/2/z0td7NZHoTan9Rf6MJfkvLB/DapYDvGNcwX4pxUM8AXECy6vYKi367ekIHlV5Al8aXze+QaHcj25DIYHXa9JI3e8ElRLBaHyUg1ATVSW94X9WAy2d8NrJHshuK2VLw2vqpqp2vXJzqaekHQ8i0Na176Ulcy7Ct1H0aBa7pcdqsGfA1X1nEdnU+i135P+LZxGZBhnmvpaloheVcmcT2b+rZz163xu4SlxGcI880F6Qg3Ux5jk25YWigTIM2ZAupK0W3XO4VPBtw2oOg6QdarAEbLLTo1mYnNTnILN4SaKBndN7Lavl6h3Io75Wm1mcqBLPqrrLpM/P5fHoUWP5SdTLFEAls8dJiJblasTLzCF0cKOqB78Kq8c76nY0S0+NMMgyKQVDnO22l4Lzr2L6eauymsHYr1aq/WbCD5s47nS+2fDMPFIMveOU173wva2gqbtyzMpFGN9ORbGfstZGIrQYO1k81kTZcLnn1tLWLKG81TzIbi0Bsb8uwvdRtfSvPzIoDhSra2qZ1vjJZ62bLZ1Orbkn6wRN5xLf7g6l0L189rMGRuiTN8q0La98PmjF2sMqz9qlXiPWWe4umvRXPCr1+9lZmf84Ck63iW5vt1+QKUg0sgXg94/NuabZpr93c5x3zpudwlIEH2tPNw1LvHSPVdGLplZ3A/JwNxIKTnW/U96gbzwy4ZjIz2Z39D/Qo6iHursWUYVC1B0do0xs7P57Ut6undJ6D6v2AbA2rzrRfNVq8fhIz6VPV/kD2qpJx7qks9FQ766llRmA8wr3BwFi0oLiXr2WQTVIvbm1wpDXriu4GioSjBuunTJ/2P91hYfV34loGzFrZSur1+uUhtKJSdIl4HC3yG+5BwzrvRq863+TZjHgcqpLu9t7mz3hIn9amkmIbklpxvZs2pG3qFYqlt/Jy122PN4K2T7yF0pqnN6G9uKgf0Mr+Ib618ULbVTYDiXtshgbzfePznmZz4167ofWpzEzZsOss9v3S6GQCxmdzmV2Xcf6c2oIVXPtSzBm8nP8kmF3kC4vvPNPBJGplIU/q3erp6qefzSjd3Kiec/UgwJj98528PVSbguq1pIedOLzIPLI3v4TvYJ7E1OocnRqduaa6XVBjhXUw8jhbOmhcP/G4NxtOilO8vmVQcraUepyOKpTuvfFgnB5XGZ/p1M/YOt9AAUhWi7i1ezYDPVWj9Pc9cIyphCGOi+Sh7P+nLDDXGyAiw83akK5Tr1cwL/dw26P7GM+3jRie9RrsWwjxNXpeJVgM8epvoEX7+dYmCtpWLIGmeVcf9jfqtZt9eVfzXcs+CJXA0MnotcehbGliPGK2kVmZYKOb0rNU/jyPZmV49BRJMrG3eKuJ4L+tG8VsE7kt6FlKVro4y9GpFKLJBaVxD+tJ5a1gMLauxr65t8Eo/hsqB85MYytkvS5W8O5OPO8S3QlvJqlJ/dQdl1g9W/jVtQzaHyXwdX8L+oRE6lo1GN2OjrLHMRC0QZ0PSAhdbvVs7lGlQ74UHNVthjLZ9jqWq4MLc8mewFSucb52+fj2fjLI1/1qm1LbeLtN3S139aD5Wnbdx5Sm4sbwbEvi5+LpiRKL65C/ZHxbt72aHEFHJV4VrrBY4vWMz3uRcge9diPrU9fqpj142snc4sXDY2C0k1kw2PBIteq2Y1QmUdH1bv7jqQCYB5s3dLht756bScR/ed6L6mHccA8VlyL1bejpJqk9mYOql4JXX9B9tmd/t1I07W5XdpooBay/oBP1lafmWWM91CfQNoRq5+NKPpRETa0LRStfb1I/VaIBkwGbJeR1vpxKxJXqlgECtpp6hIJpENU2J4NBeM56FlDe3/CLmfiaRon9p6YON3w2VaWL0EW3wbGatA0X6uE2TB3DdLJkr8fN7XQ0PHGULRrU/IaeR1eywPL7HR7sKvVSuQfMT2/Wo3lidUisKxfvRtshyBaiikm6aikyn/tFdGuzpZocl6sGlkADPaPznivZRa/dyPrUrbCnLyp83vGBoTDDUk11J4MtUDzGp71QSZ41HFTLNENudKzmIov7g9uRarol52l/YuPR8Wf+RVUwOQvtpbHUCggep5hyr6JGhM2QW9DTkxV5Mg1fEE+I+Eu6ttSa2iEm8QmZIbV/TzkLJZ5mpK0fqzzCKHHXxNkwYavWxctqUj/12kiF32CRSv9qPtpwZyq9RPsg0DIgqe2mXuSl7kj33hFTqCLrfF163vvVz6bnjUuMC8clWjqZUkj1bHiT7Paici8vNXWbpY5BxeEbloQsayrPnDFQooowZP45D2b3dlWT1MtZqbpSKk18TSyXu7K4zAUvIVI3SqWsR/KUVMQnoqEbbVVWtnivsD0lkYD9Gd/abKMmR+e+gSUQr2d83rWe3fTajazPbN2aef5FQzYAhu97sVsFbMbCDMuA6s8GEVQAABD8SURBVMY78BKuCImxltl/cTIz2Zv/R2nerdS+ILkGkqnZAHtS+We3qtcPNKNpeEykG32ZQ3fqRQJzeLHIYyYSDzuEzif+RZDX38fzxywsAj5in1JsiWU3qt3r6WMnT6bvxdAX1nNNBjJOUkNeYTA6AE9wNIHzCdaftnPqCxh9TS2FjtXliwX+Bah/CUBLaB/L6eACXOTcFxErWP2J/XqmNjuaYMS7Jpe1n7fral29YlmIRvVT8YQrVl4/IUXyhCU9g6WW1YAsweD/ypZBYm019aBapRuKWKABS5rW+ZL02AtVz+bKbEJ0CUmdd1owPXBirG8pJTn6wmQ4eV++NdsrV6na+plHCIZM+835bfaESerTqNRz4daB9IHr5PjitvR7lM0arTdfZXIgj+NiJ3FJvrwuvQjVdlXzNSqCbUh06lb+Ik7iyl1bXNjAJGOPrKPhxUw/6xluxPNBLWUdoWJsEP19KDa0Gy5Y69SOFUf20Jdqd6Sbs5v66Nam85rcKO/xlkADPaPzDvBd9dr/cQsxPQ87YEi9xeOpfcHzLd5lmrLuYs29hXPhEDd6dfajzG+qtrK5TCO+dZiqkl0rvEjsLV+dObZutsr7vGcC9f/UTR8n7v6zuARDM/n78JGc/sm3bvduUI2gSttvbG6bRG3z3mB31wg9dZDSXwGVpNuSWTdtgrhVwJVwxW19HXm7+FTfxIo7Ei6PJZlvvESKSKj7weC8mA7zWor1GR6KRabdyE6FSW/nSrrB/ed+ISqs2pk8Wx6iiG0zKa47FbO4gaPKWmeFrDxpUD9TOdWPRzDz9RBBoapl0MlvLfVKSuZN5DCtyuZVHBelGFnnnfhNTyU999kc394m1zAjBBM2E1IiZU0Sf50v6pBquyTUKYzA5O3t9fPzY7nMvuEUObN1LNXPUEDjQTckqEdT7S6cbU59evsyTZ6d1I0Y4cNgvdNRyrUPIxsXRU+TKZDlOEtIGaWyqkv8HmV+TRwF4lLPtKj/36zcIc94jlSjlO+Vk6blz0WuiJMdXJeiDyyvmseKOzAqkVSwzwsMwOiYSPXhJN35HVdyJYwYVhJm/bTCZDGti7LrtzNj2KAU6rVVgp3VZEOhyLxL+rFqImBuWqSlHn7iYoRKLemu18bDhvkbV+ZrABJwL1klzJOuCCjSTZYA7SrhSjmohI92jagM3u6mpLF3OW+XFcYigV0R2MmzuavMMJ1DJiCd19a7iUMG9At177LXxpd3PYHDmj8Sdrj5hTiZpTIBrP1483R8Yb2RlENtdEVNxfE5C2wklZFJ4JcT2MGz+csJMnudEJDvr4k7t6MTyRSyrwS677Ux8ItfPgdC3q0PxpVtX0spWi8Fn++P0bwYkARIgARI4GcJYNizmFn/s6ow9UMloOd9WlOB1qu3wIyhQ83knuqNB1jmyma/8gSU7A7/kwAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkAAJkEBXBMa3Ly+3466kHZacfznvh1VS1JYESIAESIAESGDHBP5np9cfX11Mh4NeT11er56fXj9PTpK/i+W7HTDibPm6ms1G42S5DAfuXz3eT3RiEmh1d3adhYYBNxukMc3rYWF7dCcm70liZhHKr58vzxdeznZAI5x1w6Fk3bPZZCGB/+Lz5rpF4dryeEYCJEACJEACJEACLQjAFHl5eXm8HffTyDBF5Ur7EUyRGDH6CTMJ6V5lyZqqj2/9180w+3kcmfckpe7NvZkzHc6Dsy/4aiiFCQOwUeJmgjwmARIgARIgARIggW0Q+G8mdHyLQUgZVStGwt6Xi/Ozu1WSHJ34LMMsZvj/+9+39WBaa1iFBeDO96d3NLAyzj7cjM37++d3VC7fF08oCU9RAM/6+cY/ZloPYnl9fvM1nddYr/VyGIIESIAESIAESIAE4gik1uf4Fl+5vUbM8vpu1Ts+jZPmhhITrDf80852dYUd2HnneV8+PK+T3uTCmUo7Hh29/d3EQn9fnN+8DWmAHlj9orokQAIkQAIkcKgElPXZv5pihuXqyT+ABqun7eBnIiN2ZYPpUGE107vzvIs9myQDTKUtfii6JFBuRaDaI22A3nMEtJYUA5AACZAACZAACWxKQKzP/p8hHH/WXx8BYbBN/HZpILx1Gf43jsFk3f7VJ13nvWx+oui+XzM/rY1YopAv34Y0QDeCyMgkQAIkQAIkQAL1BODznhqfjT/fwmFlNsBU0bvzRZX9g6HT6T0mfy7bW7BuNuBoM59mjvkJPPPfXpPjk7/XnhTMoOv16slx8O73x6eYVXAyGh0fDQbfqct9EQmyb1yxxV3RqzL1rvMuw6mTmUyl1TTHF8O3h4WLp+25GKDJ4/1jEnK9byuY8UiABEiABEiABEggJ4Cxz9NjWfKosXfPeDSQeL2J9SU4F1wcdDwBEkbvPb4235ylv8unZDiZTQaeuakSdHb09nSpg948JbN7xz38z0h+x8mRyowojUjz0evN+Zk4XPUGk7nlNdUgdRHWcd6TRIZTk2wq7cZTPkVF66dHQDkH1ILCExIgARIgARIggS4J/Dfpnxy1Egg7CLMQ4apU++VXTYDsyPdITVHFeOQy97N5h9v2Jfxx3LmpWKIInlSyhGYWFiERsGfak++La/1TDuUYB756nH7dpH7/H1/I4No0y+NTz5B2mXcls/A9gjIb+htlSlr/YYDSCckiwhMSIAESIAESIIEuCaQ+721EwurDmGL1Z/dULizVrfoevS9unp0sjC9kASl3JSIxBj1+42nco+n8+KmY4wo7DPnLl793EihOPakXN2W0stO8p5M/p7cXw+/N/Y0MRYtDZPzpe3ifrvz6f9G/QgKPSIAESIAESIAESCBAYAPrMyDRe1k+GNvO2t5g9RdleUwx5txFnGAwWbM+MS/AP5tADWi646Rpur3vp2pbMzZ1Kx+d5T2Vqs3PHqap1o46W3rEn8gI8NHbpTHAHB+XIUmABEiABEiABEigksB/E73ceWWgDm7KB+NNF55Xasj6o+sB5m++YJOeq3HfNUO1rmo6QdiLP7CA6arWnItL3eHVWd5TuWoAt2qRAif9ZqcwPefDtxvbmG8mgqFJgARIgARIgARIIEgg3+ddDQfmkymD4VvfkBG7CSZ/Lt43TQRf/JdqP/rJAP7fkxnczu9uHpZlub3J/cuktcKBiNGpG/G7y7shdCuHMD3vh2/0ed8KXAolARIgARIgARIQAvjyLl+G4Uft8RnPEPUDI4zZ/aj/yv+mtFNPVNRyIGwCqmadXt49r9Y9DIX6FqrEvqGZY7z7v/oDezk9+0pU6maUTvNuCu70mKZnpzgpjARIgARIgARIwEtA5n2qqZAln/Ei+PjiopPNMjuYANkf2zM+tR14KWsjma7sejpBlUFd5K7BUWzqHpEt896/ujJ3NvII7uoSTc+uSFIOCZAACZAACZBAJQGxPvU8wmwRyVJwrCr5tdFG4rnExiYYpm/aOzCdjmbuPueSAZmOaY/eVjkXuUZkrl/dQXTqHkGN8y4ysBFAEtqBypNG60t6ric/uLcGyIgkQAIkQAIkQALRBLTPe7qIpL2wupIBuwQLYFru5JlsLLz+At+fJoNzfv8bMczyFdQz6fjfl618bLsXRqXXd0m8jCwnI2VRe1c66l/NR0m7uafRqRuZyA/9ec9vew6g6cRcbdQTpItL2vSkm1EXLCmDBEiABEiABEigloC2PjH8eQ5XcrjpPKaLPCIidqHEtj/mApiWtOi9jsxY4n9THmRVnuT4dI60Mxd2Sfveb/emWmYhxUq9nU96K2fxS7W0/GAm5nEeNM1RcNbnSR7SVNo6jkzdiqNP/HnXi/2XloBS+ceKpfbQr0fqhpd0EdP03BAjo5MACZAACZAACUQT+I8ZEvbmRbGBumdbdDOwbEkZs8+7FQcn49uXWZJuqG7eS93YZfdOrCa0Xr09PeS7FBXhkOjo6+k1GU2HxUbv5f3b8whimeZbwpdyJJMdJzrFPIY6WHkUxI2mqdtC3bwHU8+jwW/KWflI6GEl0+IX0LQIIEcqlickNLj4NDeOsqPpMyw277vsufaf/1jVyROCl0iABEiABEiABEhg9wRgCr3c7siXZve5q05xB3mHhSzzIcxRXBiZ7qVqNa270VsdxRqplnSekAAJkAAJkAAJ/GME0i/vu8y1mgA5+jfNz+3nXU+IsGY3wHepl6ydGbS7LHGmRQIkQAIkQAIkQAI5gR+wPhOZAOn1Hcq1+r0HW8+7cuGSTUZThmpSbLK6c77g/17CzBkJkAAJkAAJkMB+E+BEvf0unzba9a/ghTWomUAbL5jzPuNZMSQJkAAJkAAJkEAtAVqftYgYgAS6JEBrvkualEUCJEACJHCABH7iy/sBYqLKJEACJEACJEACJEACnRCg9dkJRgohARIgARIgARIgARKIIkDrMwoTA5EACZAACZAACZAACXRCgNZnJxgphARIgARIgARIgARIIIoArc8oTAxEAiRAAiRAAiRAAiTQCQFan51gpBASIAESIAESIAESIIEoArQ+ozAxEAmQAAmQAAmQAAmQQCcEaH12gpFCSIAESIAESIAESIAEogjQ+ozCxEAkQAIkQAIkQAIkQAKdEKD12QlGCiEBEiABEiABEiABEogiQOszChMDkQAJkAAJkAAJkAAJdEKA1mcnGCmEBEiABEiABEiABEggigCtzyhMDEQCJEACJEACJEACJNAJAVqfnWCkEBIgARIgARIgARIggSgCtD6jMDEQCZAACZAACZAACZBAJwRofXaCkUJIgARIgARIgARIgASiCND6jMLEQCRAAiRAAiRAAiRAAp0QoPXZCUYKIQESIAESIAESIAESiCJA6zMKEwORAAmQAAmQAAmQAAl0QoDWZycYKYQESIAESIAESIAESCCKAK3PKEwMRAIkQAIkQAIkQAIk0AkBWp+dYKQQEiABEiABEiABEiCBKAK0PqMwMRAJkAAJkAAJkAAJkEAnBGh9doKRQkiABEiABEiABEiABKII0PqMwsRAJEACJEACJEACJEACnRCg9dkJRgohARIgARIgARIgARKIIkDrMwoTA5EACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZAACZDAjxP4fxLtU22heL6DAAAAAElFTkSuQmCC)</p>
<p>2.检查JAVA_HOME配置</p>
<p><img src="/2020/07/12/jt-day01/7.png" alt="JAVA_HOME"></p>
<ol>
<li><strong>修改字符集</strong></li>
</ol>
<p><img src="/2020/07/12/jt-day01/8.png" alt="修改字符集"></p>
<ol>
<li><strong>检查**</strong>JDK**</li>
</ol>
<p><img src="/2020/07/12/jt-day01/9.png" alt="检查JDK">))</p>
<ol>
<li><strong>关闭校验</strong></li>
</ol>
<p><img src="/2020/07/12/jt-day01/10.png" alt="关闭校验"></p>
<ol>
<li><p><strong>Maven</strong></p>
</li>
<li><p>添加maven</p>
</li>
</ol>
<p><img src="/2020/07/12/jt-day01/11.png" alt="Maven配置"></p>
<ol>
<li>引入maven配置</li>
</ol>
<p><img src="/2020/07/12/jt-day01/12.png" alt="maven">))</p>
<ol>
<li><p><strong>Maven**</strong>复习**</p>
</li>
<li><ol>
<li><strong>Maven**</strong>介绍**</li>
</ol>
</li>
</ol>
<p>说明:maven是一站式的项目管理工具.可以负责项目的创建/打包/部署.还可以自动的实现jar包的依赖,和版本控制</p>
<ol>
<li><strong>Maven**</strong>工作原理**</li>
</ol>
<p><img src="/2020/07/12/jt-day01/13.png" alt="maven原理"> </p>
<ol>
<li><strong>Maven坐标</strong></li>
</ol>
<p>说明:Maven中使用坐标定位jar包的位置.</p>
<p><img src="/2020/07/12/jt-day01/14.png" alt="maven坐标"></p>
<ol>
<li><p><strong>Maven**</strong>加载<strong><strong>jar</strong></strong>包的工作原理**</p>
</li>
<li><p>Maven中如何保证jar包不被篡改.</p>
</li>
</ol>
<p>Md5方式进行加密.</p>
<p>安全<a href="https://baike.baidu.com/item/哈希算法" target="_blank" rel="noopener">哈希算法</a>（Secure Hash Algorithm）主要适用于<a href="https://baike.baidu.com/item/数字签名" target="_blank" rel="noopener">数字签名</a>标准 （Digital Signature Standard DSS）里面定义的数字签名算法（Digital Signature Algorithm DSA）。对于长度小于2^64位的消息，SHA1会产生一个160位的<a href="https://baike.baidu.com/item/消息摘要/4547744" target="_blank" rel="noopener">消息摘要</a>。当接收到消息的时候，<strong>这个消息摘要可以用来验证数据的完整性</strong>。在传输的过程中，数据很可能会发生变化，那么这时候就会产生不同的消息摘要。 SHA1有如下特性：不可以从消息摘要中复原信息；两个不同的消息不会产生同样的消息摘要,(但会有1x10 ^ 48分之一的机率出现相同的消息摘要,一般使用时忽略)。</p>
<p>特点:使用Maven必须联网(或者通过私服镜像链接)</p>
<ol>
<li>Maven如何自动依赖jar包?</li>
</ol>
<!--依赖具体步骤:

   1.用户添加指定的坐标加载jar包

   2.maven会解析jar包的pom文件.

   3.动态加载pom.xml文件中的依赖.

   依次加载获取全部的依赖包.

  -->  









<ol>
<li><strong>拷贝本地仓库</strong></li>
</ol>
<p>将6g文件中的maven本地仓库拷贝到本地解压.</p>
<ol>
<li><strong>切换本地仓库</strong></li>
</ol>
<p>将课前资料中的maven中settings文件拷贝到maven/conf</p>
<p> 切换本地仓库路径</p>
<p>切换本地仓库路径</p>
<p> 里边已经配置好了JDK/和镜像.学生连接达内私服镜像.</p>
<p>里边已经配置好了JDK/和镜像.学生连接达内私服镜像.</p>
<p>之后检查仓库是否切换</p>
<p><img src="data:image/png;base64,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" alt="00 引 0 0  Java 俪 忙 。 0 。  学 0 Cle Mapp•ng  ， Oomph  RmoteSFtems  一 检 查 是 否 更 新  “ “ and g 流 《 "></p>
<p>最后:新建maven项目检查配置是否有效.</p>
<ol>
<li><strong>分布式项目搭建</strong></li>
</ol>
<p><img src="data:image/png;base64,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gAABAgQIDItA+IhZ7Fj08e5GG2h2bPH2+Pc3v5ufLu1b1P7QXwIECBAgQIAAgSEUGNnf3w/f7b3NrWxmenRmOnzT7RbzK/XFP2vtQ7sv/l4kgZGRkfJwa/kfsNwB/45ZwNkSc3X0jQCB4wXqiZjH98mnBBIWEBoSLu6ZD83ZcuakfpAAgWACte2LGWyEGiJAgAABAgQIEAgsIGIGBtccAQIECBAgQCB9AREz/RobIQECBAgQIEAgsICIGRhccwQIECBAgACB9AVEzPRrbIQECBAgQIAAgcACImZgcM0RIECAAAECBNIXEDHTr7EREiBAgAABAgQCC4iYgcE1R4AAAQIECBBIX0DETL/GRkiAAAECBAgQCCwgYgYG1xwBAgQIECBAIH0BETP9GhshAQIECBAgQCCwgIgZGFxzBAgQIECAAIH0BUTM9GtshAQIECBAgACBwAIiZmBwzREgQIAAAQIE0hcQMdOvsRESIECAAAECBAILiJiBwTVHgAABAgQIEEhfQMRMv8ZGSIAAAQIECBAILCBiBgbXHAECBAgQIEAgfQERM/0aGyEBAgQIECBAILCAiBkYXHMECBAgQIAAgfQFRMz0a2yEBAgQIECAAIHAAiJmYHDNESBAgAABAgTSFxAx06+xERIgQIAAAQIEAguImIHBNUeAAAECBAgQSF9AxEy/xkZIgAABAgQIEAgsIGIGBtccAQIECBAgQCB9AREz/RobIQECBAgQIEAgsICIGRhccwQIECBAgACB9AVEzPRrbIQECBAgQIAAgcACY4Hb0xwBAmWBkZGR8kv/JkCAAAECaQiYxUyjjkZBgAABAgQIEIhIQMSMqBi6QoAAAQIECBBIQ0DETKOORkGAAAECBAgQiEhAxIyoGLpCgAABAgQIEEhDYGR/fz+NkRgFAQIECBAgQIBAJAJmMSMphG4QIECAAAECBNIREDHTqaWRECBAgAABAgQiERAxIymEbhAgQIAAAQIE0hEQMdOppZEQIECAAAECBCIREDEjKYRuECBAgAABAgTSERAx06mlkRAgQIAAAQIEIhEQMSMphG4QIECAAAECBNIREDHTqaWRECBAgAABAgQiERAxIymEbhAgQIAAAQIE0hEQMdOppZEQIECAAAECBCIREDEjKYRuECBAgAABAgTSERAx06mlkRAgQIAAAQIEIhEQMSMphG4QIECAAAECBNIREDHTqaWRECBAgAABAgQiERAxIymEbhAgQIAAAQIE0hEQMdOppZEQIECAAAECBCIREDEjKYRuECBAgAABAgTSERAx06mlkRAgQIAAAQIEIhEQMSMphG4QIECAAAECBNIREDHTqaWRECBAgAABAgQiERAxIymEbhAgQIAAAQIE0hH4PziYxrh2emKeAAAAAElFTkSuQmCC" alt="称 之 为 业 务 支 撑  继 丿  parent  jar 包  多 个  继 承  用 户 管 理  部 门 管 理  依 赖  common  一 个 jar 包 "></p>
<ol>
<li><strong>项目中**</strong>jar<strong>**包如何管理</strong></li>
</ol>
<p>采用父级项目的方式进行定义.使用maven创建 jar/war/<strong>pom</strong>(聚合项目).管理项目中<strong>公共</strong>的jar包.</p>
<ol>
<li><strong>项目中工具类如何管理</strong></li>
</ol>
<p>说明:一般整个项目中的工具类,会不断的更新和维护.所以将工具类代码单独的保存到项目中,将项目<strong>打成**</strong>jar<strong>**包</strong>.其他的程序通过pom文件动态依赖即可.</p>
<ol>
<li><p><strong>创建**</strong>jt-parent(<strong><strong>管理公共的</strong></strong>jar<strong><strong>包</strong></strong>)**</p>
</li>
<li><ol>
<li><strong>创建项目</strong></li>
</ol>
</li>
</ol>
<p><img src="data:image/png;base64,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" alt="Confgure р  Artifkt  Р. ProjM "></p>
<ol>
<li><p><strong>编辑**</strong>pom.xml<strong>**文件</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 集中定义依赖版本号 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.1.3.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.2.8<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">mybatis.spring.version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">mybatis.spring.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">mybatis.paginator.version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">mybatis.paginator.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">bonecp-spring.version</span>&gt;</span>0.8.0.RELEASE<span class="tag">&lt;/<span class="name">bonecp-spring.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.0.29<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">mapper.version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">mapper.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">pagehelper.version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">pagehelper.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">jsqlparser.version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">jsqlparser.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.4<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">jstl.version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jstl.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">jsp-api.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">jsp-api.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">joda-time.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">joda-time.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">commons-lang3.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">commons-lang3.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">httpclient.version</span>&gt;</span>4.3.5<span class="tag">&lt;/<span class="name">httpclient.version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">jedis.version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">jedis.version</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  		<span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  		<span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		</span><br><span class="line">  		</span><br><span class="line">  		<span class="comment">&lt;!-- Mybatis --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.miemiedev<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-paginator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.paginator.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		</span><br><span class="line">  		<span class="comment">&lt;!-- MySql --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		<span class="comment">&lt;!--引入阿里druid监控  --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		<span class="comment">&lt;!-- 通用Mapper --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.abel533<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mapper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		<span class="comment">&lt;!-- 分页插件 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pagehelper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.jsqlparser<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsqlparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsqlparser.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		<span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jolbox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bonecp-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;bonecp-spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		<span class="comment">&lt;!-- Jackson Json处理工具包 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  		<span class="comment">&lt;!-- httpclient --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpmime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		</span><br><span class="line">  		<span class="comment">&lt;!-- 消息队列 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 		       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 		       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 		       <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="comment">&lt;!-- JSP相关 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jstl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsp-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="comment">&lt;!-- 时间操作组件 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;joda-time.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="comment">&lt;!-- Apache工具组件 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-lang3.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 		<span class="comment">&lt;!-- 文件上传组件 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="comment">&lt;!-- jedis --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jedis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="comment">&lt;!--添加spring-datajar包  --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 		</span><br><span class="line"> 		<span class="comment">&lt;!-- 字符加密、解密 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="comment">&lt;!-- 数据校验 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol>
<li><p><strong>构建**</strong>jt-common<strong>**工具类项目</strong></p>
</li>
<li><ol>
<li><strong>创建项目</strong></li>
</ol>
</li>
</ol>
<p><img src alt></p>
<ol>
<li><strong>项目配置</strong></li>
</ol>
<p><img src alt></p>
<ol>
<li><strong>导入工具类</strong></li>
</ol>
<p>说明:将课前资料中的工具类代码进行拷贝.</p>
<p><img src alt="img"></p>
<ol>
<li><strong>添加继承</strong></li>
</ol>
<p><img src alt></p>
<p>添加完成后.将common打包.供其他项目调用.</p>
<ol>
<li><p><strong>京淘项目模块划分</strong></p>
<table>
<thead>
<tr>
<th>域名</th>
<th>ip</th>
<th>名称</th>
</tr>
</thead>
<tbody><tr>
<td>Manage.jt.com</td>
<td>127.0.0.1:8091</td>
<td>京淘后台管理系统</td>
</tr>
<tr>
<td><a href="http://www.jt.com" target="_blank" rel="noopener">www.jt.com</a></td>
<td>127.0.0.1:8092</td>
<td>京淘前台管理系统</td>
</tr>
<tr>
<td>sso.jt.com</td>
<td>127.0.0.1:8093</td>
<td>单点登录服务器</td>
</tr>
<tr>
<td>cart.jt.com</td>
<td>127.0.0.1:8094</td>
<td>购物车管理系统</td>
</tr>
<tr>
<td>order.jt.com</td>
<td>127.0.0.1:8095</td>
<td>订单管理系统</td>
</tr>
</tbody></table>
</li>
<li><p><strong>项目创建</strong></p>
</li>
</ol>
<p>1.选择骨架</p>
<p><img src alt></p>
<p>2.创建项目</p>
<p><img src alt></p>
<ol>
<li><p><strong>添加继承和依赖</strong></p>
</li>
<li><p>添加继承</p>
</li>
</ol>
<p><img src alt></p>
<ol>
<li>添加依赖</li>
</ol>
<p><img src alt></p>
<ol>
<li><p><strong>Tomcat**</strong>插件**</p>
</li>
<li><ol>
<li><strong>使用本机**</strong>tomcat<strong>**存在的问题</strong></li>
</ol>
</li>
<li><p>项目修改完成后,需要手动的重启(tomcat热部署)</p>
</li>
<li><p>Tomcat使用时间越久,启动越慢. Webapps(xxxxAPP).会生成很多临时文件.</p>
</li>
<li><p>Eclipse整合tomcat步骤繁琐.</p>
</li>
<li><p>Windows中启动多台tomcat不方便. 8080/8009/8005</p>
</li>
<li><ol>
<li><strong>引入**</strong>tomcat<strong>**插件</strong></li>
</ol>
</li>
</ol>
<!--添加tomcat插件 

   工作原理:当线程执行启动时,线程会去将tomcat进行

   实例化.每个线程内部维护一个独立运行的tomcat,程序

   运行在JVM内存中.当线程关闭,GC回收内存.

 -->

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">port</span>&gt;</span>8091<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!--表示缺省路径访问 --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol>
<li><strong>Tomcat**</strong>插件配置**</li>
</ol>
<p><img src alt></p>
<p>2.添加源码</p>
<p><img src alt></p>
<ol>
<li><strong>启动测试</strong></li>
</ol>
<p><img src alt></p>
]]></content>
  </entry>
  <entry>
    <title>ActiveMQ_07</title>
    <url>/2020/07/12/ActiveMQ-07/</url>
    <content><![CDATA[<p>Apache ActiveMQ™ is the most popular <strong>open source, multi-protocol, Java-based messaging server</strong>. It supports industry standard protocols so users get the benefits of client choices across a broad range of languages and platforms. Connectivity from C, C++, Python, .Net, and more is available. Integrate your multi-platform applications using the ubiquitous <strong>AMQP</strong> protocol. Exchange messages between your web applications using <strong>STOMP</strong> over websockets. Manage your IoT devices using <strong>MQTT</strong>. Support your existing <strong>JMS</strong> infrastructure and beyond. ActiveMQ offers the power and flexibility to support any messaging use-case.</p>
<p>There are currently two “flavors” of ActiveMQ available - the “classic” 5.x broker and the “next generation” Artemis broker. Once Artemis reaches a sufficient level of feature parity with the 5.x code-base it will become ActiveMQ 6. Initial <a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">migration documentation</a> is available.</p>
<a id="more"></a>





<h1 id="Active-MQ-07"><a href="#Active-MQ-07" class="headerlink" title="Active MQ 07"></a>Active MQ 07</h1><h2 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h2><p><strong>官方文档</strong></p>
<p><a href="http://activemq.apache.org/clustering" target="_blank" rel="noopener">http://activemq.apache.org/clustering</a></p>
<h3 id="主备集群"><a href="#主备集群" class="headerlink" title="主备集群"></a>主备集群</h3><p><a href="http://activemq.apache.org/masterslave.html" target="_blank" rel="noopener">http://activemq.apache.org/masterslave.html</a></p>
<table>
<thead>
<tr>
<th>Master Slave Type</th>
<th>Requirements</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://activemq.apache.org/shared-file-system-master-slave" target="_blank" rel="noopener">Shared File System Master Slave</a></td>
<td>A shared file system such as a SAN</td>
<td>Run as many slaves as required. Automatic recovery of old masters</td>
<td>Requires shared file system</td>
</tr>
<tr>
<td><a href="http://activemq.apache.org/jdbc-master-slave" target="_blank" rel="noopener">JDBC Master Slave</a></td>
<td>A Shared database</td>
<td>Run as many slaves as required. Automatic recovery of old masters</td>
<td>Requires a shared database. Also relatively slow as it cannot use the high performance journal</td>
</tr>
<tr>
<td><a href="http://activemq.apache.org/replicated-Features/PersistenceFeatures/Persistence/Features/Persistence/leveldb-store" target="_blank" rel="noopener">Replicated LevelDB Store</a></td>
<td>ZooKeeper Server</td>
<td>Run as many slaves as required. Automatic recovery of old masters. Very fast.</td>
<td>Requires a ZooKeeper server.</td>
</tr>
</tbody></table>
<h4 id="Shared-File-System-Master-Slave"><a href="#Shared-File-System-Master-Slave" class="headerlink" title="Shared File System Master Slave"></a>Shared File System Master Slave</h4><p>基于共享存储的Master-Slave；多个broker共用同一数据源，谁拿到锁谁就是master,其他处于待启动状态，如果master挂掉了，某个抢到文件锁的slave变成master</p>
<p><strong>启动后</strong></p>
<p><img src="/2020/07/12/ActiveMQ-07/Startup.png" alt="img"></p>
<p><strong>Master宕机</strong></p>
<p><img src="/2020/07/12/ActiveMQ-07/MasterFailed.png" alt="img"></p>
<p><strong>Master重启</strong></p>
<p><img src="/2020/07/12/ActiveMQ-07/image-20200212193653842.png" alt="image-20200212193653842"></p>
<p><strong>JDBC Master Slave</strong></p>
<p>基于JDBC的Master-Slave:使用同一个数据库，拿到LOCK表的写锁的broker成为master.</p>
<p>性能较低，不能使用高性能日志</p>
<p><strong>Replicated LeveDB Store</strong></p>
<p>基于zookeeper复制LeveDB存储的Master-Slave机制</p>
<p><strong>配置步骤</strong></p>
<ol>
<li>修改broker名称</li>
<li>修改数据源<ol>
<li>如果使用kahadb，配置相同路径</li>
<li>如果使用mysql 使用同一数据源（同一数据库和表）</li>
</ol>
</li>
</ol>
<p><strong>尝试</strong></p>
<p><img src="/2020/07/12/ActiveMQ-07/image-20200212144259602.png" alt="image-20200212144259602"></p>
<p><a href="http://activemq.apache.org/failover-transport-reference.html" target="_blank" rel="noopener">http://activemq.apache.org/failover-transport-reference.html</a></p>
<h4 id="failover-故障转移协议"><a href="#failover-故障转移协议" class="headerlink" title="failover 故障转移协议"></a>failover 故障转移协议</h4><p>断线重连机制是ActiveMQ的高可用性具体体现之一。ActiveMQ提供failover机制去实现断线重连的高可用性，可以使得连接断开之后，不断的重试连接到一个或多个brokerURL。</p>
<p>默认情况下，如果client与broker直接的connection断开，则client会新起一个线程，不断的从url参数中获取一个url来重试连接。</p>
<p>配置语法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(</span><br><span class="line">		<span class="string">"admin"</span>,</span><br><span class="line">		<span class="string">"admin"</span>,</span><br><span class="line">		<span class="string">"failover:(nio://localhost:5671,nio://localhost:5672)"</span></span><br><span class="line">		);</span><br></pre></td></tr></table></figure>

<p><strong>可配置选项</strong></p>
<h4 id="Transport-Options"><a href="#Transport-Options" class="headerlink" title="Transport Options"></a>Transport Options</h4><table>
<thead>
<tr>
<th>Option Name</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>backup</code></td>
<td><code>false</code></td>
<td>Initialize and hold a second transport connection - to enable fast failover.</td>
</tr>
<tr>
<td><code>initialReconnectDelay</code></td>
<td><code>10</code></td>
<td>The delay (in ms) before the <em>first</em> reconnect attempt.</td>
</tr>
<tr>
<td><code>maxCacheSize</code></td>
<td><code>131072</code></td>
<td>Size in bytes for the cache of tracked messages. Applicable only if <code>trackMessages</code> is <code>true</code>.</td>
</tr>
<tr>
<td><code>maxReconnectAttempts</code></td>
<td>`-1</td>
<td>0`</td>
</tr>
<tr>
<td><code>maxReconnectDelay</code></td>
<td><code>30000</code></td>
<td>The maximum delay (in ms) between the <em>second and subsequent</em> reconnect attempts.</td>
</tr>
<tr>
<td><code>nested.*</code></td>
<td><code>null</code></td>
<td><strong>From ActiveMQ 5.9:</strong> common URI options that will be applied to each URI in the list<strong>.</strong></td>
</tr>
<tr>
<td><code>randomize</code></td>
<td><code>true</code></td>
<td>If <code>true</code>, choose a URI at random from the list to use for reconnect.</td>
</tr>
<tr>
<td><code>reconnectDelayExponent</code></td>
<td><code>2.0</code></td>
<td>The exponent used during exponential back-off attempts.</td>
</tr>
<tr>
<td><code>reconnectSupported</code></td>
<td><code>true</code></td>
<td>Determines whether the client should respond to broker <code>ConnectionControl</code> events with a reconnect (see: <code>rebalanceClusterClients</code>).</td>
</tr>
<tr>
<td><code>startupMaxReconnectAttempts</code></td>
<td><code>-1</code></td>
<td>A value of <code>-1</code> denotes that the number of connection attempts at startup should be unlimited. A value of <code>&gt;=0</code> denotes the number of reconnect attempts at startup that will be made after which an error is sent back to the client when the client makes a subsequent reconnect attempt. <strong>Note</strong>: once successfully connected the <code>maxReconnectAttempts</code> option prevails.</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>-1</code></td>
<td><strong>From ActiveMQ 5.3</strong>: set the timeout on send operations (in ms) without interruption of re-connection process.</td>
</tr>
<tr>
<td><code>trackMessages</code></td>
<td><code>false</code></td>
<td>Keep a cache of in-flight messages that will flushed to a broker on reconnect.</td>
</tr>
<tr>
<td><code>updateURIsSupported</code></td>
<td><code>true</code></td>
<td><strong>From</strong> <strong>ActiveMQ 5.4:</strong> determines whether the client should accept updates from the broker to its list of known URIs.</td>
</tr>
<tr>
<td><code>updateURIsURL</code></td>
<td><code>null</code></td>
<td><strong>From ActiveMQ 5.4:</strong> a URL (or path to a local file) to a text file containing a comma separated list of URIs to use for reconnect in the case of failure.</td>
</tr>
<tr>
<td><code>useExponentialBackOff</code></td>
<td><code>true</code></td>
<td>If <code>true</code> an exponential back-off is used between reconnect attempts.</td>
</tr>
<tr>
<td><code>warnAfterReconnectAttempts</code></td>
<td><code>10</code></td>
<td><strong>From ActiveMQ 5.10:</strong> a value <code>&gt;0</code> specifies the number of reconnect attempts before a warning is logged. A logged warning indicates that there is no current connection but re-connection is being attempted. A value of <code>&lt;=0</code> disables the logging of warnings about reconnect attempts.</td>
</tr>
</tbody></table>
<p><strong>backup</strong></p>
<p>初始化的时候创建第二个连接，快速故障转移</p>
<p><strong>initialReconnectDelay</strong></p>
<p>第一次重试延迟</p>
<p><strong>trackMessages</strong></p>
<p>设置是否缓存（故障发生时）尚未传送完成的消息，当broker一旦重新连接成功，便将这些缓存中的消息刷新到新连接的代理中，使得消息可以在broker切换前后顺利传送。默认false</p>
<p><strong>maxCacheSize</strong></p>
<p>当trackMessage启动时，缓存的最大子字节数</p>
<p><strong>maxReconnectAttempts</strong></p>
<p>默认1|0，自5.6版本开始，-1为默认值，代表不限重试次数，0标识从不重试（只尝试连接一次，并不重连），5.6以前的版本，0为默认值，代表不重试，如果设置大于0的数，则代表最大重试次数。</p>
<p><strong>maxReconnectDelay</strong></p>
<p>最长重试间隔</p>
<p><strong>randomize</strong></p>
<p>使用随机连接，以达到负载均衡的目的，默认true</p>
<p>只配主备的情况下最好关闭</p>
<p><strong>startupMaxReconnectAttempts</strong></p>
<p>初始化时的最大重试次</p>
<p>“-1”表示在启动时连接尝试的次数是无限的。</p>
<p>‘ &gt;=0 ‘的值表示在启动时重新连接尝试的次数</p>
<p>一旦成功连接后续将使用“maxReconnectAttempts”选项</p>
<p><strong>timeout</strong></p>
<p>连接超时</p>
<p><strong>updateURIsSupported</strong></p>
<p>是否可以动态修改broker uri</p>
<p><strong>updateURIsURL</strong></p>
<p>指定动态修改地址的路径</p>
<p><strong>useExponentialBackOff</strong></p>
<p>重连时间间隔是否以指数形式增长</p>
<p><strong>reconnectDelayExponent</strong></p>
<p>指数增长时的指数</p>
<p><strong>warnAfterReconnectAttempts</strong></p>
<p>重连日志记录</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p><strong>官方文档</strong></p>
<p><a href="http://activemq.apache.org/networks-of-brokers.html" target="_blank" rel="noopener">http://activemq.apache.org/networks-of-brokers.html</a></p>
<h4 id="静态网络配置"><a href="#静态网络配置" class="headerlink" title="静态网络配置"></a>静态网络配置</h4><p><img src="/2020/07/12/ActiveMQ-07/10190bfe-30d7-3021-8bbe-9d7882530083.png" alt="img"></p>
<p>在broker节点下配置networkConnectors</p>
<ul>
<li>networkConnectors（网络连接器）主要用来配置ActiveMQ服务端与服务端之间的通信</li>
<li>TransportConnector（传输连接器）主要用于配置ActiveMQ服务端和客户端之间的通信方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;networkConnectors&gt;</span><br><span class="line">  &lt;networkConnector duplex&#x3D;&quot;true&quot; name&#x3D;&quot;amq-cluster&quot; uri&#x3D;&quot;static:failover:&#x2F;&#x2F;(nio:&#x2F;&#x2F;localhost:5671,nio:&#x2F;&#x2F;localhost:5672)&quot;  &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;networkConnectors&gt;</span><br></pre></td></tr></table></figure>

<p>参与的节点都需要修改</p>
<p>注意如果单机启动多个节点，记得修改端口避免冲突</p>
<p>启动成功后<code>Connections</code>中会有其他节点</p>
<p><img src="/2020/07/12/ActiveMQ-07/image-20200212165236443.png" alt="image-20200212165236443"></p>
<p><code>Network</code>中也会显示桥接连接</p>
<p><img src="/2020/07/12/ActiveMQ-07/image-20200212165658958.png" alt="image-20200212165658958"></p>
<p>负载均衡的环境下，broker上的消息优先给在本地连接的consumer</p>
<p>当networkerConnector与remote Broker建立链接之后，那么remote Broker将会向local Broker交付订阅信息，包括remote broker持有的destinations、Consumers、持久订阅者列表等；那么此后local Broker将把remote Broker做一个消息“订阅者”</p>
<p><strong>Advisory</strong></p>
<p>ActiveMQ提供了“Advisory”机制，通常ActiveMQ内部将某些事件作为“advisory”在全局广播，比如destination的创建、consumer的加入、DLQ的产生等，这将额外的消耗极小的性能；我们可以在ActiveMQ的监控页面上看到影响的消息，开发者也可以View这些消息(通道名称以“ActiveMQ.Advisory.”开头)。对于分布式网络中的broker，将严重依赖“Advisory”，特别是“dynamic network”，默认已开启</p>
<p>在一个broker上发生事件，都会以“通知”的方式发送给配置文件中指定的所有networkConnector</p>
<p><strong>Dynamic networks</strong></p>
<p>“动态网络”表明当remote Broker持有通道的消费者时，local Broker才会转发相应的消息；此时我们需要开启advisorySupport。当remote broker上有Consumer创建时，Advisory中将会广播消息，消息为ConsumerInfo类型，它将包括consumer所在的broker path，如果local broker与此path建立了networkConnector，那么此后local Broker将会启动响应的消息转发。</p>
<p><strong>Static networks</strong></p>
<p>  相对于“动态网络”而言，“静态网络”将不依赖Advisory，在任何时候，即使remote Broker中没有相应的consumer，消息也将转发给remote Broker</p>
<p>将brokers作为简单代理并转发消息到远端而不管是否有消费者</p>
<h4 id="可配置属性"><a href="#可配置属性" class="headerlink" title="可配置属性"></a>可配置属性</h4><h5 id="URI的几个属性"><a href="#URI的几个属性" class="headerlink" title="URI的几个属性"></a>URI的几个属性</h5><table>
<thead>
<tr>
<th>property</th>
<th>default</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>initialReconnectDelay</td>
<td>1000</td>
<td>time(ms) to wait before attempting a reconnect (if useExponentialBackOff is false)</td>
</tr>
<tr>
<td>maxReconnectDelay</td>
<td>30000</td>
<td>time(ms) to wait before attempting to re-connect</td>
</tr>
<tr>
<td>useExponentialBackOff</td>
<td>true</td>
<td>increases time between reconnect for every failure in a reconnect sequence</td>
</tr>
<tr>
<td>backOffMultiplier</td>
<td>2</td>
<td>multipler used to increase the wait time if using exponential back off</td>
</tr>
</tbody></table>
<h5 id="NetworkConnector-Properties"><a href="#NetworkConnector-Properties" class="headerlink" title="NetworkConnector Properties"></a>NetworkConnector Properties</h5><table>
<thead>
<tr>
<th>property</th>
<th>default</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>bridge</td>
<td>name of the network - for more than one network connector between the same two brokers - use different names</td>
</tr>
<tr>
<td>dynamicOnly</td>
<td>false</td>
<td>if true, only activate a networked durable subscription when a corresponding durable subscription reactivates, by default they are activated on startup.</td>
</tr>
<tr>
<td>decreaseNetworkConsumerPriority</td>
<td>false</td>
<td>if true, starting at priority -5, decrease the priority for dispatching to a network Queue consumer the further away it is (in network hops) from the producer. When false all network consumers use same default priority(0) as local consumers</td>
</tr>
<tr>
<td>networkTTL</td>
<td>1</td>
<td>the number of brokers in the network that messages and subscriptions can pass through (sets both message&amp;consumer -TTL)</td>
</tr>
<tr>
<td>messageTTL</td>
<td>1</td>
<td>(version 5.9) the number of brokers in the network that messages can pass through</td>
</tr>
<tr>
<td>consumerTTL</td>
<td>1</td>
<td>(version 5.9) the number of brokers in the network that subscriptions can pass through (keep to 1 in a mesh)</td>
</tr>
<tr>
<td>conduitSubscriptions</td>
<td>true</td>
<td>multiple consumers subscribing to the same destination are treated as one consumer by the network</td>
</tr>
<tr>
<td>excludedDestinations</td>
<td>empty</td>
<td>destinations matching this list won’t be forwarded across the network (this only applies to dynamicallyIncludedDestinations)</td>
</tr>
<tr>
<td>dynamicallyIncludedDestinations</td>
<td>empty</td>
<td>destinations that match this list <strong>will</strong> be forwarded across the network <strong>n.b.</strong> an empty list means all destinations not in the exluded list will be forwarded</td>
</tr>
<tr>
<td>useVirtualDestSubs</td>
<td>false</td>
<td>if true, the network connection will listen to advisory messages for virtual destination consumers</td>
</tr>
<tr>
<td>staticallyIncludedDestinations</td>
<td>empty</td>
<td>destinations that match will always be passed across the network - even if no consumers have ever registered an interest</td>
</tr>
<tr>
<td>duplex</td>
<td>false</td>
<td>if true, a network connection will be used to both produce <strong><em>AND\</em></strong> Consume messages. This is useful for hub and spoke scenarios when the hub is behind a firewall etc.</td>
</tr>
<tr>
<td>prefetchSize</td>
<td>1000</td>
<td>Sets the <a href="http://activemq.apache.org/what-is-the-prefetch-limit-for" target="_blank" rel="noopener">prefetch size</a> on the network connector’s consumer. It must be &gt; 0 because network consumers do not poll for messages</td>
</tr>
<tr>
<td>suppressDuplicateQueueSubscriptions</td>
<td>false</td>
<td>(from 5.3) if true, duplicate subscriptions in the network that arise from network intermediaries will be suppressed. For example, given brokers A,B and C, networked via multicast discovery. A consumer on A will give rise to a networked consumer on B and C. In addition, C will network to B (based on the network consumer from A) and B will network to C. When true, the network bridges between C and B (being duplicates of their existing network subscriptions to A) will be suppressed. Reducing the routing choices in this way provides determinism when producers or consumers migrate across the network as the potential for dead routes (stuck messages) are eliminated. networkTTL needs to match or exceed the broker count to require this intervention.</td>
</tr>
<tr>
<td>bridgeTempDestinations</td>
<td>true</td>
<td>Whether to broadcast advisory messages for created temp destinations in the network of brokers or not. Temp destinations are typically created for request-reply messages. Broadcasting the information about temp destinations is turned on by default so that consumers of a request-reply message can be connected to another broker in the network and still send back the reply on the temporary destination specified in the JMSReplyTo header. In an application scenario where most/all messages use request-reply pattern, this will generate additional traffic on the broker network as every message typically sets a unique JMSReplyTo address (which causes a new temp destination to be created and broadcasted via an advisory message in the network of brokers). When disabling this feature such network traffic can be reduced but then producer and consumers of a request-reply message need to be connected to the same broker. Remote consumers (i.e. connected via another broker in your network) won’t be able to send the reply message but instead raise a “temp destination does not exist” exception.</td>
</tr>
<tr>
<td>alwaysSyncSend</td>
<td>false</td>
<td>(version 5.6) When true, non persistent messages are sent to the remote broker using request/reply in place of a oneway. This setting treats both persistent and non-persistent messages the same.</td>
</tr>
<tr>
<td>staticBridge</td>
<td>false</td>
<td>(version 5.6) If set to true, broker will not dynamically respond to new consumers. It will only use <code>staticallyIncludedDestinations</code> to create demand subscriptions</td>
</tr>
<tr>
<td>userName</td>
<td>null</td>
<td>The username to authenticate against the remote broker</td>
</tr>
<tr>
<td>password</td>
<td>null</td>
<td>The password for the username to authenticate against the remote broker</td>
</tr>
</tbody></table>
<p><strong>name</strong></p>
<p>相同的名称会被添加到同一集群中</p>
<p><strong>dynamicOnly</strong></p>
<p>是否直接转发，设置成true的话 broker会在没有消费者的时候不去转发消息</p>
<p><strong>decreaseNetworkConsumerPriority</strong></p>
<p>如果为true，网络的消费者优先级降低为-5。如果为false，则默认跟本地消费者一样为0.</p>
<p><strong>networkTTL</strong> <strong>messageTTL</strong> <strong>consumerTTL</strong></p>
<p>消息和订阅在网络中被broker转发（穿过）的最大次数，消息在网络中每转发一次，都会将TTL-1</p>
<p><strong>conduitSubscriptions</strong></p>
<p>多个消费者消费消息被当作一个消费者</p>
<p><strong>excludedDestinations</strong></p>
<p>在这个名单中的Destination不会在网络中被转发</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">excludedDestinaitons</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">queue</span> <span class="attr">physicalName</span>=<span class="string">"include.test.foo"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">topic</span> <span class="attr">physicalName</span>=<span class="string">"include.test.bar"</span>/&gt;</span></span><br><span class="line">　<span class="tag">&lt;/<span class="name">excludedDestinaitons</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>dynamicallyIncludedDestinations</strong></p>
<p>通过网络转发的destinations，注意空列表代表所有的都转发。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">　<span class="tag">&lt;<span class="name">dynamicallyIncludeDestinaitons</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">queue</span> <span class="attr">physicalName</span>=<span class="string">"include.test.foo"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">topic</span> <span class="attr">physicalName</span>=<span class="string">"include.test.bar"</span>/&gt;</span></span><br><span class="line">　<span class="tag">&lt;/<span class="name">dynamicallyIncludeDestinaitons</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>useVirtualDestSubs</strong></p>
<p>开启此选项会在转发消息时</p>
<p><strong>staticallyIncludedDestinations</strong></p>
<p>匹配的目的地将始终通过网络传递——即使没有消费者对此感兴趣 对应静态networks</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">staticallyIncludeDestinaitons</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">queue</span> <span class="attr">physicalName</span>=<span class="string">"aways.include.queue"</span>/&gt;</span></span><br><span class="line">　<span class="tag">&lt;/<span class="name">staticallyIncludeDestinaitons</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>duplex</strong></p>
<p>是否允许双向连接<strong>如果该属性为true，当这个节点使用Network Bridge连接到其它目标节点后，将强制目标也建立Network Bridge进行反向连接</strong></p>
<p><strong>prefetchSize</strong></p>
<p>缓冲消息大小，必须大于0，不会主动拉取消息</p>
<p><strong>suppressDuplicateQueueSubscriptions</strong></p>
<p>如果为true, 重复的订阅关系一产生即被阻止。</p>
<p><strong>bridgeTempDestinations</strong></p>
<p>是否转发临时destination，禁用后再使用request/reply模型的时候客户端需要连接到同一broker，不然会找不到destination</p>
<p><strong>alwaysSyncSend</strong></p>
<p>开启后转发非持久化消息会使用request/reply模型</p>
<p><strong>staticBridge</strong></p>
<p>如果设置为true，则代理将不会动态响应新的consumer，只能使用staticallyIncludedDestinations中的destination</p>
<p><strong>userName</strong> <strong>password</strong></p>
<p>连接broker时的用户名和密码</p>
<h4 id="动态网络配置"><a href="#动态网络配置" class="headerlink" title="动态网络配置"></a>动态网络配置</h4><p><strong>官方文档</strong></p>
<p><a href="http://activemq.apache.org/multicast-transport-reference" target="_blank" rel="noopener">http://activemq.apache.org/multicast-transport-reference</a></p>
<p>使用multicast协议，可以指定组播地址或使用<code>multicast://default</code>（239.255.2.3）</p>
<p>配置<code>networkConnectors</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">networkConnectors</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">networkConnector</span> <span class="attr">uri</span>=<span class="string">"multicast://239.0.0.5"</span> <span class="attr">duplex</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">networkConnectors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>broker启动后会使用udp协议向组播地址发送数据报文以便让其他在这个组播地址的节点感知到自己的存在</p>
<p>每个UDP数据报中，包含的主要信息包括本节点ActiveMQ的版本信息，以及连接到自己所需要使用的host名字、协议名和端口信息。</p>
<p>配置<code>transportConnector</code>指明将哪一个连接通过UDP数据报向其他ActiveMQ节点进行公布，就需要在transportConnector标签上使用discoveryUri属性进行标识</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">"auto+nio"</span> <span class="attr">uri</span>=<span class="string">"auto+nio://localhost:5672"</span> <span class="attr">discoveryUri</span>=<span class="string">"multicast://239.0.0.5"</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="消息回流"><a href="#消息回流" class="headerlink" title="消息回流"></a>消息回流</h3><p>在消息转发的时候，remote broker转发Local broker的消息会消费掉LocalBroker的消息</p>
<p>那么在转发的过程中，消息在被拉取后和发送给consumer的过程中重启的话会造成消息丢失</p>
<p><code>replayWhenNoConsumers</code> 选项可以使remote broke上有需要转发的消息但是没有被消费时，把消息回流到它原始的broker.同时把enableAudit设置为false,为了防止消息回流后被当作重复消息而不被分发</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">　　　　 <span class="tag">&lt;<span class="name">destinationPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">policyMap</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">policyEntries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">policyEntry</span> <span class="attr">queue</span>=<span class="string">"&gt;"</span> <span class="attr">enableAudit</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networkBridgeFilterFactory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">conditionalNetworkBridgeFilterFactory</span> <span class="attr">replayWhenNoConsumers</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networkBridgeFilterFactory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">policyEntry</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">policyEntries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">policyMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">destinationPolicy</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="消息副本"><a href="#消息副本" class="headerlink" title="消息副本"></a>消息副本</h3><p><a href="http://activemq.apache.org/replicated-message-store" target="_blank" rel="noopener">http://activemq.apache.org/replicated-message-store</a></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MQ</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ActiveMQ_06</title>
    <url>/2020/07/12/ActiveMQ-06/</url>
    <content><![CDATA[<p>Apache ActiveMQ™ is the most popular <strong>open source, multi-protocol, Java-based messaging server</strong>. It supports industry standard protocols so users get the benefits of client choices across a broad range of languages and platforms. Connectivity from C, C++, Python, .Net, and more is available. Integrate your multi-platform applications using the ubiquitous <strong>AMQP</strong> protocol. Exchange messages between your web applications using <strong>STOMP</strong> over websockets. Manage your IoT devices using <strong>MQTT</strong>. Support your existing <strong>JMS</strong> infrastructure and beyond. ActiveMQ offers the power and flexibility to support any messaging use-case.</p>
<p>There are currently two “flavors” of ActiveMQ available - the “classic” 5.x broker and the “next generation” Artemis broker. Once Artemis reaches a sufficient level of feature parity with the 5.x code-base it will become ActiveMQ 6. Initial <a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">migration documentation</a> is available.</p>
<a id="more"></a>



<h1 id="Active-MQ-06"><a href="#Active-MQ-06" class="headerlink" title="Active MQ 06"></a>Active MQ 06</h1><h2 id="Request-Response模型实现"><a href="#Request-Response模型实现" class="headerlink" title="Request/Response模型实现"></a>Request/Response模型实现</h2><h3 id="QueueRequestor"><a href="#QueueRequestor" class="headerlink" title="QueueRequestor"></a>QueueRequestor</h3><p>同步阻塞</p>
<h3 id="TemporaryQueue"><a href="#TemporaryQueue" class="headerlink" title="TemporaryQueue"></a>TemporaryQueue</h3><p>异步监听，当消息过多时会创建响应的临时queue</p>
<h3 id="JMSCorrelationID-消息属性"><a href="#JMSCorrelationID-消息属性" class="headerlink" title="JMSCorrelationID 消息属性"></a>JMSCorrelationID 消息属性</h3><p>异步监听，公用queue</p>
<h2 id="调优总结"><a href="#调优总结" class="headerlink" title="调优总结"></a>调优总结</h2><h3 id="Topic加强-可追溯消息"><a href="#Topic加强-可追溯消息" class="headerlink" title="Topic加强 可追溯消息"></a>Topic加强 可追溯消息</h3><p><a href="http://activemq.apache.org/retroactive-consumer.html" target="_blank" rel="noopener">http://activemq.apache.org/retroactive-consumer.html</a></p>
<p>避免topic下错过消息</p>
<h4 id="消费者设置"><a href="#消费者设置" class="headerlink" title="消费者设置"></a>消费者设置</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Destination topic &#x3D; session.createTopic(&quot;tpk?consumer.retroactive&#x3D;true&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="Summary-of-Available-Recovery-Policies"><a href="#Summary-of-Available-Recovery-Policies" class="headerlink" title="Summary of Available Recovery Policies"></a>Summary of Available Recovery Policies</h3><table>
<thead>
<tr>
<th>Policy Name</th>
<th>Sample Configuration</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>FixedSizedSubscriptionRecoveryPolicy</td>
<td><fixedSizedSubscriptionRecoveryPolicy maximumsize="1024"></fixedSizedSubscriptionRecoveryPolicy></td>
<td>Keep a fixed amount of memory in RAM for message history which is evicted in time order.</td>
</tr>
<tr>
<td>FixedCountSubscriptionRecoveryPolicy</td>
<td><fixedCountSubscriptionRecoveryPolicy maximumsize="100"></fixedCountSubscriptionRecoveryPolicy></td>
<td>Keep a fixed count of last messages.</td>
</tr>
<tr>
<td>LastImageSubscriptionRecoveryPolicy</td>
<td><lastImageSubscriptionRecoveryPolicy></lastImageSubscriptionRecoveryPolicy></td>
<td>Keep only the last message.</td>
</tr>
<tr>
<td>NoSubscriptionRecoveryPolicy</td>
<td><noSubscriptionRecoveryPolicy></noSubscriptionRecoveryPolicy></td>
<td>Disables message recovery.</td>
</tr>
<tr>
<td>QueryBasedSubscriptionRecoveryPolicy</td>
<td><queryBasedSubscriptionRecoveryPolicy query="JMSType = 'car' AND color = 'blue'"></queryBasedSubscriptionRecoveryPolicy></td>
<td>Perform a user specific query mechanism to load any message they may have missed. Details on message selectors are available <a href="http://java.sun.com/j2ee/1.4/docs/api/javax/jms/Message.html" target="_blank" rel="noopener">here</a></td>
</tr>
<tr>
<td>TimedSubscriptionRecoveryPolicy</td>
<td><timedSubscriptionRecoveryPolicy recoverduration="60000"></timedSubscriptionRecoveryPolicy></td>
<td>Keep a timed buffer of messages around in memory and use that to recover new subscriptions. Recovery time is in milliseconds.</td>
</tr>
<tr>
<td>RetainedMessageSubscriptionRecoveryPolicy</td>
<td><retainedMessageSubscriptionRecoveryPolicy></retainedMessageSubscriptionRecoveryPolicy></td>
<td>Keep the last message with ActiveMQ.Retain property set to true</td>
</tr>
</tbody></table>
<h4 id="保留固定字节的消息"><a href="#保留固定字节的消息" class="headerlink" title="保留固定字节的消息"></a>保留固定字节的消息</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">policyEntry</span> <span class="attr">topic</span>=<span class="string">"&gt;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">fixedSizedSubscriptionRecoveryPolicy</span> <span class="attr">maximumSize</span>=<span class="string">"1024"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">policyEntry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="保留固定数量的消息"><a href="#保留固定数量的消息" class="headerlink" title="保留固定数量的消息"></a>保留固定数量的消息</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">policyEntry</span> <span class="attr">topic</span>=<span class="string">"&gt;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">fixedCountSubscriptionRecoveryPolicy</span> <span class="attr">maximumSize</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">policyEntry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="保留时间"><a href="#保留时间" class="headerlink" title="保留时间"></a>保留时间</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">timedSubscriptionRecoveryPolicy</span> <span class="attr">recoverDuration</span>=<span class="string">"60000"</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="保留最后一条"><a href="#保留最后一条" class="headerlink" title="保留最后一条"></a>保留最后一条</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lastImageSubscriptionRecoveryPolicy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">subscriptionRecoveryPolicy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="慢速消费"><a href="#慢速消费" class="headerlink" title="慢速消费"></a>慢速消费</h3><h4 id="SlowConsumerStrategy"><a href="#SlowConsumerStrategy" class="headerlink" title="SlowConsumerStrategy"></a>SlowConsumerStrategy</h4><p>对于慢消费者，broker会启动一个后台线程用来检测所有的慢速消费者，并定期的关闭慢消费者。<br> <strong>AbortSlowConsumerStrategy abortConnection</strong>：中断慢速消费者，慢速消费将会被关闭。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slowConsumerStrategy</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">abortSlowConsumerStrategy</span> <span class="attr">abortConnection</span>=<span class="string">"false"</span>/&gt;</span><span class="comment">&lt;!-- 不关闭底层链接 --&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">slowConsumerStrategy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> <strong>AbortSlowConsumerStrategy maxTimeSinceLastAck</strong>：如果慢速消费者最后一个ACK距离现在的时间间隔超过阀值，则中断慢速消费者。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slowConsumerStrategy</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">abortSlowConsumerStrategy</span>  <span class="attr">maxTimeSinceLastAck</span>=<span class="string">"30000"</span>/&gt;</span><span class="comment">&lt;!-- 30秒滞后 --&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">slowConsumerStrategy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="PendingMessageLimitStrategy：消息限制策略（面向慢消费者）"><a href="#PendingMessageLimitStrategy：消息限制策略（面向慢消费者）" class="headerlink" title="PendingMessageLimitStrategy：消息限制策略（面向慢消费者）"></a>PendingMessageLimitStrategy：消息限制策略（面向慢消费者）</h4><p><a href="http://activemq.apache.org/slow-consumer-handling" target="_blank" rel="noopener">http://activemq.apache.org/slow-consumer-handling</a></p>
<p>  此策略只对Topic有效，只对未持久化订阅者有效，当通道中有大量的消息积压时，broker可以保留的消息量。为了防止Topic中有慢速消费者，导致整个通道消息积压。<br><strong>ConstantPendingMessageLimitStrategy</strong>：保留固定条数的消息，如果消息量超过limit，将使用<strong>消息剔除策略</strong>移除消息。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">policyEntry</span> <span class="attr">topic</span>=<span class="string">"ORDERS.&gt;"</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- lets force old messages to be discarded for slow consumers --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">pendingMessageLimitStrategy</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">constantPendingMessageLimitStrategy</span> <span class="attr">limit</span>=<span class="string">"50"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">pendingMessageLimitStrategy</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">policyEntry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> <strong>PrefetchRatePendingMessageLimitStrategy</strong>：保留prefetchSize倍数条消息。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 若prefetchSize为100，则保留2.5 * 100条消息 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">prefetchRatePendingMessageLimitStrategy</span> <span class="attr">multiplier</span>=<span class="string">"2.5"</span>/&gt;</span></span><br></pre></td></tr></table></figure>







<h3 id="消息堆积内存上涨"><a href="#消息堆积内存上涨" class="headerlink" title="消息堆积内存上涨"></a>消息堆积内存上涨</h3><ul>
<li>检查消息是否持久化</li>
<li>检查消息 消费速度与生产速度</li>
<li>调整xms xmx参数</li>
</ul>
<h3 id="磁盘满"><a href="#磁盘满" class="headerlink" title="磁盘满"></a>磁盘满</h3><p>当非持久化消息堆积到一定程度，ActiveMQ会将非持久化消息写入临时文件，但是在重启的时候不会恢复</p>
<p>当存储持久化数据的磁盘满了的时候</p>
<p><strong>持久化消息</strong></p>
<p>生产者阻塞，消费正常，当消费一部分消息后，腾出空间，生产者继续</p>
<p><strong>非持久化消息</strong></p>
<p>由于临时文件造成磁盘满了，生产者阻塞，消费异常，无法提供服务</p>
<h3 id="开启事务"><a href="#开启事务" class="headerlink" title="开启事务"></a>开启事务</h3><p>在发送非持久化消息的时候，可以有效防止消息丢失</p>
<h3 id="prefetchSize影响消费倾斜"><a href="#prefetchSize影响消费倾斜" class="headerlink" title="prefetchSize影响消费倾斜"></a>prefetchSize影响消费倾斜</h3><p>慢速消费的时候可以将prefetchSize设为1，每次取一条</p>
<h3 id="prefetchSize造成消费者内存溢出"><a href="#prefetchSize造成消费者内存溢出" class="headerlink" title="prefetchSize造成消费者内存溢出"></a>prefetchSize造成消费者内存溢出</h3><h3 id="AUTO-ACKNOWLEDGE造成消息丢失-乱序"><a href="#AUTO-ACKNOWLEDGE造成消息丢失-乱序" class="headerlink" title="AUTO_ACKNOWLEDGE造成消息丢失/乱序"></a>AUTO_ACKNOWLEDGE造成消息丢失/乱序</h3><p>消息消费失败后，无法复原消息，可以手动ack 避免broker把消息自动确认删除</p>
<p>receive()方法接受到消息后立即确认</p>
<p>listener 的onmessage方法执行完毕才会确认</p>
<p>手动ack的时候要等connection断开 才会重新推送给其他的consumer，所以有可能会导致消费顺序错乱</p>
<h3 id="exclusive-和selector有可能造成消息堆积"><a href="#exclusive-和selector有可能造成消息堆积" class="headerlink" title="exclusive 和selector有可能造成消息堆积"></a>exclusive 和selector有可能造成消息堆积</h3>]]></content>
      <categories>
        <category>Java</category>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MQ</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ActiveMQ_05</title>
    <url>/2020/07/12/ActiveMQ-05/</url>
    <content><![CDATA[<p>Apache ActiveMQ™ is the most popular <strong>open source, multi-protocol, Java-based messaging server</strong>. It supports industry standard protocols so users get the benefits of client choices across a broad range of languages and platforms. Connectivity from C, C++, Python, .Net, and more is available. Integrate your multi-platform applications using the ubiquitous <strong>AMQP</strong> protocol. Exchange messages between your web applications using <strong>STOMP</strong> over websockets. Manage your IoT devices using <strong>MQTT</strong>. Support your existing <strong>JMS</strong> infrastructure and beyond. ActiveMQ offers the power and flexibility to support any messaging use-case.</p>
<p>There are currently two “flavors” of ActiveMQ available - the “classic” 5.x broker and the “next generation” Artemis broker. Once Artemis reaches a sufficient level of feature parity with the 5.x code-base it will become ActiveMQ 6. Initial <a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">migration documentation</a> is available.</p>
<a id="more"></a>



<h1 id="Active-MQ-05"><a href="#Active-MQ-05" class="headerlink" title="Active MQ 05"></a>Active MQ 05</h1><h2 id="高级使用"><a href="#高级使用" class="headerlink" title="高级使用"></a>高级使用</h2><h3 id="queue-browser"><a href="#queue-browser" class="headerlink" title="queue browser"></a>queue browser</h3><p>可以查看队列中的消息而不消费，没有订阅的功能</p>
<h3 id="JMSCorrelationID"><a href="#JMSCorrelationID" class="headerlink" title="JMSCorrelationID"></a>JMSCorrelationID</h3><p>用于消息之间的关联，给人一种会话的感觉</p>
<p><a href="http://activemq.apache.org/how-should-i-implement-request-response-with-jms.html" target="_blank" rel="noopener">http://activemq.apache.org/how-should-i-implement-request-response-with-jms.html</a></p>
<hr>
<h3 id="JMSReplyTo"><a href="#JMSReplyTo" class="headerlink" title="JMSReplyTo"></a><strong>JMSReplyTo</strong></h3><p>发送方可以接受到消息消费确认的地址</p>
<h3 id="QueueRequestor同步消息"><a href="#QueueRequestor同步消息" class="headerlink" title="QueueRequestor同步消息"></a>QueueRequestor同步消息</h3><p>可以发送同步消息</p>
<p>本质违背了mq的异步通讯原则</p>
<p>但是mq还是能够提供应用解耦、异构系统的特性</p>
<p>因为使用QueueRequestor发送消息后，会等待接收端的回复，如果收不到回复就会造成死等现象!而且该方法没有设置超时等待的功能 </p>
<h3 id="生产环境中影响性能的几个因素"><a href="#生产环境中影响性能的几个因素" class="headerlink" title="生产环境中影响性能的几个因素"></a>生产环境中影响性能的几个因素</h3><h4 id="Out-of-memory"><a href="#Out-of-memory" class="headerlink" title="Out of memory"></a>Out of memory</h4><p>activemq启动脚本中配置内存</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%ACTIVEMQ_OPTS%&quot; &#x3D;&#x3D; &quot;&quot; set ACTIVEMQ_OPTS&#x3D;-Xms1G -Xmx1G</span><br></pre></td></tr></table></figure>



<p>以及配置文件中的百分比</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;memoryUsage percentOfJvmHeap&#x3D;&quot;70&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>



<p>SystemUsage配置设置了一些系统内存和硬盘容量，当系统消耗超过这些容量设置时，amq会“slow down producer”，还是很重要的。</p>
<h4 id="持久化和非持久化"><a href="#持久化和非持久化" class="headerlink" title="持久化和非持久化"></a>持久化和非持久化</h4><h4 id="消息异步发送"><a href="#消息异步发送" class="headerlink" title="消息异步发送"></a>消息异步发送</h4><p>建议使用默认，强制开启有可能丢失消息</p>
<p>异步发送丢失消息的场景是：生产者设置UseAsyncSend=true，使用producer.send(msg)持续发送消息。由于消息不阻塞，生产者会认为所有send的消息均被成功发送至MQ。如果服务端突然宕机，此时生产者端内存中尚未被发送至MQ的消息都会丢失。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new ActiveMQConnectionFactory(&quot;tcp:&#x2F;&#x2F;locahost:61616?jms.useAsyncSend&#x3D;true&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((ActiveMQConnectionFactory)connectionFactory).setUseAsyncSend(true);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((ActiveMQConnection)connection).setUseAsyncSend(true)</span><br></pre></td></tr></table></figure>



<h4 id="批量确认"><a href="#批量确认" class="headerlink" title="批量确认"></a>批量确认</h4><p>ActiveMQ缺省支持批量确认消息，批量确认可以提高系统性能</p>
<p><strong>关闭方法</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new ActiveMQConnectionFactory(&quot;tcp:&#x2F;&#x2F;locahost:61616?jms.optimizeAcknowledge&#x3D;false&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((ActiveMQConnectionFactory)connectionFactory).setOptimizeAcknowledge(fase);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((ActiveMQConnection)connection).setOptimizeAcknowledge(true);</span><br></pre></td></tr></table></figure>



<h3 id="消费缓冲与消息积压prefetchSize"><a href="#消费缓冲与消息积压prefetchSize" class="headerlink" title="消费缓冲与消息积压prefetchSize"></a>消费缓冲与消息积压prefetchSize</h3><p>消费者端，一般来说消费的越快越好，broker的积压越小越好。</p>
<p>但是考虑到事务性和客户端确认的情况，如果一个消费者一次获取到了很多消息却都不确认，这会造成事务上下文变大，broker端这种“半消费状态”的数据变多，所以ActiveMQ有一个prefetchSize参数来控制未确认情况下，最多可以预获取多少条记录。</p>
<p><strong>Pre-fetch默认值</strong></p>
<table>
<thead>
<tr>
<th>consumer type</th>
<th>default value</th>
</tr>
</thead>
<tbody><tr>
<td>queue</td>
<td>1000</td>
</tr>
<tr>
<td>queue browser</td>
<td>500</td>
</tr>
<tr>
<td>topic</td>
<td>32766</td>
</tr>
<tr>
<td>durable topic</td>
<td>1000</td>
</tr>
</tbody></table>
<h4 id="可以通过3中方式设置prefetchSize"><a href="#可以通过3中方式设置prefetchSize" class="headerlink" title="可以通过3中方式设置prefetchSize"></a>可以通过3中方式设置prefetchSize</h4><p><strong>创建连接时整体设置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ActiveMQConnectionFactory connectio nFactory &#x3D; new ActiveMQConnectionFactory(</span><br><span class="line">			&quot;admin&quot;,</span><br><span class="line">			&quot;admin&quot;,</span><br><span class="line">			&quot;tcp:&#x2F;&#x2F;localhost:5671?jms.prefetchPolicy.all&#x3D;50&quot;</span><br><span class="line">			);</span><br></pre></td></tr></table></figure>

<p><strong>创建连接时对topic和queue单独设置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ActiveMQConnectionFactory connectionFactory &#x3D; new ActiveMQConnectionFactory(</span><br><span class="line">		&quot;admin&quot;,</span><br><span class="line">		&quot;admin&quot;,</span><br><span class="line">		&quot;tcp:&#x2F;&#x2F;localhost:5671?jms.prefetchPolicy.queuePrefetch&#x3D;1&amp;jms.prefetchPolicy.topicPrefetch&#x3D;1&quot;</span><br><span class="line">		);</span><br></pre></td></tr></table></figure>

<p><strong>针对destination单独设置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Destination topic &#x3D; session.createTopic(&quot;user?consumer.prefetchSize&#x3D;10&quot;);</span><br></pre></td></tr></table></figure>



<p>注意：对destination设置prefetchsize后会覆盖连接时的设置值</p>
<h3 id="消息到底是推还是拉"><a href="#消息到底是推还是拉" class="headerlink" title="消息到底是推还是拉?"></a>消息到底是推还是拉?</h3><p>发送消息时是推向broker</p>
<p>获取消息时：</p>
<ul>
<li>默认是一条一条的推</li>
<li>当customer的prefetchSize满的时候停止推消息</li>
<li>当customer的prefetchSize ==0时 拉取消息</li>
</ul>
<h3 id="EIP-Enterprise-Integration-Patterns"><a href="#EIP-Enterprise-Integration-Patterns" class="headerlink" title="EIP Enterprise Integration Patterns."></a>EIP Enterprise Integration Patterns.</h3><p>EIP系统是以数据为基础，应用为核心，以实现业务及业务流程的自动化为目的多功能企业信息平台。为企业的信息化建设提供一种循序渐进，逐步优化的路径</p>
<p><img src="/2020/07/12/ActiveMQ-05/image-20200207162242385.png" alt="image-20200207162242385"></p>
<p>一个围绕消息集成的企业应用集成场景基本在上面的图中描述的比较清楚的，简单说明如下</p>
<p>1)消息发送方和接收方：可以是异构的业务系统，但是都需要提供Endpoint实现集成。<br>2)消息本身：两个应用系统通过channel连接，实现了消息本身的发送和接收操作<br>3)消息Channel：即消息传输的通道，消息本身必须要通过channel来实现传输，从源到达目标。<br>4)消息路由：当有多个目标接收方的时候，如果根据消息的特征来确定究竟发送到哪个接收方？<br>5)消息转换：消息在传输过程中是否需要进行转换和数据映射，包括报文格式转换和内容转换映射。<br>6)Pipe and Filter：在执行复杂的消息流处理时，如何维护消息本身的独立性和灵活性。</p>
<p>常用实现Camel</p>
<p>支持ActiveMQ、RabbitMQ、kafka、WebService</p>
<p><strong>camel实现了客户端与服务端的解耦， 生产者和消费者的解耦。</strong></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MQ</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ActiveMQ_04</title>
    <url>/2020/07/12/ActiveMQ-04/</url>
    <content><![CDATA[<p>Apache ActiveMQ™ is the most popular <strong>open source, multi-protocol, Java-based messaging server</strong>. It supports industry standard protocols so users get the benefits of client choices across a broad range of languages and platforms. Connectivity from C, C++, Python, .Net, and more is available. Integrate your multi-platform applications using the ubiquitous <strong>AMQP</strong> protocol. Exchange messages between your web applications using <strong>STOMP</strong> over websockets. Manage your IoT devices using <strong>MQTT</strong>. Support your existing <strong>JMS</strong> infrastructure and beyond. ActiveMQ offers the power and flexibility to support any messaging use-case.</p>
<p>There are currently two “flavors” of ActiveMQ available - the “classic” 5.x broker and the “next generation” Artemis broker. Once Artemis reaches a sufficient level of feature parity with the 5.x code-base it will become ActiveMQ 6. Initial <a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">migration documentation</a> is available.</p>
<a id="more"></a>

<h1 id="Active-MQ-04"><a href="#Active-MQ-04" class="headerlink" title="Active MQ 04"></a>Active MQ 04</h1><h2 id="Linux下安装"><a href="#Linux下安装" class="headerlink" title="Linux下安装"></a>Linux下安装</h2><p><strong>下载</strong></p>
<p><strong>解压</strong></p>
<p>在<code>init.d</code>下建立软连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;activemq&#x2F;bin&#x2F;activemq .&#x2F;</span><br></pre></td></tr></table></figure>

<p><strong>设置开启启动</strong></p>
<p><code>chkconfig activemq on</code></p>
<p>服务管理</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">service activemq start</span><br><span class="line">service activemq status</span><br><span class="line">service activemq stop</span><br></pre></td></tr></table></figure>

<h3 id="NIO配置"><a href="#NIO配置" class="headerlink" title="NIO配置"></a>NIO配置</h3><p>默认配置为tcp，使用的是bio</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;transportConnector name&#x3D;&quot;openwire&quot; uri&#x3D;&quot;tcp:&#x2F;&#x2F;0.0.0.0:61616?maximumConnections&#x3D;1000&amp;wireFormat.maxFrameSize&#x3D;104857600&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p><a href="http://activemq.apache.org/configuring-version-5-transports" target="_blank" rel="noopener">http://activemq.apache.org/configuring-version-5-transports</a></p>
<p>Nio是基于TCP的</p>
<p>客户端使用连接时也应使用nio</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ActiveMQConnectionFactory connectionFactory &#x3D; new ActiveMQConnectionFactory(</span><br><span class="line">		&quot;admin&quot;,</span><br><span class="line">		&quot;admin&quot;,</span><br><span class="line">		&quot;nio:&#x2F;&#x2F;localhost:61617&quot;</span><br><span class="line">		);</span><br></pre></td></tr></table></figure>

<p>Auto + Nio</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;transportConnector name&#x3D;&quot;auto+nio&quot; uri&#x3D;&quot;auto+nio:&#x2F;&#x2F;localhost:5671&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>自动适配协议</p>
<h3 id="OpenWire-可用配置选项"><a href="#OpenWire-可用配置选项" class="headerlink" title="OpenWire 可用配置选项"></a>OpenWire 可用配置选项</h3><table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>cacheEnabled</code></td>
<td><code>true</code></td>
<td>Should commonly repeated values be cached so that less marshaling occurs?</td>
</tr>
<tr>
<td><code>cacheSize</code></td>
<td><code>1024</code></td>
<td>When <code>cacheEnabled=true</code> then this parameter is used to specify the number of values to be cached.</td>
</tr>
<tr>
<td><code>maxInactivityDuration</code></td>
<td><code>30000</code></td>
<td>The maximum <a href="http://activemq.apache.org/activemq-inactivitymonitor" target="_blank" rel="noopener">inactivity</a> duration (before which the socket is considered dead) in milliseconds. On some platforms it can take a long time for a socket to die. Therefore allow the broker to kill connections when they have been inactive for the configured period of time. Used by some transports to enable a keep alive heart beat feature. Inactivity monitoring is disabled when set to a value <code>&lt;= 0</code>.</td>
</tr>
<tr>
<td><code>maxInactivityDurationInitalDelay</code></td>
<td><code>10000</code></td>
<td>The initial delay before starting <a href="http://activemq.apache.org/activemq-inactivitymonitor" target="_blank" rel="noopener">inactivity</a> checks. Yes, the word <code>&#39;Inital&#39;</code> is supposed to be misspelled like that.</td>
</tr>
<tr>
<td><code>maxFrameSize</code></td>
<td><code>MAX_LONG</code></td>
<td>Maximum allowed frame size. Can help help prevent OOM DOS attacks.</td>
</tr>
<tr>
<td><code>sizePrefixDisabled</code></td>
<td><code>false</code></td>
<td>Should the size of the packet be prefixed before each packet is marshaled?</td>
</tr>
<tr>
<td><code>stackTraceEnabled</code></td>
<td><code>true</code></td>
<td>Should the stack trace of exception that occur on the broker be sent to the client?</td>
</tr>
<tr>
<td><code>tcpNoDelayEnabled</code></td>
<td><code>true</code></td>
<td>Does not affect the wire format, but provides a hint to the peer that <code>TCP_NODELAY</code> should be enabled on the communications Socket.</td>
</tr>
<tr>
<td><code>tightEncodingEnabled</code></td>
<td><code>true</code></td>
<td>Should wire size be optimized over CPU usage?</td>
</tr>
</tbody></table>
<h3 id="Transport-可用配置选项"><a href="#Transport-可用配置选项" class="headerlink" title="Transport 可用配置选项"></a>Transport 可用配置选项</h3><table>
<thead>
<tr>
<th>Option Name</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>backlog</td>
<td>5000</td>
<td>Specifies the maximum number of connections waiting to be accepted by the transport server socket.</td>
</tr>
<tr>
<td>closeAsync</td>
<td>true</td>
<td>If <strong><code>true</code></strong> the socket close call happens asynchronously. This parameter should be set to <strong><code>false</code></strong> for protocols like STOMP, that are commonly used in situations where a new connection is created for each read or write. Doing so ensures the socket close call happens synchronously. A synchronous close prevents the broker from running out of available sockets owing to the rapid cycling of connections.</td>
</tr>
<tr>
<td>connectionTimeout</td>
<td>30000</td>
<td>If <strong><code>&gt;=1</code></strong> the value sets the connection timeout in milliseconds. A value of <strong><code>0</code></strong> denotes no timeout. Negative values are ignored.</td>
</tr>
<tr>
<td>daemon</td>
<td>false</td>
<td>If <strong><code>true</code></strong> the transport thread will run in daemon mode. Set this parameter to <strong><code>true</code></strong> when embedding the broker in a Spring container or a web container to allow the container to shut down correctly.</td>
</tr>
<tr>
<td>dynamicManagement</td>
<td>false</td>
<td>If <strong><code>true</code></strong> the <strong><code>TransportLogger</code></strong> can be managed by JMX.</td>
</tr>
<tr>
<td>ioBufferSize</td>
<td>8 * 1024</td>
<td>Specifies the size of the buffer to be used between the TCP layer and the OpenWire layer where <strong><code>wireFormat</code></strong> based marshaling occurs.</td>
</tr>
<tr>
<td>jmxPort</td>
<td>1099</td>
<td>(Client Only) Specifies the port that will be used by the JMX server to manage the <strong><code>TransportLoggers</code></strong>. This should only be set, via URI, by either a client producer or consumer as the broker creates its own JMX server. Specifying an alternate JMX port is useful for developers that test a broker and client on the same machine and need to control both via JMX.</td>
</tr>
<tr>
<td>keepAlive</td>
<td>false</td>
<td>If <strong><code>true</code>,</strong> enables <a href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTOoverview" target="_blank" rel="noopener">TCP KeepAlive</a> on the broker connection to prevent connections from timing out at the TCP level. This should <em>not</em> be confused with <strong><code>KeepAliveInfo</code></strong> messages as used by the <strong><code>InactivityMonitor</code>.</strong></td>
</tr>
<tr>
<td>logWriterName</td>
<td>default</td>
<td>Sets the name of the <strong><code>org.apache.activemq.transport.LogWriter</code></strong> implementation to use. Names are mapped to classes in the <strong><code>resources/META-INF/services/org/apache/activemq/transport/logwriters</code></strong> directory.</td>
</tr>
<tr>
<td>maximumConnections</td>
<td>Integer.MAX_VALUE</td>
<td>The maximum number of sockets allowed for this broker.</td>
</tr>
<tr>
<td>minmumWireFormatVersion</td>
<td>0</td>
<td>The minimum remote <strong><code>wireFormat</code></strong> version that will be accepted (note the misspelling). Note: when the remote <strong><code>wireFormat</code></strong> version is lower than the configured minimum acceptable version an exception will be thrown and the connection attempt will be refused. A value of <strong><code>0</code></strong> denotes no checking of the remote <strong><code>wireFormat</code></strong> version.</td>
</tr>
<tr>
<td>socketBufferSize</td>
<td>64 * 1024</td>
<td>Sets the size, in bytes, for the accepted socket’s read and write buffers.</td>
</tr>
<tr>
<td>soLinger</td>
<td>Integer.MIN_VALUE</td>
<td>Sets the socket’s option <strong><code>soLinger</code></strong> when the value is <strong><code>&gt; -1</code></strong>. When set to <strong><code>-1</code></strong> the <strong><code>soLinger</code></strong> socket option is disabled.</td>
</tr>
<tr>
<td>soTimeout</td>
<td>0</td>
<td>Sets the socket’s read timeout in milliseconds. A value of <strong><code>0</code></strong> denotes no timeout.</td>
</tr>
<tr>
<td>soWriteTimeout</td>
<td>0</td>
<td>Sets the socket’s write timeout in milliseconds. If the socket write operation does not complete before the specified timeout, the socket will be closed. A value of <strong>0</strong> denotes no timeout.</td>
</tr>
<tr>
<td>stackSize</td>
<td>0</td>
<td>Set the stack size of the transport’s background reading thread. Must be specified in multiples of <strong><code>128K</code></strong>. A value of <strong><code>0</code></strong> indicates that this parameter is ignored.</td>
</tr>
<tr>
<td>startLogging</td>
<td>true</td>
<td>If <strong><code>true</code></strong> the <strong><code>TransportLogger</code></strong> object of the Transport stack will initially write messages to the log. This parameter is ignored unless <strong><code>trace=true</code></strong>.</td>
</tr>
<tr>
<td>tcpNoDelay</td>
<td>false</td>
<td>If <strong><code>true</code></strong> the socket’s option <strong><code>TCP_NODELAY</code></strong> is set. This disables Nagle’s algorithm for small packet transmission.</td>
</tr>
<tr>
<td>threadName</td>
<td>N/A</td>
<td>When this parameter is specified the name of the thread is modified during the invocation of a transport. The remote address is appended so that a call stuck in a transport method will have the destination information in the thread name. This is extremely useful when using thread dumps for degugging.</td>
</tr>
<tr>
<td>trace</td>
<td>false</td>
<td>Causes all commands that are sent over the transport to be logged. To view the logged output define the <strong><code>Log4j</code></strong> logger: <strong><code>log4j.logger.org.apache.activemq.transport.TransportLogger=DEBUG</code></strong>.</td>
</tr>
<tr>
<td>trafficClass</td>
<td>0</td>
<td>The Traffic Class to be set on the socket.</td>
</tr>
<tr>
<td>diffServ</td>
<td>0</td>
<td>(Client only) The preferred Differentiated Services traffic class to be set on outgoing packets, as described in RFC 2475. Valid integer values: <strong><code>[0,64]</code></strong>. Valid string values: <strong><code>EF</code>, <code>AF[1-3][1-4]</code></strong> or <strong><code>CS[0-7]</code></strong>. With JDK 6, only works when the JVM uses the IPv4 stack. To use the IPv4 stack set the system property <strong><code>java.net.preferIPv4Stack=true</code></strong>. Note: it’s invalid to specify both ‘<strong>diffServ</strong> and <strong>typeOfService</strong>’ at the same time as they share the same position in the TCP/IP packet headers</td>
</tr>
<tr>
<td>typeOfService</td>
<td>0</td>
<td>(Client only) The preferred Type of Service value to be set on outgoing packets. Valid integer values: <strong><code>[0,256]</code></strong>. With JDK 6, only works when the JVM is configured to use the IPv4 stack. To use the IPv4 stack set the system property <strong><code>java.net.preferIPv4Stack=true</code></strong>. Note: it’s invalid to specify both ‘<strong>diffServ</strong> and <strong>typeOfService</strong>’ at the same time as they share the same position in the TCP/IP packet headers.</td>
</tr>
<tr>
<td>useInactivityMonitor</td>
<td>true</td>
<td>When <strong><code>false</code></strong> the <strong><code>InactivityMonitor</code></strong> is disabled and connections will never time out.</td>
</tr>
<tr>
<td>useKeepAlive</td>
<td>true</td>
<td>When <strong><code>true</code> <code>KeepAliveInfo</code></strong> messages are sent on an idle connection to prevent it from timing out. If this parameter is <strong><code>false</code></strong> connections will still timeout if no data was received on the connection for the specified amount of time.</td>
</tr>
<tr>
<td>useLocalHost</td>
<td>false</td>
<td>When <strong><code>true</code></strong> local connections will be made using the value <strong><code>localhost</code></strong> instead of the actual local host name. On some operating systems, such as <strong><code>OS X</code></strong>, it’s not possible to connect as the local host name so <strong><code>localhost</code></strong> is better.</td>
</tr>
<tr>
<td>useQueueForAccept</td>
<td>true</td>
<td>When <strong><code>true</code></strong> accepted sockets are placed onto a queue for asynchronous processing using a separate thread.</td>
</tr>
<tr>
<td>wireFormat</td>
<td>default</td>
<td>The name of the <strong><code>wireFormat</code></strong> factory to use.</td>
</tr>
<tr>
<td>wireFormat.*</td>
<td>N/A</td>
<td>Properties with this prefix are used to configure the <strong><code>wireFormat</code></strong>.</td>
</tr>
</tbody></table>
<h2 id="ActiveMQ服务监控-Hawtio"><a href="#ActiveMQ服务监控-Hawtio" class="headerlink" title="ActiveMQ服务监控 Hawtio"></a>ActiveMQ服务监控 Hawtio</h2><h3 id="官方网站"><a href="#官方网站" class="headerlink" title="官方网站"></a>官方网站</h3><p><a href="https://hawt.io/" target="_blank" rel="noopener">https://hawt.io/</a></p>
<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><h4 id="独立jar包的形式运行"><a href="#独立jar包的形式运行" class="headerlink" title="独立jar包的形式运行"></a>独立jar包的形式运行</h4><p>java -jar</p>
<p>hawtio单程序运行，可以对多个远程ActiveMQ服务器进行监控</p>
<h4 id="嵌入ActiveMQ"><a href="#嵌入ActiveMQ" class="headerlink" title="嵌入ActiveMQ"></a>嵌入ActiveMQ</h4><ul>
<li>下载war包</li>
<li>复制到webapps下</li>
</ul>
<p><strong>jetty.xml bean标签下添加</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean class&#x3D;&quot;org.eclipse.jetty.webapp.WebAppContext&quot;&gt;        </span><br><span class="line">	&lt;property name&#x3D;&quot;contextPath&quot; value&#x3D;&quot;&#x2F;hawtio&quot; &#x2F;&gt;        </span><br><span class="line">	&lt;property name&#x3D;&quot;war&quot; value&#x3D;&quot;$&#123;activemq.home&#125;&#x2F;webapps&#x2F;hawtio.war&quot; &#x2F;&gt;        </span><br><span class="line">	&lt;property name&#x3D;&quot;logUrlOnStart&quot; value&#x3D;&quot;true&quot; &#x2F;&gt;  </span><br><span class="line">&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>



<p><strong>ActiveMQ.bat下添加</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if &quot;%ACTIVEMQ_OPTS%&quot; &#x3D;&#x3D; &quot;&quot; set ACTIVEMQ_OPTS&#x3D;-Xms1G -Xmx1G -Dhawtio.realm&#x3D;activemq -Dhawtio.role&#x3D;admins -Dhawtio.rolePrincipalClasses&#x3D;org.apache.activemq.jaas.GroupPrincipal -Djava.util.logging.config.file&#x3D;logging.properties -Djava.security.auth.login.config&#x3D;&quot;%ACTIVEMQ_CONF%\login.config&quot;</span><br></pre></td></tr></table></figure>



<h2 id="JMS消息结构（Message）"><a href="#JMS消息结构（Message）" class="headerlink" title="JMS消息结构（Message）"></a>JMS消息结构（Message）</h2><p>Message主要由三部分组成，分别是Header，Properties，Body， 详细如下：</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>消息头，所有类型的这部分格式都是一样的</th>
</tr>
</thead>
<tbody><tr>
<td>Properties</td>
<td>属性，按类型可以分为应用设置的属性，标准属性和消息中间件定义的属性</td>
</tr>
<tr>
<td>Body</td>
<td>消息正文，指我们具体需要消息传输的内容。</td>
</tr>
</tbody></table>
<h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>JMS消息头使用的所有方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Destination <span class="title">getJMSDestination</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSDestination</span><span class="params">(Destination destination)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getJMSDeliveryMode</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSDeliveryMode</span><span class="params">(<span class="keyword">int</span> deliveryMode)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getJMSMessageID</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSMessageID</span><span class="params">(String id)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getJMSTimestamp</span><span class="params">()</span> <span class="keyword">throws</span> JMSException'</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSTimestamp</span><span class="params">(<span class="keyword">long</span> timestamp)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getJMSExpiration</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSExpiration</span><span class="params">(<span class="keyword">long</span> expiration)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getJMSRedelivered</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSRedelivered</span><span class="params">(<span class="keyword">boolean</span> redelivered)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getJMSPriority</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSPriority</span><span class="params">(<span class="keyword">int</span> priority)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Destination <span class="title">getJMSReplyTo</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSReplyTo</span><span class="params">(Destination replyTo)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getJMScorrelationID</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSCorrelationID</span><span class="params">(String correlationID)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getJMSCorrelationIDAsBytes() <span class="keyword">throws</span> JMSException;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSCorrelationIDAsBytes</span><span class="params">(<span class="keyword">byte</span>[] correlationID)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getJMSType</span><span class="params">()</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJMSType</span><span class="params">(String type)</span> <span class="keyword">throws</span> JMSException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>消息头分为自动设置和手动设置的内容</strong></p>
<h4 id="自动头信息"><a href="#自动头信息" class="headerlink" title="自动头信息"></a>自动头信息</h4><p>有一部分可以在创建Session和MessageProducer时设置</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>说明</th>
<th>设置者</th>
</tr>
</thead>
<tbody><tr>
<td>JMSDeliveryMode</td>
<td>消息的发送模式，分为<strong>NON_PERSISTENT</strong>和<strong>PERSISTENT</strong>，即非持久性模式的和持久性模式。默认设置为<strong>PERSISTENT（持久性）。</strong>一条<strong>持久性消息</strong>应该被传送一次（就一次），这就意味着如果JMS提供者出现故障，该消息并不会丢失； 它会在服务器恢复正常之后再次传送。一条<strong>非持久性消息</strong>最多只会传送一次，这意味着如果JMS提供者出现故障，该消息可能会永久丢失。在持久性和非持久性这两种传送模式中，消息服务器都不会将一条消息向同一消息者发送一次以上（成功算一次）。</td>
<td>send</td>
</tr>
<tr>
<td>JMSMessageID</td>
<td>消息ID，需要以ID:开头，用于唯一地标识了一条消息</td>
<td>send</td>
</tr>
<tr>
<td>JMSTimestamp</td>
<td>消息发送时的时间。这条消息头用于确定发送消息和它被消费者实际接收的时间间隔。时间戳是一个以毫秒来计算的Long类型时间值（自1970年1月1日算起）。</td>
<td>send</td>
</tr>
<tr>
<td>JMSExpiration</td>
<td>消息的过期时间，以毫秒为单位，用来防止把过期的消息传送给消费者。任何直接通过编程方式来调用setJMSExpiration()方法都会被忽略。</td>
<td>send</td>
</tr>
<tr>
<td>JMSRedelivered</td>
<td>消息是否重复发送过，如果该消息之前发送过，那么这个属性的值需要被设置为true, 客户端可以根据这个属性的值来确认这个消息是否重复发送过，以避免重复处理。</td>
<td>Provider</td>
</tr>
<tr>
<td>JMSPriority</td>
<td>消息的优先级,0-4为普通的优化级，而5-9为高优先级，通常情况下，高优化级的消息需要优先发送。任何直接通过编程方式调用setJMSPriority()方法都将被忽略。</td>
<td>send</td>
</tr>
<tr>
<td>JMSDestination</td>
<td>消息发送的目的地，是一个Topic或Queue</td>
<td>send</td>
</tr>
</tbody></table>
<p><strong>JMSDeliveryMode</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MessageProducer producer = session.createProducer(topic);</span><br><span class="line">producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);</span><br></pre></td></tr></table></figure>
<p><strong>JMSExpiration</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将过期时间设置为1小时（1000毫秒 ＊60 ＊60）</span></span><br><span class="line">producer.setTimeToLive(<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br></pre></td></tr></table></figure>

<p><strong>JMSPriority</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">producer.setPriority(9);</span><br></pre></td></tr></table></figure>



<h4 id="手动头信息"><a href="#手动头信息" class="headerlink" title="手动头信息"></a>手动头信息</h4><table>
<thead>
<tr>
<th>属性名称</th>
<th>说明</th>
<th>设置者</th>
</tr>
</thead>
<tbody><tr>
<td>JMSCorrelationID</td>
<td>关联的消息ID，这个通常用在需要回传消息的时候</td>
<td>client</td>
</tr>
<tr>
<td>JMSReplyTo</td>
<td>消息回复的目的地，其值为一个Topic或Queue, 这个由发送者设置，但是接收者可以决定是否响应</td>
<td>client</td>
</tr>
<tr>
<td>JMSType</td>
<td>由消息发送者设置的消息类型，代表消息的结构，有的消息中间件可能会用到这个，但这个并不是是批消息的种类，比如TextMessage之类的</td>
<td>client</td>
</tr>
</tbody></table>
<p>从上表中我们可以看到，系统提供的标准头信息一共有10个属性，其中有6个是由send方法在调用时设置的，有三个是由客户端（client）设置的，还有一个是由消息中间件（Provider）设置的。</p>
<p>需要注意的是，这里</p>
<h2 id="下一代-ActiveMQ-6？Artemis"><a href="#下一代-ActiveMQ-6？Artemis" class="headerlink" title="下一代 ActiveMQ 6？Artemis"></a>下一代 ActiveMQ 6？Artemis</h2><p>为下一代事件驱动的消息传递应用程序提供高性能、无阻塞的体系结构。</p>
<ul>
<li>包含JNDI，具有完整的JMS 1.1 &amp; 2.0客户端实现</li>
<li>高可用性共享存储、网络复制能力</li>
<li>简单而强大的寻址模型协议</li>
<li>灵活的负载均衡分配能力</li>
<li>针对低延迟持久性和JDBC的高级日志实现</li>
<li>与ActiveMQ 5的高功能奇偶校验，以简化迁移</li>
</ul>
<p>官方文档：<a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">http://activemq.apache.org/components/artemis/migration</a></p>
<ul>
<li>netty</li>
<li>自己的存储</li>
<li>优化传输流程</li>
<li>更高的性能</li>
<li>不再把所有的协议转换成openwire</li>
</ul>
<h2 id="高级使用"><a href="#高级使用" class="headerlink" title="高级使用"></a>高级使用</h2><h3 id="JMSCorrelationID"><a href="#JMSCorrelationID" class="headerlink" title="JMSCorrelationID"></a>JMSCorrelationID</h3><p>用于消息之间的关联，给人一种会话的感觉</p>
<hr>
<h3 id="JMSReplyTo"><a href="#JMSReplyTo" class="headerlink" title="JMSReplyTo"></a><strong>JMSReplyTo</strong></h3><p>发送方可以接受到消息消费确认的地址</p>
<p>ActiveMQ5.10.x 以上版本必须使用 JDK1.8 才能正常使用。 </p>
<p>ActiveMQ5.9.x 及以下版本使用 JDK1.7 即可正常使用。</p>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="ActiveMQ如何防止消息丢失？会不会丢消息？"><a href="#ActiveMQ如何防止消息丢失？会不会丢消息？" class="headerlink" title="ActiveMQ如何防止消息丢失？会不会丢消息？"></a>ActiveMQ如何防止消息丢失？会不会丢消息？</h3><p>做高可用</p>
<p>死信队列</p>
<p>持久化</p>
<p>ack</p>
<p>消息重投</p>
<p>记录日志</p>
<p>接收（消费）确认</p>
<p>broker负载/限流</p>
<h3 id="如何防止重复消费？"><a href="#如何防止重复消费？" class="headerlink" title="如何防止重复消费？"></a>如何防止重复消费？</h3><p>消息幂等处理</p>
<p>map <em>ConcurrentHashMap</em> -&gt; putIfAbsent   guava cache</p>
<h3 id="如何保证消费顺序？"><a href="#如何保证消费顺序？" class="headerlink" title="如何保证消费顺序？"></a>如何保证消费顺序？</h3><p>queue 优先级别设置</p>
<p>多消费端 -&gt; </p>
]]></content>
      <categories>
        <category>Java</category>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MQ</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ActiveMQ_03</title>
    <url>/2020/07/12/ActiveMQ-03/</url>
    <content><![CDATA[<p>Apache ActiveMQ™ is the most popular <strong>open source, multi-protocol, Java-based messaging server</strong>. It supports industry standard protocols so users get the benefits of client choices across a broad range of languages and platforms. Connectivity from C, C++, Python, .Net, and more is available. Integrate your multi-platform applications using the ubiquitous <strong>AMQP</strong> protocol. Exchange messages between your web applications using <strong>STOMP</strong> over websockets. Manage your IoT devices using <strong>MQTT</strong>. Support your existing <strong>JMS</strong> infrastructure and beyond. ActiveMQ offers the power and flexibility to support any messaging use-case.</p>
<p>There are currently two “flavors” of ActiveMQ available - the “classic” 5.x broker and the “next generation” Artemis broker. Once Artemis reaches a sufficient level of feature parity with the 5.x code-base it will become ActiveMQ 6. Initial <a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">migration documentation</a> is available.</p>
<a id="more"></a>



<h1 id="Active-MQ-03"><a href="#Active-MQ-03" class="headerlink" title="Active MQ 03"></a>Active MQ 03</h1><h2 id="整合SpringBoot"><a href="#整合SpringBoot" class="headerlink" title="整合SpringBoot"></a>整合SpringBoot</h2><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="POM"><a href="#POM" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.3.BUILD-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mashibing.arika<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mq<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.messaginghub<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pooled-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/snapshot<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/snapshot<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">activemq:</span></span><br><span class="line">    <span class="attr">broker-url:</span> <span class="string">tcp://localhost:61616</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">pool:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment">#连接池最大连接数</span></span><br><span class="line">      <span class="attr">max-connections:</span> <span class="number">5</span></span><br><span class="line">      <span class="comment">#空闲的连接过期时间，默认为30秒</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">packages:</span></span><br><span class="line">      <span class="attr">trust-all:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">jms:</span></span><br><span class="line">    <span class="attr">pub-sub-domain:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="Config类"><a href="#Config类" class="headerlink" title="Config类"></a>Config类</h4><p>用于生产ConnectionFactory</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.arika;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.annotation.EnableJms;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.config.DefaultJmsListenerContainerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.config.JmsListenerContainerFactory;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJms</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveMqConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	 <span class="meta">@Bean</span></span><br><span class="line">	    <span class="keyword">public</span> JmsListenerContainerFactory&lt;?&gt; jmsListenerContainerTopic(ConnectionFactory activeMQConnectionFactory) &#123;</span><br><span class="line">	        DefaultJmsListenerContainerFactory bean = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();</span><br><span class="line">	        bean.setPubSubDomain(<span class="keyword">true</span>);</span><br><span class="line">	        bean.setConnectionFactory(activeMQConnectionFactory);</span><br><span class="line">	        <span class="keyword">return</span> bean;</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="comment">// queue模式的ListenerContainer</span></span><br><span class="line">	    <span class="meta">@Bean</span></span><br><span class="line">	    <span class="keyword">public</span> JmsListenerContainerFactory&lt;?&gt; jmsListenerContainerQueue(ConnectionFactory activeMQConnectionFactory) &#123;</span><br><span class="line">	        DefaultJmsListenerContainerFactory bean = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();</span><br><span class="line">	        bean.setConnectionFactory(activeMQConnectionFactory);</span><br><span class="line">	        <span class="keyword">return</span> bean;</span><br><span class="line">	    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="收"><a href="#收" class="headerlink" title="收"></a>收</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@JmsListener</span>(destination = <span class="string">"user"</span>,containerFactory = <span class="string">"jmsListenerContainerQueue"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveStringQueue</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"接收到消息...."</span> + msg);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JmsListener</span>(destination = <span class="string">"ooo"</span>,containerFactory = <span class="string">"jmsListenerContainerTopic"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveStringTopic</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"接收到消息...."</span> + msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="发"><a href="#发" class="headerlink" title="发"></a>发</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.arika;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Connection;</span><br><span class="line"><span class="keyword">import</span> javax.jms.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageProducer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Queue;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Session;</span><br><span class="line"><span class="keyword">import</span> javax.jms.TextMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.command.ActiveMQQueue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.JmsMessagingTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.JmsTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.MessageCreator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MqProducerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JmsMessagingTemplate jmsMessagingTemplate;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendStringQueue</span><span class="params">(String destination, String msg)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"send..."</span>);</span><br><span class="line">		ActiveMQQueue queue = <span class="keyword">new</span> ActiveMQQueue(destination);</span><br><span class="line">		jmsMessagingTemplate.afterPropertiesSet();</span><br><span class="line">		</span><br><span class="line">		ConnectionFactory factory = jmsMessagingTemplate.getConnectionFactory();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Connection connection = factory.createConnection();</span><br><span class="line">			connection.start();</span><br><span class="line">			</span><br><span class="line">			Session session = connection.createSession(<span class="keyword">true</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">			Queue queue2 = session.createQueue(destination);</span><br><span class="line">			</span><br><span class="line">			MessageProducer producer = session.createProducer(queue2);</span><br><span class="line">			</span><br><span class="line">			TextMessage message = session.createTextMessage(<span class="string">"hahaha"</span>);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			producer.send(message);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		jmsMessagingTemplate.convertAndSend(queue, msg);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendStringQueueList</span><span class="params">(String destination, String msg)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"xxooq"</span>);</span><br><span class="line">		ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		list.add(<span class="string">"1"</span>);</span><br><span class="line">		list.add(<span class="string">"2"</span>);</span><br><span class="line">		jmsMessagingTemplate.convertAndSend(<span class="keyword">new</span> ActiveMQQueue(destination), list);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MQ</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ActiveMQ_02</title>
    <url>/2020/07/12/ActiveMQ-02/</url>
    <content><![CDATA[<p>Apache ActiveMQ™ is the most popular <strong>open source, multi-protocol, Java-based messaging server</strong>. It supports industry standard protocols so users get the benefits of client choices across a broad range of languages and platforms. Connectivity from C, C++, Python, .Net, and more is available. Integrate your multi-platform applications using the ubiquitous <strong>AMQP</strong> protocol. Exchange messages between your web applications using <strong>STOMP</strong> over websockets. Manage your IoT devices using <strong>MQTT</strong>. Support your existing <strong>JMS</strong> infrastructure and beyond. ActiveMQ offers the power and flexibility to support any messaging use-case.</p>
<p>There are currently two “flavors” of ActiveMQ available - the “classic” 5.x broker and the “next generation” Artemis broker. Once Artemis reaches a sufficient level of feature parity with the 5.x code-base it will become ActiveMQ 6. Initial <a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">migration documentation</a> is available.</p>
<a id="more"></a>

<h1 id="Active-MQ-02"><a href="#Active-MQ-02" class="headerlink" title="Active MQ 02"></a>Active MQ 02</h1><h2 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h2><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">session.commit();</span></span><br><span class="line"><span class="attr">session.rollback();</span></span><br></pre></td></tr></table></figure>

<p>用来提交/回滚事务</p>
<h3 id="Purge"><a href="#Purge" class="headerlink" title="Purge"></a>Purge</h3><p>清理消息</p>
<h3 id="签收模式"><a href="#签收模式" class="headerlink" title="签收模式"></a>签收模式</h3><p>签收代表接收端的session已收到消息的一次确认，反馈给broker</p>
<p>ActiveMQ支持自动签收与手动签收</p>
<h4 id="Session-AUTO-ACKNOWLEDGE"><a href="#Session-AUTO-ACKNOWLEDGE" class="headerlink" title="Session.AUTO_ACKNOWLEDGE"></a>Session.AUTO_ACKNOWLEDGE</h4><p>当客户端从receiver或onMessage成功返回时，Session自动签收客户端的这条消息的收条。</p>
<h4 id="Session-CLIENT-ACKNOWLEDGE"><a href="#Session-CLIENT-ACKNOWLEDGE" class="headerlink" title="Session.CLIENT_ACKNOWLEDGE"></a>Session.CLIENT_ACKNOWLEDGE</h4><p>客户端通过调用消息(Message)的acknowledge方法签收消息。在这种情况下，签收发生在Session层面：签收一个已经消费的消息会自动地签收这个Session所有已消费的收条。</p>
<h4 id="Session-DUPS-OK-ACKNOWLEDGE"><a href="#Session-DUPS-OK-ACKNOWLEDGE" class="headerlink" title="Session.DUPS_OK_ACKNOWLEDGE"></a>Session.DUPS_OK_ACKNOWLEDGE</h4><p>Session不必确保对传送消息的签收，这个模式可能会引起消息的重复，但是降低了Session的开销，所以只有客户端能容忍重复的消息，才可使用。</p>
<h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><p>默认持久化是开启的</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT)</span></span><br></pre></td></tr></table></figure>

<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><p>可以打乱消费顺序</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">producer.setPriority</span></span><br></pre></td></tr></table></figure>

<p>配置文件需要指定使用优先级的目的地</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">policyEntry</span> <span class="attr">queue</span>=<span class="string">"queue1"</span> <span class="attr">prioritizedMessages</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="消息超时-过期"><a href="#消息超时-过期" class="headerlink" title="消息超时/过期"></a>消息超时/过期</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">producer.setTimeToLive</span></span><br></pre></td></tr></table></figure>

<p>设置了消息超时的消息，消费端在超时后无法在消费到此消息。</p>
<p>给消息设置一个超时时间 -&gt; 死信队列 -&gt; 拿出来 -&gt; 重发</p>
<h4 id="死信"><a href="#死信" class="headerlink" title="死信"></a>死信</h4><p>此类消息会进入到<code>ActiveMQ.DLQ</code>队列且不会自动清除，称为死信</p>
<p>此处有消息堆积的风险</p>
<h4 id="修改死信队列名称"><a href="#修改死信队列名称" class="headerlink" title="修改死信队列名称"></a>修改死信队列名称</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">policyEntry</span> <span class="attr">queue</span>=<span class="string">"f"</span> <span class="attr">prioritizedMessages</span>=<span class="string">"true"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">deadLetterStrategy</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">individualDeadLetterStrategy</span>   <span class="attr">queuePrefix</span>=<span class="string">"DLxxQ."</span> <span class="attr">useQueueForQueueMessages</span>=<span class="string">"true"</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">deadLetterStrategy</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">policyEntry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>useQueueForQueueMessages: 设置使用队列保存死信，还可以设置useQueueForTopicMessages，使用Topic来保存死信 </p>
<h4 id="让非持久化的消息也进入死信队列"><a href="#让非持久化的消息也进入死信队列" class="headerlink" title="让非持久化的消息也进入死信队列"></a>让非持久化的消息也进入死信队列</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">individualDeadLetterStrategy</span>   <span class="attr">queuePrefix</span>=<span class="string">"DLxxQ."</span> <span class="attr">useQueueForQueueMessages</span>=<span class="string">"true"</span>  <span class="attr">processNonPersistent</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>processNonPersistent=”true”</p>
<h4 id="过期消息不进死信队列"><a href="#过期消息不进死信队列" class="headerlink" title="过期消息不进死信队列"></a>过期消息不进死信队列</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">individualDeadLetterStrategy</span>   <span class="attr">processExpired</span>=<span class="string">"false"</span>  /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="独占消费者"><a href="#独占消费者" class="headerlink" title="独占消费者"></a>独占消费者</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Queue queue = session.createQueue(<span class="string">"xxoo?consumer.exclusive=true"</span>);</span><br></pre></td></tr></table></figure>

<p>还可以设置优先级</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Queue queue = session.createQueue(<span class="string">"xxoo?consumer.exclusive=true&amp;consumer.priority=10"</span>);</span><br></pre></td></tr></table></figure>



<h2 id="消息类型"><a href="#消息类型" class="headerlink" title="消息类型"></a>消息类型</h2><h3 id="object"><a href="#object" class="headerlink" title="object"></a>object</h3><h4 id="发送端"><a href="#发送端" class="headerlink" title="发送端"></a>发送端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Girl girl = <span class="keyword">new</span> Girl(<span class="string">"qiqi"</span>,<span class="number">25</span>,<span class="number">398.0</span>);</span><br><span class="line"></span><br><span class="line">Message message = session.createObjectMessage(girl);</span><br></pre></td></tr></table></figure>



<h4 id="接受端"><a href="#接受端" class="headerlink" title="接受端"></a>接受端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(message <span class="keyword">instanceof</span> ActiveMQObjectMessage) &#123;</span><br><span class="line">	</span><br><span class="line">	Girl girl = (Girl)((ActiveMQObjectMessage)message).getObject();</span><br><span class="line">	</span><br><span class="line">	System.out.println(girl);</span><br><span class="line">	System.out.println(girl.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>如果遇到此类报错</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Exception in thread "main" javax.jms.JMSException: Failed to build body from content. Serializable class not available to broker. Reason: java.lang.ClassNotFoundException: Forbidden class com.mashibing.mq.Girl! This class is not trusted to be serialized as ObjectMessage payload. Please take a look at http://activemq.apache.org/objectmessage.html for more information on how to configure trusted classes.</span><br><span class="line">	at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:<span class="number">36</span>)</span><br><span class="line">	at org.apache.activemq.command.ActiveMQObjectMessage.getObject(ActiveMQObjectMessage.java:<span class="number">213</span>)</span><br><span class="line">	at com.mashibing.mq.Receiver.main(Receiver.java:<span class="number">65</span>)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: Forbidden class com.mashibing.mq.Girl! This class is not trusted to be serialized as ObjectMessage payload. Please take a look at http://activemq.apache.org/objectmessage.html for more information on how to configure trusted classes.</span><br><span class="line">	at org.apache.activemq.util.ClassLoadingAwareObjectInputStream.checkSecurity(ClassLoadingAwareObjectInputStream.java:<span class="number">112</span>)</span><br><span class="line">	at org.apache.activemq.util.ClassLoadingAwareObjectInputStream.resolveClass(ClassLoadingAwareObjectInputStream.java:<span class="number">57</span>)</span><br><span class="line">	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:<span class="number">1868</span>)</span><br><span class="line">	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:<span class="number">1751</span>)</span><br><span class="line">	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:<span class="number">2042</span>)</span><br><span class="line">	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:<span class="number">1573</span>)</span><br><span class="line">	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:<span class="number">431</span>)</span><br><span class="line">	at org.apache.activemq.command.ActiveMQObjectMessage.getObject(ActiveMQObjectMessage.java:<span class="number">211</span>)</span><br><span class="line">	... <span class="number">1</span> more</span><br></pre></td></tr></table></figure>

<p><strong>需要添加信任</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">connectionFactory.setTrustedPackages(</span><br><span class="line">		<span class="keyword">new</span> ArrayList&lt;String&gt;(</span><br><span class="line">				Arrays.asList(</span><br><span class="line">						<span class="keyword">new</span> String[]&#123;</span><br><span class="line">								Girl<span class="class">.<span class="keyword">class</span>.<span class="title">getPackage</span>().<span class="title">getName</span>()</span></span><br><span class="line"><span class="class">								&#125;</span></span><br><span class="line"><span class="class">						</span></span><br><span class="line"><span class="class">						)</span></span><br><span class="line"><span class="class">				)</span></span><br><span class="line"><span class="class">		</span></span><br><span class="line"><span class="class">		)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="bytesMessage"><a href="#bytesMessage" class="headerlink" title="bytesMessage"></a>bytesMessage</h3><h4 id="发送端-1"><a href="#发送端-1" class="headerlink" title="发送端"></a>发送端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BytesMessage bytesMessage = session.createBytesMessage();</span><br><span class="line">      bytesMessage.writeBytes(<span class="string">"str"</span>.getBytes());</span><br><span class="line">      bytesMessage.writeUTF(<span class="string">"哈哈"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="接受端-1"><a href="#接受端-1" class="headerlink" title="接受端"></a>接受端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(message <span class="keyword">instanceof</span> BytesMessage) &#123;</span><br><span class="line">	BytesMessage bm = (BytesMessage)message;</span><br><span class="line">	</span><br><span class="line">	 <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">           <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">           <span class="keyword">while</span> ((len = bm.readBytes(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">               System.out.println(<span class="keyword">new</span> String(b, <span class="number">0</span>, len));</span><br><span class="line">           &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>还可以使用ActiveMQ给提供的便捷方法,但要注意读取和写入的顺序</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">bm.readBoolean()</span><br><span class="line">bm.readUTF()</span><br></pre></td></tr></table></figure>



<h4 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileOutputStream out = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    out = <span class="keyword">new</span> FileOutputStream(<span class="string">"d:/aa.txt"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e2) &#123;</span><br><span class="line">    e2.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">byte</span>[] by = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>((len = bm.readBytes(by))!= -<span class="number">1</span>)&#123;</span><br><span class="line">        out.write(by,<span class="number">0</span>,len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e1) &#123;</span><br><span class="line">    e1.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MapMessage"><a href="#MapMessage" class="headerlink" title="MapMessage"></a>MapMessage</h3><h4 id="发送端-2"><a href="#发送端-2" class="headerlink" title="发送端"></a>发送端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MapMessage mapMessage = session.createMapMessage();</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">mapMessage.setString(<span class="string">"name"</span>,<span class="string">"lucy"</span>);</span><br><span class="line">      mapMessage.setBoolean(<span class="string">"yihun"</span>,<span class="keyword">false</span>);</span><br><span class="line">mapMessage.setInt(<span class="string">"age"</span>, <span class="number">17</span>);</span><br><span class="line"></span><br><span class="line">producer.send(mapMessage);</span><br></pre></td></tr></table></figure>

<h4 id="接收端"><a href="#接收端" class="headerlink" title="接收端"></a>接收端</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Message message = consumer.receive();</span><br><span class="line">MapMessage mes = (MapMessage) message;</span><br><span class="line"></span><br><span class="line">System.out.println(mes);</span><br><span class="line"></span><br><span class="line">System.out.println(mes.getString(<span class="string">"name"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="消息发送原理"><a href="#消息发送原理" class="headerlink" title="消息发送原理"></a>消息发送原理</h2><h3 id="同步与异步"><a href="#同步与异步" class="headerlink" title="同步与异步"></a>同步与异步</h3><table>
<thead>
<tr>
<th></th>
<th>开启事务</th>
<th>关闭事务</th>
</tr>
</thead>
<tbody><tr>
<td>持久化</td>
<td>异步</td>
<td>同步</td>
</tr>
<tr>
<td>非持久化</td>
<td>异步</td>
<td>异步</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>我们可以通过以下几种方式来设置异步发送：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(</span><br><span class="line">		<span class="string">"admin"</span>,</span><br><span class="line">		<span class="string">"admin"</span>,</span><br><span class="line">		<span class="string">"tcp://localhost:61616"</span></span><br><span class="line">		);</span><br><span class="line"><span class="comment">// 2.获取一个向ActiveMQ的连接</span></span><br><span class="line">connectionFactory.setUseAsyncSend(<span class="keyword">true</span>);</span><br><span class="line">ActiveMQConnection connection = (ActiveMQConnection)connectionFactory.createConnection();</span><br><span class="line">connection.setUseAsyncSend(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="消息堆积"><a href="#消息堆积" class="headerlink" title="消息堆积"></a>消息堆积</h3><p>producer每发送一个消息，统计一下发送的字节数，当字节数达到ProducerWindowSize值时，需要等待broker的确认，才能继续发送。</p>
<p>brokerUrl中设置: <code>tcp://localhost:61616?jms.producerWindowSize=1048576</code></p>
<p>destinationUri中设置: <code>myQueue?producer.windowSize=1048576</code></p>
<h3 id="延迟消息投递"><a href="#延迟消息投递" class="headerlink" title="延迟消息投递"></a>延迟消息投递</h3><p>首先在配置文件中开启延迟和调度</p>
<p><strong>schedulerSupport=”true”</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;broker xmlns=<span class="string">"http://activemq.apache.org/schema/core"</span> brokerName=<span class="string">"localhost"</span> dataDirectory=<span class="string">"$&#123;activemq.data&#125;"</span> schedulerSupport=<span class="string">"true"</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="延迟发送"><a href="#延迟发送" class="headerlink" title="延迟发送"></a>延迟发送</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, <span class="number">10</span>*<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="带间隔的重复发送"><a href="#带间隔的重复发送" class="headerlink" title="带间隔的重复发送"></a>带间隔的重复发送</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> delay = <span class="number">10</span> * <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">long</span> period = <span class="number">2</span> * <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">int</span> repeat = <span class="number">9</span>;</span><br><span class="line">message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, delay);</span><br><span class="line">message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_PERIOD, period);</span><br><span class="line">message.setIntProperty(ScheduledMessage.AMQ_SCHEDULED_REPEAT, repeat);</span><br><span class="line">createProducer.send(message);</span><br></pre></td></tr></table></figure>

<h3 id="Cron表达式定时发送"><a href="#Cron表达式定时发送" class="headerlink" title="Cron表达式定时发送"></a>Cron表达式定时发送</h3><p>Cron表达式是一个字符串，字符串以5或6个空格隔开，分为6或7个域，每一个域代表一个含义，Cron有如下两种语法格式： </p>
<p><em>Seconds Minutes Hours DayofMonth Month DayofWeek Year或</em> </p>
<p>Seconds Minutes Hours DayofMonth Month DayofWeek</p>
<p>每一个域可出现的字符如下： </p>
<p>Seconds:可出现”, - * /“四个字符，有效范围为0-59的整数 </p>
<p>Minutes:可出现”, - * /“四个字符，有效范围为0-59的整数 </p>
<p>Hours:可出现”, - * /“四个字符，有效范围为0-23的整数 </p>
<p>DayofMonth:可出现”, - * / ? L W C”八个字符，有效范围为0-31的整数 </p>
<p>Month:可出现”, - * /“四个字符，有效范围为1-12的整数或JAN-DEc </p>
<p>DayofWeek:可出现”, - * / ? L C #”四个字符，有效范围为1-7的整数或SUN-SAT两个范围。1表示星期天，2表示星期一， 依次类推 </p>
<p>Year:可出现”, - * /“四个字符，有效范围为1970-2099年</p>
<p>每一个域都使用数字，但还可以出现如下特殊字符，它们的含义是： </p>
<p>(1)<em>：表示匹配该域的任意值，假如在Minutes域使用</em>, 即表示每分钟都会触发事件。</p>
<p>(2)?:只能用在DayofMonth和DayofWeek两个域。它也匹配域的任意值，但实际不会。因为DayofMonth和 DayofWeek会相互影响。例如想在每月的20日触发调度，不管20日到底是星期几，则只能使用如下写法： 13 13 15 20 * ?, 其中最后一位只能用？，而不能使用<em>，如果使用</em>表示不管星期几都会触发，实际上并不是这样。 </p>
<p>(3)-:表示范围，例如在Minutes域使用5-20，表示从5分到20分钟每分钟触发一次 </p>
<p>(4)/：表示起始时间开始触发，然后每隔固定时间触发一次，例如在Minutes域使用5/20,则意味着5分钟触发一次，而25，45等分别触发一次. </p>
<p>(5),:表示列出枚举值值。例如：在Minutes域使用5,20，则意味着在5和20分每分钟触发一次。 </p>
<p>(6)L:表示最后，只能出现在DayofWeek和DayofMonth域，如果在DayofWeek域使用5L,意味着在最后的一个星期四触发。 </p>
<p>(7)W: 表示有效工作日(周一到周五),只能出现在DayofMonth域，系统将在离指定日期的最近的有效工作日触发事件。例如：在 DayofMonth使用5W，如果5日是星期六，则将在最近的工作日：星期五，即4日触发。如果5日是星期天，则在6日(周一)触发；如果5日在星期一 到星期五中的一天，则就在5日触发。另外一点，W的最近寻找不会跨过月份 </p>
<p>(8)LW:这两个字符可以连用，表示在某个月最后一个工作日，即最后一个星期五。 </p>
<p>(9)#:用于确定每个月第几个星期几，只能出现在DayofMonth域。例如在4#2，表示某月的第二个星期三。</p>
<p>举几个例子: </p>
<p>0 0 2 1 * ? * 表示在每月的1日的凌晨2点调度任务 </p>
<p>0 15 10 ? * MON-FRI 表示周一到周五每天上午10：15执行作业 </p>
<p>0 15 10 ? 6L 2002-2006 表示2002-2006年的每个月的最后一个星期五上午10:15执行作</p>
<p>一个cron表达式有至少6个（也可能7个）有空格分隔的时间元素。 </p>
<p>按顺序依次为 </p>
<p>秒（0~59） </p>
<p>分钟（0~59） </p>
<p>小时（0~23） </p>
<p>天（月）（0~31，但是你需要考虑你月的天数） </p>
<p>月（0~11） </p>
<p>天（星期）（1~7 1=SUN 或 SUN，MON，TUE，WED，THU，FRI，SAT） </p>
<p>年份（1970－2099）</p>
<p>其中每个元素可以是一个值(如6),一个连续区间(9-12),一个间隔时间(8-18/4)(/表示每隔4小时),一个列表(1,3,5),通配符。由于”月份中的日期”和”星期中的日期”这两个元素互斥的,必须要对其中一个设置?</p>
<p>0 0 10,14,16 * * ? 每天上午10点，下午2点，4点 </p>
<p>0 0/30 9-17 * * ? 朝九晚五工作时间内每半小时 </p>
<p>0 0 12 ? * WED 表示每个星期三中午12点 </p>
<p>“0 0 12 * * ?” 每天中午12点触发 </p>
<p>“0 15 10 ? * *” 每天上午10:15触发 </p>
<p>“0 15 10 * * ?” 每天上午10:15触发 </p>
<p>“0 15 10 * * ? *” 每天上午10:15触发 </p>
<p>“0 15 10 * * ? 2005” 2005年的每天上午10:15触发 </p>
<p>“0 * 14 * * ?” 在每天下午2点到下午2:59期间的每1分钟触发 </p>
<p>“0 0/5 14 * * ?” 在每天下午2点到下午2:55期间的每5分钟触发 </p>
<p>“0 0/5 14,18 * * ?” 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发 </p>
<p>“0 0-5 14 * * ?” 在每天下午2点到下午2:05期间的每1分钟触发 </p>
<p>“0 10,44 14 ? 3 WED” 每年三月的星期三的下午2:10和2:44触发 </p>
<p>“0 15 10 ? * MON-FRI” 周一至周五的上午10:15触发 </p>
<p>“0 15 10 15 * ?” 每月15日上午10:15触发 </p>
<p>“0 15 10 L * ?” 每月最后一日的上午10:15触发 </p>
<p>“0 15 10 ? * 6L” 每月的最后一个星期五上午10:15触发 </p>
<p>“0 15 10 ? * 6L 2002-2005” 2002年至2005年的每月的最后一个星期五上午10:15触发 </p>
<p>“0 15 10 ? * 6#3” 每月的第三个星期五上午10:15触发</p>
<h2 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h2><p>可以使用监听器来处理消息接收</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">consumer.setMessageListener(new MyListener());</span><br></pre></td></tr></table></figure>

<p>需要实现接口MessageListener</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		TextMessage textMessage = (TextMessage)message;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"xxoo"</span> + textMessage.getText());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当收到消息后会调起onMessage方法</p>
<h2 id="消息过滤"><a href="#消息过滤" class="headerlink" title="消息过滤"></a>消息过滤</h2><h3 id="消息发送"><a href="#消息发送" class="headerlink" title="消息发送"></a>消息发送</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MapMessage msg1 = session.createMapMessage();</span><br><span class="line">msg1.setString(<span class="string">"name"</span>, <span class="string">"qiqi"</span>);</span><br><span class="line">msg1.setString(<span class="string">"age"</span>, <span class="string">"18"</span>);</span><br><span class="line"></span><br><span class="line">msg1.setStringProperty(<span class="string">"name"</span>, <span class="string">"qiqi"</span>);</span><br><span class="line">msg1.setIntProperty(<span class="string">"age"</span>, <span class="number">18</span>);</span><br><span class="line">MapMessage msg2 = session.createMapMessage();</span><br><span class="line">msg2.setString(<span class="string">"name"</span>, <span class="string">"lucy"</span>);</span><br><span class="line">msg2.setString(<span class="string">"age"</span>, <span class="string">"18"</span>);</span><br><span class="line">msg2.setStringProperty(<span class="string">"name"</span>, <span class="string">"lucy"</span>);</span><br><span class="line">msg2.setIntProperty(<span class="string">"age"</span>, <span class="number">18</span>);</span><br><span class="line">MapMessage msg3 = session.createMapMessage();</span><br><span class="line">msg3.setString(<span class="string">"name"</span>, <span class="string">"qianqian"</span>);</span><br><span class="line">msg3.setString(<span class="string">"age"</span>, <span class="string">"17"</span>);</span><br><span class="line">msg3.setStringProperty(<span class="string">"name"</span>, <span class="string">"qianqian"</span>);</span><br><span class="line">msg3.setIntProperty(<span class="string">"age"</span>, <span class="number">17</span>);</span><br></pre></td></tr></table></figure>

<h3 id="消息接收"><a href="#消息接收" class="headerlink" title="消息接收"></a>消息接收</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	</span><br><span class="line">String selector1 = <span class="string">"age &gt; 17"</span>;</span><br><span class="line">String selector2 = <span class="string">"name = 'lucy'"</span>;</span><br><span class="line">MessageConsumer consumer = session.createConsumer(queue,selector2);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Java</category>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MQ</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ActiveMQ_01</title>
    <url>/2020/07/12/ActiveMQ-01/</url>
    <content><![CDATA[<p>Apache ActiveMQ™ is the most popular <strong>open source, multi-protocol, Java-based messaging server</strong>. It supports industry standard protocols so users get the benefits of client choices across a broad range of languages and platforms. Connectivity from C, C++, Python, .Net, and more is available. Integrate your multi-platform applications using the ubiquitous <strong>AMQP</strong> protocol. Exchange messages between your web applications using <strong>STOMP</strong> over websockets. Manage your IoT devices using <strong>MQTT</strong>. Support your existing <strong>JMS</strong> infrastructure and beyond. ActiveMQ offers the power and flexibility to support any messaging use-case.</p>
<p>There are currently two “flavors” of ActiveMQ available - the “classic” 5.x broker and the “next generation” Artemis broker. Once Artemis reaches a sufficient level of feature parity with the 5.x code-base it will become ActiveMQ 6. Initial <a href="http://activemq.apache.org/components/artemis/migration" target="_blank" rel="noopener">migration documentation</a> is available.</p>
<a id="more"></a>





<h1 id="1-消息中间件之ActiveMQ-01"><a href="#1-消息中间件之ActiveMQ-01" class="headerlink" title="1. 消息中间件之ActiveMQ 01"></a>1. 消息中间件之ActiveMQ 01</h1><h2 id="1-1-什么是JMS-MQ"><a href="#1-1-什么是JMS-MQ" class="headerlink" title="1.1 什么是JMS MQ"></a>1.1 什么是JMS MQ</h2><p>全称：Java MessageService 中文：Java 消息服务。 </p>
<p>JMS 是 Java 的一套 API 标准，最初的目的是为了使应用程序能够访问现有的 MOM 系 统（MOM 是 MessageOriented Middleware 的英文缩写，指的是利用高效可靠的消息传递机 制进行平台无关的数据交流，并基于数据通信来进行分布式系统的集成。） ；</p>
<p>后来被许多现有 的 MOM 供应商采用，并实现为 MOM 系统。【常见 MOM 系统包括 Apache 的 ActiveMQ、 阿里巴巴的 RocketMQ、IBM 的 MQSeries、Microsoft 的 MSMQ、BEA 的 RabbitMQ 等。 （并 非全部的 MOM 系统都遵循 JMS 规范）】 </p>
<p>基于 JMS 实现的 MOM，又被称为 JMSProvider。</p>
<p>“消息”是在两台计算机间传送的数据单位。消息可以非常简单，例如只包含文本字符串； 也可以更复杂，可能包含嵌入对象。 消息被发送到队列中。</p>
<p>“消息队列”是在消息的传输过程中保存消息的容器。消息队列管 理器在将消息从它的源中继到它的目标时充当中间人。</p>
<p>队列的主要目的是提供路由并保证消 息的传递；如果发送消息时接收者不可用，消息队列会保留消息，直到可以成功地传递它。</p>
<p>消息队列的主要特点是异步处理，主要目的是减少请求响应时间和解耦。所以主要的使 用场景就是将比较耗时而且不需要即时（同步）返回结果的操作作为消息放入消息队列。同 时由于使用了消息队列，只要保证消息格式不变，消息的发送方和接收方并不需要彼此联系， 也不需要受对方的影响，即解耦和。如: 跨系统的异步通信，所有需要异步交互的地方都可以使用消息队列。就像我们除了打电 话（同步）以外，还需要发短信，发电子邮件（异步）的通讯方式。 多个应用之间的耦合，由于消息是平台无关和语言无关的，而且语义上也不再是函数调 用，因此更适合作为多个应用之间的松耦合的接口。基于消息队列的耦合，不需要发送方和 接收方同时在线。 在企业应用集成（EAI）中，文件传输，共享数据库，消息队列，远程过程调用都可以 作为集成的方法。 应用内的同步变异步，比如订单处理，就可以由前端应用将订单信息放到队列，后端应 用从队列里依次获得消息处理，高峰时的大量订单可以积压在队列里慢慢处理掉。由于同步 通常意味着阻塞，而大量线程的阻塞会降低计算机的性能。 消息驱动的架构（EDA），系统分解为消息队列，和消息制造者和消息消费者，一个处 理流程可以根据需要拆成多个阶段（Stage） ，阶段之间用队列连接起来，前一个阶段处理的 结果放入队列，后一个阶段从队列中获取消息继续处理。 应用需要更灵活的耦合方式，如发布订阅，比如可以指定路由规则。 跨局域网，甚至跨城市的通讯，比如北京机房与广州机房的应用程序的通信。</p>
<p>##1.2  消息中间件应用场景</p>
<h3 id="1-2-1-异步通信"><a href="#1-2-1-异步通信" class="headerlink" title="1.2.1  异步通信"></a>1.2.1  <strong>异步通信</strong></h3><p>有些业务不想也不需要立即处理消息。消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。想向队列中放入多少消息就放多少，然后在需要的时候再去处理它们。</p>
<h3 id="1-2-2-缓冲"><a href="#1-2-2-缓冲" class="headerlink" title="1.2.2   缓冲"></a>1.2.2   <strong>缓冲</strong></h3><p>在任何重要的系统中，都会有需要不同的处理时间的元素。消息队列通过一个缓冲层来帮助任务最高效率的执行，该缓冲有助于控制和优化数据流经过系统的速度。以调节系统响应时间。</p>
<h3 id="1-2-3-解耦"><a href="#1-2-3-解耦" class="headerlink" title="1.2.3 解耦"></a>1.2.3 <strong>解耦</strong></h3><p>降低工程间的强依赖程度，针对异构系统进行适配。在项目启动之初来预测将来项目会碰到什么需求，是极其困难的。通过消息系统在处理过程中间插入了一个隐含的、基于数据的接口层，两边的处理过程都要实现这一接口，当应用发生变化时，可以独立的扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束。</p>
<h3 id="1-2-4-冗余"><a href="#1-2-4-冗余" class="headerlink" title="1.2.4 冗余"></a>1.2.4 <strong>冗余</strong></h3><p>有些情况下，处理数据的过程会失败。除非数据被持久化，否则将造成丢失。消息队列把数据进行持久化直到它们已经被完全处理，通过这一方式规避了数据丢失风险。许多消息队列所采用的”插入-获取-删除”范式中，在把一个消息从队列中删除之前，需要你的处理系统明确的指出该消息已经被处理完毕，从而确保你的数据被安全的保存直到你使用完毕。</p>
<h3 id="1-2-5-扩展性"><a href="#1-2-5-扩展性" class="headerlink" title="1.2.5 扩展性"></a>1.2.5 <strong>扩展性</strong></h3><p>因为消息队列解耦了你的处理过程，所以增大消息入队和处理的频率是很容易的，只要另外增加处理过程即可。不需要改变代码、不需要调节参数。便于分布式扩容。</p>
<h3 id="1-2-6-可恢复性"><a href="#1-2-6-可恢复性" class="headerlink" title="1.2.6 可恢复性"></a>1.2.6 <strong>可恢复性</strong></h3><p>系统的一部分组件失效时，不会影响到整个系统。消息队列降低了进程间的耦合度，所以即使一个处理消息的进程挂掉，加入队列中的消息仍然可以在系统恢复后被处理。</p>
<h3 id="1-2-7-顺序保证"><a href="#1-2-7-顺序保证" class="headerlink" title="1.2.7 顺序保证"></a>1.2.7 <strong>顺序保证</strong></h3><p>在大多使用场景下，数据处理的顺序都很重要。大部分消息队列本来就是排序的，并且能保证数据会按照特定的顺序来处理。</p>
<h3 id="1-2-8-过载保护"><a href="#1-2-8-过载保护" class="headerlink" title="1.2.8 过载保护"></a>1.2.8 <strong>过载保护</strong></h3><p>在访问量剧增的情况下，应用仍然需要继续发挥作用，但是这样的突发流量无法提取预知；如果以为了能处理这类瞬间峰值访问为标准来投入资源随时待命无疑是巨大的浪费。使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。</p>
<h3 id="1-2-9-数据流处理"><a href="#1-2-9-数据流处理" class="headerlink" title="1.2.9 数据流处理"></a>1.2.9 <strong>数据流处理</strong></h3><p>分布式系统产生的海量数据流，如：业务日志、监控数据、用户行为等，针对这些数据流进行实时或批量采集汇总，然后进行大数据分析是当前互联网的必备技术，通过消息队列完成此类数据收集是最好的选择。</p>
<h2 id="1-3-常用消息队列（ActiveMQ、RabbitMQ、RocketMQ、Kafka）比较"><a href="#1-3-常用消息队列（ActiveMQ、RabbitMQ、RocketMQ、Kafka）比较" class="headerlink" title="1.3 常用消息队列（ActiveMQ、RabbitMQ、RocketMQ、Kafka）比较"></a>1.3 常用消息队列（ActiveMQ、RabbitMQ、RocketMQ、Kafka）比较</h2><table>
<thead>
<tr>
<th>特性MQ</th>
<th>ActiveMQ</th>
<th>RabbitMQ</th>
<th>RocketMQ</th>
<th>Kafka</th>
</tr>
</thead>
<tbody><tr>
<td>生产者消费者模式</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>发布订阅模式</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>请求回应模式</td>
<td>支持</td>
<td>支持</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td>Api完备性</td>
<td>高</td>
<td>高</td>
<td>高</td>
<td>高</td>
</tr>
<tr>
<td>多语言支持</td>
<td>支持</td>
<td>支持</td>
<td>java</td>
<td>支持</td>
</tr>
<tr>
<td>单机吞吐量</td>
<td>万级</td>
<td>万级</td>
<td>万级</td>
<td>十万级</td>
</tr>
<tr>
<td>消息延迟</td>
<td>无</td>
<td>微秒级</td>
<td>毫秒级</td>
<td>毫秒级</td>
</tr>
<tr>
<td>可用性</td>
<td>高（主从）</td>
<td>高（主从）</td>
<td>非常高（分布式）</td>
<td>非常高（分布式）</td>
</tr>
<tr>
<td>消息丢失</td>
<td>低</td>
<td>低</td>
<td>理论上不会丢失</td>
<td>理论上不会丢失</td>
</tr>
<tr>
<td>文档的完备性</td>
<td>高</td>
<td>高</td>
<td>高</td>
<td>高</td>
</tr>
<tr>
<td>提供快速入门</td>
<td>有</td>
<td>有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>社区活跃度</td>
<td>高</td>
<td>高</td>
<td>有</td>
<td>高</td>
</tr>
<tr>
<td>商业支持</td>
<td>无</td>
<td>无</td>
<td>商业云</td>
<td>商业云</td>
</tr>
</tbody></table>
<h2 id="1-4-JMS中的一些角色"><a href="#1-4-JMS中的一些角色" class="headerlink" title="1.4 JMS中的一些角色"></a>1.4 JMS中的一些角色</h2><h3 id="1-4-1-Broker"><a href="#1-4-1-Broker" class="headerlink" title="1.4.1 Broker"></a>1.4.1 <strong>Broker</strong></h3><p>消息服务器，作为server提供消息核心服务</p>
<h3 id="1-4-2-provider"><a href="#1-4-2-provider" class="headerlink" title="1.4.2 provider"></a>1.4.2 provider</h3><p>生产者</p>
<p>消息生产者是由会话创建的一个对象，用于把消息发送到一个目的地。</p>
<h3 id="1-4-3-Consumer"><a href="#1-4-3-Consumer" class="headerlink" title="1.4.3 Consumer"></a>1.4.3 Consumer</h3><p>消费者</p>
<p>消息消费者是由会话创建的一个对象，它用于接收发送到目的地的消息。消息的消费可以采用以下两种方法之一：</p>
<ul>
<li>同步消费。通过调用消费者的receive方法从目的地中显式提取消息。receive方法可以一直阻塞到消息到达。</li>
<li>异步消费。客户可以为消费者注册一个消息监听器，以定义在消息到达时所采取的动作。</li>
</ul>
<h3 id="1-4-4-p2p"><a href="#1-4-4-p2p" class="headerlink" title="1.4.4 p2p"></a>1.4.4 p2p</h3><p>基于点对点的消息模型</p>
<p>消息生产者生产消息发送到 queue 中，然后消息消费者从 queue 中取出并且消费消息。 消息被消费以后，queue 中不再有存储，所以消息消费者不可能消费到已经被消费的消<br>息。<br>Queue 支持存在多个消费者，但是对一个消息而言，只会有一个消费者可以消费、其它 的则不能消费此消息了。 当消费者不存在时，消息会一直保存，直到有消费消费</p>
<p><img src="/2020/07/12/ActiveMQ-01/image-20200110192535698.png" alt="image-20200110192535698"></p>
<h3 id="1-4-5-pub-sub"><a href="#1-4-5-pub-sub" class="headerlink" title="1.4.5 pub/sub"></a>1.4.5 pub/sub</h3><p><img src="/2020/07/12/ActiveMQ-01/image-20200110192613518.png" alt="image-20200110192613518"></p>
<p>基于订阅/发布的消息模型</p>
<p>消息生产者（发布）将消息发布到 topic 中，同时有多个消息消费者（订阅）消费该消<br>息。<br>和点对点方式不同，发布到 topic 的消息会被所有订阅者消费。 当生产者发布消息，不管是否有消费者。都不会保存消息 一定要先有消息的消费者，后有消息的生产者。</p>
<h3 id="1-4-6-PTP-和-PUB-SUB-简单对"><a href="#1-4-6-PTP-和-PUB-SUB-简单对" class="headerlink" title="1.4.6 PTP 和 PUB/SUB 简单对"></a>1.4.6 PTP 和 PUB/SUB 简单对</h3><table>
<thead>
<tr>
<th>1</th>
<th>Topic</th>
<th>Queue</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>Publish Subscribe messaging 发布 订阅消息</td>
<td>Point-to-Point 点对点</td>
</tr>
<tr>
<td>有无状态</td>
<td>topic 数据默认不落地，是无状态的。</td>
<td>Queue 数据默认会在 mq 服 务器上以文件形式保存，比如 Active MQ 一 般 保 存 在 $AMQ_HOME\data\kahadb 下 面。也可以配置成 DB 存储。</td>
</tr>
<tr>
<td>完整性保障</td>
<td>并不保证 publisher 发布的每条数 据，Subscriber 都能接受到。</td>
<td>Queue 保证每条数据都能 被 receiver 接收。消息不超时。</td>
</tr>
<tr>
<td>消息是否会丢失</td>
<td>一般来说 publisher 发布消息到某 一个 topic 时，只有正在监听该 topic 地址的 sub 能够接收到消息；如果没 有 sub 在监听，该 topic 就丢失了。</td>
<td>Sender 发 送 消 息 到 目 标 Queue， receiver 可以异步接收这 个 Queue 上的消息。Queue 上的 消息如果暂时没有 receiver 来 取，也不会丢失。前提是消息不 超时。</td>
</tr>
<tr>
<td>消息发布接 收策略</td>
<td>一对多的消息发布接收策略，监 听同一个topic地址的多个sub都能收 到 publisher 发送的消息。Sub 接收完 通知 mq 服务器</td>
<td>一对一的消息发布接收策 略，一个 sender 发送的消息，只 能有一个 receiver 接收。 receiver 接收完后，通知 mq 服务器已接 收，mq 服务器对 queue 里的消 息采取删除或其他操作。</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-4-7-Queue"><a href="#1-4-7-Queue" class="headerlink" title="1.4.7 Queue"></a>1.4.7 Queue</h3><p>队列存储，常用与点对点消息模型 </p>
<p>默认只能由唯一的一个消费者处理。一旦处理消息删除。 </p>
<h3 id="1-4-8-Topic"><a href="#1-4-8-Topic" class="headerlink" title="1.4.8 Topic"></a>1.4.8 Topic</h3><p>主题存储，用于订阅/发布消息模型</p>
<p>主题中的消息，会发送给所有的消费者同时处理。只有在消息可以重复处 理的业务场景中可使用。</p>
<p>Queue/Topic都是 Destination 的子接口</p>
<h3 id="1-4-9-ConnectionFactory"><a href="#1-4-9-ConnectionFactory" class="headerlink" title="1.4.9 ConnectionFactory"></a>1.4.9 ConnectionFactory</h3><p>连接工厂，jms中用它创建连接</p>
<p>连接工厂是客户用来创建连接的对象，例如ActiveMQ提供的ActiveMQConnectionFactory。</p>
<h3 id="1-4-10-Connection"><a href="#1-4-10-Connection" class="headerlink" title="1.4.10 Connection"></a>1.4.10 Connection</h3><p>JMS Connection封装了客户与JMS提供者之间的一个虚拟的连接。  </p>
<h3 id="1-4-11-Destination"><a href="#1-4-11-Destination" class="headerlink" title="1.4.11 Destination"></a>1.4.11 Destination</h3><p>消息的目的地</p>
<p>目的地是客户用来指定它生产的消息的目标和它消费的消息的来源的对象。JMS1.0.2规范中定义了两种消息传递域：点对点（PTP）消息传递域和发布/订阅消息传递域。 点对点消息传递域的特点如下：</p>
<ul>
<li>每个消息只能有一个消费者。</li>
<li>消息的生产者和消费者之间没有时间上的相关性。无论消费者在生产者发送消息的时候是否处于运行状态，它都可以提取消息。</li>
</ul>
<p>发布/订阅消息传递域的特点如下：</p>
<ul>
<li>每个消息可以有多个消费者。</li>
<li>生产者和消费者之间有时间上的相关性。</li>
<li>订阅一个主题的消费者只能消费自它订阅之后发布的消息。JMS规范允许客户创建持久订阅，这在一定程度上放松了时间上的相关性要求 。持久订阅允许消费者消费它在未处于激活状态时发送的消息。<br>在点对点消息传递域中，目的地被成为队列（queue）；在发布/订阅消息传递域中，目的地被成为主题（topic）。</li>
</ul>
<h3 id="1-4-12-Session"><a href="#1-4-12-Session" class="headerlink" title="1.4.12 Session"></a>1.4.12 Session</h3><p>JMS Session是生产和消费消息的一个单线程上下文。会话用于创建消息生产者（producer）、消息消费者（consumer）和消息（message）等。会话提供了一个事务性的上下文，在这个上下文中，一组发送和接收被组合到了一个原子操作中。</p>
<h2 id="1-5-JMS的消息格式"><a href="#1-5-JMS的消息格式" class="headerlink" title="1.5 JMS的消息格式"></a>1.5 JMS的消息格式</h2><h3 id="1-5-1-JMS消息由以下三部分组成的："><a href="#1-5-1-JMS消息由以下三部分组成的：" class="headerlink" title="1.5.1  JMS消息由以下三部分组成的："></a>1.5.1  JMS消息由以下三部分组成的：</h3><ul>
<li><p>消息头。</p>
<p>每个消息头字段都有相应的getter和setter方法。</p>
</li>
<li><p>消息属性。</p>
<p>如果需要除消息头字段以外的值，那么可以使用消息属性。</p>
</li>
<li><p>消息体。</p>
<p>JMS定义的消息类型有TextMessage、MapMessage、BytesMessage、StreamMessage和ObjectMessage。</p>
</li>
</ul>
<h3 id="1-5-2-TextMessage"><a href="#1-5-2-TextMessage" class="headerlink" title="1.5.2 TextMessage"></a>1.5.2 TextMessage</h3><p>文本消息</p>
<h3 id="1-5-3-MapMessage"><a href="#1-5-3-MapMessage" class="headerlink" title="1.5.3 MapMessage"></a>1.5.3 MapMessage</h3><p>k/v</p>
<h3 id="1-5-4-BytesMessage"><a href="#1-5-4-BytesMessage" class="headerlink" title="1.5.4 BytesMessage"></a>1.5.4 BytesMessage</h3><p>字节流</p>
<h3 id="1-5-5-StreamMessage"><a href="#1-5-5-StreamMessage" class="headerlink" title="1.5.5 StreamMessage"></a>1.5.5 StreamMessage</h3><p>java原始的数据流</p>
<h3 id="1-5-6-ObjectMessage"><a href="#1-5-6-ObjectMessage" class="headerlink" title="1.5.6 ObjectMessage"></a>1.5.6 ObjectMessage</h3><p>序列化的java对象</p>
<h2 id="1-6-消息可靠性机制"><a href="#1-6-消息可靠性机制" class="headerlink" title="1.6 消息可靠性机制"></a>1.6 消息可靠性机制</h2><h3 id="1-6-1-确认-JMS消息"><a href="#1-6-1-确认-JMS消息" class="headerlink" title="1.6.1 确认 JMS消息"></a>1.6.1 确认 JMS消息</h3><p>只有在被确认之后，才认为已经被成功地消费了。</p>
<p>消息的成功消费通常包含三个阶段：客户接收消息、客户处理消息和消息被确认。 </p>
<p>在事务性会话中，当一个事务被提交的时候，确认自动发生。</p>
<p>在非事务性会话中，消息何时被确认取决于创建会话时的应答模式（acknowledgement mode）。该参数有以下三个可选值：</p>
<ul>
<li>Session.AUTO_ACKNOWLEDGE。当客户成功的从receive方法返回的时候，或者从MessageListener.onMessage方法成功返回的时候，会话自动确认客户收到的消息。</li>
<li>Session.CLIENT_ACKNOWLEDGE。客户通过消息的acknowledge方法确认消息。需要注意的是，在这种模式中，确认是在会话层上进行：确认一个被消费的消息将自动确认所有已被会话消费的消息。例如，如果一个消息消费者消费了10个消息，然后确认第5个消息，那么所有10个消息都被确认。</li>
<li>Session.DUPS_ACKNOWLEDGE。该选择只是会话迟钝的确认消息的提交。如果JMS Provider失败，那么可能会导致一些重复的消息。如果是重复的消息，那么JMS Provider必须把消息头的JMSRedelivered字段设置为true。</li>
</ul>
<h3 id="1-6-2持久性"><a href="#1-6-2持久性" class="headerlink" title="1.6.2持久性"></a>1.6.2持久性</h3><p>JMS 支持以下两种消息提交模式：</p>
<ul>
<li>PERSISTENT。指示JMS Provider持久保存消息，以保证消息不会因为JMS Provider的失败而丢失。</li>
<li>NON_PERSISTENT。不要求JMS Provider持久保存消息。</li>
</ul>
<h3 id="1-6-3优先级"><a href="#1-6-3优先级" class="headerlink" title="1.6.3优先级"></a>1.6.3优先级</h3><p>可以使用消息优先级来指示JMS Provider首先提交紧急的消息。优先级分10个级别，从0（最低）到9（最高）。如果不指定优先级，默认级别是4。需要注意的是，JMS Provider并不一定保证按照优先级的顺序提交消息。</p>
<h3 id="1-6-4消息过期"><a href="#1-6-4消息过期" class="headerlink" title="1.6.4消息过期"></a>1.6.4消息过期</h3><p>可以设置消息在一定时间后过期，默认是永不过期。</p>
<h3 id="1-6-5临时目的地"><a href="#1-6-5临时目的地" class="headerlink" title="1.6.5临时目的地"></a>1.6.5临时目的地</h3><p>可以通过会话上的createTemporaryQueue方法和createTemporaryTopic方法来创建临时目的地。它们的存在时间只限于创建它们的连接所保持的时间。只有创建该临时目的地的连接上的消息消费者才能够从临时目的地中提取消息。</p>
<h3 id="1-6-6持久订阅"><a href="#1-6-6持久订阅" class="headerlink" title="1.6.6持久订阅"></a>1.6.6持久订阅</h3><p>首先消息生产者必须使用PERSISTENT提交消息。客户可以通过会话上的createDurableSubscriber方法来创建一个持久订阅，该方法的第一个参数必须是一个topic，第二个参数是订阅的名称。 JMS Provider会存储发布到持久订阅对应的topic上的消息。如果最初创建持久订阅的客户或者任何其它客户使用相同的连接工厂和连接的客户ID、相同的主题和相同的订阅名再次调用会话上的createDurableSubscriber方法，那么该持久订阅就会被激活。JMS Provider会象客户发送客户处于非激活状态时所发布的消息。 持久订阅在某个时刻只能有一个激活的订阅者。持久订阅在创建之后会一直保留，直到应用程序调用会话上的unsubscribe方法。</p>
<h3 id="1-6-7本地事务"><a href="#1-6-7本地事务" class="headerlink" title="1.6.7本地事务"></a>1.6.7本地事务</h3><p>在一个JMS客户端，可以使用本地事务来组合消息的发送和接收。JMS Session接口提供了commit和rollback方法。事务提交意味着生产的所有消息被发送，消费的所有消息被确认；事务回滚意味着生产的所有消息被销毁，消费的所有消息被恢复并重新提交，除非它们已经过期。 事务性的会话总是牵涉到事务处理中，commit或rollback方法一旦被调用，一个事务就结束了，而另一个事务被开始。关闭事务性会话将回滚其中的事务。 需要注意的是，如果使用请求/回复机制，即发送一个消息，同时希望在同一个事务中等待接收该消息的回复，那么程序将被挂起，因为知道事务提交，发送操作才会真正执行。 需要注意的还有一个，消息的生产和消费不能包含在同一个事务中。</p>
<h1 id="2-ActiveMQ"><a href="#2-ActiveMQ" class="headerlink" title="2. ActiveMQ"></a>2. ActiveMQ</h1><p><img src="/2020/07/12/ActiveMQ-01/activemq_logo_white_vertical.png" alt="img"></p>
<p>官方网站</p>
<p><a href="http://activemq.apache.org/" target="_blank" rel="noopener">http://activemq.apache.org/</a></p>
<p>文档</p>
<p><a href="http://activemq.apache.org/components/classic/documentation" target="_blank" rel="noopener">http://activemq.apache.org/components/classic/documentation</a></p>
<h2 id="2-1-Broker"><a href="#2-1-Broker" class="headerlink" title="2.1 Broker"></a>2.1 Broker</h2><p>ActiveMQ 5.0 的二进制发布包中bin目录中包含一个名为activemq的脚本，直接运行这个脚本就可以启动一个broker。 此外也可以通过Broker Configuration URI或Broker XBean URI对broker进行配置，以下是一些命令行参数的例子：</p>
<table>
<thead>
<tr>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>activemq</td>
<td>Runs a broker using the default  ‘xbean:activemq.xml’ as the broker configuration file.</td>
</tr>
<tr>
<td>activemq xbean:myconfig.xml</td>
<td>Runs a broker using the file myconfig.xml as the  broker configuration file that is located in the classpath.</td>
</tr>
<tr>
<td>activemq xbean:file:./conf/broker1.xml</td>
<td>Runs a broker using the file broker1.xml as the  broker configuration file that is located in the relative file path  ./conf/broker1.xml</td>
</tr>
<tr>
<td>activemq xbean:file:C:/ActiveMQ/conf/broker2.xml</td>
<td>Runs a broker using the file broker2.xml as the  broker configuration file that is located in the absolute file path  C:/ActiveMQ/conf/broker2.xml</td>
</tr>
<tr>
<td>activemq broker:(tcp://localhost:61616,  tcp://localhost:5000)?useJmx=true</td>
<td>Runs a broker with two transport connectors and  JMX enabled.</td>
</tr>
<tr>
<td>activemq broker:(tcp://localhost:61616,  network:tcp://localhost:5000)?persistent=false</td>
<td>Runs a broker with 1 transport connector and 1  network connector with persistence disabled.</td>
</tr>
</tbody></table>
<h2 id="2-2-存储"><a href="#2-2-存储" class="headerlink" title="2.2 存储"></a>2.2 存储</h2><h3 id="2-2-1-KahaDB存储"><a href="#2-2-1-KahaDB存储" class="headerlink" title="2.2.1 KahaDB存储"></a>2.2.1 KahaDB存储</h3><p>KahaDB是默认的持久化策略，所有消息顺序添加到一个日志文件中，同时另外有一个索引文件记录指向这些日志的存储地址，还有一个事务日志用于消息回复操作。是一个专门针对消息持久化的解决方案,它对典型的消息使用模式进行了优化。</p>
<p>在data/kahadb这个目录下，会生成四个文件，来完成消息持久化<br>1.db.data 它是消息的索引文件，本质上是B-Tree（B树），使用B-Tree作为索引指向db-*.log里面存储的消息<br>2.db.redo 用来进行消息恢复 *</p>
<p>3.db-.log 存储消息内容。新的数据以APPEND的方式追加到日志文件末尾。属于顺序写入，因此消息存储是比较 快的。默认是32M，达到阀值会自动递增<br>4.lock文件 锁，写入当前获得kahadb读写权限的broker ，用于在集群环境下的竞争处理</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;persistenceAdapter&gt; &lt;!--directory:保存数据的目录;journalMaxFileLength:保存消息的文件大小 --&gt; &lt;kahaDBdirectory&#x3D;&quot;$&#123;activemq.data&#125;&#x2F;kahadb&quot;journalMaxFileLength&#x3D;&quot;16mb&quot;&#x2F;&gt; &lt;&#x2F;persistenceAdapter&gt;</span><br></pre></td></tr></table></figure>

<p>特性：</p>
<p>1、日志形式存储消息；</p>
<p>2、消息索引以 B-Tree 结构存储，可以快速更新；</p>
<p>3、 完全支持 JMS 事务；</p>
<p>4、支持多种恢复机制kahadb 可以限制每个数据文件的大小。不代表总计数据容量。 </p>
<h3 id="2-2-2-AMQ-方式"><a href="#2-2-2-AMQ-方式" class="headerlink" title="2.2.2 AMQ 方式"></a>2.2.2 AMQ 方式</h3><p>只适用于 5.3 版本之前。 AMQ 也是一个文件型数据库，消息信息最终是存储在文件中。内存中也会有缓存数据。 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;persistenceAdapter&gt; &lt;!--directory:保存数据的目录 ;maxFileLength:保存消息的文件大小 --&gt; &lt;amqPersistenceAdapterdirectory&#x3D;&quot;$&#123;activemq.data&#125;&#x2F;amq&quot;maxFileLength&#x3D;&quot;32mb&quot;&#x2F;&gt; &lt;&#x2F;persistenceAdapter&gt;</span><br></pre></td></tr></table></figure>







<p> 性能高于 JDBC，写入消息时，会将消息写入日志文件，由于是顺序追加写，性能很高。</p>
<p> 为了提升性能，创建消息主键索引，并且提供缓存机制，进一步提升性能。</p>
<p>每个日志文件的 大小都是有限制的（默认 32m，可自行配置） 。 </p>
<p>当超过这个大小，系统会重新建立一个文件。</p>
<p>当所有的消息都消费完成，系统会删除这 个文件或者归档。 </p>
<p>主要的缺点是 AMQ Message 会为每一个 Destination 创建一个索引，如果使用了大量的 Queue，索引文件的大小会占用很多磁盘空间。 </p>
<p>而且由于索引巨大，一旦 Broker（ActiveMQ 应用实例）崩溃，重建索引的速度会非常 慢。 </p>
<p>虽然 AMQ 性能略高于 Kaha DB 方式，但是由于其重建索引时间过长，而且索引文件 占用磁盘空间过大，所以已经不推荐使用。</p>
<h3 id="2-2-3JDBC存储"><a href="#2-2-3JDBC存储" class="headerlink" title="2.2.3JDBC存储"></a>2.2.3JDBC存储</h3><p>使用JDBC持久化方式，数据库默认会创建3个表，每个表的作用如下：<br>activemq_msgs：queue和topic的消息都存在这个表中<br>activemq_acks：存储持久订阅的信息和最后一个持久订阅接收的消息ID<br>activemq_lock：跟kahadb的lock文件类似，确保数据库在某一时刻只有一个broker在访问</p>
<p>ActiveMQ 将数据持久化到数据库中。 </p>
<p>不指定具体的数据库。 可以使用任意的数据库 中。 </p>
<p>本环节中使用 MySQL 数据库。 下述文件为 activemq.xml 配置文件部分内容。 </p>
<p> 首先定义一个 mysql-ds 的 MySQL 数据源，然后在 persistenceAdapter 节点中配置 jdbcPersistenceAdapter 并且引用刚才定义的数据源。</p>
<p>dataSource 指定持久化数据库的 bean，createTablesOnStartup 是否在启动的时候创建数 据表，默认值是 true，这样每次启动都会去创建数据表了，一般是第一次启动的时候设置为 true，之后改成 false。 </p>
<p><strong>Beans中添加</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean id&#x3D;&quot;mysql-ds&quot; class&#x3D;&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method&#x3D;&quot;close&quot;&gt; </span><br><span class="line"></span><br><span class="line">&lt;property name&#x3D;&quot;driverClassName&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt; </span><br><span class="line">&lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;activemq?relaxAutoCommit&#x3D;true&quot;&#x2F;&gt; </span><br><span class="line">&lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;activemq&quot;&#x2F;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;activemq&quot;&#x2F;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;maxActive&quot; value&#x3D;&quot;200&quot;&#x2F;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;poolPreparedStatements&quot; value&#x3D;&quot;true&quot;&#x2F;&gt; </span><br><span class="line"></span><br><span class="line">&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<p><strong>修改persistenceAdapter</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">      &lt;persistenceAdapter&gt;</span><br><span class="line">         &lt;!-- &lt;kahaDB directory&#x3D;&quot;$&#123;activemq.data&#125;&#x2F;kahadb&quot;&#x2F;&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;jdbcPersistenceAdapter dataSource&#x3D;&quot;#mysql-ds&quot; createTablesOnStartup&#x3D;&quot;true&quot; &#x2F;&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      &lt;&#x2F;persistenceAdapter&gt;</span><br></pre></td></tr></table></figure>

<p>依赖jar包</p>
<p>commons-dbcp commons-pool mysql-connector-java</p>
<h4 id="2-2-3-1表字段解释"><a href="#2-2-3-1表字段解释" class="headerlink" title="2.2.3.1表字段解释"></a>2.2.3.1表字段解释</h4><p><strong>activemq_acks</strong>：用于存储订阅关系。如果是持久化Topic，订阅者和服务器的订阅关系在这个表保存。<br>主要的数据库字段如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">container：消息的destination </span><br><span class="line">sub_dest：如果是使用static集群，这个字段会有集群其他系统的信息 </span><br><span class="line">client_id：每个订阅者都必须有一个唯一的客户端id用以区分 </span><br><span class="line">sub_name：订阅者名称 </span><br><span class="line">selector：选择器，可以选择只消费满足条件的消息。条件可以用自定义属性实现，可支持多属性and和or操作 </span><br><span class="line">last_acked_id：记录消费过的消息的id。</span><br></pre></td></tr></table></figure>

<p>2：<strong>activemq_lock</strong>：在集群环境中才有用，只有一个Broker可以获得消息，称为Master Broker，其他的只能作为备份等待Master Broker不可用，才可能成为下一个Master Broker。这个表用于记录哪个Broker是当前的Master Broker。</p>
<p>3：<strong>activemq_msgs</strong>：用于存储消息，Queue和Topic都存储在这个表中。<br>主要的数据库字段如下：</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id：自增的数据库主键 </span><br><span class="line">container：消息的destination </span><br><span class="line">msgid_prod：消息发送者客户端的主键 </span><br><span class="line">msg_seq：是发送消息的顺序，msgid_prod+msg_seq可以组成jms的messageid </span><br><span class="line">expiration：消息的过期时间，存储的是从1970-01-01到现在的毫秒数 </span><br><span class="line">msg：消息本体的java序列化对象的二进制数据 </span><br><span class="line">priority：优先级，从0-9，数值越大优先级越高 </span><br><span class="line">xid:用于存储订阅关系。如果是持久化topic，订阅者和服务器的订阅关系在这个表保存。</span><br></pre></td></tr></table></figure>











<h3 id="2-2-4LevelDB存储"><a href="#2-2-4LevelDB存储" class="headerlink" title="2.2.4LevelDB存储"></a>2.2.4LevelDB存储</h3><p>LevelDB持久化性能高于KahaDB，虽然目前默认的持久化方式仍然是KahaDB。并且，在ActiveMQ 5.9版本提供 了基于LevelDB和Zookeeper的数据复制方式，用于Master-slave方式的首选数据复制方案。 但是在ActiveMQ官网对LevelDB的表述：LevelDB官方建议使用以及不再支持，推荐使用的是KahaDB </p>
<h3 id="2-2-5Memory-消息存储"><a href="#2-2-5Memory-消息存储" class="headerlink" title="2.2.5Memory 消息存储"></a>2.2.5Memory 消息存储</h3><p>顾名思义，基于内存的消息存储，就是消息存储在内存中。persistent=”false”,表示不设置持 久化存储，直接存储到内存中<br>在broker标签处设置。</p>
<h3 id="2-2-6JDBC-Message-store-with-ActiveMQ-Journal"><a href="#2-2-6JDBC-Message-store-with-ActiveMQ-Journal" class="headerlink" title="2.2.6JDBC Message store with ActiveMQ Journal"></a>2.2.6JDBC Message store with ActiveMQ Journal</h3><p>这种方式克服了JDBC Store的不足，JDBC存储每次消息过来，都需要去写库和读库。 ActiveMQ Journal，使用延迟存储数据到数据库，当消息来到时先缓存到文件中，延迟后才写到数据库中。</p>
<p>当消费者的消费速度能够及时跟上生产者消息的生产速度时，journal文件能够大大减少需要写入到DB中的消息。 举个例子，生产者生产了1000条消息，这1000条消息会保存到journal文件，如果消费者的消费速度很快的情况 下，在journal文件还没有同步到DB之前，消费者已经消费了90%的以上的消息，那么这个时候只需要同步剩余的 10%的消息到DB。 如果消费者的消费速度很慢，这个时候journal文件可以使消息以批量方式写到DB。 </p>
<h2 id="2-3协议"><a href="#2-3协议" class="headerlink" title="2.3协议"></a>2.3协议</h2><p>完整支持的协议</p>
<p><a href="http://activemq.apache.org/configuring-version-5-transports.html" target="_blank" rel="noopener">http://activemq.apache.org/configuring-version-5-transports.html</a></p>
<p>ActiveMQ支持的client-broker通讯协议有：TCP、NIO、UDP、SSL、Http(s)、VM。</p>
<h3 id="2-3-1-Transmission-Control-Protocol-TCP"><a href="#2-3-1-Transmission-Control-Protocol-TCP" class="headerlink" title="2.3.1 Transmission Control Protocol (TCP)"></a>2.3.1 Transmission Control Protocol (TCP)</h3><p>1：这是默认的Broker配置，TCP的Client监听端口是61616。<br>2：在网络传输数据前，必须要序列化数据，消息是通过一个叫wire protocol的来序列化成字节流。默认情况下，ActiveMQ把wire protocol叫做OpenWire，它的目的是促使网络上的效率和数据快速交互。<br>3：TCP连接的URI形式：tcp://hostname:port?key=value&amp;key=value，加粗部分是必须的<br>4：TCP传输的优点：<br>(1)TCP协议传输可靠性高，稳定性强<br>(2)高效性：字节流方式传递，效率很高<br>(3)有效性、可用性：应用广泛，支持任何平台</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;transportConnector name&#x3D;&quot;openwire&quot; uri&#x3D;&quot;tcp:&#x2F;&#x2F;0.0.0.0:61616?maximumConnections&#x3D;1000&amp;wireFormat.maxFrameSize&#x3D;104857600&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-2-New-I-O-API-Protocol（NIO）"><a href="#2-3-2-New-I-O-API-Protocol（NIO）" class="headerlink" title="2.3.2 New I/O API Protocol（NIO）"></a>2.3.2 New I/O API Protocol（NIO）</h3><p>1：NIO协议和TCP协议类似，但NIO更侧重于底层的访问操作。它允许开发人员对同一资源可有更多的client调用和服务端有更多的负载。<br>2：适合使用NIO协议的场景：<br>(1)可能有大量的Client去链接到Broker上一般情况下，大量的Client去链接Broker是被操作系统的线程数所限制的。因此，NIO的实现比TCP需要更少的线程去运行，所以建议使用NIO协议<br>(2)可能对于Broker有一个很迟钝的网络传输NIO比TCP提供更好的性能<br>3：NIO连接的URI形式：nio://hostname:port?key=value<br>4：Transport Connector配置示例： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;transportConnectors&gt;</span><br><span class="line">　　&lt;transportConnector</span><br><span class="line">　　　　name&#x3D;&quot;tcp&quot;</span><br><span class="line">　　　　uri&#x3D;&quot;tcp:&#x2F;&#x2F;localhost:61616?trace&#x3D;true&quot; &#x2F;&gt;</span><br><span class="line">　　&lt;transportConnector</span><br><span class="line">　　　　name&#x3D;&quot;nio&quot;</span><br><span class="line">　　　　uri&#x3D;&quot;nio:&#x2F;&#x2F;localhost:61618?trace&#x3D;true&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;transportConnectors&gt;</span><br></pre></td></tr></table></figure>


<p>上面的配置，示范了一个TCP协议监听61616端口，一个NIO协议监听61618端口 </p>
<h3 id="2-3-3User-Datagram-Protocol（UDP"><a href="#2-3-3User-Datagram-Protocol（UDP" class="headerlink" title="2.3.3User Datagram Protocol（UDP)"></a>2.3.3User Datagram Protocol（UDP)</h3><p>1：UDP和TCP的区别<br>(1)TCP是一个原始流的传递协议，意味着数据包是有保证的，换句话说，数据包是不会被复制和丢失的。UDP，另一方面，它是不会保证数据包的传递的<br>(2)TCP也是一个稳定可靠的数据包传递协议，意味着数据在传递的过程中不会被丢失。这样确保了在发送和接收之间能够可靠的传递。相反，UDP仅仅是一个链接协议，所以它没有可靠性之说<br>2：从上面可以得出：TCP是被用在稳定可靠的场景中使用的；UDP通常用在快速数据传递和不怕数据丢失的场景中，还有ActiveMQ通过防火墙时，只能用UDP<br>3：UDP连接的URI形式：udp://hostname:port?key=value<br>4：Transport Connector配置示例： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;transportConnectors&gt;</span><br><span class="line">    &lt;transportConnector</span><br><span class="line">        name&#x3D;&quot;udp&quot;</span><br><span class="line">        uri&#x3D;&quot;udp:&#x2F;&#x2F;localhost:61618?trace&#x3D;true&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;transportConnectors&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-4-Secure-Sockets-Layer-Protocol-SSL"><a href="#2-3-4-Secure-Sockets-Layer-Protocol-SSL" class="headerlink" title="2.3.4 Secure Sockets Layer Protocol (SSL)"></a>2.3.4 Secure Sockets Layer Protocol (SSL)</h3><p>1：连接的URI形式：ssl://hostname:port?key=value<br>2：Transport Connector配置示例： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;transportConnectors&gt;</span><br><span class="line">    &lt;transportConnector name&#x3D;&quot;ssl&quot; uri&#x3D;&quot;ssl:&#x2F;&#x2F;localhost:61617?trace&#x3D;true&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;transportConnectors&gt;</span><br></pre></td></tr></table></figure>





<h3 id="2-3-5-Hypertext-Transfer-Protocol-HTTP-HTTPS"><a href="#2-3-5-Hypertext-Transfer-Protocol-HTTP-HTTPS" class="headerlink" title="2.3.5 Hypertext Transfer Protocol (HTTP/HTTPS)"></a>2.3.5 Hypertext Transfer Protocol (HTTP/HTTPS)</h3><p>1：像web和email等服务需要通过防火墙来访问的，Http可以使用这种场合<br>2：连接的URI形式：<a href="http://hostname:port?key=value或者https://hostname:port?key=value">http://hostname:port?key=value或者https://hostname:port?key=value</a><br>3：Transport Connector配置示例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;transportConnectors&gt;</span><br><span class="line">    &lt;transportConnector name&#x3D;&quot;http&quot; uri&#x3D;&quot;http:&#x2F;&#x2F;localhost:8080?trace&#x3D;true&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;transportConnectors&gt;</span><br></pre></td></tr></table></figure>





<h3 id="2-3-6-VM-Protocol（VM）"><a href="#2-3-6-VM-Protocol（VM）" class="headerlink" title="2.3.6 VM Protocol（VM）"></a>2.3.6 VM Protocol（VM）</h3><p>1、VM transport允许在VM内部通信，从而避免了网络传输的开销。这时候采用的连 接不是socket连接，而是直接的方法调用。 </p>
<p>2、第一个创建VM连接的客户会启动一个embed VM broker，接下来所有使用相同的 broker name的VM连接都会使用这个broker。当这个broker上所有的连接都关闭 的时候，这个broker也会自动关闭。 </p>
<p>3、连接的URI形式：vm://brokerName?key=value </p>
<p>4、Java中嵌入的方式： vm:broker:(tcp://localhost:6000)?brokerName=embeddedbroker&amp;persistent=fal se ， 定义了一个嵌入的broker名称为embededbroker以及配置了一个 tcptransprotconnector在监听端口6000上 </p>
<p>5、使用一个加载一个配置文件来启动broker vm://localhost?brokerConfig=xbean:activemq.xml</p>
<h2 id="2-4-HelloWorld"><a href="#2-4-HelloWorld" class="headerlink" title="2.4 HelloWorld"></a>2.4 HelloWorld</h2><h3 id="2-4-1-下载"><a href="#2-4-1-下载" class="headerlink" title="2.4.1 下载"></a>2.4.1 下载</h3><p><a href="http://activemq.apache.org/" target="_blank" rel="noopener">http://activemq.apache.org/</a></p>
<h3 id="2-4-2-安装启动"><a href="#2-4-2-安装启动" class="headerlink" title="2.4.2 安装启动"></a>2.4.2 安装启动</h3><p>解压后直接执行</p>
<p><code>bin/win64/activemq.bat</code></p>
<h3 id="2-4-3-web控制台"><a href="#2-4-3-web控制台" class="headerlink" title="2.4.3  web控制台"></a>2.4.3  web控制台</h3><p><a href="http://localhost:8161/" target="_blank" rel="noopener">http://localhost:8161/</a></p>
<p>通过8161端口访问</p>
<h3 id="2-4-4-修改访问端口"><a href="#2-4-4-修改访问端口" class="headerlink" title="2.4.4 修改访问端口"></a>2.4.4 修改访问端口</h3><p>修改 ActiveMQ 配置文件:/usr/local/activemq/conf/jetty.xml</p>
<p><strong>jettyport节点</strong></p>
<p>配置文件修改完毕，保存并重新启动 ActiveMQ 服务。</p>
<h3 id="2-4-5-开发"><a href="#2-4-5-开发" class="headerlink" title="2.4.5 开发"></a>2.4.5 开发</h3><p>maven坐标</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.apache.activemq&#x2F;activemq-all --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.activemq&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;activemq-all&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.15.11&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>



<h4 id="2-4-5-1-Sender"><a href="#2-4-5-1-Sender" class="headerlink" title="2.4.5.1 Sender"></a>2.4.5.1 Sender</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.activemq01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Connection;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Destination;</span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageProducer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Queue;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Session;</span><br><span class="line"><span class="keyword">import</span> javax.jms.TextMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 1. 建立工厂对象，</span></span><br><span class="line">		ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(</span><br><span class="line">				ActiveMQConnectionFactory.DEFAULT_USER,</span><br><span class="line">				ActiveMQConnectionFactory.DEFAULT_PASSWORD,</span><br><span class="line">				<span class="string">"tcp://localhost:61616"</span></span><br><span class="line">				);</span><br><span class="line">		<span class="comment">//2 从工厂里拿一个连接</span></span><br><span class="line">		Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">		connection.start();</span><br><span class="line">		<span class="comment">//3 从连接中获取Session(会话)</span></span><br><span class="line">		Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">		<span class="comment">// 从会话中获取目的地(Destination)消费者会从这个目的地取消息</span></span><br><span class="line">		Queue queue = session.createQueue(<span class="string">"f"</span>);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//从会话中创建消息提供者</span></span><br><span class="line">		</span><br><span class="line">		MessageProducer producer = session.createProducer(queue);</span><br><span class="line">		<span class="comment">//从会话中创建文本消息(也可以创建其它类型的消息体)</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			TextMessage message = session.createTextMessage(<span class="string">"msg: "</span> + i);</span><br><span class="line">			<span class="comment">// 通过消息提供者发送消息到ActiveMQ</span></span><br><span class="line">			Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			producer.send(message);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 关闭连接</span></span><br><span class="line">		connection.close();</span><br><span class="line">		System.out.println(<span class="string">"exit"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Receiver"><a href="#Receiver" class="headerlink" title="Receiver"></a>Receiver</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.activemq01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Connection;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Destination;</span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageConsumer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageProducer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Queue;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Session;</span><br><span class="line"><span class="keyword">import</span> javax.jms.TextMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 1. 建立工厂对象，</span></span><br><span class="line">		ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(</span><br><span class="line">				ActiveMQConnectionFactory.DEFAULT_USER,</span><br><span class="line">				ActiveMQConnectionFactory.DEFAULT_PASSWORD,</span><br><span class="line">				<span class="string">"tcp://localhost:61616"</span></span><br><span class="line">				);</span><br><span class="line">		<span class="comment">//2 从工厂里拿一个连接</span></span><br><span class="line">		Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">		connection.start();</span><br><span class="line">		<span class="comment">//3 从连接中获取Session(会话)</span></span><br><span class="line">		Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">		<span class="comment">// 从会话中获取目的地(Destination)消费者会从这个目的地取消息</span></span><br><span class="line">		Queue queue = session.createQueue(<span class="string">"f"</span>);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//从会话中创建消息提供者</span></span><br><span class="line">		</span><br><span class="line">		MessageConsumer consumer = session.createConsumer(queue);</span><br><span class="line">		<span class="comment">//从会话中创建文本消息(也可以创建其它类型的消息体)</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			TextMessage receive = (TextMessage)consumer.receive();</span><br><span class="line">			System.out.println(<span class="string">"TextMessage:"</span> + receive.getText());</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-Active-MQ的安全机制"><a href="#3-Active-MQ的安全机制" class="headerlink" title="3. Active MQ的安全机制"></a>3. Active MQ的安全机制</h1><h2 id="3-1-web控制台安全"><a href="#3-1-web控制台安全" class="headerlink" title="3.1 web控制台安全"></a>3.1 web控制台安全</h2><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># username: password [,rolename ...]</span></span><br><span class="line"><span class="attr">admin</span>: <span class="string">admin, admin</span></span><br><span class="line"><span class="attr">user</span>: <span class="string">user, user</span></span><br><span class="line"><span class="attr">yiming</span>: <span class="string">123, user</span></span><br></pre></td></tr></table></figure>

<p>用户名：密码，角色</p>
<p>注意: 配置需重启ActiveMQ才会生效。</p>
<h2 id="3-2-消息安全机制"><a href="#3-2-消息安全机制" class="headerlink" title="3.2 消息安全机制"></a>3.2 消息安全机制</h2><p>修改 activemq.xml</p>
<p>在123行      节点中添加</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">simpleAuthenticationPlugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">authenticationUser</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">groups</span>=<span class="string">"admins,publishers,consumers"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">authenticationUser</span> <span class="attr">username</span>=<span class="string">"publisher"</span> <span class="attr">password</span>=<span class="string">"publisher"</span>  <span class="attr">groups</span>=<span class="string">"publishers,consumers"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">authenticationUser</span> <span class="attr">username</span>=<span class="string">"consumer"</span> <span class="attr">password</span>=<span class="string">"consumer"</span> <span class="attr">groups</span>=<span class="string">"consumers"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">authenticationUser</span> <span class="attr">username</span>=<span class="string">"guest"</span> <span class="attr">password</span>=<span class="string">"guest"</span>  <span class="attr">groups</span>=<span class="string">"guests"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">simpleAuthenticationPlugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MQ</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>Pom</title>
    <url>/2020/07/04/pom/</url>
    <content><![CDATA[<p>Def of pom.xml file.</p>
<a id="more"></a>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.Apache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>openSource_Project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 项目属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- main version setting --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis-spring.version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">mybatis-spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.0.16<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shiro.version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">shiro.version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- environment setting --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">start-class</span>&gt;</span>com.Apache.Application<span class="tag">&lt;/<span class="name">start-class</span>&gt;</span></span><br><span class="line">      	<span class="comment">&lt;!-- --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">m2eclipse.wtp.contextRoot</span>&gt;</span>/$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">m2eclipse.wtp.contextRoot</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.11.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Import dependency management from Spring Boot --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;thymeleaf.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;thymeleaf.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>nz.net.ultraq.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-layout-dialect<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;thymeleaf-layout-dialect.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- PERSISTENCE begin --&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- MyBatis --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- connection pool --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- SPRING end --&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- AOP begin --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- AOP end --&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- GENERAL UTILS begin --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- GENERAL UTILS end --&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 打war包需要将内嵌容器依赖标记为provided --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SPRING begin --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-ldap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring orm --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring end --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- jackson json --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.module<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-module-jaxb-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jackson json end --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- PERSISTENCE begin --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- MyBatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- connection pool --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- jdbc driver --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- PERSISTENCE end --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- WEB begin --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;taglibs&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;standard&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- WEB end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- SPRING end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- AOP begin --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- AOP end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- LOGGING begin --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- common-logging 实际调用slf4j --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- java.util.logging 实际调用slf4j --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- LOGGING end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- impala start --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudera<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ImpalaJDBC41<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/ImpalaJDBC41.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive_metastore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/hive_metastore.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive_service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/hive_service.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;1.3&lt;/version&gt;</span></span><br><span class="line"><span class="comment">            &lt;scope&gt;system&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">            &lt;systemPath&gt;$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/commons-codec-1.3.jar&lt;/systemPath&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.facebook<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>libfb303-0.9.0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/libfb303-0.9.0.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.facebook<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>libthrift-0.9.0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/libthrift-0.9.0.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/ql.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>TCLIServiceClient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/webapp/WEB-INF/lib/TCLIServiceClient.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- impala --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.assertj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>assertj-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ognl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ognl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atlassian.commonmark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commonmark-ext-gfm-tables<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;$&#123;shiro.version&#125;&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;shiro-web&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;$&#123;shiro.version&#125;&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;shiro.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;shiro.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-cas<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;shiro.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">failOnMissingWebXml</span>&gt;</span>false<span class="tag">&lt;/<span class="name">failOnMissingWebXml</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                如果打包为.jar，取消此注释</span></span><br><span class="line"><span class="comment">                 &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                    &lt;mainClass&gt;$&#123;start-class&#125;&lt;/mainClass&gt;</span></span><br><span class="line"><span class="comment">                    &lt;layout&gt;ZIP&lt;/layout&gt;</span></span><br><span class="line"><span class="comment">                &lt;/configuration&gt; --&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 直接打jar包或war包的前提是项目使用了spring-boot-starter-parent作为了parent, 否则就需要加上下面executions这部分--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">						&lt;plugin&gt; </span></span><br><span class="line"><span class="comment">									&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; </span></span><br><span class="line"><span class="comment">									&lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; </span></span><br><span class="line"><span class="comment">                	&lt;configuration&gt; </span></span><br><span class="line"><span class="comment">											&lt;useSystemClassLoader&gt;false&lt;/useSystemClassLoader&gt; </span></span><br><span class="line"><span class="comment">									&lt;/configuration&gt; </span></span><br><span class="line"><span class="comment">            &lt;/plugin&gt; </span></span><br><span class="line"><span class="comment">						--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- tomcat7插件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">uriEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">uriEncoding</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>$&#123;deploy.tomcat.url&#125;<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">server</span>&gt;</span>tomcat8<span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">username</span>&gt;</span>ex_huangsl1<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>ex_huangsl1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>mappers/<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>mappers_auth/<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>mappers_kudu/<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>static/<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>templates/<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>mappers/<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>mappers_auth/<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>mappers_kudu/<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>static/<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>templates/<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 本地运行配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>default<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.tomcat.url</span>&gt;</span>http://10.16.73.106:52000/manager/text<span class="tag">&lt;/<span class="name">deploy.tomcat.url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 测试环境，使用UAT的配置，不应该再使用 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>uat<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.tomcat.url</span>&gt;</span>http://10.16.73.106:51000/manager/text<span class="tag">&lt;/<span class="name">deploy.tomcat.url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- SIT环境配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>sit<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>sit<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.tomcat.url</span>&gt;</span>http://10.16.73.106:52000/manager/text<span class="tag">&lt;/<span class="name">deploy.tomcat.url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- UAT环境配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>uat<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>uat<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.tomcat.url</span>&gt;</span>http://10.16.73.106:51000/manager/text<span class="tag">&lt;/<span class="name">deploy.tomcat.url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--生产环境服务器配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.tomcat.url</span>&gt;</span>http://10.16.73.106:52000/manager/text<span class="tag">&lt;/<span class="name">deploy.tomcat.url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 移动端 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>mobile<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>default<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.tomcat.url</span>&gt;</span>http://10.16.73.106:53000/manager/text<span class="tag">&lt;/<span class="name">deploy.tomcat.url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 天气任务 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod_cron<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>prod_cron<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.tomcat.url</span>&gt;</span>http://10.16.73.105:54000/manager/text<span class="tag">&lt;/<span class="name">deploy.tomcat.url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>工业互联网接口项目<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>pom</tag>
      </tags>
  </entry>
  <entry>
    <title>Springboot-Json</title>
    <url>/2020/06/27/springboot-json/</url>
    <content><![CDATA[<p>JSON是目前主流的前后端数据传输方式, SpringMVC中使用消息转化器HttpMessageConverter对JSON的转换提供了很好的支持,在SpringBoot中对相关配置做了进一步简化. HttpMessageConverter既可以将服务端返回的对象序列化为JSON串, 也可以将JSON串反序列化为对象.</p>
<p> 常见的JSON处理器除了Jackson-databind，还有Gson和fastjson. </p>
<p>前者是spring/springboot处理JSON的默认的自带方案.  后两者分别由Google和阿里提供, 在使用后两者前应排除掉自身的Jackson依赖以使其生效.</p>
<a id="more"></a>

<h1 id="1-Springboot-整合Jackson"><a href="#1-Springboot-整合Jackson" class="headerlink" title="1. Springboot 整合Jackson"></a>1. Springboot 整合Jackson</h1><h2 id="1-1-项目目录结构"><a href="#1-1-项目目录结构" class="headerlink" title="1.1 项目目录结构"></a>1.1 项目目录结构</h2><p><img src="/2020/06/27/springboot-json/JacksonProjectStructure.png" alt="Jackson"></p>
<h2 id="1-2-构建过程"><a href="#1-2-构建过程" class="headerlink" title="1.2 构建过程"></a>1.2 构建过程</h2><h3 id="1-2-1-新建项目"><a href="#1-2-1-新建项目" class="headerlink" title="1.2.1 新建项目"></a>1.2.1 新建项目</h3><p>新建项目导入spring-boot-starter-web即可, 因为该starter内已经有Jackson相关依赖.</p>
<p><img src="/2020/06/27/springboot-json/WebStarter.png" alt="web依赖目录"></p>
<h3 id="1-2-2-准备entity"><a href="#1-2-2-准备entity" class="headerlink" title="1.2.2 准备entity"></a>1.2.2 准备entity</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boy.springbootalljson.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String  username;</span><br><span class="line">    <span class="comment">//@JsonFormat(pattern="yyyy/MM/dd")</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birth="</span> + birth +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> id;  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123; <span class="keyword">this</span>.id = id; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;  <span class="keyword">return</span> username;  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123; <span class="keyword">this</span>.username = username;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> birth; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;  <span class="keyword">this</span>.birth = birth;    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-3-准备controller"><a href="#1-2-3-准备controller" class="headerlink" title="1.2.3 准备controller"></a>1.2.3 准备controller</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boy.springbootalljson.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.boy.springbootalljson.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">Users</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ArrayList&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">4</span> ; i++) &#123;</span><br><span class="line">            User user = <span class="keyword">new</span> User();</span><br><span class="line">            user.setId(i);</span><br><span class="line">            user.setUsername(<span class="string">"Elo"</span>);</span><br><span class="line">            user.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">            users.add(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-4-测试"><a href="#1-2-4-测试" class="headerlink" title="1.2.4 测试"></a>1.2.4 测试</h3><p><img src="/2020/06/27/springboot-json/JacksonTestResult.png" alt="JacksonTestResult"></p>
<h3 id="1-2-5分析"><a href="#1-2-5分析" class="headerlink" title="1.2.5分析"></a>1.2.5分析</h3><p>可以看出测试结果中日期是没有被格式化的. 因为Jackson的默认配置中并没有对日期进行特殊处理. 从源码可以看出这一点:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.http.JacksonHttpMessageConvertersConfiguration类中有如下代码片段:</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MappingJackson2HttpMessageConverterConfiguration</span> </span>&#123;</span><br><span class="line">     MappingJackson2HttpMessageConverterConfiguration() &#123;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="meta">@ConditionalOnMissingBean</span>(</span><br><span class="line">         value = &#123;MappingJackson2HttpMessageConverter<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line"><span class="class">         <span class="title">ignoredType</span> </span>= &#123;<span class="string">"org.springframework.hateoas.server.mvc.TypeConstrainedMappingJackson2HttpMessageConverter"</span>, <span class="string">"org.springframework.data.rest.webmvc.alps.AlpsJsonHttpMessageConverter"</span>&#125;</span><br><span class="line">     )</span><br><span class="line">     <span class="function">MappingJackson2HttpMessageConverter <span class="title">mappingJackson2HttpMessageConverter</span><span class="params">(ObjectMapper objectMapper)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MappingJackson2HttpMessageConverter(objectMapper);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-6-两种解决方案"><a href="#1-2-6-两种解决方案" class="headerlink" title="1.2.6 两种解决方案"></a>1.2.6 两种解决方案</h3><p>有两种方法可以解决这个问题</p>
<p>一种”简单”的方法就是在entity的日期属性上加一个注解,如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">//@JsonFormat(pattern="yyyy/MM/dd")</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>但是如果有很多实体类中都有日期字段,都需要添加该注解就显得臃肿, 不和适宜. </p>
<p>一种更为简单的方式就是单独的配置日期格式.自己提供一个MappingJackson2HttpMessageConverter类型的bean, 让autoConfiguration默认配置失效, 然后再在自建的bean中进行日期格式化处理. </p>
<p>新建一个config类.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.boy.springbootalljson.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJsonConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MappingJackson2HttpMessageConverter <span class="title">mappingJackson2HttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        MappingJackson2HttpMessageConverter mappingJackson2HttpMessageConverter = <span class="keyword">new</span> MappingJackson2HttpMessageConverter();</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>));</span><br><span class="line">        mappingJackson2HttpMessageConverter.setObjectMapper(objectMapper);</span><br><span class="line">        <span class="keyword">return</span> mappingJackson2HttpMessageConverter;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用配置类处理日期格式后的测试结果:</p>
<p><img src="/2020/06/27/springboot-json/HttpMessageConverterTestResult.png" alt="HttpMessageConverterTestResult"></p>
<p>从源码片段最后的返回语句</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> MappingJackson2HttpMessageConverter(objectMapper);</span><br></pre></td></tr></table></figure>

<p>可以看出默认配置中返回的 MappingJackson2HttpMessageConverter bean是有一个new objectMapper的参数的, 该参数是自动注入的. </p>
<p>往上游追可以知道该参数是JacksonAutoConfiguration类提供的, 源码片段 :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line">	<span class="meta">@ConditionalOnClass</span>(Jackson2ObjectMapperBuilder<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">	<span class="title">static</span> <span class="title">class</span> <span class="title">JacksonObjectMapperConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@Primary</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">		<span class="function">ObjectMapper <span class="title">jacksonObjectMapper</span><span class="params">(Jackson2ObjectMapperBuilder builder)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> builder.createXmlMapper(<span class="keyword">false</span>).build();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说, 可以得出如下结论:</p>
<p>项目中没有自己提供ObjectMapper bean时, MappingJackson2HttpMessageConverter使用的是JacksonAutoConfiguration中提供的objectmapper bean来进行构造bean并返回到容器中的. </p>
<p>基于这样的结论, 以及最终实现日期格式化操作是objectmapper提供的setDateFormat(format) 的这一事实, 所以, 在自动一的MyJsonConfig类中也可以之定义一个objectmapper bean并返回即可. (即: 可以用如下bean替换掉MyJsonConfig类中的 mappingJackson2HttpMessageConverter bean )</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">objectMapper</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    objectMapper.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd hh:mm"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> objectMapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果:</p>
<p><img src="/2020/06/27/springboot-json/objectmapperTestResult.png" alt="objectmapperTestResult"></p>
<h1 id="2-Springboot-整合Gson"><a href="#2-Springboot-整合Gson" class="headerlink" title="2. Springboot 整合Gson"></a>2. Springboot 整合Gson</h1><h2 id="2-1-引入pom依赖"><a href="#2-1-引入pom依赖" class="headerlink" title="2.1 引入pom依赖"></a>2.1 引入pom依赖</h2><p>因为Gson是第三方(Google)提供的json处理方案, 所以pom要先将自身的Jackson依赖进行排除, 然后再添加Gson依赖. 具体操作如下:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-测试依赖引入是否成功"><a href="#2-2-测试依赖引入是否成功" class="headerlink" title="2.2 测试依赖引入是否成功"></a>2.2 测试依赖引入是否成功</h2><p>reimport后可以看到, 此时spring-boot-starter-web中已经没有Jackson而是换成了gson</p>
<p><img src="/2020/06/27/springboot-json/gson.png" alt="gson"></p>
<h2 id="2-3-Gson源码解析"><a href="#2-3-Gson源码解析" class="headerlink" title="2.3 Gson源码解析"></a>2.3 Gson源码解析</h2><p>从GsonHttpMessageConvertersConfiguration的源码可以看出: </p>
<p>1: 如果pom依赖中提供了gson, 那么GsonHttpMessageConvertersConfiguration配置就会生效, 因为该类有一个注解: @ConditionalOnClass(Gson.class)</p>
<p>2: 如果用户没有提供GsonHttpMessageConverter bean, 那么自动配置的GsonHttpMessageConverter bean就会生效, 其处理逻辑类似Jackson源码,只不过该bean的自动注入参数是gson而非objectmapper. </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 2012-2019 the original author or authors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Configuration for HTTP Message converters that use Gson.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Andy Wilkinson</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Eddú Meléndez</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(Gson<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">GsonHttpMessageConvertersConfiguration</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">  <span class="meta">@Configuration</span></span><br><span class="line">	<span class="meta">@ConditionalOnBean</span>(Gson<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">	@<span class="title">Conditional</span>(<span class="title">PreferGsonOrJacksonAndJsonbUnavailableCondition</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">	<span class="title">protected</span> <span class="title">static</span> <span class="title">class</span> <span class="title">GsonHttpMessageConverterConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> GsonHttpMessageConverter <span class="title">gsonHttpMessageConverter</span><span class="params">(Gson gson)</span> </span>&#123;</span><br><span class="line">			GsonHttpMessageConverter converter = <span class="keyword">new</span> GsonHttpMessageConverter();</span><br><span class="line">			converter.setGson(gson); <span class="comment">//</span></span><br><span class="line">			<span class="keyword">return</span> converter;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  .  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-自定义GsonHttpMessageConverter-bean"><a href="#2-4-自定义GsonHttpMessageConverter-bean" class="headerlink" title="2.4 自定义GsonHttpMessageConverter bean"></a>2.4 自定义GsonHttpMessageConverter bean</h2><p>在MyJsonConfig类中提供一个GsonHttpMessageConverter bean:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> GsonHttpMessageConverter <span class="title">gsonHttpMessageConverter</span><span class="params">(Gson gson)</span></span>&#123;</span><br><span class="line">      GsonHttpMessageConverter gsonHttpMessageConverter = <span class="keyword">new</span> GsonHttpMessageConverter();</span><br><span class="line">      gsonHttpMessageConverter.setGson(<span class="keyword">new</span> GsonBuilder().setDateFormat(<span class="string">"yyyy/MM/dd hh:mm:ss"</span>).create());</span><br><span class="line">      <span class="keyword">return</span> gsonHttpMessageConverter;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>启动项目查看结果(如下图),从日期格式可以看出GsonHttpMessageConverter配置在生效了.</p>
<p><img src="/2020/06/27/springboot-json/GsonTestResult.png" alt="GsonTestResult"></p>
<h2 id="2-5-自定义Gson-bean"><a href="#2-5-自定义Gson-bean" class="headerlink" title="2.5 自定义Gson bean"></a>2.5 自定义Gson bean</h2><p>对比Jackson的源码分析思路, 以及日期设置是在Gson参数中设置的, 可以对Gson进行同样的分析. org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration部分源码片段如下: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(Gson<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">GsonProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">GsonAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> GsonBuilder <span class="title">gsonBuilder</span><span class="params">(List&lt;GsonBuilderCustomizer&gt; customizers)</span> </span>&#123;</span><br><span class="line">		GsonBuilder builder = <span class="keyword">new</span> GsonBuilder();</span><br><span class="line">		customizers.forEach((c) -&gt; c.customize(builder));</span><br><span class="line">		<span class="keyword">return</span> builder;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Gson <span class="title">gson</span><span class="params">(GsonBuilder gsonBuilder)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gsonBuilder.create();</span><br><span class="line">	&#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>可以看出: </p>
<p>1: 只要pom依赖中引入了Gson, GsonAutoConfiguration配置就会会生效, 因为其被注解 @ConditionalOnClass(Gson.class)修饰</p>
<p>2: GsonHttpMessageConverter bean中的gson参数是从此处的Gson构造引入的, </p>
<p>所以类比整合Jackson时可以只在配置文件中提供一个objectmapper bean的情况, 可以推断, 整合gson也可以在MyJsonConfig类中只提供一个Gson bean, 应该也能实现同样的整合配合. </p>
<p>在MyJsonConfig注释掉GsonHttpMessageConverter bean, 然后 提供如下bean后重启项目测试:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Gson <span class="title">gson</span><span class="params">(GsonBuilder gsonBuilder)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> gsonBuilder.setDateFormat(<span class="string">"yyyy-MM-dd"</span>).create();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>测试结果:</p>
<p><img src="/2020/06/27/springboot-json/GBTestResult.png" alt="GsonTestResult"></p>
<h1 id="3-整合FastJson"><a href="#3-整合FastJson" class="headerlink" title="3. 整合FastJson"></a>3. 整合FastJson</h1><h2 id="3-1-引入依赖"><a href="#3-1-引入依赖" class="headerlink" title="3.1 引入依赖"></a>3.1 引入依赖</h2><p>因为Fastjson是第三方(阿里)提供的json处理方案, 所以pom要先将自身的Jackson依赖进行排除, 但你果然也要将志气啊添加的Gson排除, 然后再添加fastjson依赖. 具体操作如下:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;gson&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2测试依赖引入是否成功"><a href="#3-2测试依赖引入是否成功" class="headerlink" title="3.2测试依赖引入是否成功"></a>3.2测试依赖引入是否成功</h2><p>reimport后可以看出只存在fastjson依赖相关的jar包了</p>
<p><img src="/2020/06/27/springboot-json/fastjsonpom.png" alt="fastjsonpom"></p>
<h2 id="3-3-源码分析"><a href="#3-3-源码分析" class="headerlink" title="3.3 源码分析"></a>3.3 源码分析</h2><p>与Jackson和Gson不同的是, 要整合fastjson, 则必须引入FastJsonHttpMessageConverter bean, 因为没有starter中并没有相关的autoconfiguration. </p>
<p>源码: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastJsonHttpMessageConverter</span> <span class="keyword">extends</span> <span class="title">AbstractHttpMessageConverter</span>&lt;<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Charset UTF8     = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="keyword">private</span> Charset             charset  = UTF8;</span><br><span class="line">    <span class="keyword">private</span> SerializerFeature[] features = <span class="keyword">new</span> SerializerFeature[<span class="number">0</span>];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FastJsonHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> MediaType(<span class="string">"application"</span>, <span class="string">"json"</span>, UTF8), <span class="keyword">new</span> MediaType(<span class="string">"application"</span>, <span class="string">"*+json"</span>, UTF8));</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看见, </p>
<p>1: FastJsonHttpMessageConverter 类和其构造方法并没有被任何@ConditionalOnMissingBean(…)或@ConditionalOnBean(…)之类的注解修饰, </p>
<p>2: 构造方法为空参构造, 也就是说只能提供FastJsonHttpMessageConverter  bean进行自定义配置, 而不能像Gson只提供gson bean或者Jackson只提供objectmapper bean那样进行配置.</p>
<h2 id="3-4-自定义FastJsonHttpMessageConverter"><a href="#3-4-自定义FastJsonHttpMessageConverter" class="headerlink" title="3.4 自定义FastJsonHttpMessageConverter"></a>3.4 自定义FastJsonHttpMessageConverter</h2><p>在MyJsonConfig类中提供一个FastJsonHttpMessageConverter bean后重启项目; (注意fastjson的配置是在FastJsonConfig中设置的, 这一点与Gson和jackson稍有不同)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FastJsonHttpMessageConverter <span class="title">fastJsonHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FastJsonHttpMessageConverter fastJsonHttpMessageConverter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">    FastJsonConfig fastJsonConfig = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">    fastJsonConfig.setDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">    fastJsonHttpMessageConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">    <span class="keyword">return</span>  fastJsonHttpMessageConverter;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-5-测试结果"><a href="#3-5-测试结果" class="headerlink" title="3.5 测试结果"></a>3.5 测试结果</h2><p>测试结果如下图:</p>
<p><img src="/2020/06/27/springboot-json/FastJsonResult.png" alt="FastJsonResult"></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>Json</tag>
      </tags>
  </entry>
  <entry>
    <title>mashibing_架构师前置知识_OA系统_03</title>
    <url>/2020/05/17/mashibing-%E6%9E%B6%E6%9E%84%E5%B8%88%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-OA%E7%B3%BB%E7%BB%9F-03/</url>
    <content><![CDATA[<p>张一明架构师前置知识- Chapter 13</p>
<a id="more"></a>



<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><h3 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h3><p>基于角色的权限访问控制（Role-Based Access Control）作为传统访问控制（自主访问，强制访问）的有前景的代替受到广泛的关注。在RBAC中，权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。这就极大地简化了权限的管理。在一个组织中，角色是为了完成各种工作而创造，用户则依据它的责任和资格来被指派相应的角色，用户可以很容易地从一个角色被指派到另一个角色。角色可依新的需求和系统的合并而赋予新的权限，而权限也可根据需要而从某角色中回收。角色与角色的关系可以建立起来以囊括更广泛的客观情况。</p>
<p><img src="/2020/05/17/mashibing-%E6%9E%B6%E6%9E%84%E5%B8%88%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-OA%E7%B3%BB%E7%BB%9F-03/RBAC_logic_flow1.png" alt="1562154499822"></p>
<p><img src="/2020/05/17/mashibing-%E6%9E%B6%E6%9E%84%E5%B8%88%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-OA%E7%B3%BB%E7%BB%9F-03/RBAC_logic_flow2.png" alt="1562154499822"></p>
<h4 id="permission-权限"><a href="#permission-权限" class="headerlink" title="permission 权限"></a>permission 权限</h4><h5 id="异步JSON提交表单"><a href="#异步JSON提交表单" class="headerlink" title="异步JSON提交表单"></a>异步JSON提交表单</h5><p>js:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function add()&#123;</span><br><span class="line">	</span><br><span class="line">	var data &#x3D; $(&quot;#add&quot;).serializeArray();</span><br><span class="line">	</span><br><span class="line">	var formObject &#x3D; &#123;&#125;;</span><br><span class="line">	 $.each(data,function(i,item)&#123;</span><br><span class="line">            formObject[item.name] &#x3D; item.value;</span><br><span class="line">        &#125;);</span><br><span class="line">	 </span><br><span class="line">$.ajax(&#123;</span><br><span class="line">       type: &quot;POST&quot;,</span><br><span class="line">       url: &quot;permissionAdd&quot;,</span><br><span class="line">       contentType: &quot;application&#x2F;json; charset&#x3D;utf-8&quot;,</span><br><span class="line">       data: JSON.stringify(formObject),</span><br><span class="line">       dataType: &quot;json&quot;,</span><br><span class="line">       success: function (message) &#123;</span><br><span class="line">           if (message &gt; 0) &#123;</span><br><span class="line">               alert(&quot;请求已提交！我们会尽快与您取得联系&quot;);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       error: function (message) &#123;</span><br><span class="line">         alert(&quot;提交数据失败！&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@RequestMapping(&quot;permissionAdd&quot;)</span><br><span class="line">public String permissionAdd(Model model,@RequestBody(required &#x3D; false) Map&lt;String, String&gt; map) &#123;</span><br><span class="line">	</span><br><span class="line">	System.out.println(&quot;map:&quot; + map);</span><br><span class="line">	return &quot;manager&#x2F;permissionAdd&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复选框</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;input type&#x3D;&quot;checkbox&quot; name&#x3D;&quot;r&quot;   th:checked&#x3D;&quot;$&#123;p&#125;&#x3D;&#x3D;null?&#39;&#39;:$&#123;p.r &#125;   &quot; value&#x3D;&quot;true&quot;&gt;查看  </span><br><span class="line">&lt;input type&#x3D;&quot;checkbox&quot; name&#x3D;&quot;c&quot;   th:checked&#x3D;&quot;$&#123;p&#125;&#x3D;&#x3D;null?&#39;&#39;:$&#123;p.c &#125;   &quot; value&#x3D;&quot;true&quot;&gt;添加  </span><br><span class="line">&lt;input type&#x3D;&quot;checkbox&quot; name&#x3D;&quot;d&quot;   th:checked&#x3D;&quot;$&#123;p&#125;&#x3D;&#x3D;null?&#39;&#39;:$&#123;p.d &#125;   &quot; value&#x3D;&quot;true&quot;&gt;删除 </span><br><span class="line">&lt;input type&#x3D;&quot;checkbox&quot; name&#x3D;&quot;u&quot;   th:checked&#x3D;&quot;$&#123;p&#125;&#x3D;&#x3D;null?&#39;&#39;:$&#123;p.u&#125;   &quot; value&#x3D;&quot;true&quot;&gt;修改</span><br></pre></td></tr></table></figure>

<h3 id="表设计"><a href="#表设计" class="headerlink" title="表设计"></a>表设计</h3><p>多对多</p>
<p>SELECT r.id, r.name,p.name,p.uri FROM role r inner join role_permission m on r.id = m.role_id inner join permission p on m.permission_id = p.id;</p>
<p><strong>Inner Join</strong> 交集部分</p>
<p><strong>LEFT OUTER JOIN</strong></p>
<p>RIGHT OUTER JOIN</p>
<p>一方全部</p>
<h3 id="踢下线-单用户登录"><a href="#踢下线-单用户登录" class="headerlink" title="踢下线 单用户登录"></a>踢下线 单用户登录</h3><h2 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h2><h3 id="实体注解："><a href="#实体注解：" class="headerlink" title="实体注解："></a>实体注解：</h3><p>controller</p>
<p>@Valid @RequestBody Permission p,BindingResult bindingResult</p>
<p>@NotBlank:判断字符创是否是null或者是空串(去掉首尾空格)。</p>
<p>@NotEmpty判断字符串是否为null会者是空串。</p>
<p>@Length判断字符的长度（最大或最小）</p>
<p>@Min判断数值最小值</p>
<p>@Max判断数值最大值</p>
<p>@Email判断邮箱是否合法</p>
<p>@Null 限制只能为null @NotNull 限制必须不为null @AssertFalse 限制必须为false @AssertTrue 限制必须为true @DecimalMax(value) 限制必须为一个不大于指定值的数字 @DecimalMin(value) 限制必须为一个不小于指定值的数字 @Digits(integer,fraction) 限制必须为一个小数，且整数部分的位数不能超过integer，小数部分的位数不能超过fraction @Max(value) 限制必须为一个不大于指定值的数字 @Min(value) 限制必须为一个不小于指定值的数字 @Future 限制必须是一个将来的日期 @Past 限制必须是一个过去的日期 @Pattern(value) 限制必须符合指定的正则表达式 @Size(max,min) 限制字符长度必须在min到max之间 @NotEmpty 验证注解的元素值不为null且不为空（字符串长度不为0、集合大小不为0） @NotBlank 验证注解的元素值不为空（不为null、去除首尾空格后长度不为0），不同于@NotEmpty，@NotBlank只应用于字符串且在比较时会去除字符串的空格 @Email 验证注解的元素值是Email，也可以通过正则表达式和flag指定自定义的email格式</p>
<p>文件上传</p>
<p>代码生成</p>
<h2 id="MockMvc"><a href="#MockMvc" class="headerlink" title="MockMvc"></a>MockMvc</h2><p>本文为本人整理的听课笔记, 稍有修改.<br>自学之用, 不作任何商业用途.如有侵权, 请联系删除</p>
<p>原文引用于如下原创内容 :</p>
<p><a href>Original</a></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>mashibing</tag>
        <tag>ArchetectPre</tag>
      </tags>
  </entry>
  <entry>
    <title>OA系统_02</title>
    <url>/2020/05/16/mashibing-%E6%9E%B6%E6%9E%84%E5%B8%88%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-OA%E7%B3%BB%E7%BB%9F-02/</url>
    <content><![CDATA[<p>张一明架构师前置知识- Chapter 12</p>
<a id="more"></a>



<h1 id="OA-用户模块-02"><a href="#OA-用户模块-02" class="headerlink" title="OA 用户模块 02"></a>OA 用户模块 02</h1><h2 id="列表分页"><a href="#列表分页" class="headerlink" title="列表分页"></a>列表分页</h2><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> PageInfo&lt;Account&gt; <span class="title">findByPage</span><span class="params">(<span class="keyword">int</span> pageNum, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">	</span><br><span class="line">	AccountExample example = <span class="keyword">new</span> AccountExample();</span><br><span class="line">	PageInfo&lt;Account&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;Account&gt;(accMapper.selectByExample(example ),<span class="number">5</span>);</span><br><span class="line"><span class="keyword">return</span>	pageInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;'/account/list?pageNum=' + $&#123;accountList.prePage&#125;&#125;"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">"num : $&#123;accountList.navigatepageNums&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;'/account/list?pageNum='+$&#123;num&#125;&#125;"</span>&gt;</span>[[$&#123;num&#125;]]<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;'/account/list?pageNum=' + $&#123;accountList.nextPage&#125;&#125;"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h2><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><h4 id="html"><a href="#html" class="headerlink" title="html"></a>html</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;'javascript:deleteUser('+$&#123;account.id&#125;+');'&#125;"</span> &gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteUser</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> url = <span class="string">"/account/deleteAccount"</span>;</span><br><span class="line">	<span class="keyword">var</span> args = &#123;<span class="attr">accountId</span>:id&#125;;</span><br><span class="line">	$.post(url,args,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">		<span class="keyword">if</span>(data.code == <span class="number">200</span>)&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">window</span>.location.reload();</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			</span><br><span class="line">			alert(<span class="string">"操作失败："</span> + data.msg)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="确认"><a href="#确认" class="headerlink" title="确认"></a>确认</h4><h5 id="纯js"><a href="#纯js" class="headerlink" title="纯js"></a>纯js</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> r=confirm(<span class="string">"Press a button"</span>)</span><br><span class="line"><span class="keyword">if</span> (r==<span class="literal">true</span>)</span><br><span class="line">  &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">"You pressed OK!"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">"You pressed Cancel!"</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h5 id="模态窗口"><a href="#模态窗口" class="headerlink" title="模态窗口"></a>模态窗口</h5><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"com-alert"</span> <span class="attr">class</span>=<span class="string">"modal"</span> <span class="attr">style</span>=<span class="string">"z-index:9999;display: none;"</span> &gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-dialog modal-sm"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-content"</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-header"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>×<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Close<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">"modal-title"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-exclamation-circle"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> [Title]<span class="tag">&lt;/<span class="name">h5</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-body small"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>[Message]<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-footer"</span> &gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary ok"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span>&gt;</span>[BtnOk]<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-default cancel"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span>&gt;</span>[BtnCancel]<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="js"><a href="#js" class="headerlink" title="js"></a>js</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">	  <span class="built_in">window</span>.Modal = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">	    <span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"\\[([^\\[\\]]*?)\\]"</span>, <span class="string">'igm'</span>);  </span><br><span class="line">	    <span class="keyword">var</span> alr = $(<span class="string">"#com-alert"</span>);  </span><br><span class="line">	    <span class="keyword">var</span> ahtml = alr.html();  </span><br><span class="line">	  </span><br><span class="line">	    <span class="keyword">var</span> _tip = <span class="function"><span class="keyword">function</span> (<span class="params">options, sec</span>) </span>&#123;  </span><br><span class="line">	        alr.html(ahtml);    <span class="comment">// 复原  </span></span><br><span class="line">	        alr.find(<span class="string">'.ok'</span>).hide();  </span><br><span class="line">	        alr.find(<span class="string">'.cancel'</span>).hide();  </span><br><span class="line">	        alr.find(<span class="string">'.modal-content'</span>).width(<span class="number">500</span>);  </span><br><span class="line">	        _dialog(options, sec);  </span><br><span class="line">	          </span><br><span class="line">	        <span class="keyword">return</span> &#123;  </span><br><span class="line">	            on: <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;  </span><br><span class="line">	            &#125;  </span><br><span class="line">	        &#125;;  </span><br><span class="line">	    &#125;;  </span><br><span class="line">	  </span><br><span class="line">	    <span class="keyword">var</span> _alert = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;  </span><br><span class="line">	      alr.html(ahtml);  <span class="comment">// 复原  </span></span><br><span class="line">	      alr.find(<span class="string">'.ok'</span>).removeClass(<span class="string">'btn-success'</span>).addClass(<span class="string">'btn-primary'</span>);  </span><br><span class="line">	      alr.find(<span class="string">'.cancel'</span>).hide();  </span><br><span class="line">	      _dialog(options);  </span><br><span class="line">	  </span><br><span class="line">	      <span class="keyword">return</span> &#123;  </span><br><span class="line">	        on: <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;  </span><br><span class="line">	          <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="built_in">Function</span>) &#123;  </span><br><span class="line">	            alr.find(<span class="string">'.ok'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; callback(<span class="literal">true</span>) &#125;);  </span><br><span class="line">	          &#125;  </span><br><span class="line">	        &#125;  </span><br><span class="line">	      &#125;;  </span><br><span class="line">	    &#125;;  </span><br><span class="line">	  </span><br><span class="line">	    <span class="keyword">var</span> _confirm = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;  </span><br><span class="line">	      alr.html(ahtml); <span class="comment">// 复原  </span></span><br><span class="line">	      alr.find(<span class="string">'.ok'</span>).removeClass(<span class="string">'btn-primary'</span>).addClass(<span class="string">'btn-success'</span>);  </span><br><span class="line">	      alr.find(<span class="string">'.cancel'</span>).show();  </span><br><span class="line">	      _dialog(options);  </span><br><span class="line">	  </span><br><span class="line">	      <span class="keyword">return</span> &#123;  </span><br><span class="line">	        on: <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;  </span><br><span class="line">	          <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="built_in">Function</span>) &#123;  </span><br><span class="line">	            alr.find(<span class="string">'.ok'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; callback(<span class="literal">true</span>) &#125;);  </span><br><span class="line">	            alr.find(<span class="string">'.cancel'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span>; &#125;);  </span><br><span class="line">	          &#125;  </span><br><span class="line">	        &#125;  </span><br><span class="line">	      &#125;;  </span><br><span class="line">	    &#125;;  </span><br><span class="line">	  </span><br><span class="line">	    <span class="keyword">var</span> _dialog = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;  </span><br><span class="line">	      <span class="keyword">var</span> ops = &#123;  </span><br><span class="line">	        msg: <span class="string">"提示内容"</span>,  </span><br><span class="line">	        title: <span class="string">"操作提示"</span>,  </span><br><span class="line">	        btnok: <span class="string">"确定"</span>,  </span><br><span class="line">	        btncl: <span class="string">"取消"</span>  </span><br><span class="line">	      &#125;;  </span><br><span class="line">	  </span><br><span class="line">	      $.extend(ops, options);  </span><br><span class="line">	  </span><br><span class="line">	      <span class="keyword">var</span> html = alr.html().replace(reg, <span class="function"><span class="keyword">function</span> (<span class="params">node, key</span>) </span>&#123;  </span><br><span class="line">	        <span class="keyword">return</span> &#123;  </span><br><span class="line">	          Title: ops.title,  </span><br><span class="line">	          Message: ops.msg,  </span><br><span class="line">	          BtnOk: ops.btnok,  </span><br><span class="line">	          BtnCancel: ops.btncl  </span><br><span class="line">	        &#125;[key];  </span><br><span class="line">	      &#125;);  </span><br><span class="line">	        </span><br><span class="line">	      alr.html(html);  </span><br><span class="line">	      alr.modal(&#123;  </span><br><span class="line">	        width: <span class="number">250</span>,  </span><br><span class="line">	        backdrop: <span class="string">'static'</span>  </span><br><span class="line">	      &#125;);  </span><br><span class="line">	    &#125;  </span><br><span class="line">	  </span><br><span class="line">	    <span class="keyword">return</span> &#123;  </span><br><span class="line">	      tip: _tip,  </span><br><span class="line">	      alert: _alert,  </span><br><span class="line">	      confirm: _confirm  </span><br><span class="line">	    &#125;  </span><br><span class="line">	  </span><br><span class="line">	  &#125;();  </span><br><span class="line">	&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showTip</span>(<span class="params">msg, sec, callback</span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">if</span>(!sec) &#123;  </span><br><span class="line">        sec = <span class="number">1000</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    Modal.tip(&#123;  </span><br><span class="line">        title:<span class="string">'提示'</span>,  </span><br><span class="line">        msg: msg  </span><br><span class="line">    &#125;, sec);  </span><br><span class="line">    setTimeout(callback, sec);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 显示消息 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>msg </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">msg, callback</span>)</span>&#123;  </span><br><span class="line">    Modal.alert(&#123;  </span><br><span class="line">        title:<span class="string">'提示'</span>,  </span><br><span class="line">        msg: msg,  </span><br><span class="line">        btnok: <span class="string">'确定'</span>  </span><br><span class="line">    &#125;).on(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(callback)&#123;  </span><br><span class="line">            callback();  </span><br><span class="line">        &#125;  </span><br><span class="line">     &#125;);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 模态对话框 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>msg </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span></span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showConfirm</span>(<span class="params">msg,callback</span>)</span>&#123;  </span><br><span class="line">    <span class="comment">//var res = false;  </span></span><br><span class="line">    Modal.confirm(  </span><br><span class="line">      &#123;  </span><br><span class="line">          title:<span class="string">'提示'</span>,  </span><br><span class="line">          msg: msg,  </span><br><span class="line">      &#125;).on( <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;  </span><br><span class="line">          callback();  </span><br><span class="line">          <span class="comment">//res=true;  </span></span><br><span class="line">      &#125;);  </span><br><span class="line">    <span class="comment">//return res;  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteUser</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">var</span> url = <span class="string">"/account/deleteAccount"</span>;</span><br><span class="line">		<span class="keyword">var</span> args = &#123;<span class="attr">accountId</span>:id&#125;;</span><br><span class="line">		</span><br><span class="line">		showConfirm(<span class="string">"确认要删除吗？"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			$.post(url,args,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">				</span><br><span class="line">				<span class="built_in">console</span>.log(data)</span><br><span class="line">				<span class="keyword">if</span>(data.code == <span class="number">200</span>)&#123;</span><br><span class="line">					</span><br><span class="line">					<span class="built_in">window</span>.location.reload();</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					</span><br><span class="line">					alert(<span class="string">"操作失败："</span> + data.msg)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h5 id="代码调用"><a href="#代码调用" class="headerlink" title="代码调用"></a>代码调用</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">showTip(<span class="string">"haha"</span>, <span class="number">1000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line">showMsg(<span class="string">"haha"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line">showConfirm(<span class="string">"haha"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h2><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">spring.resources.<span class="keyword">static</span>-locations=classpath:/META-INF/resources/,classpath:/resources/,classpath:/<span class="keyword">static</span>/,classpath:/<span class="keyword">public</span>/,file:D:/upload/</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/fileUploadController"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">fileUpload</span> <span class="params">(MultipartFile filename,String password)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"password:"</span> + password);</span><br><span class="line">	System.out.println(<span class="string">"file:"</span> + filename.getOriginalFilename());</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		</span><br><span class="line">	File path = <span class="keyword">new</span> File(ResourceUtils.getURL(<span class="string">"classpath:"</span>).getPath());</span><br><span class="line">       File upload = <span class="keyword">new</span> File(path.getAbsolutePath(), <span class="string">"static/upload/"</span>);</span><br><span class="line">       </span><br><span class="line">       System.out.println(<span class="string">"upload:"</span> + upload);</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       filename.transferTo(<span class="keyword">new</span> File(upload+<span class="string">"/"</span>+filename.getOriginalFilename()));</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"profile"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="添加包名称"><a href="#添加包名称" class="headerlink" title="添加包名称"></a>添加包名称</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;build&gt; 的子标签下 添加</span><br><span class="line">&lt;packaging&gt;war&lt;&#x2F;packaging&gt;</span><br></pre></td></tr></table></figure>



<h3 id="引入依赖-避免Tomcat的包重复"><a href="#引入依赖-避免Tomcat的包重复" class="headerlink" title="引入依赖 避免Tomcat的包重复"></a>引入依赖 避免Tomcat的包重复</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;!--打包的时候可以不用包进去，别的设施会提供。事实上该依赖理论上可以参与编译，测试，运行等周期。</span><br><span class="line">        相当于compile，但是打包阶段做了exclude操作--&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">在入口类上添加标记</span><br><span class="line">public class ServletInitializer extends SpringBootServletInitializer &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) &#123;</span><br><span class="line">        &#x2F;&#x2F;此处的Application.class为带有@SpringBootApplication注解的启动类</span><br><span class="line">        return builder.sources(Application.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="批量生成文件"><a href="#批量生成文件" class="headerlink" title="批量生成文件"></a>批量生成文件</h2><h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">		</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="官方示例"><a href="#官方示例" class="headerlink" title="官方示例"></a>官方示例</h3><p><a href="https://mp.baomidou.com/guide/generator.html" target="_blank" rel="noopener">https://mp.baomidou.com/guide/generator.html</a></p>
<h3 id="自定义注入"><a href="#自定义注入" class="headerlink" title="自定义注入"></a>自定义注入</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InjectionConfig cfg = <span class="keyword">new</span> InjectionConfig() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"xxoo"</span>, <span class="string">"yimingge"</span>);</span><br><span class="line">        <span class="keyword">this</span>.setMap(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="自定义模板"><a href="#自定义模板" class="headerlink" title="自定义模板"></a>自定义模板</h3><p>模板文件实际位置</p>
<p>src/main/resources/templates/entity.ftl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配置模板</span></span><br><span class="line">TemplateConfig templateConfig = <span class="keyword">new</span> TemplateConfig();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">templateConfig.setEntity(<span class="string">"/templates/entity"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="读取自定义注入内容"><a href="#读取自定义注入内容" class="headerlink" title="读取自定义注入内容"></a>读取自定义注入内容</h3><p> 末班文件中加入</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$&#123;cfg.xxoo&#125;</span><br></pre></td></tr></table></figure>



<h2 id="freemarker-模板"><a href="#freemarker-模板" class="headerlink" title="freemarker 模板"></a>freemarker 模板</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&#123;&quot;abc&quot;?cap_first&#125;  &#x2F;&#x2F;首字母大写</span><br><span class="line">$&#123;entity&#125; 实体类名</span><br><span class="line">$&#123;table&#125; 表</span><br><span class="line">$&#123;table.controllerName&#125; controller名称</span><br><span class="line">$&#123;r&#39;$&#123;itemStat.count&#125;&#39;&#125; 转义</span><br><span class="line">$&#123;table.entityName&#125; 大写类名</span><br><span class="line">$&#123;table.name&#125; 小写</span><br></pre></td></tr></table></figure>



<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">	<span class="tag">&lt;<span class="name">#list</span> <span class="attr">table.fields</span> <span class="attr">as</span> <span class="attr">field</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;r'$&#123;item.'&#125;$&#123;field.propertyName&#125;&#125;"</span>&gt;</span>$&#123;field.propertyName&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="自定义输出"><a href="#自定义输出" class="headerlink" title="自定义输出"></a>自定义输出</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加前端页面</span></span><br><span class="line">	<span class="comment">// 输入</span></span><br><span class="line">String html_list_Path = <span class="string">"/templates/html_list.ftl"</span>;</span><br><span class="line">	<span class="comment">//输出</span></span><br><span class="line">focList.add(<span class="keyword">new</span> FileOutConfig(html_list_Path) &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">outputFile</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 自定义输出文件名 ， 如果你 Entity 设置了前后缀、此处注意 xml 的名称会跟着发生变化！！</span></span><br><span class="line">		<span class="keyword">return</span> projectPath + <span class="string">"/src/main/resources/templates/"</span> + pc.getModuleName()</span><br><span class="line">		+ <span class="string">"/"</span> + tableInfo.getEntityName() + <span class="string">"List.html"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="entity模板"><a href="#entity模板" class="headerlink" title="entity模板"></a>entity模板</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> $&#123;<span class="keyword">package</span>.Entity&#125;;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment">  $&#123;cfg.xxoo&#125;</span></span><br><span class="line"><span class="comment"> * $&#123;table.comment!&#125;</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> $&#123;author&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> $&#123;date&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $</span>&#123;entity&#125; implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">&lt;#if entitySerialVersionUID&gt;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">//TableInfo(importPackages=[java.io.Serializable], convert=false, name=menu, comment=, entityName=Menu, mapperName=MenuMapper, xmlName=MenuMapper, serviceName=IMenuService, serviceImplName=MenuServiceImpl, controllerName=MenuController, fields=[TableField(convert=false, keyFlag=false, keyIdentityFlag=false, name=name, type=varchar(45), propertyName=name, columnType=STRING, comment=, fill=null, customMap=null), TableField(convert=false, keyFlag=false, keyIdentityFlag=false, name=roles, type=varchar(45), propertyName=roles, columnType=STRING, comment=, fill=null, customMap=null), TableField(convert=false, keyFlag=false, keyIdentityFlag=false, name=index, type=varchar(45), propertyName=index, columnType=STRING, comment=, fill=null, customMap=null)], commonFields=[TableField(convert=false, keyFlag=true, keyIdentityFlag=true, name=id, type=int(11), propertyName=id, columnType=INTEGER, comment=, fill=null, customMap=null)], fieldNames=name, roles, index)</span></span><br><span class="line"></span><br><span class="line">&lt;#-- ----------  主键 字段循环遍历  ----------&gt;</span><br><span class="line">&lt;#list table.commonFields as field&gt;</span><br><span class="line">    <span class="keyword">private</span> $&#123;field.propertyType&#125; $&#123;field.propertyName&#125;;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;#-- ----------  BEGIN 字段循环遍历  ----------&gt;</span><br><span class="line">&lt;#list table.fields as field&gt;</span><br><span class="line">    <span class="keyword">private</span> $&#123;field.propertyType&#125; $&#123;field.propertyName&#125;;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;#------------  END 字段循环遍历  ----------&gt;</span><br><span class="line"></span><br><span class="line">&lt;#if !entityLombokModel&gt;</span><br><span class="line">    &lt;#list table.fields as field&gt;</span><br><span class="line">        &lt;#if field.propertyType == "boolean"&gt;</span><br><span class="line">            &lt;#assign getprefix="is"/&gt;</span><br><span class="line">        &lt;#else&gt;</span><br><span class="line">            &lt;#assign getprefix="get"/&gt;</span><br><span class="line">        &lt;/#if&gt;</span><br><span class="line">    <span class="keyword">public</span> $&#123;field.propertyType&#125; $&#123;getprefix&#125;$&#123;field.capitalName&#125;() &#123;</span><br><span class="line">        <span class="keyword">return</span> $&#123;field.propertyName&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &lt;#if entityBuilderModel&gt;</span><br><span class="line">    <span class="keyword">public</span> $&#123;entity&#125; set$&#123;field.capitalName&#125;($&#123;field.propertyType&#125; $&#123;field.propertyName&#125;) &#123;</span><br><span class="line">    &lt;#else&gt;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> set$&#123;field.capitalName&#125;($&#123;field.propertyType&#125; $&#123;field.propertyName&#125;) &#123;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">        <span class="keyword">this</span>.$&#123;field.propertyName&#125; = $&#123;field.propertyName&#125;;</span><br><span class="line">        &lt;#if entityBuilderModel&gt;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &lt;/#if&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/#list&gt;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line"></span><br><span class="line">&lt;#if entityColumnConstant&gt;</span><br><span class="line">    &lt;#list table.fields as field&gt;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String $&#123;field.name?upper_case&#125; = <span class="string">"$&#123;field.name&#125;"</span>;</span><br><span class="line"></span><br><span class="line">    &lt;/#list&gt;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">&lt;#if activeRecord&gt;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Serializable <span class="title">pkVal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &lt;#if keyPropertyName??&gt;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.$&#123;keyPropertyName&#125;;</span><br><span class="line">    &lt;#else&gt;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;/#if&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;#list table.commonFields as field&gt;</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">void</span>  set$&#123;field.propertyName?cap_first&#125;($&#123;field.propertyType&#125; $&#123;field.propertyName&#125;)&#123;</span><br><span class="line">    	<span class="keyword">this</span>.$&#123;field.propertyName&#125; = $&#123;field.propertyName&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">      <span class="keyword">public</span> $&#123;field.propertyType&#125;  get$&#123;field.propertyName?cap_first&#125;()&#123;</span><br><span class="line">    </span><br><span class="line">    	<span class="keyword">return</span> $&#123;field.propertyName&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line"></span><br><span class="line">&lt;#-- ----------  get set 字段循环遍历  ----------&gt;</span><br><span class="line">&lt;#list table.fields as field&gt;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">void</span>  set$&#123;field.propertyName?cap_first&#125;($&#123;field.propertyType&#125; $&#123;field.propertyName&#125;)&#123;</span><br><span class="line">    	<span class="keyword">this</span>.$&#123;field.propertyName&#125; = $&#123;field.propertyName&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">      <span class="keyword">public</span> $&#123;field.propertyType&#125;  get$&#123;field.propertyName?cap_first&#125;()&#123;</span><br><span class="line">    </span><br><span class="line">    	<span class="keyword">return</span> $&#123;field.propertyName&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;#------------  END 字段循环遍历  ----------&gt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * $&#123;table.comment!&#125; 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *$&#123;table&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> $&#123;author&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> $&#123;date&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"&lt;#if package.ModuleName??&gt;/$&#123;package.ModuleName&#125;&lt;/#if&gt;/&lt;#if controllerMappingHyphenStyle??&gt;$&#123;controllerMappingHyphen&#125;&lt;#else&gt;$&#123;table.entityPath&#125;&lt;/#if&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $</span>&#123;table.controllerName&#125; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	 $&#123;entity&#125;Service $&#123;table.name&#125;Srv;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/delete$&#123;entity&#125;"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="keyword">public</span> RespStat delete$&#123;table.controllerName&#125;(<span class="keyword">int</span> id) &#123;</span><br><span class="line">		System.out.println(<span class="string">"id:"</span> + id);</span><br><span class="line">		RespStat stat = $&#123;table.name&#125;Srv.delete(id);</span><br><span class="line">		<span class="keyword">return</span> stat;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">		<span class="meta">@RequestMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(@RequestParam(defaultValue = <span class="string">"1"</span>)</span> <span class="keyword">int</span> pageNum,@<span class="title">RequestParam</span><span class="params">(defaultValue = <span class="string">"1"</span> )</span> <span class="keyword">int</span> pageSize,Model model) </span>&#123;</span><br><span class="line">		</span><br><span class="line">		PageInfo&lt;$&#123;entity&#125;&gt;accountList = $&#123;table.name&#125;Srv.findByPage(pageNum,pageSize);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"/$&#123;table.name&#125;/list"</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>





<p>后面要讲的</p>
<ol>
<li>多表关联查询</li>
</ol>
<h1 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a>课后作业</h1><ul>
<li><ol>
<li>注册功能 异步</li>
<li>修改密码</li>
<li>权限认证<ol>
<li>修改权限 后台 accountController-&gt;List 方法里 用户权限的增删改查</li>
<li>对修改动作 做权限控制<ol>
<li>要不要显示给 User的用户 </li>
<li>提交删除请求的时候 ，查一下 当前操作用户的权限是不是admin</li>
</ol>
</li>
</ol>
</li>
<li>翻页功能</li>
<li>欠下的</li>
<li>bootstrap - table 替换现有 的表格</li>
<li>修改头像 上传图片<ol>
<li>表里 添加一个字段（图片的完整 url 路径,相对路径（文件名））</li>
<li>前端页面 修改头像的功能</li>
<li>有个默认头像 （如果表字段里没有图 显示默认）</li>
</ol>
</li>
<li>一定要有自学的能力</li>
</ol>
</li>
</ul>
<p>本文为本人整理的听课笔记, 稍有修改.<br>自学之用, 不作任何商业用途.如有侵权, 请联系删除</p>
<p>原文引用于如下原创内容 :</p>
<p>[Original]([<a href="https://github.com/bjmashibing/InternetArchitect/blob/master/03%20OA%E8%B4%A6%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/OA%20%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%2002.md]" target="_blank" rel="noopener">https://github.com/bjmashibing/InternetArchitect/blob/master/03%20OA%E8%B4%A6%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/OA%20%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%2002.md]</a>(<a href="https://github.com/bjmashibing/InternetArchitect/blob/master/03" target="_blank" rel="noopener">https://github.com/bjmashibing/InternetArchitect/blob/master/03</a> OA账户权限管理/OA 用户模块 02.md))</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>mashibing</tag>
        <tag>ArchetectPre</tag>
      </tags>
  </entry>
  <entry>
    <title>OA系统_01</title>
    <url>/2020/05/16/mashibing-%E6%9E%B6%E6%9E%84%E5%B8%88%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-OA%E7%B3%BB%E7%BB%9F-01/</url>
    <content><![CDATA[<p>张一明架构师前置知识- Chapter 11</p>
<a id="more"></a>

<h1 id="OA-用户模块-01"><a href="#OA-用户模块-01" class="headerlink" title="OA 用户模块 01"></a>OA 用户模块 01</h1><ul>
<li>项目角色分配<ul>
<li>项目经理<ul>
<li>只懂业务</li>
<li>跟进进度</li>
<li>人员、财务预算</li>
</ul>
</li>
<li>技术总监</li>
<li>项目组长 teamLeader</li>
<li>后端开发</li>
<li>设计师 UI/UE</li>
<li>产品经理</li>
<li>前端</li>
</ul>
</li>
<li>开发流程<ul>
<li>需求  %30</li>
<li>设计 %20</li>
<li>实现 %50</li>
</ul>
</li>
<li>用户管理<ul>
<li>登录</li>
<li>异步提交</li>
<li>对未登录用户做控制</li>
</ul>
</li>
<li>前端页面美化一下</li>
</ul>
<h2 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h2><h3 id="默认连接池"><a href="#默认连接池" class="headerlink" title="默认连接池"></a>默认连接池</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">DataSource dataSource;</span><br><span class="line">	</span><br><span class="line">		System.out.println(<span class="string">"数据源&gt;&gt;&gt;&gt;&gt;&gt;"</span> + dataSource.getClass());</span><br><span class="line">        Connection connection;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			connection = dataSource.getConnection();</span><br><span class="line">			System.out.println(<span class="string">"连接&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span> + connection);</span><br><span class="line">			System.out.println(<span class="string">"连接地址&gt;&gt;&gt;&gt;&gt;"</span> + connection.getMetaData().getURL());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>以前版本，如 Spring Boot 1.5 默认使用 org.apache.tomcat.jdbc.pool.DataSource 作为数据源；</p>
<p>HikariDataSource 号称 Java WEB 当前速度最快的数据源，相比于传统的 C3P0 、DBCP、Tomcat jdbc 等连接池更加优秀；</p>
<p><img src="/2020/05/16/mashibing-%E6%9E%B6%E6%9E%84%E5%B8%88%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-OA%E7%B3%BB%E7%BB%9F-01/C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1561363553381.png" alt="1561363553381"></p>
<p><img src="/2020/05/16/mashibing-%E6%9E%B6%E6%9E%84%E5%B8%88%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-OA%E7%B3%BB%E7%BB%9F-01/C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1561363566787.png" alt="1561363566787"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">spring.datasource.type=com.zaxxer.hikari.HikariDataSource1</span><br><span class="line">## 最小空闲连接数量</span><br><span class="line">spring.datasource.hikari.minimum-idle=<span class="number">5</span></span><br><span class="line">## 连接池最大连接数，默认是10  池中最大连接数，包括闲置和使用中的连接</span><br><span class="line">spring.datasource.hikari.maximum-pool-size=<span class="number">15</span></span><br><span class="line">spring.datasource.hikari.auto-commit=<span class="keyword">true</span></span><br><span class="line">## 空闲连接存活最大时间，默认600000（10分钟）</span><br><span class="line">spring.datasource.hikari.idle-timeout=<span class="number">30000</span></span><br><span class="line">## 连接池名称</span><br><span class="line">spring.datasource.hikari.pool-name=<span class="number">22</span>DatebookHikariCP</span><br><span class="line">## 此属性控制池中连接的最长生命周期，值0表示无限生命周期，默认1800000即30分钟</span><br><span class="line">spring.datasource.hikari.max-lifetime=<span class="number">1800000</span></span><br><span class="line">spring.datasource.hikari.connection-timeout=<span class="number">30000</span></span><br><span class="line">spring.datasource.hikari.connection-test-query=SELECT <span class="number">1</span></span><br></pre></td></tr></table></figure>





<h3 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h3><p>官方地址</p>
<p><a href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter" target="_blank" rel="noopener">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
<p><a href="https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter/1.1.17" target="_blank" rel="noopener">https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter/1.1.17</a></p>
<h4 id="加入依赖"><a href="#加入依赖" class="headerlink" title="加入依赖"></a>加入依赖</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">		<span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"># 初始化大小，最小，最大</span><br><span class="line">spring.datasource.initial-size=<span class="number">5</span></span><br><span class="line">spring.datasource.max-active=<span class="number">20</span></span><br><span class="line">spring.datasource.min-idle=<span class="number">5</span></span><br><span class="line"># 配置获取连接等待超时的时间</span><br><span class="line">spring.datasource.max-wait=<span class="number">60000</span></span><br><span class="line"># 配置一个连接在池中最小生存的时间，单位是毫秒</span><br><span class="line">spring.datasource.min-evictable-idle-time-millis=<span class="number">60000</span></span><br><span class="line">spring.datasource.validation-query=SELECT <span class="number">1</span></span><br><span class="line">spring.datasource.validation-query-timeout=<span class="number">2000</span></span><br></pre></td></tr></table></figure>



<h4 id="web监控"><a href="#web监控" class="headerlink" title="web监控"></a>web监控</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.springboot.controller;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.support.http.StatViewServlet;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将自定义的 Druid 数据源添加到容器中，不再让 Spring Boot 自动创建</span></span><br><span class="line"><span class="comment">     * 这样做的目的是：绑定全局配置文件中的 druid 数据源属性到 com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">     * 从而让它们生效</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ConfigurationProperties</span>(prefix = "spring.datasource")：作用就是将 全局配置文件中 前缀为 spring.datasource</span></span><br><span class="line"><span class="comment">     * 的属性值注入到 com.alibaba.druid.pool.DruidDataSource 的同名参数中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置 Druid 监控 之  管理后台的 Servlet</span></span><br><span class="line"><span class="comment">     * 内置 Servler 容器时没有web.xml 文件，所以使用 Spring Boot 的注册 Servlet 方式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(),</span><br><span class="line">                <span class="string">"/druid/*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * loginUsername：Druid 后台管理界面的登录账号</span></span><br><span class="line"><span class="comment">         * loginPassword：Druid 后台管理界面的登录密码</span></span><br><span class="line"><span class="comment">         * allow：Druid 后台允许谁可以访问</span></span><br><span class="line"><span class="comment">         *      initParams.put("allow", "localhost")：表示只有本机可以访问</span></span><br><span class="line"><span class="comment">         *      initParams.put("allow", "")：为空或者为null时，表示允许所有访问</span></span><br><span class="line"><span class="comment">         * deny：Druid 后台拒绝谁访问</span></span><br><span class="line"><span class="comment">         *      initParams.put("deny", "192.168.1.20");表示禁止此ip访问</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"loginUsername"</span>, <span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"loginPassword"</span>, <span class="string">"123456"</span>);</span><br><span class="line">        initParams.put(<span class="string">"allow"</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 设置初始化参数*/</span></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="spring-boot-mybatis-用户管理"><a href="#spring-boot-mybatis-用户管理" class="headerlink" title="spring boot +  mybatis 用户管理"></a>spring boot +  mybatis 用户管理</h1><h2 id="1-登录验证"><a href="#1-登录验证" class="headerlink" title="1. 登录验证"></a>1. 登录验证</h2><h3 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h3><h4 id="前端异步提交及登录跳转-js"><a href="#前端异步提交及登录跳转-js" class="headerlink" title="前端异步提交及登录跳转 js"></a>前端异步提交及登录跳转 js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">	</span><br><span class="line">$(<span class="string">".login_btn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"val:"</span> + 	$(<span class="string">"#loginName"</span>).val())</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"val:"</span> + 	$(<span class="string">"#password"</span>).val())</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> loginName = $(<span class="string">"#loginName"</span>).val();</span><br><span class="line">	<span class="keyword">var</span> password = $(<span class="string">"#password"</span>).val();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(loginName == <span class="string">''</span> || password == <span class="string">''</span>)&#123;</span><br><span class="line">		$(<span class="string">".tip"</span>).html(<span class="string">"用户名或密码不能为空"</span>)</span><br><span class="line">		</span><br><span class="line">		$(<span class="string">".tip"</span>).css(<span class="string">"display"</span>,<span class="string">"block"</span>)</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">var</span> url = <span class="string">"/account/login"</span>;</span><br><span class="line">		<span class="keyword">var</span> method = &#123;<span class="attr">loginName</span>:loginName,<span class="attr">password</span>:password&#125;;</span><br><span class="line">		$.post(url,method,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">"data:"</span> + <span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(data.code == <span class="number">200</span>)&#123;</span><br><span class="line">				<span class="comment">//登录成功</span></span><br><span class="line">				<span class="built_in">window</span>.location.href = <span class="string">"/index"</span>;</span><br><span class="line">				</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				</span><br><span class="line">				$(<span class="string">".tip"</span>).html(data.msg)</span><br><span class="line">				$(<span class="string">".tip"</span>).css(<span class="string">"display"</span>,<span class="string">"block"</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"提交"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>人力资源管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/css/bootstrap.min.css&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/js/common/jquery.min.js&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/js/bootstrap.min.js&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 页头 开始 ↓ --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default"</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">"#bs-example-navbar-collapse-1"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  人员管理  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"bs-example-navbar-collapse-1"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">         	 人员管理 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          </span><br><span class="line">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Another action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>One more separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!--  系统设置  --&gt;</span></span><br><span class="line">      </span><br><span class="line">       <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>系统设置 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/account/list"</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Another action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>One more separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form navbar-left"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Search"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!--  当前用户 已登录 --&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.account&#125;!=null"</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">          欢迎回来: </span><br><span class="line">          [[$&#123;session.account&#125;==null?'':$&#123;session.account.loginName&#125;]]</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">           <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Another action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/account/logOut"</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!--  当前用户未登录 --&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.account&#125;==null"</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/login"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/register"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.navbar-collapse --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.container-fluid --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 页头 结束 ↑ --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"jumbotron"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>人力资源管理系统<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-lg"</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-lg"</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-lg"</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-lg"</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.springboot.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebFilter</span>(urlPatterns = <span class="string">"/*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		HttpServletRequest req = (HttpServletRequest)request;</span><br><span class="line">		Object attribute = req.getSession().getAttribute(<span class="string">"account"</span>);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		String loginURI = <span class="string">"/login"</span>;</span><br><span class="line">		System.out.println(req.getRequestURI());;</span><br><span class="line">		HttpServletResponse rep = (HttpServletResponse)response;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(req.getRequestURI().equals(loginURI)) &#123;</span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> == attribute ) &#123;</span><br><span class="line">			 </span><br><span class="line">			rep.sendRedirect(<span class="string">"/login"</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			</span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"---init"</span>);</span><br><span class="line">		Filter.<span class="keyword">super</span>.init(filterConfig);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(@RequestParam(required = <span class="keyword">false</span>)</span> String loginName,@<span class="title">RequestParam</span><span class="params">(required = <span class="keyword">false</span>)</span> String password ,</span></span><br><span class="line"><span class="function">		HttpServletRequest request</span></span><br><span class="line"><span class="function">		,Model model) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">boolean</span> canLogin = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">if</span>(StringUtils.isEmpty(loginName) || StringUtils.isEmpty(password)) &#123;</span><br><span class="line">		System.out.println(<span class="string">"111"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	Account account = accSrv.login(loginName,password);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">null</span> != account) &#123;</span><br><span class="line">		System.out.println(<span class="string">"22"</span>);</span><br><span class="line">		request.getSession().setAttribute(<span class="string">"account"</span>, account);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"redirect:list"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	System.out.println(<span class="string">"canLogin:"</span> + canLogin);</span><br><span class="line">	model.addAttribute(<span class="string">"msg"</span>, <span class="string">"请重试"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="用户列表"><a href="#用户列表" class="headerlink" title="用户列表"></a>用户列表</h3><h4 id="html"><a href="#html" class="headerlink" title="html"></a>html</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-hover"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">"id"</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">"loginName"</span>&gt;</span>loginName<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">"nickName"</span>&gt;</span>nickName<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">"age"</span>&gt;</span>age<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">"location"</span>&gt;</span>location<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">"price"</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">"row : $&#123;page.list&#125;"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- EL JSTL--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span> = <span class="string">"$&#123;row.id&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span> = <span class="string">"$&#123;row.loginName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span> = <span class="string">"$&#123;row.nickName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span> = <span class="string">"$&#123;row.age&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span> = <span class="string">"$&#123;row.location&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">td</span> &gt;</span>crud<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">list</span> <span class="params">(@RequestParam(defaultValue = <span class="string">"asc"</span>)</span> String order,@<span class="title">RequestParam</span><span class="params">(defaultValue = <span class="string">"1"</span>)</span><span class="keyword">int</span> offset,@<span class="title">RequestParam</span><span class="params">(defaultValue = <span class="string">"10"</span>)</span><span class="keyword">int</span> limit,Model model) </span>&#123;</span><br><span class="line">	PageInfo&lt;Account&gt; page = accSrv.findAllByPage(offset,limit,order);</span><br><span class="line">	model.addAttribute(<span class="string">"page"</span>, page);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"list"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageInfo&lt;Account&gt; <span class="title">findAllByPage</span><span class="params">(<span class="keyword">int</span> offset, <span class="keyword">int</span> limit, String order)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	PageHelper.startPage(offset, limit);</span><br><span class="line">	</span><br><span class="line">	AccountExample example = <span class="keyword">new</span> AccountExample();</span><br><span class="line">	example.setOrderByClause(<span class="string">"id "</span> + order);</span><br><span class="line">	List&lt;Account&gt; list = mapper.selectByExample(example );</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> PageInfo&lt;Account&gt;(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="JSON相关操作"><a href="#JSON相关操作" class="headerlink" title="JSON相关操作"></a>JSON相关操作</h2><h3 id="对象转字符串"><a href="#对象转字符串" class="headerlink" title="对象转字符串"></a>对象转字符串</h3><p>JSON.stringify(data)</p>
<h3 id="字符串转对象"><a href="#字符串转对象" class="headerlink" title="字符串转对象"></a>字符串转对象</h3><p>JSON.parse(jsonBook);</p>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><h3 id="The-alias-‘GeneratedCriteria’-is-already-mapped-to-the-value"><a href="#The-alias-‘GeneratedCriteria’-is-already-mapped-to-the-value" class="headerlink" title="The alias ‘GeneratedCriteria’ is already mapped to the value"></a>The alias ‘GeneratedCriteria’ is already mapped to the value</h3><p>由<strong>mybatis.type-aliases-package=com.mashibing.springboot.mapper</strong>引起</p>
<p>解决方法：把实体类和Example分开放</p>
<h3 id><a href="#" class="headerlink" title></a></h3><p>本文为本人整理的听课笔记, 稍有修改.<br>自学之用, 不作任何商业用途.如有侵权, 请联系删除</p>
<p>原文引用于如下原创内容 :</p>
<p><a href="https://github.com/bjmashibing/InternetArchitect/tree/master/03%20OA%E8%B4%A6%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/11%20%E4%BC%81%E4%B8%9A%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2%E3%80%81%E6%B5%81%E7%A8%8B%E3%80%81%E4%BB%BB%E5%8A%A1%E5%88%86%E9%85%8D" target="_blank" rel="noopener">Original</a></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>mashibing</tag>
        <tag>ArchetectPre</tag>
      </tags>
  </entry>
  <entry>
    <title>BugsCollection</title>
    <url>/2020/04/15/BugsCollection/</url>
    <content><![CDATA[<p>  This post exclusively is designed to record the problems I’ve encountered when coding, together with how I solved them . </p>
<p>Perhaps, the format needs optimizing, but not now.  Therefore, use this page as a <font color="red">DICTIONARY ONLY</font>. </p>
<a id="more"></a>



<ol>
<li>配置web.xml文件时报错如下, 原因是各标签属性(如过滤器, 监听器等)必须有顺序, 且顺序如下描述. </li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">The content of element type "web-app" must match </span><br><span class="line">"(icon?</span><br><span class="line">,display-name?</span><br><span class="line">,description?</span><br><span class="line">,distributable?</span><br><span class="line">,context-param*</span><br><span class="line">,filter*</span><br><span class="line">,filter-mapping*</span><br><span class="line">,listener*</span><br><span class="line">,servlet*</span><br><span class="line">,servlet-mapping*</span><br><span class="line">,session-config?</span><br><span class="line">,mime-mapping*</span><br><span class="line">,welcome-file-list?</span><br><span class="line">,error-page*</span><br><span class="line">,taglib*</span><br><span class="line">,resource-env-ref*</span><br><span class="line">,resource-ref*</span><br><span class="line">,security-constraint*</span><br><span class="line">,login-config?</span><br><span class="line">,security-role*</span><br><span class="line">,env-entry*</span><br><span class="line">,ejb-ref*</span><br><span class="line">,ejb-local-ref*</span><br><span class="line">)".</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
        <category>Bugs</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Bugs</tag>
      </tags>
  </entry>
  <entry>
    <title>Shiro框架简介</title>
    <url>/2020/04/13/Shiro/</url>
    <content><![CDATA[<p><strong>Apache Shiro™</strong> is a powerful and easy-to-use Java security framework that performs <font color="red">authentication, authorization, cryptography, and session management</font>. With Shiro’s easy-to-understand API, you can quickly and easily secure any application – from the smallest mobile applications to the largest web and enterprise applications.</p>
<a id="more"></a>







<p>Reference: </p>
<p><a href="https://cloud.tencent.com/developer/article/1062698" target="_blank" rel="noopener">腾讯文档:Shiro</a></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>Shiro</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Shiro</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Security OAuth2.0认证授权</title>
    <url>/2020/04/13/Spring-security/</url>
    <content><![CDATA[<p>Spring Security  is</p>
<p>OAuth2.0 is</p>
<a id="more"></a>



<h1 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1.  基本概念"></a>1.  基本概念</h1><h2 id="1-1-什么是认证"><a href="#1-1-什么是认证" class="headerlink" title="1.1 什么是认证"></a>1.1 什么是认证</h2><p>进入移动互联网时代，大家每天都在刷手机，常用的软件有微信、支付宝、头条等，下边拿微信来举例子说明认证 相关的基本概念，在初次使用微信前需要注册成为微信用户，然后输入账号和密码即可登录微信，输入账号和密码 登录微信的过程就是认证。</p>
<p>系统为什么要认证？</p>
<p>认证是为了保护系统的隐私数据与资源，用户的身份合法方可访问该系统的资源。</p>
<p>认证 ：用户认证就是判断一个用户的身份是否合法的过程，用户去访问系统资源时系统要求验证用户的身份信 息，身份合法方可继续访问，不合法则拒绝访问。常见的用户身份认证方式有：用户名密码登录，二维码登录，手 机短信登录，指纹认证等方式。</p>
<h2 id="1-2-什么是会话"><a href="#1-2-什么是会话" class="headerlink" title="1.2 什么是会话"></a>1.2 什么是会话</h2><p>用户认证通过后，为了避免用户的每次操作都进行认证可将用户的信息保证在会话中。会话就是系统为了保持当前 用户的登录状态所提供的机制，常见的有基于session方式、基于token方式等。</p>
<p>基于session的认证方式如下图：</p>
<p><img src="/2020/04/13/Spring-security/session_authentication.png" alt="session认证"></p>
<p>它的交互流程是，用户认证成功后，在服务端生成用户相关的数据保存在session(当前会话)中，发给客户端的 sesssion_id 存放到 cookie 中，这样用户客户端请求时带上 session_id 就可以验证服务器端是否存在 session 数 据，以此完成用户的合法校验，当用户退出系统或session过期销毁时,客户端的session_id也就无效了。</p>
<p>基于token方式如下图：</p>
<p><img src="/2020/04/13/Spring-security/token_authentication.png" alt="token认证"></p>
<p>它的交互流程是，用户认证成功后，服务端生成一个token发给客户端，客户端可以放到 cookie 或 localStorage 等存储中，每次请求时带上 token，服务端收到token通过验证后即可确认用户身份。</p>
<p>基于session的认证方式由Servlet规范定制，服务端要存储session信息需要占用内存资源，客户端需要支持 cookie；基于token的方式则一般不需要服务端存储token，并且不限制客户端的存储方式。如今移动互联网时代 更多类型的客户端需要接入系统，系统多是采用前后端分离的架构进行实现，所以基于token的方式更适合。</p>
<h2 id="1-3-什么是授权"><a href="#1-3-什么是授权" class="headerlink" title="1.3 什么是授权"></a>1.3 什么是授权</h2><p>还拿微信来举例子，微信登录成功后用户即可使用微信的功能，比如，发红包、发朋友圈、添加好友等，没有绑定 银行卡的用户是无法发送红包的，绑定银行卡的用户才可以发红包，发红包功能、发朋友圈功能都是微信的资源即 功能资源，用户拥有发红包功能的权限才可以正常使用发送红包功能，拥有发朋友圈功能的权限才可以使用发朋友 圈功能，这个根据用户的权限来控制用户使用资源的过程就是授权。</p>
<p>为什么要授权？</p>
<p>认证是为了保证用户身份的合法性，授权则是为了更细粒度的对隐私数据进行划分，授权是在认证通过后发生的， 控制不同的用户能够访问不同的资源。</p>
<p>授权： 授权是用户认证通过根据用户的权限来控制用户访问资源的过程，拥有资源的访问权限则正常访问，没有 权限则拒绝访问。</p>
<h2 id="1-4-授权的数据模型"><a href="#1-4-授权的数据模型" class="headerlink" title="1.4 授权的数据模型"></a>1.4 授权的数据模型</h2><p>如何进行授权即如何对用户访问资源进行控制，首先需要学习授权相关的数据模型。</p>
<p>授权可简单理解为Who对What(which)进行How操作，包括如下：</p>
<p>Who，即主体（Subject），主体一般是指用户，也可以是程序，需要访问系统中的资源。 What，即资源 （Resource），如系统菜单、页面、按钮、代码方法、系统商品信息、系统订单信息等。系统菜单、页面、按 钮、代码方法都属于系统功能资源，对于web系统每个功能资源通常对应一个URL；系统商品信息、系统订单信息 都属于实体资源（数据资源），实体资源由资源类型和资源实例组成，比如商品信息为资源类型，商品编号 为001 的商品为资源实例。 How，权限/许可（Permission），规定了用户对资源的操作许可，权限离开资源没有意义， 如用户查询权限、用户添加权限、某个代码方法的调用权限、编号为001的用户的修改权限等，通过权限可知用户 对哪些资源都有哪些操作许可。</p>
<p><font color="red">主体、资源、权限关系如下图：</font></p>
<p><img src="/2020/04/13/Spring-security/entity_resource_access.png" alt="主体_资源_权限关系图 "></p>
<p>主体、资源、权限相关的数据模型如下：</p>
<p>主体（用户id、账号、密码、…）</p>
<p>资源（资源id、资源名称、访问地址、…）</p>
<p>权限（权限id、权限标识、权限名称、资源id、…）</p>
<p>角色（角色id、角色名称、…）</p>
<p>角色和权限关系（角色id、权限id、…） 主体（用户）和角色关系（用户id、角色id、…）</p>
<p>主体（用户）、资源、权限关系如下图：</p>
<p><img src="/2020/04/13/Spring-security/role_resource_access.png" alt="角色_资源_权限关系图 "></p>
<p>通常企业开发中将资源和权限表合并为一张权限表，如下： </p>
<p>资源（资源id、资源名称、访问地址、…）</p>
<p> 权限（权限id、权限标识、权限名称、资源id、…） </p>
<p>合并为： 权限（权限id、权限标识、权限名称、资源名称、资源访问地址、…） </p>
<p>修改后数据模型之间的关系如下图：</p>
<p><img src="/2020/04/13/Spring-security/enterprise_user_role_access_model.png" alt="企业用户角色权限关系图"></p>
<h2 id="1-5-RBAC"><a href="#1-5-RBAC" class="headerlink" title="1.5 RBAC"></a>1.5 RBAC</h2><h3 id="1-5-1-基于角色的访问控制"><a href="#1-5-1-基于角色的访问控制" class="headerlink" title="1.5.1 基于角色的访问控制"></a>1.5.1 基于角色的访问控制</h3><p>RBAC基于角色的访问控制（Role-Based Access Control）是按角色进行授权，比如：主体的角色为总经理可以查</p>
<p>询企业运营报表，查询员工工资信息等，访问控制流程如下：</p>
<p><img src="/2020/04/13/Spring-security/RBAC_logic_flow1.png" alt="基于角色访问控制的流程图"></p>
<p>根据上图中的判断逻辑，授权代码可表示如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(主体.hasRole(<span class="string">"总经理角色id"</span>))&#123;</span><br><span class="line">  	查询工资 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果上图中查询工资所需要的角色变化为总经理和部门经理，此时就需要修改判断逻辑为“判断用户的角色是否是 总经理或部门经理”，修改代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">if</span>(主体.hasRole(<span class="string">"总经理角色id"</span>) || 主体.hasRole(<span class="string">"部门经理角色id"</span>))&#123;</span><br><span class="line">  		查询工资 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据上边的例子发现，当需要修改角色的权限时就需要修改授权的相关代码，系统可扩展性差。</p>
<h3 id="1-5-2-基于资源的访问控制"><a href="#1-5-2-基于资源的访问控制" class="headerlink" title="1.5.2 基于资源的访问控制"></a>1.5.2 基于资源的访问控制</h3><p>RBAC基于资源的访问控制（Resource-Based Access Control）是按资源（或权限）进行授权，比如：用户必须</p>
<p>具有查询工资权限才可以查询员工工资信息等，访问控制流程如下：</p>
<p><img src="/2020/04/13/Spring-security/RBAC_logic_flow2.png" alt="基于资源访问控制的流程图"></p>
<p>根据上图中的判断，授权代码可以表示为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(主体.hasPermission(&quot;查询工资权限标识&quot;))&#123;</span><br><span class="line">		查询工资</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：系统设计时定义好查询工资的权限标识，即使查询工资所需要的角色变化为总经理和部门经理也不需要修改 授权代码，系统可扩展性强。</p>
<h1 id="2-基于session的认证"><a href="#2-基于session的认证" class="headerlink" title="2. 基于session的认证"></a>2. 基于session的认证</h1><h2 id="2-1认证流程"><a href="#2-1认证流程" class="headerlink" title="2.1认证流程"></a>2.1认证流程</h2><p>基于Session认证方式的流程是，用户认证成功后，在服务端生成用户相关的数据保存在session(当前会话)，而发 给客户端的 sesssion_id 存放到 cookie 中，这样用客户端请求时带上 session_id 就可以验证服务器端是否存在 session 数据，以此完成用户的合法校验。当用户退出系统或session过期销毁时,客户端的session_id也就无效了。<br>下图是session认证方式的流程图：<br><img src="/2020/04/13/Spring-security/session_authentication.png" alt="session认证"></p>
<p>基于Session的认证机制由Servlet规范定制，Servlet容器已实现，用户通过HttpSession的操作方法即可实现，如 下是HttpSession相关的操作API。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>HttpSession getSession(Boolean create)</td>
<td>获取当前HttpSession对象</td>
</tr>
<tr>
<td>void setAttribute(String name,Object value)</td>
<td>向session中存放对象</td>
</tr>
<tr>
<td>object getAttribute(String name)</td>
<td>从session中获取对象</td>
</tr>
<tr>
<td>void removeAttribute(String name);</td>
<td>移除session中对象</td>
</tr>
<tr>
<td>void invalidate()</td>
<td>使HttpSession失效</td>
</tr>
<tr>
<td>…</td>
<td></td>
</tr>
</tbody></table>
<h2 id="2-2-创建工程"><a href="#2-2-创建工程" class="headerlink" title="2.2 创建工程"></a>2.2 创建工程</h2><p>本案例工程使用maven进行构建，使用SpringMVC、Servlet3.0实现。</p>
<h3 id="2-2-1-创建maven工程"><a href="#2-2-1-创建maven工程" class="headerlink" title="2.2.1 创建maven工程"></a>2.2.1 创建maven工程</h3><p>创建maven工程 security-springmvc，工程结构如下：</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>Spring-security</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring-security</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-02</title>
    <url>/2020/04/10/JVM-02/</url>
    <content><![CDATA[<p>JVM is </p>
<a id="more"></a>





<h1 id="一、ClassLoader"><a href="#一、ClassLoader" class="headerlink" title="一、ClassLoader"></a><strong>一、</strong>ClassLoader</h1><h2 id="3：类加载-初始化"><a href="#3：类加载-初始化" class="headerlink" title="3：类加载-初始化"></a>3：类加载-初始化</h2><ol>
<li><p>加载过程</p>
<ol>
<li><p>Loading</p>
<ol>
<li><p>双亲委派，主要出于安全来考虑(如: 用户密码), 也有其他原因, 比如效率(但是次要)</p>
<p><img src="/2020/04/10/JVM-02/parent_delegate_mechanism.png" alt="双亲委派机制"></p>
</li>
<li><p>LazyLoading 五种情况</p>
<ol>
<li><p>–new getstatic putstatic invokestatic指令，访问final变量除外</p>
<p>–java.lang.reflect对类进行反射调用时</p>
<p>–初始化子类的时候，父类首先初始化</p>
<p>–虚拟机启动时，被执行的主类必须初始化</p>
<p>–动态语言支持java.lang.invoke.MethodHandle解析的结果为REF_getstatic REF_putstatic REF_invokestatic的方法句柄时，该类必须初始化</p>
</li>
</ol>
</li>
<li><p>ClassLoader的源码</p>
<ol>
<li>findInCache -&gt; parent.loadClass -&gt; findClass()</li>
</ol>
</li>
<li><p>自定义类加载器</p>
<ol>
<li>extends ClassLoader</li>
<li>overwrite findClass() -&gt; defineClass(byte[] -&gt; Class clazz)</li>
<li>加密</li>
<li><font color="red">第一节课遗留问题：parent是如何指定的，打破双亲委派，学生问题桌面图片</font><ol>
<li>用super(parent)指定</li>
<li>双亲委派的打破<ol>
<li>如何打破：重写loadClass（）</li>
<li>何时打破过？<ol>
<li>JDK1.2之前，自定义ClassLoader都必须重写loadClass()</li>
<li>ThreadContextClassLoader可以实现基础类调用实现类代码，通过thread.setContextClassLoader指定</li>
<li>热启动，热部署<ol>
<li>osgi tomcat 都有自己的模块指定classloader（可以加载同一类库的不同版本）</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p>混合执行 编译执行 解释执行</p>
<ol>
<li>检测热点代码：-XX:CompileThreshold = 10000</li>
</ol>
</li>
</ol>
</li>
<li><p>Linking </p>
<ol>
<li>Verification<ol>
<li>验证文件是否符合JVM规定</li>
</ol>
</li>
<li>Preparation<ol>
<li>静态成员变量赋默认值</li>
</ol>
</li>
<li>Resolution<ol>
<li>将类、方法、属性等符号引用解析为直接引用<br>常量池中的各种符号引用解析为指针、偏移量等内存地址的直接引用</li>
</ol>
</li>
</ol>
</li>
<li><p>Initializing</p>
<ol>
<li>调用类初始化代码 <clinit>，给静态成员变量赋初始值</clinit></li>
</ol>
</li>
</ol>
</li>
<li><p>小总结：</p>
<ol>
<li>load - 默认值 - 初始值</li>
<li>new - 申请内存 - 默认值 - 初始值</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>Springboot_03 整合消息队列-高级</title>
    <url>/2020/03/03/springboot-03/</url>
    <content><![CDATA[<p>大多数应用中, 可通过引入消息中间件来提升系统异步通信,扩展系统解耦能力.<br>消息代理(broker):<br>消息目的地(destination):<br>当消息发送者发送消息后, 将由消息代理接管,消息代理保证消息传递到指定的目的地.</p>
<a id="more"></a>


]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Python爬虫教程_01</title>
    <url>/2020/02/24/python-crawler/</url>
    <content><![CDATA[<p>简单介绍Curl &amp; wget 命令行工具的使用. 参数使用说明具体可以参考curl –help / man curl.</p>
<p>[curl官网] (<a href="https://curl.haxx.se/" target="_blank" rel="noopener">https://curl.haxx.se/</a>)<br>[wget官网] (<a href="http://www.gnu.org/software/wget/" target="_blank" rel="noopener">http://www.gnu.org/software/wget/</a>)</p>
<a id="more"></a>





<h2 id="curl的使用"><a href="#curl的使用" class="headerlink" title="curl的使用"></a>curl的使用</h2><p>注意：安装的时候可能会遇到报错，有可能是openssl没装，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install curl</span><br><span class="line">apt install openssl</span><br><span class="line">apt install openssl-dev</span><br></pre></td></tr></table></figure>

<p>一些常用参数的用法</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>-A</td>
<td>设置user-agent</td>
<td>curl -A “Chrome” <a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a></td>
</tr>
<tr>
<td>-X</td>
<td>用指定方法请求</td>
<td>curl -X POST <a href="http://httpbin.org/post" target="_blank" rel="noopener">http://httpbin.org/post</a></td>
</tr>
<tr>
<td>-I</td>
<td>只返回请求的头信息</td>
<td></td>
</tr>
<tr>
<td>-d</td>
<td>以POST方法请求url，并发送相应的参数</td>
<td>-d a=1 -d b=2 -d c=3<br>-d “a=1&amp;b=2&amp;c=3”<br>-d @filename</td>
</tr>
<tr>
<td>-O</td>
<td>下载文件并以远程的文件名保存</td>
<td></td>
</tr>
<tr>
<td>-o</td>
<td>下载文件并以指定的文件名保存</td>
<td>curl -o fox.jpeg <a href="http://httpbin.org/image/jpeg" target="_blank" rel="noopener">http://httpbin.org/image/jpeg</a></td>
</tr>
<tr>
<td>-L</td>
<td>跟随重定向请求</td>
<td>curl -IL <a href="https://baidu.com" target="_blank" rel="noopener">https://baidu.com</a></td>
</tr>
<tr>
<td>-H</td>
<td>设置头信息</td>
<td>curl -o image.webp -H “accept:image/webp” <a href="http://httpbin.org/image" target="_blank" rel="noopener">http://httpbin.org/image</a></td>
</tr>
<tr>
<td>-k</td>
<td>允许发起不安全的SSL请求</td>
<td></td>
</tr>
<tr>
<td>-b</td>
<td>设置cookies</td>
<td>curl -b a=test <a href="http://httpbin.org/cookies" target="_blank" rel="noopener">http://httpbin.org/cookies</a></td>
</tr>
<tr>
<td>-s</td>
<td>不显示其他无关信息</td>
<td></td>
</tr>
<tr>
<td>-v</td>
<td>显示连接过程中的所有信息</td>
<td></td>
</tr>
</tbody></table>
<p>自定义一个命令，查看本机外网IP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alias myip&#x3D;&quot;curl http:&#x2F;&#x2F;httpbin.org&#x2F;get|grep -E &#39;\d+&#39;|grep -v User-Agent|cut -d &#39;\&quot;&#39; -f4&quot;</span><br></pre></td></tr></table></figure>

<h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p>安装：</p>
<figure class="highlight plain"><figcaption><span>install wget```</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">参数说明</span><br><span class="line"></span><br><span class="line">| A            | B                            | C                                             |</span><br><span class="line">| ------------ | ---------------------------- | --------------------------------------------- |</span><br><span class="line">| -O           | 以指定文件名保存下载的文件   | wget -O test.png http:&#x2F;&#x2F;httpbin.org&#x2F;image&#x2F;png |</span><br><span class="line">| --limit-rate | 以指定的速度下载目标文件     | --limit-rate&#x3D;200k                             |</span><br><span class="line">| -c           | 断点续传                     |                                               |</span><br><span class="line">| -b           | 后台下载                     |                                               |</span><br><span class="line">| -U           | 设置User-Agent               |                                               |</span><br><span class="line">| --mirror     | 镜像某个目标网站             |                                               |</span><br><span class="line">| -p           | 下载页面中的所有相关资源     |                                               |</span><br><span class="line">| -r           | 递归下载所有网页中所有的链接 |                                               |</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line"># 镜像下载整个网站并保存到本地</span><br><span class="line">wget -c --mirror -U &quot;Mozilla&quot; -p --convert-links http:&#x2F;&#x2F;docs.python-requests.org</span><br></pre></td></tr></table></figure>

<h2 id="httpie"><a href="#httpie" class="headerlink" title="httpie"></a>httpie</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install httpie</span><br><span class="line">pip install httpie</span><br></pre></td></tr></table></figure>




























]]></content>
      <categories>
        <category>Python</category>
        <category>Crawler</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Crawler</tag>
      </tags>
  </entry>
  <entry>
    <title>Springboot_02-整合缓存(Redis)-高级</title>
    <url>/2020/02/15/springboot-02/</url>
    <content><![CDATA[<p>Please stay tuned. Great show will be Contenued in 5 mins.</p>
<a id="more"></a>


<p><img src="/2020/02/15/springboot-02/mypic.png" alt="图片"></p>
]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Boot Part.1  简介与入门</title>
    <url>/2020/02/14/springboot-01/</url>
    <content><![CDATA[<p>Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications that you can “just run”.</p>
<p>We take an opinionated view of the Spring platform and third-party libraries so you can get started with minimum fuss. Most Spring Boot applications need very little Spring configuration.</p>
<a id="more"></a>



<h1 id="一、Spring-Boot-入门"><a href="#一、Spring-Boot-入门" class="headerlink" title="一、Spring Boot 入门"></a><strong>一、</strong>Spring Boot 入门</h1><h2 id="1、Spring-Boot-简介"><a href="#1、Spring-Boot-简介" class="headerlink" title="1、Spring Boot 简介"></a>1、Spring Boot 简介</h2><p><a href="https://spring.io/projects/spring-boot/" target="_blank" rel="noopener">Official</a></p>
<p><a href="https://github.com/spring-projects/spring-boot" target="_blank" rel="noopener">github</a></p>
<blockquote>
<p>简化Spring应用开发的一个框架；</p>
<p>整个Spring技术栈的一个大整合；</p>
<p>J2EE开发的一站式解决方案；</p>
</blockquote>
<h2 id="2、微服务"><a href="#2、微服务" class="headerlink" title="2、微服务"></a>2、微服务</h2><p>2014，martin fowler</p>
<p>微服务：架构风格（服务微化）</p>
<p>一个应用应该是一组小型服务；可以通过HTTP的方式进行互通；</p>
<p>单体应用：ALL IN ONE</p>
<p>微服务：每一个功能元素最终都是一个可独立替换和独立升级的软件单元；</p>
<p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa" target="_blank" rel="noopener">微服务 martin fowler</a></p>
<h2 id="3、环境准备"><a href="#3、环境准备" class="headerlink" title="3、环境准备"></a>3、环境准备</h2><p><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener">谷粒学院</a> </p>
<p>环境约束</p>
<p>–jdk1.8：Spring Boot 推荐jdk1.7及以上；java version “1.8.0_112”</p>
<p>–maven3.x：maven 3.3以上版本；Apache Maven 3.3.9</p>
<p>–IntelliJIDEA2017：IntelliJ IDEA 2017.2.2 x64、STS</p>
<p>–SpringBoot 1.5.9.RELEASE：1.5.9；</p>
<p>统一环境；</p>
<h3 id="1、MAVEN设置；"><a href="#1、MAVEN设置；" class="headerlink" title="1、MAVEN设置；"></a>1、MAVEN设置；</h3><p>给maven 的settings.xml配置文件的profiles标签添加</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2、IDEA设置"><a href="#2、IDEA设置" class="headerlink" title="2、IDEA设置"></a>2、IDEA设置</h3><p>整合maven进来；</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151045.png" alt="idea设置"></p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151112.png" alt="images/"></p>
<h2 id="4、Spring-Boot-HelloWorld"><a href="#4、Spring-Boot-HelloWorld" class="headerlink" title="4、Spring Boot HelloWorld"></a>4、Spring Boot HelloWorld</h2><p>一个功能：</p>
<p>浏览器发送hello请求，服务器接受请求并处理，响应Hello World字符串；</p>
<h3 id="1、创建一个maven工程；（jar）"><a href="#1、创建一个maven工程；（jar）" class="headerlink" title="1、创建一个maven工程；（jar）"></a>1、创建一个maven工程；（jar）</h3><h3 id="2、导入spring-boot相关的依赖"><a href="#2、导入spring-boot相关的依赖" class="headerlink" title="2、导入spring boot相关的依赖"></a>2、导入spring boot相关的依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、编写一个主程序；启动Spring-Boot应用"><a href="#3、编写一个主程序；启动Spring-Boot应用" class="headerlink" title="3、编写一个主程序；启动Spring Boot应用"></a>3、编写一个主程序；启动Spring Boot应用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldMainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、编写相关的Controller、Service"><a href="#4、编写相关的Controller、Service" class="headerlink" title="4、编写相关的Controller、Service"></a>4、编写相关的Controller、Service</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5、运行主程序测试"><a href="#5、运行主程序测试" class="headerlink" title="5、运行主程序测试"></a>5、运行主程序测试</h3><h3 id="6、简化部署"><a href="#6、简化部署" class="headerlink" title="6、简化部署"></a>6、简化部署</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个插件，可以将应用打包成一个可执行的jar包；--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将这个应用打成jar包，直接使用java -jar的命令进行执行；</p>
<h2 id="5、Hello-World探究"><a href="#5、Hello-World探究" class="headerlink" title="5、Hello World探究"></a>5、Hello World探究</h2><h3 id="1、POM文件"><a href="#1、POM文件" class="headerlink" title="1、POM文件"></a>1、POM文件</h3><h4 id="1、父项目"><a href="#1、父项目" class="headerlink" title="1、父项目"></a>1、父项目</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">他的父项目是</span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">他来真正管理Spring Boot应用里面的所有依赖版本；</span><br></pre></td></tr></table></figure>

<p>Spring Boot的版本仲裁中心；</p>
<p>以后我们导入依赖默认是不需要写版本；（没有在dependencies里面管理的依赖自然需要声明版本号）</p>
<h4 id="2、启动器"><a href="#2、启动器" class="headerlink" title="2、启动器"></a>2、启动器</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>spring-boot-starter</strong>-==web==：</p>
<p> spring-boot-starter：spring-boot场景启动器；帮我们导入了web模块正常运行所依赖的组件；</p>
<p>Spring Boot将所有的功能场景都抽取出来，做成一个个的starters（启动器），只需要在项目里面引入这些starter相关场景的所有依赖都会导入进来。要用什么功能就导入什么场景的启动器</p>
<h3 id="2、主程序类，主入口类"><a href="#2、主程序类，主入口类" class="headerlink" title="2、主程序类，主入口类"></a>2、主程序类，主入口类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldMainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@<strong>SpringBootApplication</strong>:    Spring Boot应用标注在某个类上说明这个类是SpringBoot的主配置类，SpringBoot就应该运行这个类的main方法来启动SpringBoot应用；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(excludeFilters = &#123;</span><br><span class="line">      <span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line"><span class="class">      @<span class="title">Filter</span>(<span class="title">type</span> </span>= FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter<span class="class">.<span class="keyword">class</span>) &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>@<strong>SpringBootConfiguration</strong>:Spring Boot的配置类；</p>
<p>   标注在某个类上，表示这是一个Spring Boot的配置类；</p>
<p>   @<strong>Configuration</strong>:配置类上来标注这个注解；</p>
<p>​     配置类 —–  配置文件；配置类也是容器中的一个组件；@Component</p>
<p>@<strong>EnableAutoConfiguration</strong>：开启自动配置功能；</p>
<p>   以前我们需要配置的东西，Spring Boot帮我们自动配置；@<strong>EnableAutoConfiguration</strong>告诉SpringBoot开启自动配置功能；这样自动配置才能生效；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import</span>(EnableAutoConfigurationImportSelector<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">EnableAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>​       @<strong>AutoConfigurationPackage</strong>：自动配置包</p>
<p>   @<strong>Import</strong>(AutoConfigurationPackages.Registrar.class)：</p>
<p>   Spring的底层注解@Import，给容器中导入一个组件；导入的组件由AutoConfigurationPackages.Registrar.class；</p>
<p>==将主配置类（@SpringBootApplication标注的类）的所在包及下面所有子包里面的所有组件扫描到Spring容器；==</p>
<p> @<strong>Import</strong>(EnableAutoConfigurationImportSelector.class)；</p>
<p>   给容器中导入组件？</p>
<p>   <strong>EnableAutoConfigurationImportSelector</strong>：导入哪些组件的选择器；</p>
<p>   将所有需要导入的组件以全类名的方式返回；这些组件就会被添加到容器中；</p>
<p>   会给容器中导入非常多的自动配置类（xxxAutoConfiguration）；就是给容器中导入这个场景需要的所有组件，并配置好这些组件；    <img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129224104.png" alt="自动配置类"></p>
<p>有了自动配置类，免去了我们手动编写配置注入功能组件等的工作；</p>
<p>   SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class,classLoader)；</p>
<p>==Spring Boot在启动的时候从类路径下的META-INF/spring.factories中获取EnableAutoConfiguration指定的值，将这些值作为自动配置类导入到容器中，自动配置类就生效，帮我们进行自动配置工作；==以前我们需要自己配置的东西，自动配置类都帮我们；</p>
<p>J2EE的整体整合解决方案和自动配置都在spring-boot-autoconfigure-1.5.9.RELEASE.jar；</p>
<p>==Spring注解版（谷粒学院）==</p>
<h2 id="6、使用Spring-Initializer快速创建Spring-Boot项目"><a href="#6、使用Spring-Initializer快速创建Spring-Boot项目" class="headerlink" title="6、使用Spring Initializer快速创建Spring Boot项目"></a>6、使用Spring Initializer快速创建Spring Boot项目</h2><h3 id="1、IDEA：使用-Spring-Initializer快速创建项目"><a href="#1、IDEA：使用-Spring-Initializer快速创建项目" class="headerlink" title="1、IDEA：使用 Spring Initializer快速创建项目"></a>1、IDEA：使用 Spring Initializer快速创建项目</h3><p>IDE都支持使用Spring的项目创建向导快速创建一个Spring Boot项目；</p>
<p>选择我们需要的模块；向导会联网创建Spring Boot项目；</p>
<p>默认生成的Spring Boot项目；</p>
<ul>
<li>主程序已经生成好了，我们只需要我们自己的逻辑</li>
<li>resources文件夹中目录结构<ul>
<li>static：保存所有的静态资源； js css  images；</li>
<li>templates：保存所有的模板页面；（Spring Boot默认jar包使用嵌入式的Tomcat，默认不支持JSP页面）；可以使用模板引擎（freemarker、thymeleaf）；</li>
<li>application.properties：Spring Boot应用的配置文件；可以修改一些默认设置；</li>
</ul>
</li>
</ul>
<h3 id="2、STS使用-Spring-Starter-Project快速创建项目"><a href="#2、STS使用-Spring-Starter-Project快速创建项目" class="headerlink" title="2、STS使用 Spring Starter Project快速创建项目"></a>2、STS使用 Spring Starter Project快速创建项目</h3><hr>
<h1 id="二、配置文件"><a href="#二、配置文件" class="headerlink" title="二、配置文件"></a>二、配置文件</h1><h2 id="1、配置文件"><a href="#1、配置文件" class="headerlink" title="1、配置文件"></a>1、配置文件</h2><p>SpringBoot使用一个全局的配置文件，配置文件名是固定的；</p>
<p>•application.properties</p>
<p>•application.yml</p>
<p>配置文件的作用：修改SpringBoot自动配置的默认值；SpringBoot在底层都给我们自动配置好；</p>
<p>YAML（YAML Ain’t Markup Language）</p>
<p> YAML  A Markup Language：是一个标记语言</p>
<p> YAML   isn’t Markup Language：不是一个标记语言；</p>
<p>标记语言：</p>
<p> 以前的配置文件；大多都使用的是  <strong>xxxx.xml</strong>文件；</p>
<p> YAML：<strong>以数据为中心</strong>，比json、xml等更适合做配置文件；</p>
<p> YAML：配置例子</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>

<p> XML：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="2、YAML语法："><a href="#2、YAML语法：" class="headerlink" title="2、YAML语法："></a>2、YAML语法：</h2><h3 id="1、基本语法"><a href="#1、基本语法" class="headerlink" title="1、基本语法"></a>1、基本语法</h3><p>k:(空格)v：表示一对键值对（空格必须有）；</p>
<p>以<strong>空格</strong>的缩进来控制层级关系；只要是左对齐的一列数据，都是同一个层级的</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></table></figure>

<p>属性和值也是大小写敏感；</p>
<h3 id="2、值的写法"><a href="#2、值的写法" class="headerlink" title="2、值的写法"></a>2、值的写法</h3><h4 id="字面量：普通的值（数字，字符串，布尔）"><a href="#字面量：普通的值（数字，字符串，布尔）" class="headerlink" title="字面量：普通的值（数字，字符串，布尔）"></a>字面量：普通的值（数字，字符串，布尔）</h4><p> k: v：字面直接来写；</p>
<p>   字符串默认不用加上单引号或者双引号；</p>
<p>   “”：双引号；不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思</p>
<p>​       name:   “zhangsan \n lisi”：输出；zhangsan 换行  lisi</p>
<p>   ‘’：单引号；会转义特殊字符，特殊字符最终只是一个普通的字符串数据</p>
<p>​       name:   ‘zhangsan \n lisi’：输出；zhangsan \n  lisi</p>
<h4 id="对象、Map（属性和值）（键值对）："><a href="#对象、Map（属性和值）（键值对）：" class="headerlink" title="对象、Map（属性和值）（键值对）："></a>对象、Map（属性和值）（键值对）：</h4><p> k: v：在下一行来写对象的属性和值的关系；注意缩进</p>
<p>   对象还是k: v的方式</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">zhangsan</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>行内写法：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">friends:</span> <span class="string">&#123;lastName:</span> <span class="string">zhangsan,age:</span> <span class="number">18</span><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="数组（List、Set）："><a href="#数组（List、Set）：" class="headerlink" title="数组（List、Set）："></a>数组（List、Set）：</h4><p>用- 值表示数组中的一个元素</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></table></figure>

<p>行内写法</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">pets:</span> <span class="string">[cat,dog,pig]</span></span><br></pre></td></tr></table></figure>



<h2 id="3、配置文件值注入"><a href="#3、配置文件值注入" class="headerlink" title="3、配置文件值注入"></a>3、配置文件值注入</h2><p>配置文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">birth:</span> <span class="number">2017</span><span class="string">/12/12</span></span><br><span class="line">    <span class="attr">maps:</span> <span class="string">&#123;k1:</span> <span class="string">v1,k2:</span> <span class="number">12</span><span class="string">&#125;</span></span><br><span class="line">    <span class="attr">lists:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">lisi</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zhaoliu</span></span><br><span class="line">    <span class="attr">dog:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">小狗</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>javaBean：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = "person"：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure>



<p>我们可以导入配置文件处理器，以后编写配置就有提示了</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入配置文件处理器，配置文件进行绑定就会有提示--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1、properties配置文件在idea中默认utf-8可能会乱码"><a href="#1、properties配置文件在idea中默认utf-8可能会乱码" class="headerlink" title="1、properties配置文件在idea中默认utf-8可能会乱码"></a>1、properties配置文件在idea中默认utf-8可能会乱码</h4><p>调整</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180130161620.png" alt="idea配置乱码"></p>
<h4 id="2、-Value获取值和-ConfigurationProperties获取值比较"><a href="#2、-Value获取值和-ConfigurationProperties获取值比较" class="headerlink" title="2、@Value获取值和@ConfigurationProperties获取值比较"></a>2、@Value获取值和@ConfigurationProperties获取值比较</h4><table>
<thead>
<tr>
<th></th>
<th>@ConfigurationProperties</th>
<th>@Value</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>批量注入配置文件中的属性</td>
<td>一个个指定</td>
</tr>
<tr>
<td>松散绑定（松散语法）</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>SpEL</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>JSR303数据校验</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>复杂类型封装</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<p>配置文件yml还是properties他们都能获取到值；</p>
<p>如果说，我们只是在某个业务逻辑中需要获取一下配置文件中的某项值，使用@Value；</p>
<p>如果说，我们专门编写了一个javaBean来和配置文件进行映射，我们就直接使用@ConfigurationProperties；</p>
<h4 id="3、配置文件注入值数据校验"><a href="#3、配置文件注入值数据校验" class="headerlink" title="3、配置文件注入值数据校验"></a>3、配置文件注入值数据校验</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="字面量/$&#123;key&#125;从环境变量、配置文件中获取值/#&#123;SpEL&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="comment">//@Value("$&#123;person.last-name&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#&#123;11*2&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure>



<h4 id="4、-PropertySource-amp-ImportResource-amp-Bean"><a href="#4、-PropertySource-amp-ImportResource-amp-Bean" class="headerlink" title="4、@PropertySource&amp;@ImportResource&amp;@Bean"></a>4、@PropertySource&amp;@ImportResource&amp;@Bean</h4><p>@<strong>PropertySource</strong>：加载指定的配置文件；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = "person"：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@ConfigurationProperties</span>(prefix = "person")默认从全局配置文件中获取值；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PropertySource</span>(value = &#123;<span class="string">"classpath:person.properties"</span>&#125;)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="comment">//@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="字面量/$&#123;key&#125;从环境变量、配置文件中获取值/#&#123;SpEL&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">   <span class="comment">// @Email</span></span><br><span class="line">    <span class="comment">//@Value("$&#123;person.last-name&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#&#123;11*2&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br></pre></td></tr></table></figure>



<p>@<strong>ImportResource</strong>：导入Spring的配置文件，让配置文件里面的内容生效；</p>
<p>Spring Boot里面没有Spring的配置文件，我们自己编写的配置文件，也不能自动识别；</p>
<p>想让Spring的配置文件生效，加载进来；@<strong>ImportResource</strong>标注在一个配置类上</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ImportResource</span>(locations = &#123;<span class="string">"classpath:beans.xml"</span>&#125;)</span><br><span class="line">导入Spring的配置文件让其生效</span><br></pre></td></tr></table></figure>



<p>不来编写Spring的配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.springboot.service.HelloService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>SpringBoot推荐给容器中添加组件的方式；推荐使用全注解的方式</p>
<p>1、配置类<strong>@Configuration</strong>——&gt;Spring配置文件</p>
<p>2、使用<strong>@Bean</strong>给容器中添加组件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>：指明当前类是一个配置类；就是来替代之前的Spring配置文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在配置文件中用&lt;bean&gt;&lt;bean/&gt;标签添加组件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将方法的返回值添加到容器中；容器中这个组件默认的id就是方法名</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"配置类@Bean给容器中添加组件了..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>##4、配置文件占位符</p>
<h3 id="1、随机数"><a href="#1、随机数" class="headerlink" title="1、随机数"></a>1、随机数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$&#123;random.value&#125;、$&#123;random.<span class="keyword">int</span>&#125;、$&#123;random.<span class="keyword">long</span>&#125;</span><br><span class="line">$&#123;random.<span class="keyword">int</span>(<span class="number">10</span>)&#125;、$&#123;random.<span class="keyword">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2、占位符获取之前配置的值，如果没有可以是用-指定默认值"><a href="#2、占位符获取之前配置的值，如果没有可以是用-指定默认值" class="headerlink" title="2、占位符获取之前配置的值，如果没有可以是用:指定默认值"></a>2、占位符获取之前配置的值，如果没有可以是用:指定默认值</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">person.last-name</span>=<span class="string">张三$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="meta">person.age</span>=<span class="string">$&#123;random.int&#125;</span></span><br><span class="line"><span class="meta">person.birth</span>=<span class="string">2017/12/15</span></span><br><span class="line"><span class="meta">person.boss</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">person.maps.k1</span>=<span class="string">v1</span></span><br><span class="line"><span class="meta">person.maps.k2</span>=<span class="string">14</span></span><br><span class="line"><span class="meta">person.lists</span>=<span class="string">a,b,c</span></span><br><span class="line"><span class="meta">person.dog.name</span>=<span class="string">$&#123;person.hello:hello&#125;_dog</span></span><br><span class="line"><span class="meta">person.dog.age</span>=<span class="string">15</span></span><br></pre></td></tr></table></figure>



<h2 id="5、Profile"><a href="#5、Profile" class="headerlink" title="5、Profile"></a>5、Profile</h2><h3 id="1、多Profile文件"><a href="#1、多Profile文件" class="headerlink" title="1、多Profile文件"></a>1、多Profile文件</h3><p>我们在主配置文件编写的时候，文件名可以是   application-{profile}.properties/yml</p>
<p>默认使用application.properties的配置；</p>
<h3 id="2、yml支持多文档块方式"><a href="#2、yml支持多文档块方式" class="headerlink" title="2、yml支持多文档块方式"></a>2、yml支持多文档块方式</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#指定属于哪个环境</span></span><br></pre></td></tr></table></figure>





<h3 id="3、激活指定profile"><a href="#3、激活指定profile" class="headerlink" title="3、激活指定profile"></a>3、激活指定profile</h3><p> 1、在配置文件中指定  spring.profiles.active=dev</p>
<p> 2、命令行：</p>
<p>   java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar –spring.profiles.active=dev；</p>
<p>   可以直接在测试的时候，配置传入命令行参数</p>
<p> 3、虚拟机参数；</p>
<p>   -Dspring.profiles.active=dev</p>
<h2 id="6、配置文件加载位置"><a href="#6、配置文件加载位置" class="headerlink" title="6、配置文件加载位置"></a>6、配置文件加载位置</h2><p>springboot 启动会扫描以下位置的application.properties或者application.yml文件作为Spring boot的默认配置文件</p>
<p>–file:./config/</p>
<p>–file:./</p>
<p>–classpath:/config/</p>
<p>–classpath:/</p>
<p>优先级由高到底，高优先级的配置会覆盖低优先级的配置；</p>
<p>SpringBoot会从这四个位置全部加载主配置文件；<strong>互补配置</strong>；</p>
<p>==我们还可以通过spring.config.location来改变默认的配置文件位置==</p>
<p><strong>项目打包好以后，我们可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置；指定配置文件和默认加载的这些配置文件共同起作用形成互补配置；</strong></p>
<p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar –spring.config.location=G:/application.properties</p>
<h2 id="7、外部配置加载顺序"><a href="#7、外部配置加载顺序" class="headerlink" title="7、外部配置加载顺序"></a>7、外部配置加载顺序</h2><p><strong>==SpringBoot也可以从以下位置加载配置； 优先级从高到低；高优先级的配置覆盖低优先级的配置，所有的配置会形成互补配置==</strong></p>
<p><strong>1.命令行参数</strong></p>
<p>所有的配置都可以在命令行上进行指定</p>
<p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar –server.port=8087  –server.context-path=/abc</p>
<p>多个配置用空格分开； –配置项=值</p>
<p>2.来自java:comp/env的JNDI属性</p>
<p>3.Java系统属性（System.getProperties()）</p>
<p>4.操作系统环境变量</p>
<p>5.RandomValuePropertySource配置的random.*属性值</p>
<p>==<strong>由jar包外向jar包内进行寻找；</strong>==</p>
<p>==<strong>优先加载带profile</strong>==</p>
<p><strong>6.jar包外部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p>
<p><strong>7.jar包内部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p>
<p>==<strong>再来加载不带profile</strong>==</p>
<p><strong>8.jar包外部的application.properties或application.yml(不带spring.profile)配置文件</strong></p>
<p><strong>9.jar包内部的application.properties或application.yml(不带spring.profile)配置文件</strong></p>
<p>10.@Configuration注解类上的@PropertySource</p>
<p>11.通过SpringApplication.setDefaultProperties指定的默认属性</p>
<p>所有支持的配置加载来源；</p>
<p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config" target="_blank" rel="noopener">参考官方文档</a></p>
<h2 id="8、自动配置原理"><a href="#8、自动配置原理" class="headerlink" title="8、自动配置原理"></a>8、自动配置原理</h2><p>配置文件到底能写什么？怎么写？自动配置原理；</p>
<p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties" target="_blank" rel="noopener">配置文件能配置的属性参照</a></p>
<h3 id="1、自动配置原理："><a href="#1、自动配置原理：" class="headerlink" title="1、自动配置原理："></a>1、<strong>自动配置原理：</strong></h3><p>1）、SpringBoot启动的时候加载主配置类，开启了自动配置功能 ==@EnableAutoConfiguration==</p>
<p><strong>2）、@EnableAutoConfiguration 作用：</strong></p>
<ul>
<li>利用EnableAutoConfigurationImportSelector给容器中导入一些组件？</li>
</ul>
<ul>
<li><p>可以查看selectImports()方法的内容；</p>
</li>
<li><p>List<String> configurations = getCandidateConfigurations(annotationMetadata,      attributes);获取候选的配置</String></p>
<ul>
<li><pre><code class="java">SpringFactoriesLoader.loadFactoryNames()
扫描所有jar包类路径下  META-INF/spring.factories
把扫描到的这些文件的内容包装成properties对象
从properties中获取到EnableAutoConfiguration<span class="class">.<span class="keyword">class</span>类（类名）对应的值，然后把他们添加在容器中</span>
<span class="class"></span>
<span class="class"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">**&#x3D;&#x3D;将 类路径下  META-INF&#x2F;spring.factories 里面配置的所有EnableAutoConfiguration的值加入到了容器中；&#x3D;&#x3D;**</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;properties</span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceDelegatingViewResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.SitePreferenceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.reactor.ReactorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityFilterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.FallbackWebSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.OAuth2AutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.SocialWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.FacebookAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.LinkedInAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.TwitterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.EmbeddedServletContainerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpEncodingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpMessageConvertersAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.MultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ServerPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span><br></pre></td></tr></table></figure></span>
<span class="class"></span></code></pre>
</li>
</ul>
</li>
</ul>
<p>每一个这样的  xxxAutoConfiguration类都是容器中的一个组件，都加入到容器中；用他们来做自动配置；</p>
<p>3）、每一个自动配置类进行自动配置功能；</p>
<p>4）、以<strong>HttpEncodingAutoConfiguration（Http编码自动配置）</strong>为例解释自动配置原理；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//表示这是一个配置类，以前编写的配置文件一样，也可以给容器中添加组件</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(HttpEncodingProperties<span class="class">.<span class="keyword">class</span>)  //启动指定类的<span class="title">ConfigurationProperties</span>功能；将配置文件中对应的值和<span class="title">HttpEncodingProperties</span>绑定起来；并把<span class="title">HttpEncodingProperties</span>加入到<span class="title">ioc</span>容器中</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnWebApplication</span> //<span class="title">Spring</span>底层@<span class="title">Conditional</span>注解（<span class="title">Spring</span>注解版），根据不同的条件，如果满足指定的条件，整个配置类里面的配置就会生效；    判断当前应用是否是<span class="title">web</span>应用，如果是，当前配置类生效</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnClass</span>(<span class="title">CharacterEncodingFilter</span>.<span class="title">class</span>)  //判断当前项目有没有这个类<span class="title">CharacterEncodingFilter</span>；<span class="title">SpringMVC</span>中进行乱码解决的过滤器；</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(<span class="title">prefix</span> </span>= <span class="string">"spring.http.encoding"</span>, value = <span class="string">"enabled"</span>, matchIfMissing = <span class="keyword">true</span>)  <span class="comment">//判断配置文件中是否存在某个配置  spring.http.encoding.enabled；如果不存在，判断也是成立的</span></span><br><span class="line"><span class="comment">//即使我们配置文件中不配置pring.http.encoding.enabled=true，也是默认生效的；</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//他已经和SpringBoot的配置文件映射了</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//只有一个有参构造器的情况下，参数的值就会从容器中拿</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpEncodingAutoConfiguration</span><span class="params">(HttpEncodingProperties properties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.properties = properties;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//给容器中添加一个组件，这个组件的某些值需要从properties中获取</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span>(CharacterEncodingFilter<span class="class">.<span class="keyword">class</span>) //判断容器没有这个组件？</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">CharacterEncodingFilter</span> <span class="title">characterEncodingFilter</span>() </span>&#123;</span><br><span class="line">    CharacterEncodingFilter filter = <span class="keyword">new</span> OrderedCharacterEncodingFilter();</span><br><span class="line">    filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br><span class="line">    filter.setForceRequestEncoding(<span class="keyword">this</span>.properties.shouldForce(Type.REQUEST));</span><br><span class="line">    filter.setForceResponseEncoding(<span class="keyword">this</span>.properties.shouldForce(Type.RESPONSE));</span><br><span class="line">    <span class="keyword">return</span> filter;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>根据当前不同的条件判断，决定这个配置类是否生效？</p>
<p>一但这个配置类生效；这个配置类就会给容器中添加各种组件；这些组件的属性是从对应的properties类中获取的，这些类里面的每一个属性又是和配置文件绑定的；</p>
<p>5）、所有在配置文件中能配置的属性都是在xxxxProperties类中封装者‘；配置文件能配置什么就可以参照某个功能对应的这个属性类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.http.encoding"</span>)  <span class="comment">//从配置文件中获取指定的值和bean的属性进行绑定</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>





<p><strong>精髓：</strong></p>
<p> <strong>1）、SpringBoot启动会加载大量的自动配置类</strong></p>
<p> <strong>2）、我们看我们需要的功能有没有SpringBoot默认写好的自动配置类；</strong></p>
<p> <strong>3）、我们再来看这个自动配置类中到底配置了哪些组件；（只要我们要用的组件有，我们就不需要再来配置了）</strong></p>
<p> <strong>4）、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们就可以在配置文件中指定这些属性的值；</strong></p>
<p>xxxxAutoConfigurartion：自动配置类；</p>
<p>给容器中添加组件</p>
<p>xxxxProperties:封装配置文件中相关属性；</p>
<h3 id="2、细节"><a href="#2、细节" class="headerlink" title="2、细节"></a>2、细节</h3><h4 id="1、-Conditional派生注解（Spring注解版原生的-Conditional作用）"><a href="#1、-Conditional派生注解（Spring注解版原生的-Conditional作用）" class="headerlink" title="1、@Conditional派生注解（Spring注解版原生的@Conditional作用）"></a>1、@Conditional派生注解（Spring注解版原生的@Conditional作用）</h4><p>作用：必须是@Conditional指定的条件成立，才给容器中添加组件，配置配里面的所有内容才生效；</p>
<table>
<thead>
<tr>
<th>@Conditional扩展注解</th>
<th>作用（判断是否满足当前指定条件）</th>
</tr>
</thead>
<tbody><tr>
<td>@ConditionalOnJava</td>
<td>系统的java版本是否符合要求</td>
</tr>
<tr>
<td>@ConditionalOnBean</td>
<td>容器中存在指定Bean；</td>
</tr>
<tr>
<td>@ConditionalOnMissingBean</td>
<td>容器中不存在指定Bean；</td>
</tr>
<tr>
<td>@ConditionalOnExpression</td>
<td>满足SpEL表达式指定</td>
</tr>
<tr>
<td>@ConditionalOnClass</td>
<td>系统中有指定的类</td>
</tr>
<tr>
<td>@ConditionalOnMissingClass</td>
<td>系统中没有指定的类</td>
</tr>
<tr>
<td>@ConditionalOnSingleCandidate</td>
<td>容器中只有一个指定的Bean，或者这个Bean是首选Bean</td>
</tr>
<tr>
<td>@ConditionalOnProperty</td>
<td>系统中指定的属性是否有指定的值</td>
</tr>
<tr>
<td>@ConditionalOnResource</td>
<td>类路径下是否存在指定资源文件</td>
</tr>
<tr>
<td>@ConditionalOnWebApplication</td>
<td>当前是web环境</td>
</tr>
<tr>
<td>@ConditionalOnNotWebApplication</td>
<td>当前不是web环境</td>
</tr>
<tr>
<td>@ConditionalOnJndi</td>
<td>JNDI存在指定项</td>
</tr>
</tbody></table>
<p><strong>自动配置类必须在一定的条件下才能生效；</strong></p>
<p>我们怎么知道哪些自动配置类生效；</p>
<p><strong>==我们可以通过启用  debug=true属性；来让控制台打印自动配置报告==</strong>，这样我们就可以很方便的知道哪些自动配置类生效；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">=========================</span><br><span class="line">AUTO-CONFIGURATION REPORT</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Positive matches:（自动配置类启用的）</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   DispatcherServletAutoConfiguration matched:</span><br><span class="line">      - <span class="meta">@ConditionalOnClass</span> found required <span class="class"><span class="keyword">class</span> '<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">servlet</span>.<span class="title">DispatcherServlet</span>'</span>; <span class="meta">@ConditionalOnMissingClass</span> <span class="function">did not find unwanted <span class="title">class</span> <span class="params">(OnClassCondition)</span></span></span><br><span class="line"><span class="function">      - @<span class="title">ConditionalOnWebApplication</span> <span class="params">(required)</span> found <span class="title">StandardServletEnvironment</span> <span class="params">(OnWebApplicationCondition)</span></span></span><br><span class="line"><span class="function">        </span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">Negative matches:（没有启动，没有匹配成功的自动配置类）</span></span><br><span class="line"><span class="function">-----------------</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">   ActiveMQAutoConfiguration:</span></span><br><span class="line"><span class="function">      Did not match:</span></span><br><span class="line"><span class="function">         - @ConditionalOnClass did not find required classes 'javax.jms.ConnectionFactory', 'org.apache.activemq.ActiveMQConnectionFactory' <span class="params">(OnClassCondition)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">   AopAutoConfiguration:</span></span><br><span class="line"><span class="function">      Did not match:</span></span><br><span class="line"><span class="function">         - @ConditionalOnClass did not find required classes 'org.aspectj.lang.annotation.Aspect', 'org.aspectj.lang.reflect.Advice' <span class="params">(OnClassCondition)</span></span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="三、日志"><a href="#三、日志" class="headerlink" title="三、日志"></a><strong>三、</strong>日志</h1><h2 id="1、日志框架"><a href="#1、日志框架" class="headerlink" title="1、日志框架"></a>1、日志框架</h2><p> 小张；开发一个大型系统；</p>
<p>   1、System.out.println(“”)；将关键数据打印在控制台；去掉？写在一个文件？</p>
<p>   2、框架来记录系统的一些运行时信息；日志框架 ；  zhanglogging.jar；</p>
<p>   3、高大上的几个功能？异步模式？自动归档？xxxx？  zhanglogging-good.jar？</p>
<p>   4、将以前框架卸下来？换上新的框架，重新修改之前相关的API；zhanglogging-prefect.jar；</p>
<p>   5、JDBC—数据库驱动；</p>
<p>​     写了一个统一的接口层；日志门面（日志的一个抽象层）；logging-abstract.jar；</p>
<p>​     给项目中导入具体的日志实现就行了；我们之前的日志框架都是实现的抽象层；</p>
<p><strong>市面上的日志框架；</strong></p>
<p>JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j….</p>
<table>
<thead>
<tr>
<th>日志门面  （日志的抽象层）</th>
<th>日志实现</th>
</tr>
</thead>
<tbody><tr>
<td><del>JCL（Jakarta  Commons Logging）</del>    SLF4j（Simple  Logging Facade for Java）    <strong><del>jboss-logging</del></strong></td>
<td>Log4j  JUL（java.util.logging）  Log4j2  <strong>Logback</strong></td>
</tr>
</tbody></table>
<p>左边选一个门面（抽象层）、右边来选一个实现；</p>
<p>日志门面：  SLF4J；</p>
<p>日志实现：Logback；</p>
<p>SpringBoot：底层是Spring框架，Spring框架默认是用JCL；‘</p>
<p> <strong>==SpringBoot选用 SLF4j和logback；==</strong></p>
<h2 id="2、SLF4j使用"><a href="#2、SLF4j使用" class="headerlink" title="2、SLF4j使用"></a>2、SLF4j使用</h2><h3 id="1、如何在系统中使用SLF4j-https-www-slf4j-org"><a href="#1、如何在系统中使用SLF4j-https-www-slf4j-org" class="headerlink" title="1、如何在系统中使用SLF4j   https://www.slf4j.org"></a>1、如何在系统中使用SLF4j   <a href="https://www.slf4j.org" target="_blank" rel="noopener">https://www.slf4j.org</a></h3><p>以后开发的时候，日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法；</p>
<p>给系统里面导入slf4j的jar和  logback的实现jar</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    logger.info(<span class="string">"Hello World"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图示；</p>
<p><img src="/2020/02/14/springboot-01/concrete-bindings.png" alt="bindings"></p>
<p>每一个日志的实现框架都有自己的配置文件。使用slf4j以后，<strong>配置文件还是做成日志实现框架自己本身的配置文件；</strong></p>
<h3 id="2、遗留问题"><a href="#2、遗留问题" class="headerlink" title="2、遗留问题"></a>2、遗留问题</h3><p>a（slf4j+logback）: Spring（commons-logging）、Hibernate（jboss-logging）、MyBatis、xxxx</p>
<p>统一日志记录，即使是别的框架和我一起统一使用slf4j进行输出？</p>
<p><img src="/2020/02/14/springboot-01/legacy.png" alt></p>
<p><strong>如何让系统中所有的日志都统一到slf4j；</strong></p>
<p>==1、将系统中其他日志框架先排除出去；==</p>
<p>==2、用中间包来替换原有的日志框架；==</p>
<p>==3、我们导入slf4j其他的实现==</p>
<h2 id="3、SpringBoot日志关系"><a href="#3、SpringBoot日志关系" class="headerlink" title="3、SpringBoot日志关系"></a>3、SpringBoot日志关系</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>SpringBoot使用它来做日志功能；</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>底层依赖关系</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131220946.png" alt></p>
<p>总结：</p>
<p> 1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录</p>
<p> 2）、SpringBoot也把其他的日志都替换成了slf4j；</p>
<p> 3）、中间替换包？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LogFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J = <span class="string">"http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> LogFactory logFactory = <span class="keyword">new</span> SLF4JLogFactory();</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131221411.png" alt></p>
<p> 4）、如果我们要引入其他框架？一定要把这个框架的默认日志依赖移除掉？</p>
<p>​     Spring框架用的是commons-logging；</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>==SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可；==</strong></p>
<h2 id="4、日志使用；"><a href="#4、日志使用；" class="headerlink" title="4、日志使用；"></a>4、日志使用；</h2><h3 id="1、默认配置"><a href="#1、默认配置" class="headerlink" title="1、默认配置"></a>1、默认配置</h3><p>SpringBoot默认帮我们配置好了日志；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//记录器</span></span><br><span class="line">Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//日志的级别；</span></span><br><span class="line">  <span class="comment">//由低到高   trace&lt;debug&lt;info&lt;warn&lt;error</span></span><br><span class="line">  <span class="comment">//可以调整输出的日志级别；日志就只会在这个级别以以后的高级别生效</span></span><br><span class="line">  logger.trace(<span class="string">"这是trace日志..."</span>);</span><br><span class="line">  logger.debug(<span class="string">"这是debug日志..."</span>);</span><br><span class="line">  <span class="comment">//SpringBoot默认给我们使用的是info级别的，没有指定级别的就用SpringBoot默认规定的级别；root级别</span></span><br><span class="line">  logger.info(<span class="string">"这是info日志..."</span>);</span><br><span class="line">  logger.warn(<span class="string">"这是warn日志..."</span>);</span><br><span class="line">  logger.error(<span class="string">"这是error日志..."</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<pre><code>日志输出格式：
%d表示日期时间，
%thread表示线程名，
%-5level：级别从左显示5个字符宽度
%logger{50} 表示logger名字最长50个字符，否则按照句点分割。 
%msg：日志消息，
%n是换行符
--&gt;
%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</code></pre><p>SpringBoot修改日志的默认配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">logging.level.com.atguigu</span>=<span class="string">trace</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#logging.path=</span></span><br><span class="line"><span class="comment"># 不指定路径在当前项目下生成springboot.log日志</span></span><br><span class="line"><span class="comment"># 可以指定完整的路径；</span></span><br><span class="line"><span class="comment">#logging.file=G:/springboot.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在当前磁盘的根路径下创建spring文件夹和里面的log文件夹；使用 spring.log 作为默认文件</span></span><br><span class="line"><span class="meta">logging.path</span>=<span class="string">/spring/log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  在控制台输出的日志的格式</span></span><br><span class="line"><span class="meta">logging.pattern.console</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span></span><br><span class="line"><span class="comment"># 指定文件中日志输出的格式</span></span><br><span class="line"><span class="meta">logging.pattern.file</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>logging.file</th>
<th>logging.path</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>(none)</td>
<td>(none)</td>
<td></td>
<td>只在控制台输出</td>
</tr>
<tr>
<td>指定文件名</td>
<td>(none)</td>
<td>my.log</td>
<td>输出日志到my.log文件</td>
</tr>
<tr>
<td>(none)</td>
<td>指定目录</td>
<td>/var/log</td>
<td>输出到指定目录的 spring.log 文件中</td>
</tr>
</tbody></table>
<h3 id="2、指定配置"><a href="#2、指定配置" class="headerlink" title="2、指定配置"></a>2、指定配置</h3><p>给类路径下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的了</p>
<table>
<thead>
<tr>
<th>Logging System</th>
<th>Customization</th>
</tr>
</thead>
<tbody><tr>
<td>Logback</td>
<td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td>
</tr>
<tr>
<td>Log4j2</td>
<td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td>
</tr>
<tr>
<td>JDK (Java Util Logging)</td>
<td><code>logging.properties</code></td>
</tr>
</tbody></table>
<p>logback.xml：直接就被日志框架识别了；</p>
<p><strong>logback-spring.xml</strong>：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级Profile功能</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"staging"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configuration to be enabled when the "staging" profile is active --&gt;</span></span><br><span class="line">    可以指定某段配置只在某个环境下生效</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"stdout"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        日志输出格式：</span></span><br><span class="line"><span class="comment">      %d表示日期时间，</span></span><br><span class="line"><span class="comment">      %thread表示线程名，</span></span><br><span class="line"><span class="comment">      %-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">      %logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 </span></span><br><span class="line"><span class="comment">      %msg：日志消息，</span></span><br><span class="line"><span class="comment">      %n是换行符</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ----&gt; [%thread] ---&gt; %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"!dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ==== [%thread] ==== %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误</p>
<p> <code>no applicable action for [springProfile]</code></p>
<h2 id="5、切换日志框架"><a href="#5、切换日志框架" class="headerlink" title="5、切换日志框架"></a>5、切换日志框架</h2><p>可以按照slf4j的日志适配图，进行相关的切换；</p>
<p>slf4j+log4j的方式；</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>切换为log4j2</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="四、Web开发"><a href="#四、Web开发" class="headerlink" title="四、Web开发"></a><strong>四、</strong>Web开发</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><p>使用SpringBoot；</p>
<p><strong>1）、创建SpringBoot应用，选中我们需要的模块；</strong></p>
<p><strong>2）、SpringBoot已经默认将这些场景配置好了，只需要在配置文件中指定少量配置就可以运行起来</strong></p>
<p><strong>3）、自己编写业务代码；</strong></p>
<p><strong>自动配置原理？</strong></p>
<p>这个场景SpringBoot帮我们配置了什么？能不能修改？能修改哪些配置？能不能扩展？xxx</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xxxxAutoConfiguration：帮我们给容器中自动配置组件；</span><br><span class="line">xxxxProperties:配置类来封装配置文件的内容；</span><br></pre></td></tr></table></figure>



<h2 id="2、SpringBoot对静态资源的映射规则；"><a href="#2、SpringBoot对静态资源的映射规则；" class="headerlink" title="2、SpringBoot对静态资源的映射规则；"></a>2、SpringBoot对静态资源的映射规则；</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.resources"</span>, ignoreUnknownFields = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceProperties</span> <span class="keyword">implements</span> <span class="title">ResourceLoaderAware</span> </span>&#123;</span><br><span class="line">  <span class="comment">//可以设置和静态资源有关的参数，缓存时间等</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">WebMvcAuotConfiguration：</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">      logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Integer cachePeriod = <span class="keyword">this</span>.resourceProperties.getCachePeriod();</span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line">      customizeResourceHandlerRegistration(</span><br><span class="line">          registry.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">              .addResourceLocations(</span><br><span class="line">                  <span class="string">"classpath:/META-INF/resources/webjars/"</span>)</span><br><span class="line">          .setCachePeriod(cachePeriod));</span><br><span class="line">    &#125;</span><br><span class="line">    String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">          <span class="comment">//静态资源文件夹映射</span></span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">      customizeResourceHandlerRegistration(</span><br><span class="line">          registry.addResourceHandler(staticPathPattern)</span><br><span class="line">              .addResourceLocations(</span><br><span class="line">                  <span class="keyword">this</span>.resourceProperties.getStaticLocations())</span><br><span class="line">          .setCachePeriod(cachePeriod));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//配置欢迎页映射</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      ResourceProperties resourceProperties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WelcomePageHandlerMapping(resourceProperties.getWelcomePage(),</span><br><span class="line">        <span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//配置喜欢的图标</span></span><br><span class="line">  <span class="meta">@Configuration</span></span><br><span class="line">  <span class="meta">@ConditionalOnProperty</span>(value = <span class="string">"spring.mvc.favicon.enabled"</span>, matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FaviconConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FaviconConfiguration</span><span class="params">(ResourceProperties resourceProperties)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleUrlHandlerMapping <span class="title">faviconHandlerMapping</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      SimpleUrlHandlerMapping mapping = <span class="keyword">new</span> SimpleUrlHandlerMapping();</span><br><span class="line">      mapping.setOrder(Ordered.HIGHEST_PRECEDENCE + <span class="number">1</span>);</span><br><span class="line">              <span class="comment">//所有  **/favicon.ico </span></span><br><span class="line">      mapping.setUrlMap(Collections.singletonMap(<span class="string">"**/favicon.ico"</span>,</span><br><span class="line">          faviconRequestHandler()));</span><br><span class="line">      <span class="keyword">return</span> mapping;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResourceHttpRequestHandler <span class="title">faviconRequestHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ResourceHttpRequestHandler requestHandler = <span class="keyword">new</span> ResourceHttpRequestHandler();</span><br><span class="line">      requestHandler</span><br><span class="line">          .setLocations(<span class="keyword">this</span>.resourceProperties.getFaviconLocations());</span><br><span class="line">      <span class="keyword">return</span> requestHandler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p>==1）、所有 /webjars/** ，都去 classpath:/META-INF/resources/webjars/ 找资源；==</p>
<p> webjars：以jar包的方式引入静态资源；</p>
<p><a href="http://www.webjars.org/" target="_blank" rel="noopener">http://www.webjars.org/</a></p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180203181751.png" alt></p>
<p>localhost:8080/webjars/jquery/3.3.1/jquery.js</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入jquery-webjar--&gt;</span>在访问的时候只需要写webjars下面资源的名称即可</span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>==2）、”/**” 访问当前项目的任何资源，都去（静态资源的文件夹）找映射==</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;&quot;, </span><br><span class="line">&quot;classpath:&#x2F;resources&#x2F;&quot;,</span><br><span class="line">&quot;classpath:&#x2F;static&#x2F;&quot;, </span><br><span class="line">&quot;classpath:&#x2F;public&#x2F;&quot; </span><br><span class="line">&quot;&#x2F;&quot;：当前项目的根路径</span><br></pre></td></tr></table></figure>

<p>localhost:8080/abc ===  去静态资源文件夹里面找abc</p>
<p>==3）、欢迎页； 静态资源文件夹下的所有index.html页面；被”/**”映射；==</p>
<p> localhost:8080/   找index页面</p>
<p>==4）、所有的 **/favicon.ico  都是在静态资源文件下找；==</p>
<h2 id="3、模板引擎"><a href="#3、模板引擎" class="headerlink" title="3、模板引擎"></a>3、模板引擎</h2><p>JSP、Velocity、Freemarker、Thymeleaf</p>
<p><img src="/2020/02/14/springboot-01/template-engine.png" alt></p>
<p>SpringBoot推荐的Thymeleaf；</p>
<p>语法更简单，功能更强大；</p>
<h3 id="1、引入thymeleaf；"><a href="#1、引入thymeleaf；" class="headerlink" title="1、引入thymeleaf；"></a>1、引入thymeleaf；</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            2.1.6</span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">切换thymeleaf版本</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.9.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 布局功能的支持程序  thymeleaf3主程序  layout2以上版本 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- thymeleaf2   layout1--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2、Thymeleaf使用"><a href="#2、Thymeleaf使用" class="headerlink" title="2、Thymeleaf使用"></a>2、Thymeleaf使用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.thymeleaf"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> MimeType DEFAULT_CONTENT_TYPE = MimeType.valueOf(<span class="string">"text/html"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p>只要我们把HTML页面放在classpath:/templates/，thymeleaf就能自动渲染；</p>
<p>使用：</p>
<p>1、导入thymeleaf的名称空间</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、使用thymeleaf语法；</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>成功！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--th:text 将div里面的文本内容设置为 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">"$&#123;hello&#125;"</span>&gt;</span>这是显示欢迎信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、语法规则"><a href="#3、语法规则" class="headerlink" title="3、语法规则"></a>3、语法规则</h3><p>1）、th:text；改变当前元素里面的文本内容；</p>
<p> th：任意html属性；来替换原生属性的值</p>
<p><img src="/2020/02/14/springboot-01/2018-02-04_123955.png" alt></p>
<p>2）、表达式？</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">Simple</span> <span class="string">expressions:（表达式语法）</span></span><br><span class="line">    <span class="attr">Variable</span> <span class="string">Expressions: $&#123;...&#125;：获取变量值；OGNL；</span></span><br><span class="line">        <span class="attr">1）、获取对象的属性、调用方法</span></span><br><span class="line">        <span class="attr">2）、使用内置的基本对象：</span></span><br><span class="line"><span class="comment">          #ctx : the context object.</span></span><br><span class="line"><span class="comment">          #vars: the context variables.</span></span><br><span class="line"><span class="comment">                #locale : the context locale.</span></span><br><span class="line"><span class="comment">                #request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line"><span class="comment">                #response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line"><span class="comment">                #session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line"><span class="comment">                #servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">                </span><br><span class="line">                <span class="attr">$&#123;session.foo&#125;</span></span><br><span class="line">            <span class="attr">3）、内置的一些工具对象：</span></span><br><span class="line"><span class="comment">#execInfo : information about the template being processed.</span></span><br><span class="line"><span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #&#123;…&#125; syntax.</span></span><br><span class="line"><span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line"><span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line"><span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line"><span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line"><span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line"><span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line"><span class="comment">#objects : methods for objects in general.</span></span><br><span class="line"><span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line"><span class="comment">#arrays : methods for arrays.</span></span><br><span class="line"><span class="comment">#lists : methods for lists.</span></span><br><span class="line"><span class="comment">#sets : methods for sets.</span></span><br><span class="line"><span class="comment">#maps : methods for maps.</span></span><br><span class="line"><span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line"><span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration).</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Selection</span> <span class="string">Variable Expressions: *&#123;...&#125;：选择表达式：和$&#123;&#125;在功能上是一样；</span></span><br><span class="line">      <span class="meta">补充：配合</span> <span class="string">th:object="$&#123;session.user&#125;：</span></span><br><span class="line">   <span class="meta">&lt;div</span> <span class="string">th:object="$&#123;session.user&#125;"&gt;</span></span><br><span class="line">    <span class="meta">&lt;p&gt;Name</span>: <span class="string">&lt;span th:text="*&#123;firstName&#125;"&gt;Sebastian&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="meta">&lt;p&gt;Surname</span>: <span class="string">&lt;span th:text="*&#123;lastName&#125;"&gt;Pepper&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="meta">&lt;p&gt;Nationality</span>: <span class="string">&lt;span th:text="*&#123;nationality&#125;"&gt;Saturn&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">Message</span> <span class="string">Expressions: #&#123;...&#125;：获取国际化内容</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">URL Expressions: @&#123;...&#125;：定义URL；</span></span><br><span class="line">        <span class="meta">@&#123;/order/process(execId</span>=<span class="string">$&#123;execId&#125;,execType='FAST')&#125;</span></span><br><span class="line">    <span class="attr">Fragment</span> <span class="string">Expressions: ~&#123;...&#125;：片段引用表达式</span></span><br><span class="line">        <span class="meta">&lt;div</span> <span class="string">th:insert="~&#123;commons :: main&#125;"&gt;...&lt;/div&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="attr">Literals（字面量）</span></span><br><span class="line">      <span class="attr">Text</span> <span class="string">literals: 'one text' , 'Another one!' ,…</span></span><br><span class="line">      <span class="attr">Number</span> <span class="string">literals: 0 , 34 , 3.0 , 12.3 ,…</span></span><br><span class="line">      <span class="attr">Boolean</span> <span class="string">literals: true , false</span></span><br><span class="line">      <span class="attr">Null</span> <span class="string">literal: null</span></span><br><span class="line">      <span class="attr">Literal</span> <span class="string">tokens: one , sometext , main ,…</span></span><br><span class="line"><span class="attr">Text</span> <span class="string">operations:（文本操作）</span></span><br><span class="line">    <span class="attr">String</span> <span class="string">concatenation: +</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">substitutions: |The name is $&#123;name&#125;|</span></span><br><span class="line"><span class="attr">Arithmetic</span> <span class="string">operations:（数学运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: + , - , * , / , %</span></span><br><span class="line">    <span class="attr">Minus</span> <span class="string">sign (unary operator): -</span></span><br><span class="line"><span class="attr">Boolean</span> <span class="string">operations:（布尔运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: and , or</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">negation (unary operator): ! , not</span></span><br><span class="line"><span class="attr">Comparisons</span> <span class="string">and equality:（比较运算）</span></span><br><span class="line">    <span class="attr">Comparators</span>: <span class="string">&gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line">    <span class="attr">Equality</span> <span class="string">operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="attr">Conditional</span> <span class="string">operators:条件运算（三元运算符）</span></span><br><span class="line">    <span class="meta">If-then</span>: <span class="string">(if) ? (then)</span></span><br><span class="line">    <span class="meta">If-then-else</span>: <span class="string">(if) ? (then) : (else)</span></span><br><span class="line">    <span class="attr">Default</span>: <span class="string">(value) ?: (defaultvalue)</span></span><br><span class="line"><span class="attr">Special</span> <span class="string">tokens:</span></span><br><span class="line">    <span class="meta">No-Operation</span>: <span class="string">_</span></span><br></pre></td></tr></table></figure>

<h2 id="4、SpringMVC自动配置"><a href="#4、SpringMVC自动配置" class="headerlink" title="4、SpringMVC自动配置"></a>4、SpringMVC自动配置</h2><p><a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications</a></p>
<h3 id="1-Spring-MVC-auto-configuration"><a href="#1-Spring-MVC-auto-configuration" class="headerlink" title="1. Spring MVC auto-configuration"></a>1. Spring MVC auto-configuration</h3><p>Spring Boot 自动配置好了SpringMVC</p>
<p>以下是SpringBoot对SpringMVC的默认配置:<strong>==（WebMvcAutoConfiguration）==</strong></p>
<ul>
<li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p>
<ul>
<li>自动配置了ViewResolver（视图解析器：根据方法的返回值得到视图对象（View），视图对象决定如何渲染（转发？重定向？））</li>
<li>ContentNegotiatingViewResolver：组合所有的视图解析器的；</li>
<li>==如何定制：我们可以自己给容器中添加一个视图解析器；自动的将其组合进来；==</li>
</ul>
</li>
<li><p>Support for serving static resources, including support for WebJars (see below).静态资源文件夹路径,webjars</p>
</li>
<li><p>Static <code>index.html</code> support. 静态首页访问</p>
</li>
<li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p>
</li>
</ul>
<ul>
<li><p>自动注册了 of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p>
<ul>
<li>Converter：转换器；  public String hello(User user)：类型转换使用Converter</li>
<li><code>Formatter</code>  格式化器；  2017.12.17===Date；</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"date-format"</span>)<span class="comment">//在文件中配置日期格式化的规则</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title">dateFormatter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> DateFormatter(<span class="keyword">this</span>.mvcProperties.getDateFormat());<span class="comment">//日期格式化组件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ==自己添加的格式化器转换器，我们只需要放在容器中即可==</p>
<ul>
<li><p>Support for <code>HttpMessageConverters</code> (see below).</p>
<ul>
<li><p>HttpMessageConverter：SpringMVC用来转换Http请求和响应的；User—Json；</p>
</li>
<li><p><code>HttpMessageConverters</code> 是从容器中确定；获取所有的HttpMessageConverter；</p>
<p>==自己给容器中添加HttpMessageConverter，只需要将自己的组件注册容器中（@Bean,@Component）==</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).定义错误代码生成规则</p>
</li>
<li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p>
<p>==我们可以配置一个ConfigurableWebBindingInitializer来替换默认的；（添加到容器）==</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">初始化WebDataBinder；</span><br><span class="line">请求数据&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;JavaBean；</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>org.springframework.boot.autoconfigure.web：web的所有自动场景；</strong></p>
<p>If you want to keep Spring Boot MVC features, and you just want to add additional <a href="https://docs.spring.io/spring/docs/4.3.14.RELEASE/spring-framework-reference/htmlsingle#mvc" target="_blank" rel="noopener">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p>
<p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>.</p>
<h3 id="2、扩展SpringMVC"><a href="#2、扩展SpringMVC" class="headerlink" title="2、扩展SpringMVC"></a>2、扩展SpringMVC</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/hello"</span> <span class="attr">view-name</span>=<span class="string">"success"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/hello"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>==编写一个配置类（@Configuration），是WebMvcConfigurerAdapter类型；不能标注@EnableWebMvc==</strong>;</p>
<p>既保留了所有的自动配置，也能用我们扩展的配置；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原理：</p>
<p> 1）、WebMvcAutoConfiguration是SpringMVC的自动配置类</p>
<p> 2）、在做其他自动配置时会导入；@Import(<strong>EnableWebMvcConfiguration</strong>.class)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">DelegatingWebMvcConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebMvcConfigurerComposite configurers = <span class="keyword">new</span> WebMvcConfigurerComposite();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//从容器中获取所有的WebMvcConfigurer</span></span><br><span class="line">    <span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">            <span class="comment">//一个参考实现；将所有的WebMvcConfigurer相关配置都来一起调用；  </span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">           <span class="comment">// public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line">            <span class="comment">//    for (WebMvcConfigurer delegate : this.delegates) &#123;</span></span><br><span class="line">             <span class="comment">//       delegate.addViewControllers(registry);</span></span><br><span class="line">             <span class="comment">//   &#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 3）、容器中所有的WebMvcConfigurer都会一起起作用；</p>
<p> 4）、我们的配置类也会被调用；</p>
<p> 效果：SpringMVC的自动配置和我们的扩展配置都会起作用；</p>
<h3 id="3、全面接管SpringMVC；"><a href="#3、全面接管SpringMVC；" class="headerlink" title="3、全面接管SpringMVC；"></a>3、全面接管SpringMVC；</h3><p>SpringBoot对SpringMVC的自动配置不需要了，所有都是我们自己配置；所有的SpringMVC的自动配置都失效了</p>
<p><strong>我们需要在配置类中添加@EnableWebMvc即可；</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原理：</p>
<p>为什么@EnableWebMvc自动配置就失效了；</p>
<p>1）@EnableWebMvc的核心</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import</span>(DelegatingWebMvcConfiguration<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">EnableWebMvc</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>2）、</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>3）、</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">DispatcherServlet</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">    <span class="title">WebMvcConfigurerAdapter</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">//容器中没有这个组件的时候，这个自动配置类才生效</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnMissingBean</span>(<span class="title">WebMvcConfigurationSupport</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureOrder</span>(<span class="title">Ordered</span>.<span class="title">HIGHEST_PRECEDENCE</span> + 10)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123; DispatcherServletAutoConfiguration<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">    <span class="title">ValidationAutoConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>4）、@EnableWebMvc将WebMvcConfigurationSupport组件导入进来；</p>
<p>5）、导入的WebMvcConfigurationSupport只是SpringMVC最基本的功能；</p>
<h2 id="5、如何修改SpringBoot的默认配置"><a href="#5、如何修改SpringBoot的默认配置" class="headerlink" title="5、如何修改SpringBoot的默认配置"></a>5、如何修改SpringBoot的默认配置</h2><p>模式：</p>
<p> 1）、SpringBoot在自动配置很多组件的时候，先看容器中有没有用户自己配置的（@Bean、@Component）如果有就用用户配置的，如果没有，才自动配置；如果有些组件可以有多个（ViewResolver）将用户配置的和自己默认的组合起来；</p>
<p> 2）、在SpringBoot中会有非常多的xxxConfigurer帮助我们进行扩展配置</p>
<p> 3）、在SpringBoot中会有很多的xxxCustomizer帮助我们进行定制配置</p>
<h2 id="6、RestfulCRUD"><a href="#6、RestfulCRUD" class="headerlink" title="6、RestfulCRUD"></a>6、RestfulCRUD</h2><h3 id="1）、默认访问首页"><a href="#1）、默认访问首页" class="headerlink" title="1）、默认访问首页"></a>1）、默认访问首页</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="comment">//@EnableWebMvc   不要接管SpringMVC</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title">webMvcConfigurerAdapter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        WebMvcConfigurerAdapter adapter = <span class="keyword">new</span> WebMvcConfigurerAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">                registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> adapter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2）、国际化"><a href="#2）、国际化" class="headerlink" title="2）、国际化"></a>2）、国际化</h3><p><strong>1）、编写国际化配置文件；</strong></p>
<p>2）、使用ResourceBundleMessageSource管理国际化资源文件</p>
<p>3）、在页面使用fmt:message取出国际化内容</p>
<p>步骤：</p>
<p>1）、编写国际化配置文件，抽取页面需要显示的国际化消息</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211130721.png" alt></p>
<p>2）、SpringBoot自动配置好了管理国际化资源文件的组件；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.messages"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageSourceAutoConfiguration</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Comma-separated list of basenames (essentially a fully-qualified classpath</span></span><br><span class="line"><span class="comment">   * location), each following the ResourceBundle convention with relaxed support for</span></span><br><span class="line"><span class="comment">   * slash based locations. If it doesn't contain a package qualifier (such as</span></span><br><span class="line"><span class="comment">   * "org.mypackage"), it will be resolved from the classpath root.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> String basename = <span class="string">"messages"</span>;  </span><br><span class="line">    <span class="comment">//我们的配置文件可以直接放在类路径下叫messages.properties；</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(<span class="keyword">this</span>.basename)) &#123;</span><br><span class="line">            <span class="comment">//设置国际化资源文件的基础名（去掉语言国家代码的）</span></span><br><span class="line">      messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">          StringUtils.trimAllWhitespace(<span class="keyword">this</span>.basename)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.encoding != <span class="keyword">null</span>) &#123;</span><br><span class="line">      messageSource.setDefaultEncoding(<span class="keyword">this</span>.encoding.name());</span><br><span class="line">    &#125;</span><br><span class="line">    messageSource.setFallbackToSystemLocale(<span class="keyword">this</span>.fallbackToSystemLocale);</span><br><span class="line">    messageSource.setCacheSeconds(<span class="keyword">this</span>.cacheSeconds);</span><br><span class="line">    messageSource.setAlwaysUseMessageFormat(<span class="keyword">this</span>.alwaysUseMessageFormat);</span><br><span class="line">    <span class="keyword">return</span> messageSource;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p>3）、去页面获取国际化的值；</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211134506.png" alt></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>  <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Signin Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/bootstrap.min.css"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/webjars/bootstrap/4.0.0/css/bootstrap.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/signin.css"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/asserts/css/signin.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-signin"</span> <span class="attr">action</span>=<span class="string">"dashboard.html"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"mb-4"</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/asserts/img/bootstrap-solid.svg&#125;"</span> <span class="attr">src</span>=<span class="string">"asserts/img/bootstrap-solid.svg"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"72"</span> <span class="attr">height</span>=<span class="string">"72"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h3 mb-3 font-weight-normal"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.tip&#125;"</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.username&#125;"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.username&#125;"</span> <span class="attr">required</span>=<span class="string">""</span> <span class="attr">autofocus</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.password&#125;"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.password&#125;"</span> <span class="attr">required</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox mb-3"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"remember-me"</span>/&gt;</span> [[#&#123;login.remember&#125;]]</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-lg btn-primary btn-block"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.btn&#125;"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"mt-5 mb-3 text-muted"</span>&gt;</span>© 2017-2018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：根据浏览器语言设置的信息切换了国际化；</p>
<p>原理：</p>
<p> 国际化Locale（区域信息对象）；LocaleResolver（获取区域信息对象）；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"locale"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties</span><br><span class="line">          .getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">      &#125;</span><br><span class="line">      AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">      localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">      <span class="keyword">return</span> localeResolver;</span><br><span class="line">    &#125;</span><br><span class="line">默认的就是根据请求头带来的区域信息获取Locale进行国际化</span><br></pre></td></tr></table></figure>

<p>4）、点击链接切换国际化</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 可以在连接上携带区域信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String l = request.getParameter(<span class="string">"l"</span>);</span><br><span class="line">        Locale locale = Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(l))&#123;</span><br><span class="line">            String[] split = l.split(<span class="string">"_"</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3）、登陆"><a href="#3）、登陆" class="headerlink" title="3）、登陆"></a>3）、登陆</h3><p>开发期间模板引擎页面修改以后，要实时生效</p>
<p>1）、禁用模板引擎的缓存</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 禁用缓存</span><br><span class="line">spring.thymeleaf.cache&#x3D;false</span><br></pre></td></tr></table></figure>

<p>2）、页面修改完成以后ctrl+f9：重新编译；</p>
<p>登陆错误消息的显示</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;msg&#125;"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;not #strings.isEmpty(msg)&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="4）、拦截器进行登陆检查"><a href="#4）、拦截器进行登陆检查" class="headerlink" title="4）、拦截器进行登陆检查"></a>4）、拦截器进行登陆检查</h3><p>拦截器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登陆检查，</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//目标方法执行之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object user = request.getSession().getAttribute(<span class="string">"loginUser"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//未登陆，返回登陆页面</span></span><br><span class="line">            request.setAttribute(<span class="string">"msg"</span>,<span class="string">"没有权限请先登陆"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/index.html"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//已登陆，放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注册拦截器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">  <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title">webMvcConfigurerAdapter</span><span class="params">()</span></span>&#123;</span><br><span class="line">      WebMvcConfigurerAdapter adapter = <span class="keyword">new</span> WebMvcConfigurerAdapter() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">              registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/main.html"</span>).setViewName(<span class="string">"dashboard"</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//注册拦截器</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">              <span class="comment">//super.addInterceptors(registry);</span></span><br><span class="line">              <span class="comment">//静态资源；  *.css , *.js</span></span><br><span class="line">              <span class="comment">//SpringBoot已经做好了静态资源映射</span></span><br><span class="line">              registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor()).addPathPatterns(<span class="string">"/**"</span>)</span><br><span class="line">                      .excludePathPatterns(<span class="string">"/index.html"</span>,<span class="string">"/"</span>,<span class="string">"/user/login"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> adapter;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5）、CRUD-员工列表"><a href="#5）、CRUD-员工列表" class="headerlink" title="5）、CRUD-员工列表"></a>5）、CRUD-员工列表</h3><p>实验要求：</p>
<p>1）、RestfulCRUD：CRUD满足Rest风格；</p>
<p>URI：  /资源名称/资源标识       HTTP请求方式区分对资源CRUD操作</p>
<table>
<thead>
<tr>
<th></th>
<th>普通CRUD（uri来区分操作）</th>
<th>RestfulCRUD</th>
</tr>
</thead>
<tbody><tr>
<td>查询</td>
<td>getEmp</td>
<td>emp—GET</td>
</tr>
<tr>
<td>添加</td>
<td>addEmp?xxx</td>
<td>emp—POST</td>
</tr>
<tr>
<td>修改</td>
<td>updateEmp?id=xxx&amp;xxx=xx</td>
<td>emp/{id}—PUT</td>
</tr>
<tr>
<td>删除</td>
<td>deleteEmp?id=1</td>
<td>emp/{id}—DELETE</td>
</tr>
</tbody></table>
<p>2）、实验的请求架构;</p>
<table>
<thead>
<tr>
<th>实验功能</th>
<th>请求URI</th>
<th>请求方式</th>
</tr>
</thead>
<tbody><tr>
<td>查询所有员工</td>
<td>emps</td>
<td>GET</td>
</tr>
<tr>
<td>查询某个员工(来到修改页面)</td>
<td>emp/1</td>
<td>GET</td>
</tr>
<tr>
<td>来到添加页面</td>
<td>emp</td>
<td>GET</td>
</tr>
<tr>
<td>添加员工</td>
<td>emp</td>
<td>POST</td>
</tr>
<tr>
<td>来到修改页面（查出员工进行信息回显）</td>
<td>emp/1</td>
<td>GET</td>
</tr>
<tr>
<td>修改员工</td>
<td>emp</td>
<td>PUT</td>
</tr>
<tr>
<td>删除员工</td>
<td>emp/1</td>
<td>DELETE</td>
</tr>
</tbody></table>
<p>3）、员工列表：</p>
<h4 id="thymeleaf公共页面元素抽取"><a href="#thymeleaf公共页面元素抽取" class="headerlink" title="thymeleaf公共页面元素抽取"></a>thymeleaf公共页面元素抽取</h4><p>详细文档见: <a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#including-template-fragments" target="_blank" rel="noopener">Thymeleaf Chapter8.1</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1、抽取公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2、引入公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"~&#123;footer :: copy&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">~&#123;templatename::selector&#125;：模板名::选择器</span><br><span class="line">~&#123;templatename::fragmentname&#125;:模板名::片段名</span><br><span class="line"></span><br><span class="line">3、默认效果：</span><br><span class="line">insert的公共片段在div标签中</span><br><span class="line">如果使用th:insert等属性进行引入，可以不用写~&#123;&#125;：</span><br><span class="line">行内写法可以加上：[[~&#123;&#125;]];[(~&#123;&#125;)]；</span><br></pre></td></tr></table></figure>



<p>三种引入公共片段的th属性：</p>
<p><strong>th:insert</strong>：将公共片段整个插入到声明引入的元素中</p>
<p><strong>th:replace</strong>：将声明引入的元素替换为公共片段</p>
<p><strong>th:include</strong>：将被引入的片段的内容包含进这个标签中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">引入方式</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">效果</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>引入片段的时候传入参数： </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-md-2 d-none d-md-block bg-light sidebar"</span> <span class="attr">id</span>=<span class="string">"sidebar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-sticky"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav flex-column"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link active"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">th:class</span>=<span class="string">"$&#123;activeUri=='main.html'?'nav-link active':'nav-link'&#125;"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/main.html&#125;"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">width</span>=<span class="string">"24"</span> <span class="attr">height</span>=<span class="string">"24"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 24 24"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">stroke</span>=<span class="string">"currentColor"</span> <span class="attr">stroke-width</span>=<span class="string">"2"</span> <span class="attr">stroke-linecap</span>=<span class="string">"round"</span> <span class="attr">stroke-linejoin</span>=<span class="string">"round"</span> <span class="attr">class</span>=<span class="string">"feather feather-home"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">"9 22 9 12 15 12 15 22"</span>&gt;</span><span class="tag">&lt;/<span class="name">polyline</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">                    Dashboard <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入侧边栏;传入参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"commons/bar::#sidebar(activeUri='emps')"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6）、CRUD-员工添加"><a href="#6）、CRUD-员工添加" class="headerlink" title="6）、CRUD-员工添加"></a>6）、CRUD-员工添加</h3><p>添加页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>4<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>5<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>提交的数据格式不对：生日：日期；</p>
<p>2017-12-12；2017/12/12；2017.12.12；</p>
<p>日期的格式化；SpringMVC将页面提交的值需要转换为指定的类型;</p>
<p>2017-12-12—Date； 类型转换，格式化;</p>
<p>默认日期是按照/的方式；</p>
<h3 id="7）、CRUD-员工修改"><a href="#7）、CRUD-员工修改" class="headerlink" title="7）、CRUD-员工修改"></a>7）、CRUD-员工修改</h3><p>修改添加二合一表单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--需要区分是员工修改还是添加；--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/emp&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发送put请求修改员工数据--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">1、SpringMVC中配置HiddenHttpMethodFilter;（SpringBoot自动配置好的）</span></span><br><span class="line"><span class="comment">2、页面创建一个post表单</span></span><br><span class="line"><span class="comment">3、创建一个input项，name="_method";值就是我们指定的请求方式</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"put"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;emp!=null&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;emp!=null&#125;"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp.id&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.lastName&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.email&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">th:checked</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.gender==1&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">th:checked</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.gender==0&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--提交的是部门的id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">name</span>=<span class="string">"department.id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:selected</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;dept.id == emp.department.id&#125;"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;dept.id&#125;"</span> <span class="attr">th:each</span>=<span class="string">"dept:$&#123;depts&#125;"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;dept.departmentName&#125;"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"birth"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp!=null&#125;?'修改':'添加'"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8）、CRUD-员工删除"><a href="#8）、CRUD-员工删除" class="headerlink" title="8）、CRUD-员工删除"></a>8）、CRUD-员工删除</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">"emp:$&#123;emps&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.id&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[$&#123;emp.lastName&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.email&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.gender&#125;==0?'女':'男'"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.department.departmentName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-primary"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/emp/&#125;+$&#123;emp.id&#125;"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:attr</span>=<span class="string">"del_uri=@&#123;/emp/&#125;+$&#123;emp.id&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-danger deleteBtn"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">".deleteBtn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//删除当前员工的</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#deleteEmpForm"</span>).attr(<span class="string">"action"</span>,$(<span class="keyword">this</span>).attr(<span class="string">"del_uri"</span>)).submit();</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="7、错误处理机制"><a href="#7、错误处理机制" class="headerlink" title="7、错误处理机制"></a>7、错误处理机制</h2><h3 id="1）、SpringBoot默认的错误处理机制"><a href="#1）、SpringBoot默认的错误处理机制" class="headerlink" title="1）、SpringBoot默认的错误处理机制"></a>1）、SpringBoot默认的错误处理机制</h3><p>默认效果：</p>
<p>   1）、浏览器，返回一个默认的错误页面</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173408.png" alt></p>
<p>  浏览器发送请求的请求头：</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180347.png" alt></p>
<p>   2）、如果是其他客户端，默认响应一个json数据</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173527.png" alt></p>
<p>   <img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180504.png" alt></p>
<p>原理：</p>
<p> 可以参照ErrorMvcAutoConfiguration；错误处理的自动配置；</p>
<pre><code>给容器中添加了以下组件</code></pre><p> 1、DefaultErrorAttributes：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">帮我们在页面共享信息；</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;();</span><br><span class="line">    errorAttributes.put(<span class="string">"timestamp"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">    addStatus(errorAttributes, requestAttributes);</span><br><span class="line">    addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);</span><br><span class="line">    addPath(errorAttributes, requestAttributes);</span><br><span class="line">    <span class="keyword">return</span> errorAttributes;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p> 2、BasicErrorController：处理默认/error请求</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(produces = <span class="string">"text/html"</span>)<span class="comment">//产生html类型的数据；浏览器发送的请求来到这个方法处理</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">        request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//去哪个页面作为错误页面；包含页面地址和页面内容</span></span><br><span class="line">    ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">    <span class="keyword">return</span> (modelAndView == <span class="keyword">null</span> ? <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model) : modelAndView);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span></span><br><span class="line">  <span class="meta">@ResponseBody</span>    <span class="comment">//产生json数据，其他客户端来到这个方法处理；</span></span><br><span class="line">  <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">    Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">        isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p> 3、ErrorPageCustomizer：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;error.path:/error&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String path = <span class="string">"/error"</span>;  系统出现错误以后来到error请求进行处理；（web.xml注册的错误页面规则）</span><br></pre></td></tr></table></figure>



<p> 4、DefaultErrorViewResolver：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span></span><br><span class="line"><span class="function"><span class="params">      Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    ModelAndView modelAndView = resolve(String.valueOf(status), model);</span><br><span class="line">    <span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">      modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//默认SpringBoot可以去找到一个页面？  error/404</span></span><br><span class="line">    String errorViewName = <span class="string">"error/"</span> + viewName;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模板引擎可以解析这个页面地址就用模板引擎解析</span></span><br><span class="line">    TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders</span><br><span class="line">        .getProvider(errorViewName, <span class="keyword">this</span>.applicationContext);</span><br><span class="line">    <span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//模板引擎可用的情况下返回到errorViewName指定的视图地址</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">//模板引擎不可用，就在静态资源文件夹下找errorViewName对应的页面   error/404.html</span></span><br><span class="line">    <span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p> 步骤：</p>
<p>   一但系统出现4xx或者5xx之类的错误；ErrorPageCustomizer就会生效（定制错误的响应规则）；就会来到/error请求；就会被<strong>BasicErrorController</strong>处理；</p>
<p>   1）响应页面；去哪个页面是由<strong>DefaultErrorViewResolver</strong>解析得到的；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//所有的ErrorViewResolver得到ModelAndView</span></span><br><span class="line">   <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="keyword">this</span>.errorViewResolvers) &#123;</span><br><span class="line">      ModelAndView modelAndView = resolver.resolveErrorView(request, status, model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> modelAndView;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2）、如果定制错误响应："><a href="#2）、如果定制错误响应：" class="headerlink" title="2）、如果定制错误响应："></a>2）、如果定制错误响应：</h3><h4 id="1）、如何定制错误的页面；"><a href="#1）、如何定制错误的页面；" class="headerlink" title="1）、如何定制错误的页面；"></a><strong>1）、如何定制错误的页面；</strong></h4><p>​     <strong>1）、有模板引擎的情况下；error/状态码;</strong> 【将错误页面命名为  错误状态码.html 放在模板引擎文件夹里面的 error文件夹下】，发生此状态码的错误就会来到  对应的页面；</p>
<p>​     我们可以使用4xx和5xx作为错误页面的文件名来匹配这种类型的所有错误，精确优先（优先寻找精确的状态码.html）；    </p>
<p>​     页面能获取的信息；</p>
<p>​       timestamp：时间戳</p>
<p>​       status：状态码</p>
<p>​       error：错误提示</p>
<p>​       exception：异常对象</p>
<p>​       message：异常消息</p>
<p>​       errors：JSR303数据校验的错误都在这里</p>
<p>​     2）、没有模板引擎（模板引擎找不到这个错误页面），静态资源文件夹下找；</p>
<p>​     3）、以上都没有错误页面，就是默认来到SpringBoot默认的错误提示页面；</p>
<h4 id="2）、如何定制错误的json数据；"><a href="#2）、如何定制错误的json数据；" class="headerlink" title="2）、如何定制错误的json数据；"></a>2）、如何定制错误的json数据；</h4><p>   1）、自定义异常处理&amp;返回定制json数据；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UserNotExistException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Map</span>&lt;<span class="title">String</span>,<span class="title">Object</span>&gt; <span class="title">handleException</span>(<span class="title">Exception</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//没有自适应效果...</span></span><br></pre></td></tr></table></figure>



<p>   2）、转发到/error进行自适应响应效果处理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span>(UserNotExistException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">   <span class="title">public</span> <span class="title">String</span> <span class="title">handleException</span>(<span class="title">Exception</span> <span class="title">e</span>, <span class="title">HttpServletRequest</span> <span class="title">request</span>)</span>&#123;</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">       <span class="comment">//传入我们自己的错误状态码  4xx 5xx，否则就不会进入定制错误页面的解析流程</span></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Integer statusCode = (Integer) request</span></span><br><span class="line"><span class="comment">        .getAttribute("javax.servlet.error.status_code");</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">500</span>);</span><br><span class="line">       map.put(<span class="string">"code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">       map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">       <span class="comment">//转发到/error</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3）、将我们的定制数据携带出去；"><a href="#3）、将我们的定制数据携带出去；" class="headerlink" title="3）、将我们的定制数据携带出去；"></a>3）、将我们的定制数据携带出去；</h4><p>出现错误以后，会来到/error请求，会被BasicErrorController处理，响应出去可以获取的数据是由getErrorAttributes得到的（是AbstractErrorController（ErrorController）规定的方法）；</p>
<p> 1、完全来编写一个ErrorController的实现类【或者是编写AbstractErrorController的子类】，放在容器中；</p>
<p> 2、页面上能用的数据，或者是json返回能用的数据都是通过errorAttributes.getErrorAttributes得到；</p>
<p>​     容器中DefaultErrorAttributes.getErrorAttributes()；默认进行数据处理的；</p>
<p>自定义ErrorAttributes</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//给容器中加入我们自己定义的ErrorAttributes</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">super</span>.getErrorAttributes(requestAttributes, includeStackTrace);</span><br><span class="line">        map.put(<span class="string">"company"</span>,<span class="string">"atguigu"</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终的效果：响应是自适应的，可以通过定制ErrorAttributes改变需要返回的内容，</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180228135513.png" alt></p>
<h2 id="8、配置嵌入式Servlet容器"><a href="#8、配置嵌入式Servlet容器" class="headerlink" title="8、配置嵌入式Servlet容器"></a>8、配置嵌入式Servlet容器</h2><p>SpringBoot默认使用Tomcat作为嵌入式的Servlet容器；</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180301142915.png" alt></p>
<p>问题？</p>
<h3 id="1）、如何定制和修改Servlet容器的相关配置；"><a href="#1）、如何定制和修改Servlet容器的相关配置；" class="headerlink" title="1）、如何定制和修改Servlet容器的相关配置；"></a>1）、如何定制和修改Servlet容器的相关配置；</h3><p>1、修改和server有关的配置（ServerProperties【也是EmbeddedServletContainerCustomizer】）；</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="meta">server.context-path</span>=<span class="string">/crud</span></span><br><span class="line"></span><br><span class="line"><span class="meta">server.tomcat.uri-encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//通用的Servlet容器设置</span></span><br><span class="line"><span class="attr">server.xxx</span></span><br><span class="line"><span class="attr">//Tomcat的设置</span></span><br><span class="line"><span class="attr">server.tomcat.xxx</span></span><br></pre></td></tr></table></figure>

<p>2、编写一个<strong>EmbeddedServletContainerCustomizer</strong>：嵌入式的Servlet容器的定制器；来修改Servlet容器的配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  <span class="comment">//一定要将这个定制器加入到容器中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> EmbeddedServletContainerCustomizer <span class="title">embeddedServletContainerCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedServletContainerCustomizer() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定制嵌入式的Servlet容器相关的规则</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableEmbeddedServletContainer container)</span> </span>&#123;</span><br><span class="line">            container.setPort(<span class="number">8083</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2）、注册Servlet三大组件【Servlet、Filter、Listener】"><a href="#2）、注册Servlet三大组件【Servlet、Filter、Listener】" class="headerlink" title="2）、注册Servlet三大组件【Servlet、Filter、Listener】"></a>2）、注册Servlet三大组件【Servlet、Filter、Listener】</h3><p>由于SpringBoot默认是以jar包的方式启动嵌入式的Servlet容器来启动SpringBoot的web应用，没有web.xml文件。</p>
<p>注册三大组件用以下方式</p>
<p>ServletRegistrationBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//注册三大组件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">myServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ServletRegistrationBean registrationBean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> MyServlet(),<span class="string">"/myServlet"</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FilterRegistrationBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">myFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FilterRegistrationBean registrationBean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">    registrationBean.setFilter(<span class="keyword">new</span> MyFilter());</span><br><span class="line">    registrationBean.setUrlPatterns(Arrays.asList(<span class="string">"/hello"</span>,<span class="string">"/myServlet"</span>));</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServletListenerRegistrationBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title">myListener</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = <span class="keyword">new</span> ServletListenerRegistrationBean&lt;&gt;(<span class="keyword">new</span> MyListener());</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SpringBoot帮我们自动SpringMVC的时候，自动的注册SpringMVC的前端控制器；DIspatcherServlet；</p>
<p>DispatcherServletAutoConfiguration中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)</span><br><span class="line"><span class="meta">@ConditionalOnBean</span>(value = DispatcherServlet<span class="class">.<span class="keyword">class</span>, <span class="title">name</span> </span>= DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">dispatcherServletRegistration</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      DispatcherServlet dispatcherServlet)</span> </span>&#123;</span><br><span class="line">   ServletRegistrationBean registration = <span class="keyword">new</span> ServletRegistrationBean(</span><br><span class="line">         dispatcherServlet, <span class="keyword">this</span>.serverProperties.getServletMapping());</span><br><span class="line">    <span class="comment">//默认拦截： /  所有请求；包静态资源，但是不拦截jsp请求；   /*会拦截jsp</span></span><br><span class="line">    <span class="comment">//可以通过server.servletPath来修改SpringMVC前端控制器默认拦截的请求路径</span></span><br><span class="line">    </span><br><span class="line">   registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);</span><br><span class="line">   registration.setLoadOnStartup(</span><br><span class="line">         <span class="keyword">this</span>.webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">this</span>.multipartConfig != <span class="keyword">null</span>) &#123;</span><br><span class="line">      registration.setMultipartConfig(<span class="keyword">this</span>.multipartConfig);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）、SpringBoot能不能支持其他的Servlet容器；</p>
<h3 id="3）、替换为其他嵌入式Servlet容器"><a href="#3）、替换为其他嵌入式Servlet容器" class="headerlink" title="3）、替换为其他嵌入式Servlet容器"></a>3）、替换为其他嵌入式Servlet容器</h3><p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302114401.png" alt></p>
<p>默认支持：</p>
<p>Tomcat（默认使用）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   引入web模块默认就是使用嵌入式的Tomcat作为Servlet容器；</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Jetty</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Undertow</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4）、嵌入式Servlet容器自动配置原理；"><a href="#4）、嵌入式Servlet容器自动配置原理；" class="headerlink" title="4）、嵌入式Servlet容器自动配置原理；"></a>4）、嵌入式Servlet容器自动配置原理；</h3><p>EmbeddedServletContainerAutoConfiguration：嵌入式的Servlet容器自动配置？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder</span>(Ordered.HIGHEST_PRECEDENCE)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@Import</span>(BeanPostProcessorsRegistrar<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">//导入<span class="title">BeanPostProcessorsRegistrar</span>：<span class="title">Spring</span>注解版；给容器中导入一些组件</span></span><br><span class="line"><span class="class">//导入了<span class="title">EmbeddedServletContainerCustomizerBeanPostProcessor</span>：</span></span><br><span class="line"><span class="class">//后置处理器：<span class="title">bean</span>初始化前后（创建完对象，还没赋值赋值）执行初始化工作</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">EmbeddedServletContainerAutoConfiguration</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">  <span class="meta">@ConditionalOnClass</span>(&#123; Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">Tomcat</span>.<span class="title">class</span> &#125;)//判断当前是否引入了<span class="title">Tomcat</span>依赖；</span></span><br><span class="line"><span class="class">  @<span class="title">ConditionalOnMissingBean</span>(<span class="title">value</span> </span>= EmbeddedServletContainerFactory<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)<span class="comment">//判断当前容器没有用户自己定义EmbeddedServletContainerFactory：嵌入式的Servlet容器工厂；作用：创建嵌入式的Servlet容器</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EmbeddedTomcat</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TomcatEmbeddedServletContainerFactory <span class="title">tomcatEmbeddedServletContainerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> TomcatEmbeddedServletContainerFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Nested configuration if Jetty is being used.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Configuration</span></span><br><span class="line">  <span class="meta">@ConditionalOnClass</span>(&#123; Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">Server</span>.<span class="title">class</span>, <span class="title">Loader</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">      <span class="title">WebAppContext</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">  @<span class="title">ConditionalOnMissingBean</span>(<span class="title">value</span> </span>= EmbeddedServletContainerFactory<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EmbeddedJetty</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JettyEmbeddedServletContainerFactory <span class="title">jettyEmbeddedServletContainerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> JettyEmbeddedServletContainerFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Nested configuration if Undertow is being used.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Configuration</span></span><br><span class="line">  <span class="meta">@ConditionalOnClass</span>(&#123; Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">Undertow</span>.<span class="title">class</span>, <span class="title">SslClientAuthMode</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">  @<span class="title">ConditionalOnMissingBean</span>(<span class="title">value</span> </span>= EmbeddedServletContainerFactory<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EmbeddedUndertow</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UndertowEmbeddedServletContainerFactory <span class="title">undertowEmbeddedServletContainerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UndertowEmbeddedServletContainerFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>1）、EmbeddedServletContainerFactory（嵌入式Servlet容器工厂）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmbeddedServletContainerFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取嵌入式的Servlet容器</span></span><br><span class="line">   <span class="function">EmbeddedServletContainer <span class="title">getEmbeddedServletContainer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">         ServletContextInitializer... initializers)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144835.png" alt></p>
<p>2）、EmbeddedServletContainer：（嵌入式的Servlet容器）</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144910.png" alt></p>
<p>3）、以<strong>TomcatEmbeddedServletContainerFactory</strong>为例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> EmbeddedServletContainer <span class="title">getEmbeddedServletContainer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      ServletContextInitializer... initializers)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个Tomcat</span></span><br><span class="line">   Tomcat tomcat = <span class="keyword">new</span> Tomcat();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置Tomcat的基本环节</span></span><br><span class="line">   File baseDir = (<span class="keyword">this</span>.baseDirectory != <span class="keyword">null</span> ? <span class="keyword">this</span>.baseDirectory</span><br><span class="line">         : createTempDir(<span class="string">"tomcat"</span>));</span><br><span class="line">   tomcat.setBaseDir(baseDir.getAbsolutePath());</span><br><span class="line">   Connector connector = <span class="keyword">new</span> Connector(<span class="keyword">this</span>.protocol);</span><br><span class="line">   tomcat.getService().addConnector(connector);</span><br><span class="line">   customizeConnector(connector);</span><br><span class="line">   tomcat.setConnector(connector);</span><br><span class="line">   tomcat.getHost().setAutoDeploy(<span class="keyword">false</span>);</span><br><span class="line">   configureEngine(tomcat.getEngine());</span><br><span class="line">   <span class="keyword">for</span> (Connector additionalConnector : <span class="keyword">this</span>.additionalTomcatConnectors) &#123;</span><br><span class="line">      tomcat.getService().addConnector(additionalConnector);</span><br><span class="line">   &#125;</span><br><span class="line">   prepareContext(tomcat.getHost(), initializers);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将配置好的Tomcat传入进去，返回一个EmbeddedServletContainer；并且启动Tomcat服务器</span></span><br><span class="line">   <span class="keyword">return</span> getTomcatEmbeddedServletContainer(tomcat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4）、我们对嵌入式容器的配置修改是怎么生效？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ServerProperties、EmbeddedServletContainerCustomizer</span><br></pre></td></tr></table></figure>



<p><strong>EmbeddedServletContainerCustomizer</strong>：定制器帮我们修改了Servlet容器的配置？</p>
<p>怎么修改的原理？</p>
<p>5）、容器中导入了<strong>EmbeddedServletContainerCustomizerBeanPostProcessor</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//初始化之前</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="comment">//如果当前初始化的是一个ConfigurableEmbeddedServletContainer类型的组件</span></span><br><span class="line">   <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ConfigurableEmbeddedServletContainer) &#123;</span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      postProcessBeforeInitialization((ConfigurableEmbeddedServletContainer) bean);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postProcessBeforeInitialization</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      ConfigurableEmbeddedServletContainer bean)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取所有的定制器，调用每一个定制器的customize方法来给Servlet容器进行属性赋值；</span></span><br><span class="line">    <span class="keyword">for</span> (EmbeddedServletContainerCustomizer customizer : getCustomizers()) &#123;</span><br><span class="line">        customizer.customize(bean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Collection&lt;EmbeddedServletContainerCustomizer&gt; <span class="title">getCustomizers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.customizers == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Look up does not include the parent context</span></span><br><span class="line">        <span class="keyword">this</span>.customizers = <span class="keyword">new</span> ArrayList&lt;EmbeddedServletContainerCustomizer&gt;(</span><br><span class="line">            <span class="keyword">this</span>.beanFactory</span><br><span class="line">            <span class="comment">//从容器中获取所有这葛类型的组件：EmbeddedServletContainerCustomizer</span></span><br><span class="line">            <span class="comment">//定制Servlet容器，给容器中可以添加一个EmbeddedServletContainerCustomizer类型的组件</span></span><br><span class="line">            .getBeansOfType(EmbeddedServletContainerCustomizer<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">                            <span class="title">false</span>, <span class="title">false</span>)</span></span><br><span class="line"><span class="class">            .<span class="title">values</span>())</span>;</span><br><span class="line">        Collections.sort(<span class="keyword">this</span>.customizers, AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">        <span class="keyword">this</span>.customizers = Collections.unmodifiableList(<span class="keyword">this</span>.customizers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.customizers;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServerProperties也是定制器</span><br></pre></td></tr></table></figure>

<p>步骤：</p>
<p>1）、SpringBoot根据导入的依赖情况，给容器中添加相应的EmbeddedServletContainerFactory【TomcatEmbeddedServletContainerFactory】</p>
<p>2）、容器中某个组件要创建对象就会惊动后置处理器；EmbeddedServletContainerCustomizerBeanPostProcessor；</p>
<p>只要是嵌入式的Servlet容器工厂，后置处理器就工作；</p>
<p>3）、后置处理器，从容器中获取所有的<strong>EmbeddedServletContainerCustomizer</strong>，调用定制器的定制方法</p>
<p>###5）、嵌入式Servlet容器启动原理；</p>
<p>什么时候创建嵌入式的Servlet容器工厂？什么时候获取嵌入式的Servlet容器并启动Tomcat；</p>
<p>获取嵌入式的Servlet容器工厂：</p>
<p>1）、SpringBoot应用启动运行run方法</p>
<p>2）、refreshContext(context);SpringBoot刷新IOC容器【创建IOC容器对象，并初始化容器，创建容器中的每一个组件】；如果是web应用创建<strong>AnnotationConfigEmbeddedWebApplicationContext</strong>，否则：<strong>AnnotationConfigApplicationContext</strong></p>
<p>3）、refresh(context);<strong>刷新刚才创建好的ioc容器；</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">      <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">      prepareRefresh();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">      ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">      prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">         postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">         invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">         registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">         initMessageSource();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">         initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">         onRefresh();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">         registerListeners();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">         finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">         finishRefresh();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">         <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">            logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</span><br><span class="line">                  <span class="string">"cancelling refresh attempt: "</span> + ex);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">         destroyBeans();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Reset 'active' flag.</span></span><br><span class="line">         cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">         <span class="keyword">throw</span> ex;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">// Reset common introspection caches in Spring's core, since we</span></span><br><span class="line">         <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">         resetCommonCaches();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4）、  onRefresh(); web的ioc容器重写了onRefresh方法</p>
<p>5）、webioc容器会创建嵌入式的Servlet容器；<strong>createEmbeddedServletContainer</strong>();</p>
<p><strong>6）、获取嵌入式的Servlet容器工厂：</strong></p>
<p>EmbeddedServletContainerFactory containerFactory = getEmbeddedServletContainerFactory();</p>
<p> 从ioc容器中获取EmbeddedServletContainerFactory 组件；<strong>TomcatEmbeddedServletContainerFactory</strong>创建对象，后置处理器一看是这个对象，就获取所有的定制器来先定制Servlet容器的相关配置；</p>
<p>7）、<strong>使用容器工厂获取嵌入式的Servlet容器</strong>：this.embeddedServletContainer = containerFactory      .getEmbeddedServletContainer(getSelfInitializer());</p>
<p>8）、嵌入式的Servlet容器创建对象并启动Servlet容器；</p>
<p><strong>先启动嵌入式的Servlet容器，再将ioc容器中剩下没有创建出的对象获取出来；</strong></p>
<p><strong>==IOC容器启动创建嵌入式的Servlet容器==</strong></p>
<h2 id="9、使用外置的Servlet容器"><a href="#9、使用外置的Servlet容器" class="headerlink" title="9、使用外置的Servlet容器"></a>9、使用外置的Servlet容器</h2><p>嵌入式Servlet容器：应用打成可执行的jar</p>
<p>   优点：简单、便携；</p>
<p>   缺点：默认不支持JSP、优化定制比较复杂（使用定制器【ServerProperties、自定义EmbeddedServletContainerCustomizer】，自己编写嵌入式Servlet容器的创建工厂【EmbeddedServletContainerFactory】）；</p>
<p>外置的Servlet容器：外面安装Tomcat—应用war包的方式打包；</p>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1）、必须创建一个war项目；（利用idea创建好目录结构）</p>
<p>2）、将嵌入式的Tomcat指定为provided；</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3）、必须编写一个<strong>SpringBootServletInitializer</strong>的子类，并调用configure方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletInitializer</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//传入SpringBoot应用的主程序</span></span><br><span class="line">      <span class="keyword">return</span> application.sources(SpringBoot04WebJspApplication<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4）、启动服务器就可以使用；</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>jar包：执行SpringBoot主类的main方法，启动ioc容器，创建嵌入式的Servlet容器；</p>
<p>war包：启动服务器，<strong>服务器启动SpringBoot应用</strong>【SpringBootServletInitializer】，启动ioc容器；</p>
<p>servlet3.0（Spring注解版）：</p>
<p>8.2.4 Shared libraries / runtimes pluggability：</p>
<p>规则：</p>
<p> 1）、服务器启动（web应用启动）会创建当前web应用里面每一个jar包里面ServletContainerInitializer实例：</p>
<p> 2）、ServletContainerInitializer的实现放在jar包的META-INF/services文件夹下，有一个名为javax.servlet.ServletContainerInitializer的文件，内容就是ServletContainerInitializer的实现类的全类名</p>
<p> 3）、还可以使用@HandlesTypes，在应用启动的时候加载我们感兴趣的类；</p>
<p>流程：</p>
<p>1）、启动Tomcat</p>
<p>2）、org\springframework\spring-web\4.3.14.RELEASE\spring-web-4.3.14.RELEASE.jar!\META-INF\services\javax.servlet.ServletContainerInitializer：</p>
<p>Spring的web模块里面有这个文件：<strong>org.springframework.web.SpringServletContainerInitializer</strong></p>
<p>3）、SpringServletContainerInitializer将@HandlesTypes(WebApplicationInitializer.class)标注的所有这个类型的类都传入到onStartup方法的Set&lt;Class&lt;?&gt;&gt;；为这些WebApplicationInitializer类型的类创建实例；</p>
<p>4）、每一个WebApplicationInitializer都调用自己的onStartup；</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302221835.png" alt></p>
<p>5）、相当于我们的SpringBootServletInitializer的类会被创建对象，并执行onStartup方法</p>
<p>6）、SpringBootServletInitializer实例执行onStartup的时候会createRootApplicationContext；创建容器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> WebApplicationContext <span class="title">createRootApplicationContext</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1、创建SpringApplicationBuilder</span></span><br><span class="line">   SpringApplicationBuilder builder = createSpringApplicationBuilder();</span><br><span class="line">   StandardServletEnvironment environment = <span class="keyword">new</span> StandardServletEnvironment();</span><br><span class="line">   environment.initPropertySources(servletContext, <span class="keyword">null</span>);</span><br><span class="line">   builder.environment(environment);</span><br><span class="line">   builder.main(getClass());</span><br><span class="line">   ApplicationContext parent = getExistingRootWebApplicationContext(servletContext);</span><br><span class="line">   <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.logger.info(<span class="string">"Root context already created (using as parent)."</span>);</span><br><span class="line">      servletContext.setAttribute(</span><br><span class="line">            WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="keyword">null</span>);</span><br><span class="line">      builder.initializers(<span class="keyword">new</span> ParentContextApplicationContextInitializer(parent));</span><br><span class="line">   &#125;</span><br><span class="line">   builder.initializers(</span><br><span class="line">         <span class="keyword">new</span> ServletContextApplicationContextInitializer(servletContext));</span><br><span class="line">   builder.contextClass(AnnotationConfigEmbeddedWebApplicationContext<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//调用configure方法，子类重写了这个方法，将SpringBoot的主程序类传入了进来</span></span><br><span class="line">   builder = configure(builder);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用builder创建一个Spring应用</span></span><br><span class="line">   SpringApplication application = builder.build();</span><br><span class="line">   <span class="keyword">if</span> (application.getSources().isEmpty() &amp;&amp; AnnotationUtils</span><br><span class="line">         .findAnnotation(getClass(), Configuration<span class="class">.<span class="keyword">class</span>) !</span>= <span class="keyword">null</span>) &#123;</span><br><span class="line">      application.getSources().add(getClass());</span><br><span class="line">   &#125;</span><br><span class="line">   Assert.state(!application.getSources().isEmpty(),</span><br><span class="line">         <span class="string">"No SpringApplication sources have been defined. Either override the "</span></span><br><span class="line">               + <span class="string">"configure method or add an @Configuration annotation"</span>);</span><br><span class="line">   <span class="comment">// Ensure error pages are registered</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">this</span>.registerErrorPageFilter) &#123;</span><br><span class="line">      application.getSources().add(ErrorPageFilterConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//启动Spring应用</span></span><br><span class="line">   <span class="keyword">return</span> run(application);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7）、Spring的应用就启动并且创建IOC容器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">   StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">   FailureAnalyzers analyzers = <span class="keyword">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">   SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(</span><br><span class="line">            args);</span><br><span class="line">      ConfigurableEnvironment environment = prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">      Banner printedBanner = printBanner(environment);</span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">      analyzers = <span class="keyword">new</span> FailureAnalyzers(context);</span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//刷新IOC容器</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">      listeners.finished(context, <span class="keyword">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">         <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>==启动Servlet容器，再启动SpringBoot应用==</strong></p>
<h1 id="五、Docker"><a href="#五、Docker" class="headerlink" title="五、Docker"></a><strong>五、</strong>Docker</h1><h2 id="1、简介-1"><a href="#1、简介-1" class="headerlink" title="1、简介"></a>1、简介</h2><p><strong>Docker</strong>是一个开源的应用容器引擎；是一个轻量级容器技术；</p>
<p>Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；</p>
<p>运行中的这个镜像称为容器，容器启动是非常快速的。</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145450.png" alt></p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145531.png" alt></p>
<h2 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h2><p>docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；</p>
<p>docker客户端(Client)：连接docker主机进行操作；</p>
<p>docker仓库(Registry)：用来保存各种打包好的软件镜像；</p>
<p>docker镜像(Images)：软件打包好的镜像；放在docker仓库中；</p>
<p>docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用</p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303165113.png" alt></p>
<p>使用Docker的步骤：</p>
<p>1）、安装Docker</p>
<p>2）、去Docker仓库找到这个软件对应的镜像；</p>
<p>3）、使用Docker运行这个镜像，这个镜像就会生成一个Docker容器；</p>
<p>4）、对容器的启动停止就是对软件的启动停止；</p>
<h2 id="3、安装Docker"><a href="#3、安装Docker" class="headerlink" title="3、安装Docker"></a>3、安装Docker</h2><h4 id="1）、安装linux虚拟机"><a href="#1）、安装linux虚拟机" class="headerlink" title="1）、安装linux虚拟机"></a>1）、安装linux虚拟机</h4><p> 1）、VMWare、VirtualBox（安装）；</p>
<p> 2）、导入虚拟机文件centos7-atguigu.ova；</p>
<p> 3）、双击启动linux虚拟机;使用  root/ 123456登陆</p>
<p> 4）、使用客户端连接linux服务器进行命令操作；</p>
<p> 5）、设置虚拟机网络；</p>
<p>   桥接网络===选好网卡====接入网线；</p>
<p> 6）、设置好网络以后使用命令重启虚拟机的网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>

<p> 7）、查看linux的ip地址</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>

<p> 8）、使用客户端连接linux；</p>
<h4 id="2）、在linux虚拟机上安装docker"><a href="#2）、在linux虚拟机上安装docker" class="headerlink" title="2）、在linux虚拟机上安装docker"></a>2）、在linux虚拟机上安装docker</h4><p>步骤：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、检查内核版本，必须是3.10及以上</span><br><span class="line">uname -r</span><br><span class="line">2、安装docker</span><br><span class="line">yum install docker</span><br><span class="line">3、输入y确认安装</span><br><span class="line">4、启动docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line">[root@localhost ~]# docker -v</span><br><span class="line">Docker version 1.12.6, build 3e8e77d/1.12.6</span><br><span class="line">5、开机启动docker</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">6、停止docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<h2 id="4、Docker常用命令-amp-操作"><a href="#4、Docker常用命令-amp-操作" class="headerlink" title="4、Docker常用命令&amp;操作"></a>4、Docker常用命令&amp;操作</h2><h3 id="1）、镜像操作"><a href="#1）、镜像操作" class="headerlink" title="1）、镜像操作"></a>1）、镜像操作</h3><table>
<thead>
<tr>
<th>操作</th>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>检索</td>
<td>docker  search 关键字  eg：docker  search redis</td>
<td>我们经常去docker  hub上检索镜像的详细信息，如镜像的TAG。</td>
</tr>
<tr>
<td>拉取</td>
<td>docker pull 镜像名:tag</td>
<td>:tag是可选的，tag表示标签，多为软件的版本，默认是latest</td>
</tr>
<tr>
<td>列表</td>
<td>docker images</td>
<td>查看所有本地镜像</td>
</tr>
<tr>
<td>删除</td>
<td>docker rmi image-id</td>
<td>删除指定的本地镜像</td>
</tr>
</tbody></table>
<p><a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p>
<h3 id="2）、容器操作"><a href="#2）、容器操作" class="headerlink" title="2）、容器操作"></a>2）、容器操作</h3><p>软件镜像（QQ安装程序）—-运行镜像—-产生一个容器（正在运行的软件，运行的QQ）；</p>
<p>步骤：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、搜索镜像</span><br><span class="line">[root@localhost ~]# docker search tomcat</span><br><span class="line">2、拉取镜像</span><br><span class="line">[root@localhost ~]# docker pull tomcat</span><br><span class="line">3、根据镜像启动容器</span><br><span class="line">docker run --name mytomcat -d tomcat:latest</span><br><span class="line">4、docker ps  </span><br><span class="line">查看运行中的容器</span><br><span class="line">5、 停止运行中的容器</span><br><span class="line">docker stop  容器的id</span><br><span class="line">6、查看所有的容器</span><br><span class="line">docker ps -a</span><br><span class="line">7、启动容器</span><br><span class="line">docker start 容器id</span><br><span class="line">8、删除一个容器</span><br><span class="line"> docker rm 容器id</span><br><span class="line">9、启动一个做了端口映射的tomcat</span><br><span class="line">[root@localhost ~]# docker run -d -p 8888:8080 tomcat</span><br><span class="line">-d：后台运行</span><br><span class="line">-p: 将主机的端口映射到容器的一个端口    主机端口:容器内部的端口</span><br><span class="line"></span><br><span class="line">10、为了演示简单关闭了linux的防火墙</span><br><span class="line">service firewalld status ；查看防火墙状态</span><br><span class="line">service firewalld stop：关闭防火墙</span><br><span class="line">11、查看容器的日志</span><br><span class="line">docker logs container-name/container-id</span><br><span class="line"></span><br><span class="line">更多命令参看</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/docker/</span><br><span class="line">可以参考每一个镜像的文档</span><br></pre></td></tr></table></figure>



<h3 id="3）、安装MySQL示例"><a href="#3）、安装MySQL示例" class="headerlink" title="3）、安装MySQL示例"></a>3）、安装MySQL示例</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>



<p>错误的启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -d mysql</span><br><span class="line">42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846</span><br><span class="line"></span><br><span class="line">mysql退出了</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES</span><br><span class="line">42f09819908b        mysql               "docker-entrypoint.sh"   34 seconds ago      Exited (1) 33 seconds ago                            mysql01</span><br><span class="line">538bde63e500        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       compassionate_</span><br><span class="line">goldstine</span><br><span class="line">c4f1ac60b3fc        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       lonely_fermi</span><br><span class="line">81ec743a5271        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//错误日志</span><br><span class="line">[root@localhost ~]# docker logs 42f09819908b</span><br><span class="line">error: database is uninitialized and password option is not specified </span><br><span class="line">  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD；这个三个参数必须指定一个</span><br></pre></td></tr></table></figure>

<p>正确的启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b874c56bec49        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</span><br></pre></td></tr></table></figure>

<p>做了端口映射</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ad10e4bc5c6a        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</span><br></pre></td></tr></table></figure>



<p>几个其他的高级操作</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run --name mysql03 -v &#x2F;conf&#x2F;mysql:&#x2F;etc&#x2F;mysql&#x2F;conf.d -e MYSQL_ROOT_PASSWORD&#x3D;my-secret-pw -d mysql:tag</span><br><span class="line">把主机的&#x2F;conf&#x2F;mysql文件夹挂载到 mysqldocker容器的&#x2F;etc&#x2F;mysql&#x2F;conf.d文件夹里面</span><br><span class="line">改mysql的配置文件就只需要把mysql配置文件放在自定义的文件夹下（&#x2F;conf&#x2F;mysql）</span><br><span class="line"></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD&#x3D;my-secret-pw -d mysql:tag --character-set-server&#x3D;utf8mb4 --collation-server&#x3D;utf8mb4_unicode_ci</span><br><span class="line">指定mysql的一些配置参数</span><br></pre></td></tr></table></figure>



<h1 id="六、SpringBoot与数据访问"><a href="#六、SpringBoot与数据访问" class="headerlink" title="六、SpringBoot与数据访问"></a><strong>六、</strong>SpringBoot与数据访问</h1><h2 id="1、JDBC"><a href="#1、JDBC" class="headerlink" title="1、JDBC"></a>1、JDBC</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.15.22:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p> 默认是用org.apache.tomcat.jdbc.pool.DataSource作为数据源；</p>
<p> 数据源的相关配置都在DataSourceProperties里面；</p>
<p>自动配置原理：</p>
<p>org.springframework.boot.autoconfigure.jdbc：</p>
<p>1、参考DataSourceConfiguration，根据配置创建数据源，默认使用Tomcat连接池；可以使用spring.datasource.type指定自定义的数据源类型；</p>
<p>2、SpringBoot默认可以支持；</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">org.apache.tomcat.jdbc.pool.DataSource、HikariDataSource、BasicDataSource、</span><br></pre></td></tr></table></figure>

<p>3、自定义数据源类型</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(DataSource<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(<span class="title">name</span> </span>= <span class="string">"spring.datasource.type"</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">(DataSourceProperties properties)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//使用DataSourceBuilder创建数据源，利用反射创建响应type的数据源，并且绑定相关属性</span></span><br><span class="line">      <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、<strong>DataSourceInitializer：ApplicationListener</strong>；</p>
<p> 作用：</p>
<p>   1）、runSchemaScripts();运行建表语句；</p>
<p>   2）、runDataScripts();运行插入数据的sql语句；</p>
<p>默认只需要将文件命名为：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">schema-*.sql、data-*.sql</span></span><br><span class="line"><span class="attr">默认规则：schema.sql，schema-all.sql；</span></span><br><span class="line"><span class="meta">可以使用</span>   <span class="string"></span></span><br><span class="line">  <span class="attr">schema</span>:<span class="string"></span></span><br><span class="line">      <span class="meta">-</span> <span class="string">classpath:department.sql</span></span><br><span class="line">      <span class="attr">指定位置</span></span><br></pre></td></tr></table></figure>

<p>5、操作数据库：自动配置了JdbcTemplate操作数据库</p>
<h2 id="2、整合Druid数据源"><a href="#2、整合Druid数据源" class="headerlink" title="2、整合Druid数据源"></a>2、整合Druid数据源</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">导入druid数据源</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druid</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span>  <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置Druid的监控</span></span><br><span class="line">    <span class="comment">//1、配置一个管理后台的Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(), <span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        initParams.put(<span class="string">"loginUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"loginPassword"</span>,<span class="string">"123456"</span>);</span><br><span class="line">        initParams.put(<span class="string">"allow"</span>,<span class="string">""</span>);<span class="comment">//默认就是允许所有访问</span></span><br><span class="line">        initParams.put(<span class="string">"deny"</span>,<span class="string">"192.168.15.21"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、配置一个web监控的filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FilterRegistrationBean bean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.css,/druid/*"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line"></span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、整合MyBatis"><a href="#3、整合MyBatis" class="headerlink" title="3、整合MyBatis"></a>3、整合MyBatis</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180305194443.png" alt></p>
<p>步骤：</p>
<p> 1）、配置数据源相关属性（见上一节Druid）</p>
<p> 2）、给数据库建表</p>
<p> 3）、创建JavaBean</p>
<h3 id="4）、注解版"><a href="#4）、注解版" class="headerlink" title="4）、注解版"></a>4）、注解版</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//指定这是一个操作数据库的mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>,keyProperty = <span class="string">"id"</span>)</span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into department(departmentName) values(#&#123;departmentName&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问题：</p>
<p>自定义MyBatis的配置规则；给容器中添加一个ConfigurationCustomizer；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigurationCustomizer <span class="title">configurationCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConfigurationCustomizer()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Configuration configuration)</span> </span>&#123;</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">使用MapperScan批量扫描所有的Mapper接口；</span><br><span class="line"><span class="meta">@MapperScan</span>(value = <span class="string">"com.atguigu.springboot.mapper"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot06DataMybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(SpringBoot06DataMybatisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5）、配置文件版"><a href="#5）、配置文件版" class="headerlink" title="5）、配置文件版"></a>5）、配置文件版</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="string">指定全局配置文件的位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="string">指定sql映射文件的位置</span></span><br></pre></td></tr></table></figure>

<p>更多使用参照</p>
<p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="noopener">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p>
<h2 id="4、整合SpringData-JPA"><a href="#4、整合SpringData-JPA" class="headerlink" title="4、整合SpringData JPA"></a>4、整合SpringData JPA</h2><h3 id="1）、SpringData简介"><a href="#1）、SpringData简介" class="headerlink" title="1）、SpringData简介"></a>1）、SpringData简介</h3><p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306105412.png" alt></p>
<h3 id="2）、整合SpringData-JPA"><a href="#2）、整合SpringData-JPA" class="headerlink" title="2）、整合SpringData JPA"></a>2）、整合SpringData JPA</h3><p>JPA:ORM（Object Relational Mapping）；</p>
<p>1）、编写一个实体类（bean）和数据表进行映射，并且配置好映射关系；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用JPA注解配置映射关系</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//告诉JPA这是一个实体类（和数据表映射的类）</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tbl_user"</span>) <span class="comment">//@Table来指定和哪个数据表对应;如果省略默认表名就是user；</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//这是一个主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)<span class="comment">//自增主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"last_name"</span>,length = <span class="number">50</span>) <span class="comment">//这是和数据表对应的一个列</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="meta">@Column</span> <span class="comment">//省略默认列名就是属性名</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br></pre></td></tr></table></figure>

<p>2）、编写一个Dao接口来操作实体类对应的数据表（Repository）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//继承JpaRepository来完成对数据库的操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3）、基本的配置JpaProperties</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"> <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line"><span class="comment">#     更新或者创建数据表结构</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#    控制台显示SQL</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>



<h1 id="七、启动配置原理"><a href="#七、启动配置原理" class="headerlink" title="七、启动配置原理"></a><strong>七、</strong>启动配置原理</h1><p>几个重要的事件回调机制</p>
<p>配置在META-INF/spring.factories</p>
<p><strong>ApplicationContextInitializer</strong></p>
<p><strong>SpringApplicationRunListener</strong></p>
<p>只需要放在ioc容器中</p>
<p><strong>ApplicationRunner</strong></p>
<p><strong>CommandLineRunner</strong></p>
<p>启动流程：</p>
<h2 id="1、创建SpringApplication对象"><a href="#1、创建SpringApplication对象" class="headerlink" title="1、创建SpringApplication对象"></a><strong>1、创建SpringApplication对象</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">initialize(sources);</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Object[] sources)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//保存主配置类</span></span><br><span class="line">    <span class="keyword">if</span> (sources != <span class="keyword">null</span> &amp;&amp; sources.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.sources.addAll(Arrays.asList(sources));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断当前是否一个web应用</span></span><br><span class="line">    <span class="keyword">this</span>.webEnvironment = deduceWebEnvironment();</span><br><span class="line">    <span class="comment">//从类路径下找到META-INF/spring.factories配置的所有ApplicationContextInitializer；然后保存起来</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(</span><br><span class="line">        ApplicationContextInitializer<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">    <span class="comment">//从类路径下找到ETA-INF/spring.factories配置的所有ApplicationListener</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">    <span class="comment">//从多个配置类中找到有main方法的主配置类</span></span><br><span class="line">    <span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145727.png" alt></p>
<p><img src="/2020/02/14/springboot-01/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145855.png" alt></p>
<h2 id="2、运行run方法"><a href="#2、运行run方法" class="headerlink" title="2、运行run方法"></a>2、运行run方法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">   StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">   FailureAnalyzers analyzers = <span class="keyword">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//获取SpringApplicationRunListeners；从类路径下META-INF/spring.factories</span></span><br><span class="line">   SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">    <span class="comment">//回调所有的获取SpringApplicationRunListener.starting()方法</span></span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">//封装命令行参数</span></span><br><span class="line">      ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(</span><br><span class="line">            args);</span><br><span class="line">      <span class="comment">//准备环境</span></span><br><span class="line">      ConfigurableEnvironment environment = prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">          <span class="comment">//创建环境完成后回调SpringApplicationRunListener.environmentPrepared()；表示环境准备完成</span></span><br><span class="line">       </span><br><span class="line">      Banner printedBanner = printBanner(environment);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//创建ApplicationContext；决定创建web的ioc还是普通的ioc</span></span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">       </span><br><span class="line">      analyzers = <span class="keyword">new</span> FailureAnalyzers(context);</span><br><span class="line">       <span class="comment">//准备上下文环境;将environment保存到ioc中；而且applyInitializers()；</span></span><br><span class="line">       <span class="comment">//applyInitializers()：回调之前保存的所有的ApplicationContextInitializer的initialize方法</span></span><br><span class="line">       <span class="comment">//回调所有的SpringApplicationRunListener的contextPrepared()；</span></span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       <span class="comment">//prepareContext运行完成以后回调所有的SpringApplicationRunListener的contextLoaded（）；</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">//s刷新容器；ioc容器初始化（如果是web应用还会创建嵌入式的Tomcat）；Spring注解版</span></span><br><span class="line">       <span class="comment">//扫描，创建，加载所有组件的地方；（配置类，组件，自动配置）</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">       <span class="comment">//从ioc容器中获取所有的ApplicationRunner和CommandLineRunner进行回调</span></span><br><span class="line">       <span class="comment">//ApplicationRunner先回调，CommandLineRunner再回调</span></span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">       <span class="comment">//所有的SpringApplicationRunListener回调finished方法</span></span><br><span class="line">      listeners.finished(context, <span class="keyword">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">         <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="comment">//整个SpringBoot应用启动完成以后返回启动的ioc容器；</span></span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、事件监听机制"><a href="#3、事件监听机制" class="headerlink" title="3、事件监听机制"></a>3、事件监听机制</h2><p>配置在META-INF/spring.factories</p>
<p><strong>ApplicationContextInitializer</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title">ApplicationContextInitializer</span>&lt;<span class="title">ConfigurableApplicationContext</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ApplicationContextInitializer...initialize..."</span>+applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SpringApplicationRunListener</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloSpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title">SpringApplicationRunListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//必须有的构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloSpringApplicationRunListener</span><span class="params">(SpringApplication application, String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">starting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...starting..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span class="line">        Object o = environment.getSystemProperties().get(<span class="string">"os.name"</span>);</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...environmentPrepared.."</span>+o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextPrepared..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextLoaded..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finished</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...finished..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置（META-INF/spring.factories）</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="attr">com.atguigu.springboot.listener.HelloApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.boot.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="attr">com.atguigu.springboot.listener.HelloSpringApplicationRunListener</span></span><br></pre></td></tr></table></figure>





<p>只需要放在ioc容器中</p>
<p><strong>ApplicationRunner</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApplicationRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ApplicationRunner...run...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>CommandLineRunner</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloCommandLineRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"CommandLineRunner...run..."</span>+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="八、自定义starter"><a href="#八、自定义starter" class="headerlink" title="八、自定义starter"></a><strong>八、</strong>自定义starter</h1><p>starter：</p>
<p> 1、这个场景需要使用到的依赖是什么？</p>
<p> 2、如何编写自动配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//指定这个类是一个配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnXXX</span>  <span class="comment">//在指定条件成立的情况下自动配置类生效</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>  <span class="comment">//指定自动配置类的顺序</span></span><br><span class="line"><span class="meta">@Bean</span>  <span class="comment">//给容器中添加组件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationPropertie</span>结合相关xxxProperties类来绑定相关的配置</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span> <span class="comment">//让xxxProperties生效加入到容器中</span></span><br><span class="line"></span><br><span class="line">自动配置类要能加载</span><br><span class="line">将需要启动就加载的自动配置类，配置在META-INF/spring.factories</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br></pre></td></tr></table></figure>

<p> 3、模式：</p>
<p>启动器只用来做依赖导入；</p>
<p>专门来写一个自动配置模块；</p>
<p>启动器依赖自动配置；别人只需要引入启动器（starter）</p>
<p>mybatis-spring-boot-starter；自定义启动器名-spring-boot-starter</p>
<p>步骤：</p>
<p>1）、启动器模块</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--启动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--引入自动配置模块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2）、自动配置模块</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--引入spring-boot-starter；所有starter的基本配置--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"atguigu.hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuffix</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloProperties <span class="title">getHelloProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHellAtguigu</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix()+<span class="string">"-"</span> +name + helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//web应用才生效</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(HelloProperties<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">HelloServiceAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HelloService service = <span class="keyword">new</span> HelloService();</span><br><span class="line">        service.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="九、-整合示例"><a href="#九、-整合示例" class="headerlink" title="九、 整合示例"></a><strong>九、</strong> 整合示例</h1>]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>极简系列教程之一 Typora</title>
    <url>/2020/02/14/typora-manual/</url>
    <content><![CDATA[<p>Typora gives you a seamless experience as both a reader and a writer. It removes the preview window, mode switcher, syntax symbols of markdown source code, and all other unnecessary distractions. Instead, it provide a real live preview feature to help you concentrate on the content itself.</p>
<a id="more"></a>







<p>[toc]</p>
<h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6><blockquote>
<p>引用内容1<br>引用内容2</p>
<blockquote>
<p>引用内容3</p>
</blockquote>
</blockquote>
<p><code>String str1 = &quot;hello&quot;;</code></p>
<p>​<del>~<br>​```<br>​</del>java<br>​```c</p>
<p>int a = 10;<br>int b = 20;</p>
<ul>
<li>无序列表1</li>
</ul>
<ul>
<li>无序列表2</li>
</ul>
<ul>
<li>无序列表3</li>
</ul>
<ul>
<li>多行无序列表1<br>TAB * 多行无序列表2<br>TAB TAB * 多行无序列表3</li>
</ul>
<ol>
<li>有序列表1</li>
<li>有序列表2</li>
<li>有序列表3</li>
</ol>
<ol>
<li>多行有序列表1</li>
<li>多行有序列表2<ol>
<li>多行有序列表2-1</li>
<li>多行有序列表2-2</li>
</ol>
</li>
<li>多行有序列表3<ol>
<li>多行有序列表3-1</li>
<li>多行有序列表3-2</li>
</ol>
</li>
</ol>
<p>-[ ] 抽烟<br>-[x] 喝酒<br>-[ ] 烫头</p>
<table>
<thead>
<tr>
<th align="left">姓名</th>
<th align="center">性别</th>
<th align="center">年龄</th>
<th align="right">手机号</th>
</tr>
</thead>
<tbody><tr>
<td align="left">张三</td>
<td align="center">男</td>
<td align="center">21</td>
<td align="right">18975346876</td>
</tr>
<tr>
<td align="left">李四</td>
<td align="center">女</td>
<td align="center">23</td>
<td align="right">17789548964</td>
</tr>
<tr>
<td align="left">王五</td>
<td align="center">男</td>
<td align="center">25</td>
<td align="right">15876513546</td>
</tr>
</tbody></table>
<h3 id="网络图片"><a href="#网络图片" class="headerlink" title="网络图片"></a>网络图片</h3><p><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1581671661492&di=8be0e42e1d3c1bedf19db6aea7fe873b&imgtype=0&src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20170831%2F915e50bdafad40d39195a2441bfa4f8e.jpeg" alt="typora.jpg"></p>
<h3 id="行内式链接"><a href="#行内式链接" class="headerlink" title="行内式链接"></a>行内式链接</h3><p>[百度][<a href="https://www.baidu.com/]" target="_blank" rel="noopener">https://www.baidu.com/]</a></p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p>[CSDN][CSDN网址]<br>[CSDN网址]:<a href="https://www.csdn.net/" target="_blank" rel="noopener">https://www.csdn.net/</a></p>
<h3 id="自动链接"><a href="#自动链接" class="headerlink" title="自动链接"></a>自动链接</h3><p><a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a></p>
<h3 id="斜体"><a href="#斜体" class="headerlink" title="斜体"></a>斜体</h3><p><em>斜体</em><br><em>斜体</em></p>
<h3 id="加粗"><a href="#加粗" class="headerlink" title="加粗"></a>加粗</h3><p><strong>加粗</strong><br><strong>加粗</strong></p>
<h3 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a>下划线</h3><p><u>下划线</u></p>
<h3 id="删除线"><a href="#删除线" class="headerlink" title="删除线"></a>删除线</h3><p><del>删除线</del></p>
<h3 id="鸣谢"><a href="#鸣谢" class="headerlink" title="鸣谢:"></a>鸣谢:</h3><p>[源于网络] <a href="https://www.jianshu.com/p/a6a6a22e9393" target="_blank" rel="noopener">https://www.jianshu.com/p/a6a6a22e9393</a></p>
]]></content>
      <tags>
        <tag>ToolBox</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/02/15/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<a id="more"></a>



<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
</search>
